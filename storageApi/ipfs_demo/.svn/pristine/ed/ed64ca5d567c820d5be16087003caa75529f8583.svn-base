function disableEle(a){cornerstoneTools.probe.deactivate(a,1),cornerstoneTools.wwwc.deactivate(a,1),cornerstoneTools.pan.deactivate(a,1),cornerstoneTools.rotate.deactivate(a,1),cornerstoneTools.zoom.deactivate(a,1),cornerstoneTools.length.deactivate(a,1),cornerstoneTools.ellipticalRoi.deactivate(a,1),cornerstoneTools.rectangleRoi.deactivate(a,1),cornerstoneTools.angle.deactivate(a,1),cornerstoneTools.wwwc.activate(a,4)}function loadAxialSlice(a){function b(){return c}var c=slicesObj.axialObj.imageData,d={imageId:a,minPixelValue:slicesObj.axialObj.minPixelValue,maxPixelValue:slicesObj.axialObj.maxPixelValue,slope:slicesObj.axialObj.slope,intercept:slicesObj.axialObj.intercept,windowCenter:slicesObj.axialObj.windowCenter,windowWidth:slicesObj.axialObj.windowWidth,render:cornerstone.renderGrayscaleImage,getPixelData:b,rows:slicesObj.axialObj.height,columns:slicesObj.axialObj.width,height:slicesObj.axialObj.height,width:slicesObj.axialObj.width,color:!1,columnPixelSpacing:slicesObj.axialObj.columnPixelSpacing,rowPixelSpacing:slicesObj.axialObj.rowPixelSpacing,invert:!1,sizeInBytes:slicesObj.axialObj.columns*slicesObj.axialObj.rows*2},e=$.Deferred();return e.resolve(d),e}function loadCoronalSlice(a){function b(){return c}var c=slicesObj.coronalObj.imageData,d={imageId:a,minPixelValue:slicesObj.coronalObj.minPixelValue,maxPixelValue:slicesObj.coronalObj.maxPixelValue,slope:slicesObj.coronalObj.slope,intercept:slicesObj.coronalObj.intercept,windowCenter:slicesObj.coronalObj.windowCenter,windowWidth:slicesObj.coronalObj.windowWidth,render:cornerstone.renderGrayscaleImage,getPixelData:b,rows:slicesObj.coronalObj.height,columns:slicesObj.coronalObj.width,height:slicesObj.coronalObj.height,width:slicesObj.coronalObj.width,color:!1,columnPixelSpacing:slicesObj.coronalObj.columnPixelSpacing,rowPixelSpacing:slicesObj.coronalObj.rowPixelSpacing,invert:!1,sizeInBytes:slicesObj.coronalObj.columns*slicesObj.coronalObj.rows*2},e=$.Deferred();return e.resolve(d),e}function loadSagttialSlice(a){function b(){return c}var c=slicesObj.sagttialObj.imageData,d={imageId:a,minPixelValue:slicesObj.sagttialObj.minPixelValue,maxPixelValue:slicesObj.sagttialObj.maxPixelValue,slope:slicesObj.sagttialObj.slope,intercept:slicesObj.sagttialObj.intercept,windowCenter:slicesObj.sagttialObj.windowCenter,windowWidth:slicesObj.sagttialObj.windowWidth,render:cornerstone.renderGrayscaleImage,getPixelData:b,rows:slicesObj.sagttialObj.rows,columns:slicesObj.sagttialObj.columns,height:slicesObj.sagttialObj.height,width:slicesObj.sagttialObj.width,color:!1,columnPixelSpacing:slicesObj.sagttialObj.columnPixelSpacing,rowPixelSpacing:slicesObj.sagttialObj.rowPixelSpacing,invert:!1,sizeInBytes:slicesObj.sagttialObj.columns*slicesObj.sagttialObj.rows*2},e=$.Deferred();return e.resolve(d),e}function reLoadImage(a,b){var c=$(".axialSliceOut").get(0),d=$(".coronalSliceOut").get(0),e=$(".sagittalSliceOut").get(0);if(drawAxial(c),drawCoronal(d),drawSagittal(e),$(".viewport").each(function(){$(this).children().each(function(a){a>=1&&$(this).remove()})}),a){var f=$(".magnifyViewport").get(0),g=$(".magnifyViewport").attr("location");"SAGITTAL"==g?drawSagittal(f):"CORONAL"==g?drawCoronal(f):drawAxial(f),$(".magnifyViewport").children().each(function(a){a>=1&&$(this).remove()})}}function drawAxial(a){var b="loadAxialSlice://Axial";slicesObj.axialObj.windowWidth=255,slicesObj.axialObj.windowCenter=128;for(var c=0;c<slicesObj.axialObj.rows*slicesObj.axialObj.columns;c++)slicesObj.axialObj.imageData[c]=slicesObj.axialObj.canvsData.data[4*c];slicesObj.axialObj.maxPixelValue=255,slicesObj.axialObj.minPixelValue=0,cornerstone.enable(a),cornerstone.loadImage(b).done(function(b){cornerstone.displayImage(a,b)}),cornerstoneTools.mouseInput.enable(a),cornerstoneTools.mouseWheelInput.enable(a),cornerstoneTools.wwwc.activate(a,4)}function drawCoronal(a){var b="loadCoronalSlice://Coronal";slicesObj.coronalObj.windowWidth=255,slicesObj.coronalObj.windowCenter=128;for(var c=0;c<slicesObj.coronalObj.rows*slicesObj.coronalObj.columns;c++)slicesObj.coronalObj.imageData[c]=slicesObj.coronalObj.canvsData.data[4*c];slicesObj.coronalObj.maxPixelValue=255,slicesObj.coronalObj.minPixelValue=0,cornerstone.enable(a),cornerstone.loadImage(b).done(function(b){cornerstone.displayImage(a,b)}),cornerstoneTools.mouseInput.enable(a),cornerstoneTools.mouseWheelInput.enable(a),cornerstoneTools.wwwc.activate(a,4)}function drawSagittal(a){var b="loadSagttialSlice://Sagittal";slicesObj.sagttialObj.windowWidth=255,slicesObj.sagttialObj.windowCenter=128;for(var c=0;c<slicesObj.sagttialObj.rows*slicesObj.sagttialObj.columns;c++)slicesObj.sagttialObj.imageData[c]=slicesObj.sagttialObj.canvsData.data[4*c];slicesObj.sagttialObj.maxPixelValue=255,slicesObj.sagttialObj.minPixelValue=0,cornerstone.enable(a),cornerstone.loadImage(b).done(function(b){cornerstone.displayImage(a,b)}),cornerstoneTools.mouseInput.enable(a),cornerstoneTools.mouseWheelInput.enable(a),cornerstoneTools.wwwc.activate(a,4)}function allEleResize(){mesureMode&&$(".viewport").each(function(){var a=$(this).get(0);cornerstone.resize(a,!0),$(this).children().each(function(a){a>=1&&$(this).remove()})})}function mprPlay(){changeSlice(sliceTypeArr[0],"add")}function enableEle(a,b){cornerstoneTools.mouseInput.enable(a),cornerstoneTools.mouseWheelInput.enable(a),cornerstoneTools[b].activate(a,1),$(this).children().each(function(a){a>=1&&$(this).remove()})}function enableAllEle(a){"show"==$(".magnifyBox").attr("state")?$(".magnifyViewport").each(function(){var b=$(this).get(0);cornerstone.enable(b),cornerstoneTools.mouseInput.enable(b),cornerstoneTools.mouseWheelInput.enable(b),disableEle(b),cornerstoneTools.wwwc.activate(b,4),cornerstoneTools[a].activate(b,1),$(this).children().each(function(a){a>=1&&$(this).remove()})}):$(".viewport").each(function(){var b=$(this).get(0);cornerstone.enable(b),cornerstoneTools.mouseInput.enable(b),cornerstoneTools.mouseWheelInput.enable(b),disableEle(b),cornerstoneTools.wwwc.activate(b,4),cornerstoneTools[a].activate(b,1),$(this).children().each(function(a){a>=1&&$(this).remove()})})}function disableAllEle(){$(".viewport").each(function(){var a=$(this).get(0);cornerstoneTools.wwwc.deactivate(a,1),cornerstoneTools.pan.deactivate(a,1),cornerstoneTools.rotate.deactivate(a,1),cornerstoneTools.zoom.deactivate(a,1),cornerstoneTools.length.deactivate(a,1),cornerstoneTools.ellipticalRoi.deactivate(a,1),cornerstoneTools.rectangleRoi.deactivate(a,1),cornerstoneTools.angle.deactivate(a,1),cornerstoneTools.wwwc.activate(a,4),cornerstoneTools.probe.deactivate(a,1)}),"show"==$(".magnifyBox").attr("state")&&$(".magnifyViewport").each(function(){var a=$(this).get(0);disableEle(a),$(this).children().each(function(a){a>=1&&$(this).remove()})})}function clearAllMeasure(){"show"==$(".magnifyBox").attr("state")?$(".magnifyViewport").each(function(){var a=$(this).get(0);cornerstoneTools.clearToolState(a,"length"),cornerstoneTools.clearToolState(a,"rectangleRoi"),cornerstoneTools.clearToolState(a,"ellipticalRoi"),cornerstoneTools.clearToolState(a,"angle"),cornerstoneTools.clearToolState(a,"probe"),cornerstone.updateImage(a),$(this).children().each(function(a){a>=1&&$(this).remove()})}):$(".viewport").each(function(){var a=$(this).get(0);cornerstoneTools.clearToolState(a,"length"),cornerstoneTools.clearToolState(a,"rectangleRoi"),cornerstoneTools.clearToolState(a,"ellipticalRoi"),cornerstoneTools.clearToolState(a,"angle"),cornerstoneTools.clearToolState(a,"probe"),cornerstone.updateImage(a),$(this).children().each(function(a){a>=1&&$(this).remove()})})}function resetAllEle(){"show"==$(".magnifyBox").attr("state")?$(".magnifyViewport").each(function(){var a=$(this).get(0);cornerstone.reset(a),$(this).children().each(function(a){a>=1&&$(this).remove()})}):$(".viewport").each(function(){var a=$(this).get(0);cornerstone.reset(a),$(this).children().each(function(a){a>=1&&$(this).remove()})})}function measureMode(){mesureMode||($(".stopBtn").click(),console.log("re load "),$(".positionTxt").hide(),$(".wwwcBox").show(),$(".wrapperBox").show(),$(".toolM1").show(),mprH(),reLoadImage(),mesureMode=!0)}function magnifySlice(a,b){$(".magnifyBox").attr("state","show"),$(".magnifyBox").show(),$(".magnifyViewport").attr("location",a),$(".magnifyViewport").attr("sliceType",b);var c=$(".magnifyViewport").get(0);"SAGITTAL"==a?drawSagittal(c):"CORONAL"==a?drawCoronal(c):drawAxial(c),$(".magnifyViewport").children().each(function(a){a>=1&&$(this).remove()})}function mprH(){$(".mprMainBox").css("width","90%"),outDivH=$(".mprPatientInfoBox").height()+$(".mprToolBox").height();var a=$(window).height(),b=a-outDivH,c=2*$(".mprImgBox").width()/3;c>=b&&(c=b,$(".mprMainBox").width(1.5*c));var d=$(".topBox .infoBox .title").width()+$(".infoLeftBox").width()+$(".infoRightBox").width()+40,e=$(".mprMainBox").width();d>$(".mprMainBox").width()?$(".infoBox").width(d):$(".infoBox").width(e);var f=c+outDivH;$(".mprImgBox").height(c),$(".mprMainBox").height(f);var g=0;$(".btnBox .btn").each(function(a,b){$(this).is(":hidden")||(g+=$(this).outerWidth()+20)}),$(".btnBox").width(g)}function quickWwwc(a,b){$(".wrapperBox").find(".viewport").each(function(){var c=$(this).get(0),d=cornerstone.getViewport(c);d.voi.windowWidth=a,d.voi.windowCenter=b,cornerstone.setViewport(c,d)})}function enterMprBtn(a){window.parent.$(".table2Body tr .txt").each(function(){if($(this).text()==a){var b=parseInt($(this).parents("tr").find(".wl").text()),c=parseInt($(this).parents("tr").find(".ww").text());console.log("快捷调窗out：",c,b),isNaN(c)||isNaN(b)||($("#windowInput").val(c),$("#centerInput").val(b),quickWwwc(c,b))}})}"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),cornerstoneTools.recognizeR=4,cornerstoneTools.handleR=1,cornerstoneTools.distanceSqR=4,"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(a){"use strict";function b(b){if(void 0===b)throw"disable: element element must not be undefined";for(var c=a.getEnabledElements(),d=0;d<c.length;d++)if(c[d].element===b){var e={element:b};return $(b).trigger("CornerstoneElementDisabled",e),c[d].element.removeChild(c[d].canvas),void c.splice(d,1)}}a.disable=b}(cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,void 0===f.viewport&&(f.viewport=b.internal.getDefaultViewport(f.canvas,d)),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImage=c}($,cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,f.viewport=b.internal.getDefaultViewport(f.canvas,d),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImageForJpg=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);if(void 0===c.image)throw"draw: image has not been loaded yet";b.drawImage(c)}b.draw=c}($,cornerstone),function(a,b){"use strict";function c(){for(var a=b.getEnabledElements(),c=0;c<a.length;c++){var d=a[c];d.invalid===!0&&b.drawImage(d)}}b.drawInvalidated=c}($,cornerstone),function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,invalid:!1,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}a.enable=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}a.getElementData=b,a.removeElementData=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}function e(){return f}var f=[];a.getEnabledElement=b,a.addEnabledElement=c,a.getEnabledElementsByImageId=d,a.getEnabledElements=e}(cornerstone),function(a){"use strict";function b(a){return 0===a.viewport.rotation||180===a.viewport.rotation?{width:a.image.width,height:a.image.height}:{width:a.image.height,height:a.image.width}}function c(c){var d=a.getEnabledElement(c),e=b(d),f=d.canvas.height/e.height,g=d.canvas.width/e.width;g<f?d.viewport.scale=g:d.viewport.scale=f,d.viewport.translation.x=0,d.viewport.translation.y=0,a.updateImage(c)}a.fitToWindow=c}(cornerstone),function(a,b){"use strict";function c(a,c){var d=b.getEnabledElement(a),e=b.internal.getDefaultViewport(d.canvas,c);return e}b.getDefaultViewportForImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);return c.image}b.getImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f){var g=a.getStoredPixels(b,c,d,e,f),h=a.getEnabledElement(b),i=a.internal.getModalityLUT(h.image.slope,h.image.intercept,h.viewport.modalityLUT),j=g.map(i);return j}a.getPixels=b}(cornerstone),function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;k<f;k++)for(var l=0;l<e;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}a.getStoredPixels=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=c.viewport;if(void 0!==d)return{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,fakeColor:d.fakeColor,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip,modalityLUT:d.modalityLUT,voiLUT:d.voiLUT}}a.getViewport=b}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";n=a,c()}function c(){function b(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(o<=n)){for(m.sort(b);o>n;){var c=m[m.length-1];o-=c.sizeInBytes,delete k[c.imageId],c.imagePromise.reject(),m.pop(),$(a).trigger("CornerstoneImageCachePromiseRemoved",{imageId:c.imageId})}var d=a.imageCache.getCacheInfo();$(a).trigger("CornerstoneImageCacheFull",d)}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(k.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,sharedCacheKey:void 0,imagePromise:b,timeStamp:new Date,sizeInBytes:0};k[a]=d,m.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";a.sharedCacheKey?(d.sizeInBytes=a.sizeInBytes,d.sharedCacheKey=a.sharedCacheKey,l[a.sharedCacheKey]?l[a.sharedCacheKey]++:(l[a.sharedCacheKey]=1,o+=d.sizeInBytes)):(d.sizeInBytes=a.sizeInBytes,o+=d.sizeInBytes),c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=k[a];if(void 0!==b)return b.timeStamp=new Date,b.imagePromise}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=k[a];if(void 0===b)throw"removeImagePromise: imageId must not be undefined";return m.splice(m.indexOf(b),1),m.sharedCacheKey?1===l[m.sharedCacheKey]?(o-=b.sizeInBytes,delete l[m.sharedCacheKey]):l[m.sharedCacheKey]--:o-=b.sizeInBytes,delete k[a],h(b.imagePromise,b.imageId),b.imagePromise}function g(){return{maximumSizeInBytes:n,cacheSizeInBytes:o,numberOfImagesCached:m.length}}function h(a,b){a.then(function(c){c.decache&&c.decache(),a.reject(),delete k[b]}).always(function(){delete k[b]})}function i(){for(;m.length>0;){var a=m.pop();h(a.imagePromise,a.imageId)}o=0}function j(a,b){var c=k[a];c&&c.imagePromise.then(function(a){var c=b-a.sizeInBytes;a.sizeInBytes=b,o+=c})}var k={},l={},m=[],n=1073741824,o=0;a.imageCache={putImagePromise:d,getImagePromise:e,removeImagePromise:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:i,cachedImages:m,changeImageIdCacheSize:j}}(cornerstone),function(a,b){"use strict";function c(c){var d,e=c.indexOf(":"),f=c.substring(0,e),g=i[f];return void 0===g||null===g?void 0!==h?d=h(c):void 0:(d=g(c),d.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),d)}function d(a){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadImage: no image loader for imageId";return d}function e(a){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,d),d}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}var h,i={};b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g}($,cornerstone),function(a){"use strict";function b(a){var b=$(a.element).find("canvas").get(0),c=(a.image,b.height/a.image.rows),d=b.width/a.image.columns;return d<c?d:c}function c(c,d){var e=new a.internal.Transform;e.translate(c.canvas.width/2,c.canvas.height/2);var f=c.viewport.rotation;0!==f&&e.rotate(f*Math.PI/180);var g=b(c),h=c.viewport.scale*g,i=c.viewport.scale*g;return c.image.rowPixelSpacing<c.image.columnPixelSpacing?h*=c.image.columnPixelSpacing/c.image.rowPixelSpacing:c.image.columnPixelSpacing<c.image.rowPixelSpacing&&(i*=c.image.rowPixelSpacing/c.image.columnPixelSpacing),e.scale(h,i),0!==f&&e.rotate(-f*Math.PI/180),e.translate(c.viewport.translation.x,c.viewport.translation.y),0!==f&&e.rotate(f*Math.PI/180),void 0!==d&&e.scale(d,d),c.viewport.hflip&&e.scale(-1,1),c.viewport.vflip&&e.scale(1,-1),e.translate(-c.image.width/2,-c.image.height/2),e}a.diy||(a.diy={}),a.diy.iniScaleCal=b,a.internal.calculateTransform=c}(cornerstone),function(a,b){"use strict";function c(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={viewport:b.viewport,element:b.element,image:b.image,enabledElement:b,canvasContext:e,renderTimeInMs:g};a(b.element).trigger("CornerstoneImageRendered",h),b.invalid=!1}b.internal.drawImage=c,b.drawImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f,g){void 0===b.lut&&(b.lut=new Int16Array(b.maxPixelValue-Math.min(b.minPixelValue,0)+1));var h=b.lut,i=b.maxPixelValue,j=b.minPixelValue,k=a.internal.getModalityLUT(b.slope,b.intercept,f),l=a.internal.getVOILUT(c,d,g),m=0;j<0&&(m=j);var n,o,p,q;for(n=b.minPixelValue;n<=i;n++)o=k(n),p=l(o),q=Math.min(Math.max(p,0),255),e?h[n+-m]=Math.round(255-q):h[n+-m]=Math.round(q);return h}function c(a,c,d,e,f,g){if(f||g)return b(a,c,d,e,f,g);void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)+1));var h,i,j,k,l=a.lut,m=a.maxPixelValue,n=a.minPixelValue,o=a.slope,p=a.intercept,q=c,r=d,s=0;if(n<0&&(s=n),e===!0)for(k=a.minPixelValue;k<=m;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(255-j);else for(k=a.minPixelValue;k<=m;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(j)}a.internal.generateLutNew=b,a.internal.generateLut=c,a.generateLutNew=b,a.generateLut=c}(cornerstone),function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,fakeColor:b.fakeColor,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:b.modalityLUT,voiLUT:void 0};return c}a.internal.getDefaultViewport=b,a.getDefaultViewport=b}(cornerstone),function(a){"use strict";function b(b){var c=a.internal.calculateTransform(b);return c}a.internal.getTransform=b}(cornerstone),function(a,b){"use strict";b.drawImage=b.internal.drawImage,b.generateLut=b.internal.generateLut,b.storedPixelDataToCanvasImageData=b.internal.storedPixelDataToCanvasImageData,b.storedColorPixelDataToCanvasImageData=b.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(a){"use strict";function b(a,b){var c=a,d=b;return function(a){return a*c+d}}function c(a){var b=a.lut[0],c=a.lut[a.lut.length-1],d=a.firstValueMapped+a.lut.length;return function(e){return e<a.firstValueMapped?b:e>=d?c:a.lut[e]}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getModalityLUT=d}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;if(d<0)for(;f<g;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;f<g;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}a.internal.storedColorPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(a,b,d,e){var f=a.getPixelData(),g=a.minPixelValue,h=0,i=f.length,j=f,k=b,l=d,m=e;if(m)if("printBack"==m){var n=3;if(g<0)for(;h<i;)l[n-1]=255,l[n-2]=255,l[n-3]=255,l[n]=k[j[h++]+-g],n+=4;else for(;h<i;)l[n-1]=255,l[n-2]=255,l[n-3]=255,l[n]=k[j[h++]],n+=4}else{var n=0;if(g<0)for(;h<i;){var o=c[255-parseInt(k[j[h++]+-g])];l[n++]=o[0],l[n++]=o[1],l[n++]=o[2],l[n++]=255}else for(;h<i;){var o=c[255-parseInt(k[j[h++]])];l[n++]=o[0],l[n++]=o[1],l[n++]=o[2],l[n++]=255}}else{var n=3;if(g<0)for(;h<i;)l[n]=k[j[h++]+-g],n+=4;else for(;h<i;)l[n]=k[j[h++]],n+=4}}var c=[[0,0,0],[4,4,4],[8,0,8],[16,0,16],[20,0,20],[24,0,24],[33,0,33],[37,0,37],[41,0,41],[44,0,44],[49,0,49],[53,0,53],[57,0,57],[60,0,60],[66,0,66],[70,0,70],[74,0,74],[82,0,82],[90,0,90],[99,0,99],[107,0,107],[115,0,115],[123,0,123],[132,0,132],[140,0,140],[148,0,148],[156,0,156],[165,0,165],[173,0,173],[181,0,181],[189,0,189],[198,0,198],[206,0,206],[214,0,214],[222,0,222],[231,0,231],[239,0,239],[247,0,247],[255,0,255],[255,0,255],[247,0,255],[239,0,255],[231,0,255],[222,0,255],[214,0,255],[206,0,255],[198,0,255],[189,0,255],[181,0,255],[173,0,255],[165,0,255],[156,0,255],[148,0,255],[140,0,255],[132,0,255],[123,0,255],[115,0,255],[107,0,255],[99,0,255],[90,0,255],[82,0,255],[74,0,255],[66,0,255],[57,0,255],[49,0,255],[41,0,255],[33,0,255],[24,0,255],[16,0,255],[8,0,255],[0,0,255],[0,0,255],[0,8,255],[0,16,255],[0,24,255],[0,33,255],[0,41,255],[0,49,255],[0,57,255],[0,66,255],[0,74,255],[0,82,255],[0,90,255],[0,99,255],[0,107,255],[0,115,255],[0,123,255],[0,132,255],[0,140,255],[0,148,255],[0,156,255],[0,165,255],[0,169,255],[0,173,255],[0,181,255],[0,189,255],[0,198,255],[0,206,255],[0,214,255],[0,222,255],[0,231,255],[0,239,255],[0,247,255],[0,255,255],[0,255,247],[0,255,255],[0,247,231],[0,247,239],[0,239,214],[0,239,222],[0,231,198],[0,231,206],[0,222,181],[0,222,189],[0,214,165],[0,214,173],[0,206,148],[0,206,156],[0,198,123],[0,198,132],[0,198,140],[0,189,115],[0,189,123],[0,181,99],[0,181,107],[0,177,94],[0,173,82],[0,173,90],[0,165,66],[0,165,74],[0,156,41],[0,156,49],[0,156,57],[0,148,24],[0,148,33],[0,148,41],[0,140,16],[0,140,24],[0,136,10],[0,132,0],[0,132,8],[0,132,0],[8,132,0],[8,136,0],[8,140,0],[16,140,0],[24,140,0],[24,148,0],[33,148,0],[37,148,0],[41,148,0],[41,156,0],[45,156,0],[49,156,0],[57,156,0],[57,165,0],[66,165,0],[74,165,0],[74,173,0],[82,173,0],[90,173,0],[94,177,0],[99,181,0],[107,181,0],[115,189,0],[123,189,0],[132,198,0],[140,198,0],[144,202,0],[148,206,0],[156,206,0],[165,214,0],[169,214,0],[173,214,0],[181,222,0],[189,222,0],[198,231,0],[202,231,0],[206,231,0],[214,239,0],[222,239,0],[231,247,0],[239,247,0],[247,255,0],[255,255,0],[255,255,0],[255,247,0],[255,239,0],[255,231,0],[255,222,0],[255,214,0],[255,206,0],[255,198,0],[255,189,0],[255,181,0],[255,177,0],[255,173,0],[255,165,0],[255,156,0],[255,148,0],[255,144,0],[255,140,0],[255,132,0],[255,123,0],[255,115,0],[255,107,0],[255,99,0],[255,94,0],[255,90,0],[255,82,0],[255,74,0],[255,66,0],[255,57,0],[255,49,0],[255,41,0],[255,33,0],[255,24,0],[255,16,0],[255,8,0],[255,0,0],[255,0,0],[255,8,8],[255,16,16],[255,24,24],[255,33,33],[255,41,41],[255,49,49],[255,57,57],[255,66,66],[255,74,74],[255,82,82],[255,90,90],[255,99,99],[255,107,107],[255,115,115],[255,123,123],[255,132,132],[255,140,140],[255,144,144],[255,148,148],[255,152,152],[255,156,156],[255,165,165],[255,173,173],[255,181,181],[255,185,185],[255,189,189],[255,198,198],[255,206,206],[255,214,214],[255,222,222],[255,231,231],[255,239,239],[255,247,247],[255,255,255],[255,255,255]];a.internal.storedPixelDataToCanvasImageData=b,a.storedPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(){this.reset()}b.prototype.reset=function(){this.m=[1,0,0,1,0,0]},b.prototype.clone=function(){var a=new b;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a},b.prototype.multiply=function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},b.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},b.prototype.scale=function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},b.prototype.transformPoint=function(a,b){var c=a,d=b;return a=c*this.m[0]+d*this.m[2]+this.m[4],b=c*this.m[1]+d*this.m[3]+this.m[5],{x:a,y:b}},a.internal.Transform=b}(cornerstone),function(a){"use strict";function b(a,b){return function(c){return 255*((c-b)/a+.5)}}function c(a){var b=a.numBitsPerEntry-8,c=a.lut[0]>>b,d=a.lut[a.lut.length-1]>>b,e=a.firstValueMapped+a.lut.length-1;return function(f){return f<a.firstValueMapped?c:f>=e?d:a.lut[f-a.firstValueMapped]>>b}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getVOILUT=d}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b);c.invalid=!0;var d={element:b};$(c.element).trigger("CornerstoneInvalidated",d)}a.invalidate=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}a.invalidateImageId=b}(cornerstone),function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=(e.image,b.getBoundingClientRect()),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i={x:g,y:h},j=a.internal.getTransform(e);return j.invert(),j.transformPoint(i.x,i.y)}a.pageToPixel=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.transformPoint(c.x,c.y)}a.pixelToCanvas=b}(cornerstone),function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip}function e(e,f,i){if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&e.viewport.invert===!1&&f.getCanvas&&f.getCanvas())return f.getCanvas();if(d(e,f)===!1&&i!==!0)return j;j.width===f.width&&j.height==f.height||b(f);var k=c(f,e.viewport);return a.storedColorPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}var g,h,i,j=document.createElement("canvas"),k={};a.rendering.colorImage=f,a.renderColorImage=f}(cornerstone),function(a){"use strict";function b(a){k.width=a.width,k.height=a.height,h=k.getContext("2d"),h.fillStyle="white",h.fillRect(0,0,k.width,k.height),i=h.getImageData(0,0,a.width,a.height)}function c(a,b){return!a&&!b||!(!a||!b)&&a.id!==b.id}function d(b,d,e){return void 0!==b.lut&&b.lut.windowCenter===d.voi.windowCenter&&b.lut.windowWidth===d.voi.windowWidth&&c(b.lut.modalityLUT,d.modalityLUT)&&c(b.lut.voiLUT,d.voiLUT)&&b.lut.invert===d.invert&&e!==!0?b.lut:(a.generateLut(b,d.voi.windowWidth,d.voi.windowCenter,d.invert,d.modalityLUT,d.voiLUT),b.lut.windowWidth=d.voi.windowWidth,b.lut.windowCenter=d.voi.windowCenter,b.lut.invert=d.invert,b.lut.voiLUT=d.voiLUT,b.lut.modalityLUT=d.modalityLUT,b.lut)}function e(a,b){return b.imageId!==j||l.windowCenter!==a.viewport.voi.windowCenter||l.windowWidth!==a.viewport.voi.windowWidth||l.invert!==a.viewport.invert||l.rotation!==a.viewport.rotation||l.hflip!==a.viewport.hflip||l.vflip!==a.viewport.vflip||l.modalityLUT!==a.viewport.modalityLUT||l.voiLUT!==a.viewport.voiLUT||l.fakeColor!==a.viewport.fakeColor}function f(c,f,g){if(e(c,f)===!1&&g!==!0)return k;k.width===f.width&&k.height==f.height&&l.fakeColor==f.fakeColor||(b(f),k.fakeColor=f.fakeColor);var j=d(f,c.viewport,g);return"printBack"==c.viewport.fakeColor?(a.storedPixelDataToCanvasImageData(f,j,i.data,c.viewport.fakeColor),"false"==c.viewport.fakeColor):a.storedPixelDataToCanvasImageData(f,j,i.data,c.viewport.fakeColor),h.putImageData(i,0,0),k}function g(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";
var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e);var g=f(b,d,c);e.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),j=d.imageId,l.windowCenter=b.viewport.voi.windowCenter,l.windowWidth=b.viewport.voi.windowWidth,l.invert=b.viewport.invert,l.fakeColor=b.viewport.fakeColor,l.rotation=b.viewport.rotation,l.hflip=b.viewport.hflip,l.vflip=b.viewport.vflip,l.modalityLUT=b.viewport.modalityLUT,l.voiLUT=b.viewport.voiLUT}var h,i,j,k=document.createElement("canvas"),l={};a.rendering.grayscaleImage=g,a.renderGrayscaleImage=g,a.initializeGrayscaleRenderCanvas=b}(cornerstone),function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}a.rendering.webImage=b,a.renderWebImage=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.internal.getDefaultViewport(c.canvas,c.image);c.viewport=d,a.updateImage(b)}a.reset=b}(cornerstone),function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&a.updateImage(c)}a.resize=c}(cornerstone),function(a){"use strict";function b(b,c,d){if(void 0===b)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===c)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var e=a.internal.calculateTransform(b,d);c.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5],e.m[6])}a.setToPixelCoordinateSystem=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.fakeColor=c.fakeColor,d.viewport.pixelReplication=c.pixelReplication,d.viewport.rotation=c.rotation,d.viewport.hflip=c.hflip,d.viewport.vflip=c.vflip,d.viewport.modalityLUT=c.modalityLUT,d.viewport.voiLUT=c.voiLUT,d.viewport.voi.windowWidth<1e-6&&(d.viewport.voi.windowWidth=1e-6),d.viewport.scale<1e-4&&(d.viewport.scale=.25),360!==d.viewport.rotation&&d.viewport.rotation!==-360||(d.viewport.rotation=0),a.updateImage(b)}a.setViewport=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}a.updateImage=b}(cornerstone);var cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},a.Vector3.prototype={constructor:a.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyAxisAngle:function(){var b;return function(c,d){return void 0===b&&(b=new a.Quaternion),this.applyQuaternion(b.setFromAxisAngle(c,d)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var b,c;return function(d,e){return void 0===b&&(b=new a.Vector3,c=new a.Vector3),b.set(d,d,d),c.set(e,e,e),this.clamp(b,c)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var b,c;return function(d){return void 0===b&&(b=new a.Vector3),b.copy(d).normalize(),c=this.dot(b),this.copy(b).multiplyScalar(c)}}(),projectOnPlane:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),b.copy(this).projectOnVector(c),this.sub(b)}}(),reflect:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),this.sub(b.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(b){var c=this.dot(b)/(this.length()*b.length());return Math.acos(a.clamp(c,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(a,b){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Line3=function(b,c){this.start=void 0!==b?b:new a.Vector3,this.end=void 0!==c?c:new a.Vector3},a.Line3.prototype={constructor:a.Line3,set:function(a,b){return this.start.copy(a),this.end.copy(b),this},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},center:function(b){var c=b||new a.Vector3;return c.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(b){var c=b||new a.Vector3;return c.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(b,c){var d=c||new a.Vector3;return this.delta(d).multiplyScalar(b).add(this.start)},closestPointToPointParameter:function(){var b=new a.Vector3,c=new a.Vector3;return function(d,e){b.subVectors(d,this.start),c.subVectors(this.end,this.start);var f=c.dot(c),g=c.dot(b),h=g/f;return e&&(h=a.Math.clamp(h,0,1)),h}}(),closestPointToPoint:function(b,c,d){var e=this.closestPointToPointParameter(b,c),f=d||new a.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new a.Line3).copy(this)},intersectLine:function(a){var b=this.end.clone().sub(this.start),c=a.end.clone().sub(a.start),d=a.start.clone().sub(this.start),e=b.clone().cross(c),f=d.clone().cross(c);if(0!==d.dot(b)){var g=f.dot(e)/e.lengthSq();if(!(g>1||isNaN(g))){var h=this.start.clone().add(b.clone().multiplyScalar(g)),i=h.clone().sub(a.start).lengthSq()+h.clone().sub(a.end).lengthSq();return i<=a.distanceSq()?h:void 0}}}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){return a*a}function c(a,c){return b(a.x-c.x)+b(a.y-c.y)}function d(a,b){var d=c(a.start,a.end);if(0===d)return c(b,a.start);var e=((b.x-a.start.x)*(a.end.x-a.start.x)+(b.y-a.start.y)*(a.end.y-a.start.y))/d;if(0>e)return c(b,a.start);if(e>1)return c(b,a.end);var f={x:a.start.x+e*(a.end.x-a.start.x),y:a.start.y+e*(a.end.y-a.start.y)};return c(b,f)}function e(a,b){return Math.sqrt(d(a,b))}function f(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p={},q=b.start.x,r=b.start.y,s=b.end.x,t=b.end.y,u=c.start.x,v=c.start.y,w=c.end.x,x=c.end.y;if(d=t-r,f=q-s,h=s*r-q*t,l=d*u+f*v+h,m=d*w+f*x+h,(0===l||0===m||a.sign(l)!==a.sign(m))&&(e=x-v,g=u-w,i=w*v-u*x,j=e*q+g*r+i,k=e*s+g*t+i,0===j||0===k||a.sign(j)!==a.sign(k))){n=d*g-e*f,o=f*i-g*h;var y=parseFloat(o/n);o=e*h-d*i;var z=parseFloat(o/n);return p.x=y,p.y=z,p}}return void 0===a&&(a={}),a.lineSegment={distanceToPoint:e,intersectLine:f},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a,b,c){return b>a?b:a>c?c:a}function c(a){var b=Math.PI/180;return a*b}function d(a){var b=180/Math.PI;return a*b}function e(a){return"number"==typeof a?a?0>a?-1:1:a===a?0:NaN:NaN}return void 0===a&&(a={}),a.clamp=b,a.degToRad=c,a.radToDeg=d,a.sign=e,a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},a.Matrix4.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},a.Matrix4.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},a.Matrix4.prototype.multiply=function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},a.Matrix4.prototype.getInverse=function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0===u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},a.Matrix4.prototype.applyToVector3Array=function(){var b=new a.Vector3;return function(a,c,d){void 0===c&&(c=0),void 0===d&&(d=a.length);for(var e=0,f=c;d>e;e+=3,f+=3)b.x=a[f],b.y=a[f+1],b.z=a[f+2],b.applyMatrix4(this),a[f]=b.x,a[f+1]=b.y,a[f+2]=b.z;return a}},a.Matrix4.prototype.makeTranslation=function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},a.Matrix4.prototype.multiplyScalar=function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},a.Matrix4.prototype.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},a.Matrix4.prototype.makeScale=function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Plane=function(b,c){this.normal=void 0!==b?b:new a.Vector3(1,0,0),this.constant=void 0!==c?c:0},a.Plane.prototype={constructor:a.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var b=new a.Vector3,c=new a.Vector3;return function(a,d,e){var f=b.subVectors(e,d).cross(c.subVectors(a,d)).normalize();return this.setFromNormalAndCoplanarPoint(f,a),this}}(),copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(b,c){var d=this.distanceToPoint(b),e=c||new a.Vector3;return e.copy(this.normal).multiplyScalar(d)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return 0>b&&c>0||0>c&&b>0},intersectLine:function(){var b=new a.Vector3;return function(c,d){var e=d||new a.Vector3,f=c.delta(b),g=this.normal.dot(f);if(0===g)return 0===this.distanceToPoint(c.start)?e.copy(c.start):void 0;var h=-(c.start.dot(this.normal)+this.constant)/g;return 0>h||h>1?void 0:e.copy(f).multiplyScalar(h).add(c.start)}}(),intersectPlane:function(b){var c=this.normal.clone().cross(b.normal),d=new a.Vector3,e={origin:d,direction:c};if(this.normal.clone().cross(b.normal).length<1e-10)return e.direction=new a.Vector3,e;var f=this.constant,g=b.constant,h=this.normal.clone().dot(b.normal),i=-(f-g*h)/(1-h*h),j=-(g-f*h)/(1-h*h);return e.origin=this.normal.clone().multiplyScalar(i).add(b.normal.clone().multiplyScalar(j)),e},coplanarPoint:function(b){var c=b||new a.Vector3;return c.copy(this.normal).multiplyScalar(-this.constant)},translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new a.Plane).copy(this)}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){return{x:a.pageX,y:a.pageY}}function c(a,b){return{x:a.x-b.x,y:a.y-b.y}}function d(a){return{x:a.x,y:a.y}}function e(a,b){return Math.sqrt(f(a,b))}function f(a,b){var d=c(a,b);return d.x*d.x+d.y*d.y}function g(a,b){return!(a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height)}function h(b,c){var d,e=[];b.forEach(function(b,f){var g=a.point.distance(b,c);e.push(g),d=0===f?g:Math.min(g,d)});var f=e.indexOf(d);return b[f]}return void 0===a&&(a={}),a.point={subtract:c,copy:d,pageToPoint:b,distance:e,distanceSquared:f,insideRect:g,findClosestPoint:h},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},a.Quaternion.prototype.setFromAxisAngle=function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},a.Quaternion.prototype.multiplyQuaternions=function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},a.Quaternion.prototype.setFromRotationMatrix=function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){var b={start:{x:a.left,y:a.top},end:{x:a.left+a.width,y:a.top}},c={start:{x:a.left+a.width,y:a.top},end:{x:a.left+a.width,y:a.top+a.height}},d={start:{x:a.left+a.width,y:a.top+a.height},end:{x:a.left,y:a.top+a.height}},e={start:{x:a.left,y:a.top+a.height},end:{x:a.left,y:a.top}},f=[b,c,d,e];return f}function c(c,d){var e=655535,f=b(c);return f.forEach(function(b){var c=a.lineSegment.distanceToPoint(b,d);e>c&&(e=c)}),e}function d(a){var b={topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}};return b}function e(a,b){var c,e,f=d(a),g=d(b);return c=a.width>=0?b.width>=0?!(f.bottomRight.x<=g.topLeft.x||g.bottomRight.x<=f.topLeft.x):!(f.bottomRight.x<=g.bottomRight.x||g.topLeft.x<=f.topLeft.x):b.width>=0?!(f.topLeft.x<=g.topLeft.x||g.bottomRight.x<=f.bottomRight.x):!(f.topLeft.x<=g.bottomRight.x||g.topLeft.x<=f.bottomRight.x),e=a.height>=0?b.height>=0?!(f.bottomRight.y<=g.topLeft.y||g.bottomRight.y<=f.topLeft.y):!(f.bottomRight.y<=g.bottomRight.y||g.topLeft.y<=f.topLeft.y):b.height>=0?!(f.topLeft.y<=g.topLeft.y||g.bottomRight.y<=f.bottomRight.y):!(f.topLeft.y<=g.bottomRight.y||g.top<=f.bottomRight.y),c&&e}function f(a,b){var c={topLeft:{},bottomRight:{}};if(e(a,b)){var f=d(a),g=d(b);return a.width>=0?b.width>=0?(c.topLeft.x=Math.max(f.topLeft.x,g.topLeft.x),c.bottomRight.x=Math.min(f.bottomRight.x,g.bottomRight.x)):(c.topLeft.x=Math.max(f.topLeft.x,g.bottomRight.x),c.bottomRight.x=Math.min(f.bottomRight.x,g.topLeft.x)):b.width>=0?(c.topLeft.x=Math.min(f.topLeft.x,g.bottomRight.x),c.bottomRight.x=Math.max(f.bottomRight.x,g.topLeft.x)):(c.topLeft.x=Math.min(f.topLeft.x,g.topLeft.x),c.bottomRight.x=Math.max(f.bottomRight.x,g.bottomRight.x)),a.height>=0?b.height>=0?(c.topLeft.y=Math.max(f.topLeft.y,g.topLeft.y),c.bottomRight.y=Math.min(f.bottomRight.y,g.bottomRight.y)):(c.topLeft.y=Math.max(f.topLeft.y,g.bottomRight.y),c.bottomRight.y=Math.min(f.bottomRight.y,g.topLeft.y)):b.height>=0?(c.topLeft.y=Math.min(f.topLeft.y,g.bottomRight.y),c.bottomRight.y=Math.max(f.bottomRight.y,g.topLeft.y)):(c.topLeft.y=Math.min(f.topLeft.y,g.topLeft.y),c.bottomRight.y=Math.max(f.bottomRight.y,g.bottomRight.y)),c}}return void 0===a&&(a={}),a.rect={distanceToPoint:c,getIntersectionRect:f},a}(cornerstoneMath),maxminScale=1;"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(a,b,c){"use strict";function d(c){if(!("mousewheel"===c.originalEvent.type&&0===c.originalEvent.wheelDeltaY||"DOMMouseScroll"===c.originalEvent.type&&1===c.originalEvent.axis)){var d=c.currentTarget,e=b.pageToPixel(d,c.pageX||c.originalEvent.pageX,c.pageY||c.originalEvent.pageY);c=window.event||c;var f=c.wheelDelta||-c.detail||-c.originalEvent.detail,g=Math.max(-1,Math.min(1,f)),h={element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,direction:g,pageX:c.pageX||c.originalEvent.pageX,pageY:c.pageY||c.originalEvent.pageY,imageX:e.x,imageY:e.y};a(d).trigger("CornerstoneToolsMouseWheel",h)}}function e(b){f(b),a(b).on(g,d)}function f(b){a(b).unbind(g,d)}var g="mousewheel DOMMouseScroll";c.mouseWheelInput={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(){l=!1}function f(b){a(b.element).trigger("CornerstoneToolsMouseDownActivate",b)}function g(e){var f=e.currentTarget,g="CornerstoneToolsMouseDoubleClick",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j={event:e,which:e.which,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:h,deltaPoints:{x:0,y:0},type:g},k=a.Event(g,j);a(j.element).trigger(k,j)}function h(g){function h(e){var f="CornerstoneToolsMouseDrag",g={page:c.point.pageToPoint(e),image:b.pageToPixel(k,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=b.pixelToCanvas(k,g.image);var h={page:c.point.subtract(g.page,q.page),image:c.point.subtract(g.image,q.image),client:c.point.subtract(g.client,q.client),canvas:c.point.subtract(g.canvas,q.canvas)},i={which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:g,deltaPoints:h,type:f};return a(i.element).trigger(f,i),q=d.copyPoints(g),d.pauseEvent(e)}function j(d){clearTimeout(m);var e="CornerstoneToolsMouseUp";l&&(e="CornerstoneToolsMouseClick");var f={page:c.point.pageToPoint(d),image:b.pageToPixel(k,d.pageX,d.pageY),client:{x:d.clientX,y:d.clientY}};f.canvas=b.pixelToCanvas(k,f.image);var g={page:c.point.subtract(f.page,q.page),image:c.point.subtract(f.image,q.image),client:c.point.subtract(f.client,q.client),canvas:c.point.subtract(f.canvas,q.canvas)},n={event:d,which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:f,deltaPoints:g,type:e},o=a.Event(e,n);a(n.element).trigger(o,n),a(document).off("mousemove",h),a(document).off("mouseup",j),a(n.element).on("mousemove",i),l=!0}m=setTimeout(e,n);var k=g.currentTarget,o="CornerstoneToolsMouseDown";a(k).off("mousemove",i);var p={page:c.point.pageToPoint(g),image:b.pageToPixel(k,g.pageX,g.pageY),client:{x:g.clientX,y:g.clientY}};p.canvas=b.pixelToCanvas(k,p.image);var q=d.copyPoints(p),r={event:g,which:g.which,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:p,deltaPoints:{x:0,y:0},type:o},s=a.Event(o,r);if(a(r.element).trigger(s,r),s.isImmediatePropagationStopped()===!1&&f(r)===!0)return d.pauseEvent(g);var t=g.which;return a(document).on("mousemove",h),a(document).on("mouseup",j),d.pauseEvent(g)}function i(e){var f=e.currentTarget,g="CornerstoneToolsMouseMove",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j=e.which,k={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};k.canvas=b.pixelToCanvas(f,k.image);var l={page:c.point.subtract(k.page,i.page),image:c.point.subtract(k.image,i.image),client:c.point.subtract(k.client,i.client),canvas:c.point.subtract(k.canvas,i.canvas)},m={which:j,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:k,deltaPoints:l,type:g};a(f).trigger(g,m),i=d.copyPoints(k)}function j(b){a(b).off("mousedown",h),a(b).off("mousemove",i),a(b).off("dblclick",g)}function k(b){j(b),a(b).on("mousedown",h),a(b).on("mousemove",i),a(b).on("dblclick",g)}var l,m,n=200;d.mouseInput={enable:k,disable:j}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(e){var f,g,v=e.target.parentNode;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(s=!1,clearTimeout(n)),e.type){case"tap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"doubletap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsDoubleTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"pinchstart":s=!1,clearTimeout(n),p=1;break;case"pinchmove":if(s=!1,clearTimeout(n),u===!0){p=e.scale,u=!1;break}var w=(e.scale-p)/p;h={page:e.center,image:b.pageToPixel(v,e.center.x,e.center.y)},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPinch",l={event:e,startPoints:h,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,direction:e.scale<1?1:-1,scaleChange:w,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),p=e.scale;break;case"touchstart":p=1,clearTimeout(n),clearTimeout(m),m=setTimeout(function(){h={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStart"),l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),f.isImmediatePropagationStopped()===!1&&(g="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStartActive"),l.type=g,a(v).trigger(g,l)),j=d.copyPoints(h)},50),s=!0,o=0,n=setTimeout(function(){s&&(i={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},i.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPress",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l))},r);break;case"touchend":p=1,s=!1,clearTimeout(n),h={page:c.point.pageToPoint(e.originalEvent.changedTouches[0]),image:b.pageToPixel(v,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchEnd",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"panmove":
i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},o+=Math.sqrt(k.page.x*k.page.x+k.page.y*k.page.y),o>t&&(s=!1,clearTimeout(n)),g="CornerstoneToolsTouchDrag",e.pointers.length>1&&(g="CornerstoneToolsMultiTouchDrag"),l={viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,numPointers:e.pointers.length,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),j=d.copyPoints(i);break;case"panstart":i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),j=d.copyPoints(i);break;case"panend":if(s=!1,clearTimeout(n),!j)return!1;i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},g="CornerstoneToolsDragEnd",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);var x=e.pointers.length-e.changedPointers.length;return 2===x&&(u=!0),d.pauseEvent(e);case"rotatemove":s=!1,clearTimeout(n);var y=e.rotation-q;q=e.rotation,g="CornerstoneToolsTouchRotate",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,rotation:y,type:g},f=a.Event(g,l),a(v).trigger(f,l)}return!1}function f(b){g(b);var c={inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput},f=new Hammer.Manager(b,c),h={pointers:0,direction:Hammer.DIRECTION_ALL,threshold:0},i=new Hammer.Pan(h),j=new Hammer.Pinch({threshold:0}),k=new Hammer.Rotate({threshold:0});j.recognizeWith(i),j.recognizeWith(k),f.add([i,k,j]),f.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",e),d.preventGhostClick.enable(b),a(b).on("touchstart touchend",e),a(b).data("hammer",f)}function g(b){d.preventGhostClick.disable(b),a(b).off("touchstart touchend",e);var c=a(b).data("hammer");c&&c.off("tap doubletap panstart panmove panend pinchmove rotatemove",e)}var h,i,j,k,l,m,n,o,p=1,q=0,r=700,s=!1,t=5,u=!1;d.touchInput={enable:f,disable:g}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c,d,e){a(c).off("CornerstoneToolsMouseDownActivate",b);var f={mouseButtonMask:d,options:e};a(c).on("CornerstoneToolsMouseDownActivate",f,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.simpleMouseButtonTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c){function e(e){var i=e.element,j=c.createNewMeasurement(e);if(j){var k={mouseButtonMask:e.which};d.addToolState(e.element,c.toolType,j),a(i).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(i).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(i).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(i);var l;l=1===Object.keys(j.handles).length?d.moveHandle:d.moveNewHandle;var m;m=!(!c.options||void 0===c.options.preventHandleOutsideImage)&&c.options.preventHandleOutsideImage,l(e,c.toolType,j,j.handles.end,function(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(e,j.handles)&&d.removeToolState(i,c.toolType,j),a(i).on("CornerstoneToolsMouseMove",k,c.mouseMoveCallback||g),a(i).on("CornerstoneToolsMouseDown",k,c.mouseDownCallback||h),a(i).on("CornerstoneToolsMouseDownActivate",k,c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).on("CornerstoneToolsMouseDoubleClick",k,c.mouseDoubleClickCallback),b.updateImage(i)},m)}}function f(a,b){if(d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask))return c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1}function g(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(f){for(var g=!1,h=0;h<f.data.length;h++){var i=e.currentPoints.canvas,j=f.data[h];d.handleActivator(e.element,j.handles,i)===!0&&(g=!0),(c.pointNearTool(e.element,j,i)&&!j.active||!c.pointNearTool(e.element,j,i)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function h(e,f){function h(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(f,i.handles)&&d.removeToolState(j,c.toolType,i),b.updateImage(j),a(j).on("CornerstoneToolsMouseMove",f,c.mouseMoveCallback||g)}var i,j=f.element;if(d.isMouseButtonEnabled(f.which,e.data.mouseButtonMask)){var k,l=f.startPoints.canvas,m=d.getToolState(e.currentTarget,c.toolType);if(m){var n;for(n=!(!c.options||void 0===c.options.preventHandleOutsideImage)&&c.options.preventHandleOutsideImage,k=0;k<m.data.length;k++){i=m.data[k];var o=d.distanceSqR||25,p=d.getHandleNearImagePoint(j,i.handles,l,o);if(p)return a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),i.active=!0,d.moveHandle(f,c.toolType,i,p,h,n),e.stopImmediatePropagation(),!1}}if(m&&c.pointNearTool){var q=c.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(k=0;k<m.data.length;k++)if(i=m.data[k],c.pointNearTool(j,i,l))return a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),d.moveAllHandles(e,i,m,c.toolType,q,h),e.stopImmediatePropagation(),!1}}}function i(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseUpCallback&&a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),c.mouseClickCallback&&a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(d)}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseUpCallback&&a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),c.mouseClickCallback&&a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function k(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),a(d).on("CornerstoneToolsMouseDownActivate",i,c.mouseDownActivateCallback||f),c.mouseUpCallback&&(a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),a(d).on("CornerstoneToolsMouseUp",i,c.mouseUpCallback)),c.mouseClickCallback&&(a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),a(d).on("CornerstoneToolsMouseClick",i,c.mouseClickCallback)),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function l(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),c.mouseUpCallback&&(a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),a(d).on("CornerstoneToolsMouseUp",i,c.mouseUpCallback)),c.mouseClickCallback&&(a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),a(d).on("CornerstoneToolsMouseClick",i,c.mouseClickCallback)),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function m(){return o}function n(a){o=a}var o={},p={enable:j,disable:i,activate:k,deactivate:l,getConfiguration:m,setConfiguration:n,mouseDownCallback:h,mouseMoveCallback:g,mouseDownActivateCallback:f};return c.pointNearTool&&(p.pointNearTool=c.pointNearTool),c.mouseDoubleClickCallback&&(p.mouseDoubleClickCallback=c.mouseDoubleClickCallback),c.addNewMeasurement&&(p.addNewMeasurement=c.addNewMeasurement),p}d.mouseButtonTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e){function f(b){var f=c.createNewMeasurement(b);f&&(d.addToolState(b.element,c.toolType,f),a(b.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(b,c.toolType,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(b,f.handles)&&d.removeToolState(b.element,c.toolType,f),a(b.element).on("CornerstoneToolsMouseMove",h)},e))}function g(a,b){if(d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask))return f(b),!1}function h(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=e.currentPoints.canvas,i=0;i<f.data.length;i++){var j=f.data[i];d.handleActivator(e.element,j.handles,h)===!0&&(g=!0),(c.pointInsideRect(e.element,j,h)&&!j.active||!c.pointInsideRect(e.element,j,h)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function i(f,g){function i(){j.active=!1,d.anyHandlesOutsideImage(g,j.handles)&&d.removeToolState(g.element,c.toolType,j),b.updateImage(g.element),a(g.element).on("CornerstoneToolsMouseMove",h)}var j;if(d.isMouseButtonEnabled(g.which,f.data.mouseButtonMask)){var k,l=g.startPoints.canvas,m=d.getToolState(f.currentTarget,c.toolType),n=25;if(void 0!==m)for(k=0;k<m.data.length;k++){j=m.data[k];var o=d.getHandleNearImagePoint(g.element,j.handles,l,n);if(void 0!==o)return a(g.element).off("CornerstoneToolsMouseMove",h),j.active=!0,d.moveHandle(g,c.toolType,j,o,i,e),f.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:e};if(void 0!==m&&void 0!==c.pointInsideRect)for(k=0;k<m.data.length;k++)if(j=m.data[k],c.pointInsideRect(g.element,j,l))return a(g.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(f,j,m,c.toolType,p,i),a(g.element).on("CornerstoneToolsMouseMove",h),f.stopImmediatePropagation(),!1}}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function l(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),a(d).on("CornerstoneToolsMouseDownActivate",f,g),b.updateImage(d)}function m(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m};return n}d.mouseButtonRectangleTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}c.mouseWheelTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d="CornerstoneToolsTouchDrag";c&&c.fireOnTouchStart===!0&&(d+=" CornerstoneToolsTouchStart");var e={activate:function(e){a(e).off(d,b),c&&c.eventData?a(e).on(d,c.eventData,b):a(e).on(d,b),c&&c.activateCallback&&c.activateCallback(e)},disable:function(e){a(e).off(d,b),c&&c.disableCallback&&c.disableCallback(e)},enable:function(e){a(e).off(d,b),c&&c.enableCallback&&c.enableCallback(e)},deactivate:function(e){a(e).off(d,b),c&&c.deactivateCallback&&c.deactivateCallback(e)}};return e}c.touchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}c.touchPinchTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){Object.keys(a).forEach(function(b){var c=a[b];c.active=!1})}function f(a){if(a)for(var b=0;b<a.data.length;b++){var c=a.data[b];c.active=!1,c.handles&&e(c.handles)}}function g(c){function e(e){var f=e.element,i=c.createNewMeasurement(e);if(i){if(d.addToolState(f,c.toolType,i),1===Object.keys(i.handles).length&&"CornerstoneToolsTap"===e.type)return i.active=!1,i.handles.end.active=!1,i.handles.end.highlight=!1,i.invalidated=!0,d.anyHandlesOutsideImage(e,i.handles)&&d.removeToolState(f,c.toolType,i),void b.updateImage(f);a(f).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).off("CornerstoneToolsTap",c.tapCallback||h),b.updateImage(f),d.moveNewHandleTouch(e,c.toolType,i,i.handles.end,function(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(e,i.handles)&&d.removeToolState(f,c.toolType,i),a(f).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).on("CornerstoneToolsTap",c.tapCallback||h),b.updateImage(f)})}}function g(a,b){return c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1}function h(e,i){function j(){f(o),d.anyHandlesOutsideImage(i,k.handles)&&d.removeToolState(m,c.toolType,k),b.updateImage(m),a(m).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).on("CornerstoneToolsTap",c.tapCallback||h)}var k,l,m=i.element,n=i.currentPoints.canvas,o=d.getToolState(e.currentTarget,c.toolType);if(f(o),o)for(l=0;l<o.data.length;l++){k=o.data[l];var p=25,q=d.getHandleNearImagePoint(m,k.handles,n,p);if(q)return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,q.active=!0,b.updateImage(m),d.touchMoveHandle(e,c.toolType,k,q,j),e.stopImmediatePropagation(),!1}if(o&&c.pointNearTool)for(l=0;l<o.data.length;l++)if(k=o.data[l],c.pointNearTool(m,k,n))return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,b.updateImage(m),d.touchMoveAllHandles(e,k,o,c.toolType,!0,j),e.stopImmediatePropagation(),!1;return c.touchDownActivateCallback?c.touchDownActivateCallback(e,i):g(e,i),!1}function i(e,f){function i(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(f,j.handles)&&d.removeToolState(f.element,c.toolType,j),b.updateImage(f.element),a(l).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).on("CornerstoneToolsTap",c.tapCallback||h)}var j,k,l=f.element,m=f.startPoints.canvas,n=d.getToolState(e.currentTarget,c.toolType),o=d.touchSettings.getToolDistanceFromTouch(),p=Math.max(Math.abs(o.x),Math.abs(o.y));if(n)for(k=0;k<n.data.length;k++){j=n.data[k];var q=d.getHandleNearImagePoint(f.element,j.handles,m,p);if(q)return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),j.active=!0,d.touchMoveHandle(e,c.toolType,j,q,i),e.stopImmediatePropagation(),!1}if(n&&c.pointNearTool)for(k=0;k<n.data.length;k++)if(j=n.data[k],c.pointNearTool(f.element,j,m))return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),d.touchMoveAllHandles(e,j,n,c.toolType,!0,i),e.stopImmediatePropagation(),!1}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function l(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).on("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&(a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),a(d).on("CornerstoneToolsDoubleTap",c.doubleTapCallback)),c.pressCallback&&(a(d).off("CornerstoneToolsTouchPress",c.pressCallback),a(d).on("CornerstoneToolsTouchPress",c.pressCallback)),b.updateImage(d)}function m(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&(a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),a(d).on("CornerstoneToolsDoubleTap",c.doubleTapCallback)),c.pressCallback&&(a(d).off("CornerstoneToolsTouchPress",c.pressCallback),a(d).on("CornerstoneToolsTouchPress",c.pressCallback)),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m,touchStartCallback:c.touchStartCallback||i,touchDownActivateCallback:c.touchDownActivateCallback||g,tapCallback:c.tapCallback||h};return c.pointNearTool&&(n.pointNearTool=c.pointNearTool),c.doubleTapCallback&&(n.doubleTapCallback=c.doubleTapCallback),c.pressCallback&&(n.pressCallback=c.pressCallback),c.addNewMeasurement&&(n.addNewMeasurement=c.addNewMeasurement),n}d.touchTool=g}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},start2:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:a.currentPoints.image.x,y:a.currentPoints.image.y+20,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return g<5||(f.start=b.pixelToCanvas(a,d.handles.start2),f.end=b.pixelToCanvas(a,d.handles.end2),g=c.lineSegment.distanceToPoint(f,e),g<5)}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.angle.getConfiguration(),l=0;l<e.data.length;l++){f.save(),k&&k.shadow&&(f.shadowColor=k.shadowColor||"#000000",f.shadowOffsetX=k.shadowOffsetX||1,f.shadowOffsetY=k.shadowOffsetY||1);var m=e.data[l];g=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=g,f.lineWidth=i;var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),n=b.pixelToCanvas(c.element,m.handles.start2),o=b.pixelToCanvas(c.element,m.handles.end2),f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,m.handles),f.fillStyle=g;var p=(Math.ceil(m.handles.start.x)-Math.ceil(m.handles.end.x))*c.image.columnPixelSpacing,q=(Math.ceil(m.handles.start.y)-Math.ceil(m.handles.end.y))*c.image.rowPixelSpacing,r=(Math.ceil(m.handles.start2.x)-Math.ceil(m.handles.end2.x))*c.image.columnPixelSpacing,s=(Math.ceil(m.handles.start2.y)-Math.ceil(m.handles.end2.y))*c.image.rowPixelSpacing,t=Math.acos(Math.abs((p*r+q*s)/(Math.sqrt(p*p+q*q)*Math.sqrt(r*r+s*s))));t*=180/Math.PI;var u=d.roundToDecimal(t,1),v="00B0",w=u.toString()+String.fromCharCode(parseInt(v,16)),x=(n.x+o.x)/2,y=(n.y+o.y)/2;f.font=j,d.drawTextBox(f,w,x+15,y+15,g),f.restore()}}}var h="angle";d.angle=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.angleTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){a(prompt("Enter your annotation:"))}function f(a,b){b(prompt("Change your annotation:"))}function g(c){function e(a){null!==a?f.text=a:d.removeToolState(c.element,n,f),f.active=!1,b.updateImage(c.element)}var f=h(c),g={mouseButtonMask:c.which};d.addToolState(c.element,n,f),a(c.element).off("CornerstoneToolsMouseMove",d.arrowAnnotate.mouseMoveCallback),a(c.element).off("CornerstoneToolsMouseDown",d.arrowAnnotate.mouseDownCallback),a(c.element).off("CornerstoneToolsMouseDownActivate",d.arrowAnnotate.mouseDownActivateCallback),b.updateImage(c.element),d.moveNewHandle(c,n,f,f.handles.end,function(){d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,n,f);var h=d.arrowAnnotate.getConfiguration();void 0===f.text&&h.getTextCallback(e),a(c.element).on("CornerstoneToolsMouseMove",g,d.arrowAnnotate.mouseMoveCallback),a(c.element).on("CornerstoneToolsMouseDown",g,d.arrowAnnotate.mouseDownCallback),a(c.element).on("CornerstoneToolsMouseDownActivate",g,d.arrowAnnotate.mouseDownActivateCallback),b.updateImage(c.element)})}function h(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1}}};return b}function i(a,e,f){var g={start:b.pixelToCanvas(a,e.handles.start),end:b.pixelToCanvas(a,e.handles.end)},h=c.lineSegment.distanceToPoint(g,f);if(h<25)return!0;if(e.textCoords){var i=5,j=d.textStyle.getFontSize(),k={left:e.textCoords.x,top:e.textCoords.y,width:e.textWidth+2*i,height:j+2*i},l=c.rect.distanceToPoint(k,f);return l<25}}function j(a,c){var e=d.getToolState(a.currentTarget,n);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,h=d.toolStyle.getToolWidth(),i=d.textStyle.getFont(),j=d.arrowAnnotate.getConfiguration(),k=0;k<e.data.length;k++){f.save(),j&&j.shadow&&(f.shadowColor=j.shadowColor||"#000000",f.shadowOffsetX=j.shadowOffsetX||1,f.shadowOffsetY=j.shadowOffsetY||1);var l=e.data[k];g=l.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var m=b.pixelToCanvas(c.element,l.handles.start),o=b.pixelToCanvas(c.element,l.handles.end);if(j.arrowFirst?d.drawArrow(f,o,m,g,h):d.drawArrow(f,m,o,g,h),j.drawHandles?d.drawHandles(f,c,l.handles,g):j.drawHandlesOnHover&&l.handles.start.active?d.drawHandles(f,c,[l.handles.start],g):j.drawHandlesOnHover&&l.handles.end.active&&d.drawHandles(f,c,[l.handles.end],g),l.text&&""!==l.text){f.font=i;var p,q=13,r={x:q,y:q/2};p={x:o.x-m.x,y:o.y-m.y};var s,t=f.measureText(l.text).width;j.arrowFirst?(p.x<0&&(r.x=-r.x-t),s={x:p.x+m.x+r.x,y:p.y+m.y+r.y}):(p.x>0&&(r.x=-r.x-t),s={x:-p.x+o.x+r.x,y:-p.y+o.y+r.y}),l.textCoords=s,l.textWidth=t,d.drawTextBox(f,l.text,s.x,s.y,g)}f.restore()}}}function k(c){function e(a){null!==a?g.text=a:d.removeToolState(f,n,g),g.active=!1,b.updateImage(f)}var f=c.element,g=h(c);d.addToolState(f,n,g),a(f).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).off("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback),b.updateImage(f),d.moveNewHandleTouch(c,n,g,g.handles.end,function(){b.updateImage(f),d.anyHandlesOutsideImage(c,g.handles)&&d.removeToolState(f,n,g);var h=d.arrowAnnotate.getConfiguration();void 0===g.text&&h.getTextCallback(e),a(f).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).on("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback)})}function l(a,c){function e(a,c,e){e===!0?d.removeToolState(g,n,a):a.text=c,a.active=!1,b.updateImage(g)}var f,g=c.element;if(a.data&&a.data.mouseButtonMask&&!d.isMouseButtonEnabled(c.which,a.data.mouseButtonMask))return!1;var h=d.arrowAnnotate.getConfiguration(),j=c.currentPoints.canvas,k=d.getToolState(g,n);if(!k)return!1;for(var l=0;l<k.data.length;l++)if(f=k.data[l],i(g,f,j))return f.active=!0,b.updateImage(g),h.changeTextCallback(f,e),a.stopImmediatePropagation(),!1;return!1}function m(c,e){function f(c,e,f){f===!0?d.removeToolState(h,n,c):c.text=e,c.active=!1,b.updateImage(h),a(h).on("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback)}var g,h=e.element;if(c.data&&c.data.mouseButtonMask&&!d.isMouseButtonEnabled(e.which,c.data.mouseButtonMask))return!1;var j=d.arrowAnnotate.getConfiguration(),k=e.currentPoints.canvas,l=d.getToolState(h,n);if(!l)return!1;for(var m=0;m<l.data.length;m++)if(g=l.data[m],i(h,g,k))return g.active=!0,b.updateImage(h),a(h).off("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),j.changeTextCallback(g,f),c.stopImmediatePropagation(),!1;return!1}var n="arrowAnnotate",o={getTextCallback:e,changeTextCallback:f,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};d.arrowAnnotate=d.mouseButtonTool({addNewMeasurement:g,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,mouseDoubleClickCallback:l}),d.arrowAnnotate.setConfiguration(o),d.arrowAnnotateTouch=d.touchTool({addNewMeasurement:k,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,pressCallback:m})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){d.stopImmediatePropagation();var f=c.getToolState(d.currentTarget,o);if(f){var g=d.currentTarget,h=b.getEnabledElement(g),i=h.image.imageId,j=c.metaData.get("imagePlane",i),k=e.currentPoints.image,l=c.imagePointToPatientPoint(k,j),m=f.data[0].synchronizationContext,n=m.getSourceElements();a.each(n,function(d,e){if(e!==g){var f=Number.MAX_VALUE,h=-1,i=c.getToolState(e,"stack");if(void 0!==i){var j=i.data[0];if(a.each(j.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,g=d.rowCosines.clone(),i=d.columnCosines.clone(),j=i.clone().cross(g.clone()),k=Math.abs(j.clone().dot(e)-j.clone().dot(l));k<f&&(f=k,h=a)}),h!==j.currentImageIdIndex&&h!==-1&&void 0!==j.imageIds[h]){var k=c.loadHandlerManager.getStartLoadHandler(),m=c.loadHandlerManager.getEndLoadHandler(),n=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var o;o=j.preventCache===!0?b.loadImage(j.imageIds[h]):b.loadAndCacheImage(j.imageIds[h]),o.then(function(a){var c=b.getViewport(e);j.currentImageIdIndex=h,b.displayImage(e,a,c),m&&m(e)},function(a){var b=j.imageIds[h];n&&n(e,b,a)})}}}})}}function e(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b,f){if(c.isMouseButtonEnabled(f.which,b.data.mouseButtonMask))return a(f.element).on("CornerstoneToolsMouseDrag",g),a(f.element).on("CornerstoneToolsMouseUp",e),d(b,f),!1}function g(a,b){return d(a,b),!1}function h(b,d,e){var g={mouseButtonMask:d},h=c.getToolState(b,o);h=[],c.addToolState(b,o,{synchronizationContext:e}),a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",g,f)}function i(b){a(b).off("CornerstoneToolsMouseDown",f)}function j(b,c){a(c.element).off("CornerstoneToolsTouchDrag",l),a(c.element).off("CornerstoneToolsDragEnd",j)}function k(b,c){return a(c.element).on("CornerstoneToolsTouchDrag",l),a(c.element).on("CornerstoneToolsDragEnd",j),d(b,c),!1}function l(a,b){return d(a,b),!1}function m(b,d){var e=c.getToolState(b,o);e=[],c.addToolState(b,o,{synchronizationContext:d}),a(b).off("CornerstoneToolsTouchStart",k),a(b).on("CornerstoneToolsTouchStart",k)}function n(b){a(b).off("CornerstoneToolsTouchStart",k)}var o="crosshairs";c.crosshairs={activate:h,deactivate:i,enable:h,disable:i},c.crosshairsTouch={activate:m,deactivate:n,enable:m,disable:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d={},e={disable:function(b){a(b).off("CornerstoneImageRendered",c)},enable:function(d){a(d).off("CornerstoneImageRendered",c),a(d).on("CornerstoneImageRendered",c),b.updateImage(d)},getConfiguration:function(){return d},setConfiguration:function(a){d=a}};return e}c.displayTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a.element);b.updateImage(a.element);var e=d.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0);var f=c.toolColors.getActiveColor(),g=c.textStyle.getFont(),h=c.textStyle.getFontSize(),i=c.dragProbe.getConfiguration();e.save(),i&&i.shadow&&(e.shadowColor=i.shadowColor||"#000000",e.shadowOffsetX=i.shadowOffsetX||1,e.shadowOffsetY=i.shadowOffsetY||1);var j,k,l,m=Math.round(a.currentPoints.image.x),n=Math.round(a.currentPoints.image.y);if(!(m<0||n<0||m>=a.image.columns||n>=a.image.rows)){if(a.image.color)j=c.getRGBPixels(a.element,m,n,1,1),k=""+m+", "+n,l="R: "+j[0]+" G: "+j[1]+" B: "+j[2]+" A: "+j[3];else{j=b.getStoredPixels(a.element,m,n,1,1);var o=j[0],p=o*a.image.slope+a.image.intercept,q=c.calculateSUV(a.image,o);k=""+m+", "+n,l="SP: "+o+" MO: "+parseFloat(p.toFixed(3)),q&&(l+=" SUV: "+parseFloat(q.toFixed(3)))}var r={x:a.currentPoints.image.x+3,y:a.currentPoints.image.y-3},s=b.pixelToCanvas(a.element,r);e.font=g,e.fillStyle=f,c.drawTextBox(e,l,s.x,s.y+h+5,f),c.drawTextBox(e,k,s.x,s.y,f),e.restore()}}function e(a){var d=a.element,e=b.getEnabledElement(d),f=e.image;b.updateImage(d);var g=e.canvas.getContext("2d");
g.setTransform(1,0,0,1,0,0);var h=c.toolColors.getActiveColor(),i=c.textStyle.getFont(),j=c.dragProbe.getConfiguration();g.save(),j&&j.shadow&&(g.shadowColor=j.shadowColor||"#000000",g.shadowOffsetX=j.shadowOffsetX||1,g.shadowOffsetY=j.shadowOffsetY||1);var k;k=a.isTouchEvent===!0?b.pageToPixel(d,a.currentPoints.page.x,a.currentPoints.page.y-4*c.textStyle.getFontSize()):a.currentPoints.image;var l,m;if(!(k.x<0||k.y<0||k.x>=f.columns||k.y>=f.rows)){if(f.color)l=b.getStoredPixels(d,k.x,k.y,3,1),m="R: "+l[0]+" G: "+l[1]+" B: "+l[2];else{l=b.getStoredPixels(d,k.x,k.y,1,1);var n=l[0]*f.slope+f.intercept;m=parseFloat(n.toFixed(3))}var o=b.pixelToCanvas(d,k);g.font=i,g.fillStyle=h;var p;if(a.isTouchEvent===!0){var q=g.measureText(m).width;p={x:-q/2-5,y:1.5*-c.textStyle.getFontSize()};var r=6;g.beginPath(),g.strokeStyle=h,g.arc(o.x,o.y,r,0,2*Math.PI),g.stroke()}else p={x:4,y:-4};c.drawTextBox(g,m,o.x+p.x,o.y+p.y,h),g.restore()}}function f(c,d){a(d.element).off("CornerstoneToolsMouseDrag",h),a(d.element).off("CornerstoneToolsMouseUp",f),a(d.element).off("CornerstoneToolsMouseClick",f),b.updateImage(d.element)}function g(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return a(d.element).on("CornerstoneToolsMouseDrag",h),a(d.element).on("CornerstoneToolsMouseUp",f),a(d.element).on("CornerstoneToolsMouseClick",f),c.dragProbe.strategy(d),!1}function h(a,b){return c.dragProbe.strategy(b),!1}c.dragProbe=c.simpleMouseButtonTool(g),c.dragProbe.strategies={"default":d,minimal:e},c.dragProbe.strategy=d;var i={fireOnTouchStart:!0};c.dragProbeTouch=c.touchDragTool(h,i)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,invalidated:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var c=a.width/2,d=a.height/2;if(c<=0||d<=0)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.x/(c*c)+f.y*f.y/(d*d)<=1;return g}function g(a,b){for(var c=0,d=0,e=0,g=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)f(b,{x:i,y:h})===!0&&(c+=a[g],d+=a[g]*a[g],e++),g++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function h(a,c,d,e){var g=b.pixelToCanvas(a,c.handles.start),h=b.pixelToCanvas(a,c.handles.end),i={left:Math.min(g.x,h.x)+e/2,top:Math.min(g.y,h.y)+e/2,width:Math.abs(g.x-h.x)-e,height:Math.abs(g.y-h.y)-e},j={left:Math.min(g.x,h.x)-e/2,top:Math.min(g.y,h.y)-e/2,width:Math.abs(g.x-h.x)+e,height:Math.abs(g.y-h.y)+e},k=f(i,d),l=f(j,d);return!(!l||k)}function i(a,b,c){return h(a,b,c,15)}function j(a,b,c){return h(a,b,c,25)}function k(a,c){var e=d.getToolState(a.currentTarget,l);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.textStyle.getFontSize(),m=d.ellipticalRoi.getConfiguration(),n=0;n<e.data.length;n++){f.save(),m&&m.shadow&&(f.shadowColor=m.shadowColor||"#000000",f.shadowOffsetX=m.shadowOffsetX||1,f.shadowOffsetY=m.shadowOffsetY||1);var o=e.data[n];h=o.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var p=b.pixelToCanvas(c.element,o.handles.start),q=b.pixelToCanvas(c.element,o.handles.end),r=Math.abs(p.x-q.x),s=Math.abs(p.y-q.y),t=Math.min(p.x,q.x),u=Math.min(p.y,q.y);(p.x+q.x)/2,(p.y+q.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=i,d.drawEllipse(f,t,u,r,s),f.closePath(),d.drawHandles(f,c,o.handles,h),f.font=j;var v,w,x,y;if(o.invalidated){var z=Math.abs(o.handles.start.x-o.handles.end.x),A=Math.abs(o.handles.start.y-o.handles.end.y),B=Math.min(o.handles.start.x,o.handles.end.x),C=Math.min(o.handles.start.y,o.handles.end.y),D=b.getPixels(c.element,B,C,z,A),E={left:B,top:C,width:z,height:A};y=g(D,E),x=Math.PI*(z*c.image.columnPixelSpacing/2)*(A*c.image.rowPixelSpacing/2),o.invalidated=!1,isNaN(x)||(o.area=x),isNaN(y.mean)||isNaN(y.stdDev)||(o.meanStdDev=y)}else v=o.textX,w=o.textY,y=o.meanStdDev,x=o.area;var F,G=0;void 0!==x&&(F="Area: "+x.toFixed(0)+" mm"+String.fromCharCode(178),G=f.measureText(F).width);var H="Mean: "+y.mean.toFixed(1),I=f.measureText(H).width,J="StdDev: "+y.stdDev.toFixed(1),K=f.measureText(J).width;Math.max(I,G,K);v=q.x>p.x?q.x+10:p.x+10,w=q.y>p.y?q.y+10:p.y+10,f.fillStyle=h;var L;y&&(L=Math.max(f.measureText(H).width,f.measureText(J).width)),void 0===x||isNaN(x)||(L=Math.max(L,f.measureText(F).width)),y&&(d.drawTextBox(f,H,v,w-k-5,h,L),d.drawTextBox(f,J,v,w,h,L)),void 0===x||isNaN(x)||d.drawTextBox(f,F,v,w+k+5,h,L),f.restore()}}}var l="ellipticalRoi";d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:k,pointNearTool:i,toolType:l}),d.ellipticalRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:k,pointNearTool:j,toolType:l})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var c=d.getToolState(a.element,t);if(void 0!==c){var e=d.freehand.getConfiguration(),f=c.data[e.currentTool],g={x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0,lines:[]};f.handles.length&&f.handles[e.currentHandle-1].lines.push(a.currentPoints.image),f.handles.push(g),e.currentHandle+=1,e.freehand=!1,b.updateImage(a.element)}}function f(a,e){var f=d.getToolState(a.element,t);if(void 0!==f){var g=f.data[e];if(void 0!==g.handles)for(var h=a.currentPoints.canvas,i=0;i<g.handles.length;i++){var j=b.pixelToCanvas(a.element,g.handles[i]);if(c.point.distance(j,h)<5)return i}}}function g(a){var b=d.getToolState(a.element,t);if(b)for(var c,e=0;e<b.data.length;e++)if(c=f(a,e),void 0!==c)return{handleNearby:c,toolIndex:e}}function h(c,e){a(e.element).off("CornerstoneToolsMouseUp",h);var f=d.getToolState(e.element,t);if(void 0!==f){var g=d.freehand.getConfiguration();e.event.shiftKey||(g.freehand=!1),b.updateImage(e.element)}}function i(a,c){var e=d.getToolState(c.element,t);if(e){var g=d.freehand.getConfiguration(),h=e.data[g.currentTool],i=Math.max(c.currentPoints.image.x,0);i=Math.min(i,c.image.width),g.mouseLocation.handles.start.x=i;var j=Math.max(c.currentPoints.image.y,0);j=Math.min(j,c.image.height),g.mouseLocation.handles.start.y=j;var k=g.currentHandle;if(g.modifying&&(h.active=!0,h.highlight=!0,h.handles[k].x=g.mouseLocation.handles.start.x,h.handles[k].y=g.mouseLocation.handles.start.y,k)){var l=h.handles[k-1].lines.length-1,m=h.handles[k-1].lines[l];m.x=g.mouseLocation.handles.start.x,m.y=g.mouseLocation.handles.start.y}if(g.freehand)h.handles[k-1].lines.push(c.currentPoints.image);else{var n=f(c,g.currentTool);void 0!==n&&n<h.handles.length-1&&(g.mouseLocation.handles.start.x=h.handles[n].x,g.mouseLocation.handles.start.y=h.handles[n].y)}b.updateImage(c.element)}}function j(b){a(b.element).on("CornerstoneToolsMouseMove",i),a(b.element).on("CornerstoneToolsMouseUp",h);var c={visible:!0,active:!0,handles:[]},e=d.freehand.getConfiguration();e.mouseLocation.handles.start.x=b.currentPoints.image.x,e.mouseLocation.handles.start.y=b.currentPoints.image.y,d.addToolState(b.element,t,c);var f=d.getToolState(b.element,t);e.currentTool=f.data.length-1}function k(c,e){var f=d.getToolState(c.element,t);if(f){var g=d.freehand.getConfiguration(),h=f.data[g.currentTool];h.active=!1,h.highlight=!1,void 0!==e&&h.handles[g.currentHandle-1].lines.push(h.handles[e]),g.modifying&&(g.modifying=!1),g.currentHandle=0,g.currentTool=-1,a(c.element).off("CornerstoneToolsMouseMove",i),b.updateImage(c.element)}}function l(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)){var l,m,n=d.getToolState(c.element,t),o=d.freehand.getConfiguration(),p=o.currentTool;if(o.modifying)return void k(c);if(p<0){var q=g(c);q?(l=q.handleNearby,m=q.toolIndex,void 0!==l&&(a(c.element).on("CornerstoneToolsMouseMove",i),a(c.element).on("CornerstoneToolsMouseUp",h),o.modifying=!0,o.currentHandle=l,o.currentTool=m)):(j(c),e(c))}else p>=0&&n.data[p].active&&(l=f(c,p),void 0!==l?k(c,l):c.event.shiftKey?o.freehand=!0:e(c));return!1}}function m(a,c){var e=d.getToolState(a.currentTarget,t);if(void 0!==e){var f=d.freehand.getConfiguration(),g=c.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.toolColors.getFillColor(),k=0;k<e.data.length;k++){g.save();var l=e.data[k];l.active?(h=d.toolColors.getActiveColor(),j=d.toolColors.getFillColor()):(h=d.toolColors.getToolColor(),j=d.toolColors.getToolColor());var m;if(l.handles.length)for(var n=0;n<l.handles.length;n++){m=l.handles[n];var o=b.pixelToCanvas(c.element,m);g.beginPath(),g.strokeStyle=h,g.lineWidth=i,g.moveTo(o.x,o.y);for(var p=0;p<l.handles[n].lines.length;p++){var q=b.pixelToCanvas(c.element,l.handles[n].lines[p]);g.lineTo(q.x,q.y),g.stroke()}var r=b.pixelToCanvas(c.element,f.mouseLocation.handles.start);n===l.handles.length-1&&(!l.active||f.freehand||f.modifying||(g.lineTo(r.x,r.y),g.stroke()))}l.active&&d.drawHandles(g,c,f.mouseLocation.handles,h,j),d.drawHandles(g,c,l.handles,h,j),g.restore()}}}function n(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function o(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneToolsMouseDown",e,l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseDown",e,l),b.updateImage(c)}function q(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function r(){return u}function s(a){u=a}var t="freehand",u={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};d.freehand={enable:n,disable:o,activate:p,deactivate:q,getConfiguration:r,setConfiguration:s}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=d.getToolState(a.event.currentTarget,i);if(!(b&&b.data&&b.data.length>0)){var c={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return c}}function f(a,c,d){var e=b.pixelToCanvas(a,c.handles.start),f=b.pixelToCanvas(a,c.handles.end),g={left:Math.min(e.x,f.x),top:Math.min(e.y,f.y),width:Math.abs(e.x-f.x),height:Math.abs(e.y-f.y)},h=!1;return d.x>=g.left&&d.x<=g.left+g.width&&d.y>=g.top&&d.y<=g.top+g.height&&(h=!0),h}function g(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return i<5}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);var g,h=d.toolStyle.getToolWidth();f.save();var j=e.data[0];if(j){g=j.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var k=b.pixelToCanvas(c.element,j.handles.start),l=b.pixelToCanvas(c.element,j.handles.end),m={left:Math.min(k.x,l.x),top:Math.min(k.y,l.y),width:Math.abs(k.x-l.x),height:Math.abs(k.y-l.y)};f.beginPath(),f.strokeStyle="transparent",f.rect(0,0,f.canvas.clientWidth,f.canvas.clientHeight),f.rect(m.width+m.left,m.top,-m.width,m.height),f.stroke(),f.fillStyle="rgba(0,0,0,0.0)",f.fill(),f.closePath(),f.beginPath(),f.strokeStyle=g,f.lineWidth=h,f.setLineDash([4]),f.strokeRect(m.left,m.top,m.width,m.height),f.setLineDash([]),d.drawHandles(f,c,j.handles,g),f.restore()}}}var i="highlight",j=!0;d.highlight=d.mouseButtonRectangleTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j),d.highlightTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c){a(c).off("CornerstoneToolsKeyDown",b),a(c).on("CornerstoneToolsKeyDown",b)},disable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},enable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},deactivate:function(c){a(c).off("CornerstoneToolsKeyDown",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.keyboardTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,e,f){var g,h={start:b.pixelToCanvas(a,e.handles.start),end:b.pixelToCanvas(a,e.handles.end)},i=c.lineSegment.distanceToPoint(h,f);return g=void 0===d.recognizeR?25:d.recognizeR,i<g}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g=d.toolStyle.getToolWidth(),i=d.length.getConfiguration(),j=0;j<e.data.length;j++){f.save(),i&&i.shadow&&(f.shadowColor=i.shadowColor||"#000000",f.shadowOffsetX=i.shadowOffsetX||1,f.shadowOffsetY=i.shadowOffsetY||1);var k=e.data[j],l=d.toolColors.getColorIfActive(k.active),m=b.pixelToCanvas(c.element,k.handles.start),n=b.pixelToCanvas(c.element,k.handles.end);f.beginPath(),f.strokeStyle=l,f.lineWidth=g,f.moveTo(m.x,m.y),f.lineTo(n.x,n.y),f.stroke(),d.drawHandles(f,c,k.handles,l),f.fillStyle=l;var o=(k.handles.end.x-k.handles.start.x)*(c.image.columnPixelSpacing||1),p=(k.handles.end.y-k.handles.start.y)*(c.image.rowPixelSpacing||1),q=Math.sqrt(o*o+p*p),r=" mm";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(r=" pixels");var s=""+q.toFixed(1)+r,t=d.textStyle.getFontSize(),u={x:Math.max(m.x,n.x)};u.x===m.x?u.y=m.y:u.y=n.y,u.x+=10,u.y-=t/2+7,d.drawTextBox(f,s,u.x,u.y,l),f.restore()}}}var h="length";d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.lengthTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseDrag",h),e(c)}function e(b){a(b.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function f(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseUp",e,d),a(e.element).on("CornerstoneToolsMouseDrag",e,h),i(e),!1}function g(b,c){a(c.element).off("CornerstoneToolsDragEnd",g),a(c.element).off("CornerstoneToolsTouchEnd",g),e(c)}function h(b,c){return i(c),c.isTouchEvent===!0&&(a(c.element).on("CornerstoneToolsDragEnd",g),a(c.element).on("CornerstoneToolsTouchEnd",g)),!1}function i(d){var e=a(d.element).find(".magnifyTool").get(0);e||j(d.element);var f=c.magnify.getConfiguration(),g=f.magnifySize,h=f.magnificationLevel,i=a(d.element).find("canvas").not(".magnifyTool").get(0),k=i.getContext("2d");k.setTransform(1,0,0,1,0,0);var l=e.getContext("2d");l.setTransform(1,0,0,1,0,0);var m=g/h,n=b.pixelToCanvas(d.element,d.currentPoints.image);d.isTouchEvent===!0&&(n.y-=1.25*m),n.x=Math.max(n.x,0),n.x=Math.min(n.x,i.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,i.height),l.clearRect(0,0,g,g),l.fillStyle="transparent",l.fillRect(0,0,g,g);var o={x:n.x-.5*m,y:n.y-.5*m};"Safari"===q&&(o.x=Math.max(o.x,0),o.y=Math.max(o.y,0)),o.x=Math.min(o.x,i.width),o.y=Math.min(o.y,i.height);var p={x:(i.width-o.x)*h,y:(i.height-o.y)*h};l.drawImage(i,o.x,o.y,i.width-o.x,i.height-o.y,0,0,p.x,p.y),e.style.top=n.y-.5*g+"px",e.style.left=n.x-.5*g+"px",e.style.display="block",document.body.style.cursor="none"}function j(b){if(0===a(b).find(".magnifyTool").length){var d=document.createElement("canvas");d.classList.add("magnifyTool");var e=c.magnify.getConfiguration();d.width=e.magnifySize,d.height=e.magnifySize,d.style.position="absolute",d.style.backgroundColor="blue",d.style.border="1px deepskyblue solid",b.appendChild(d)}}function k(b){a(b).find(".magnifyTool").remove()}function l(b){a(b).off("CornerstoneToolsMouseDown",f),k(b)}function m(a){var b=c.magnify.getConfiguration(b);if(!q){var d=c.getBrowserInfo(),e=d.split(" ");q=e[0]}j(a)}function n(b,c){var d={mouseButtonMask:c};a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",d,f),j(b)}function o(){return r}function p(a){r=a}var q,r={magnifySize:400,magnificationLevel:2};c.magnify={enable:m,activate:n,deactivate:l,disable:l,getConfiguration:o,setConfiguration:p};var s={fireOnTouchStart:!0,activateCallback:j,disableCallback:k};c.magnifyTouchDrag=c.touchDragTool(h,s)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d="CornerstoneToolsMultiTouchDrag",e={activate:function(c){a(c).off(d,b),a(c).on(d,b)},disable:function(c){a(c).off(d,b)},enable:function(c){a(c).off(d,b)},deactivate:function(c){a(c).off(d,b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return e}c.multiTouchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a),e=c.metaData.get("imagePlane",d.image.imageId);if(e&&e.rowCosines&&e.columnCosines){var f=c.orientation.getOrientationString(e.rowCosines),g=c.orientation.getOrientationString(e.columnCosines),h=c.orientation.invertOrientationString(f),i=c.orientation.invertOrientationString(g);return{top:i,bottom:g,left:h,right:f}}}function e(a){var c,d=b.getEnabledElement(a);c={x:d.image.width/2,y:5};var e=b.pixelToCanvas(a,c);c={x:d.image.width/2,y:d.image.height-5};var f=b.pixelToCanvas(a,c);c={x:5,y:d.image.height/2};var g=b.pixelToCanvas(a,c);c={x:d.image.width-10,y:d.image.height/2};var h=b.pixelToCanvas(a,c);return{top:e,bottom:f,left:g,right:h}}function f(a,f){var g=f.element,h=d(g);if(h){var i=e(g,h),j=deepCopy1(b.getViewport(g)),k=(j.translation,j.scale,f.canvasContext.canvas.getContext("2d"));k.setTransform(1,0,0,1,0,0);var l=c.toolColors.getToolColor();l="white";var m={top:k.measureText(h.top).width,left:k.measureText(h.left).width,right:k.measureText(h.right).width,bottom:k.measureText(h.bottom).width};if(c.drawTextBox(k,h.top,i.top.x-m.top/2,i.top.y,l),c.drawTextBox(k,h.left,i.left.x-m.left/2,i.left.y,l),0==printStruct.openFlag){var n=c.orientationMarkers.getConfiguration();n&&n.drawAllMarkers&&(c.drawTextBox(k,h.right,i.right.x-m.right/2,i.right.y,l),c.drawTextBox(k,h.bottom,i.bottom.x-m.bottom/2,i.bottom.y,l))}}}c.orientationMarkers=c.displayTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1}function f(a,c){var d=c.viewport.scale*b.diy.iniScaleCal(c);return c.viewport.translation.x+=c.deltaPoints.page.x/d,c.viewport.translation.y+=c.deltaPoints.page.y/d,b.setViewport(c.element,c.viewport),!1}c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d){var e=c.panMultiTouch.getConfiguration();if(e&&e.testPointers(d)){var f=d.viewport.scale*b.diy.iniScaleCal(d);return d.viewport.translation.x+=d.deltaPoints.page.x/f,d.viewport.translation.y+=d.deltaPoints.page.y/f,b.setViewport(d.element,d.viewport),!1}}var e={testPointers:function(a){return a.numPointers>=2}};c.panMultiTouch=c.multiTouchDragTool(d),c.panMultiTouch.setConfiguration(e)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b={visible:!0,active:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end);return cornerstoneMath.point.distance(e,d)<1.2}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=c.textStyle.getFont(),j=c.textStyle.getFontSize(),k=0;k<e.data.length;k++){f.save();var l=e.data[k];h=l.active?c.toolColors.getActiveColor():c.toolColors.getToolColor(),c.drawHandles(f,d,l.handles,h,void 0,{R:1.2});var m,n,o,p=Math.round(l.handles.end.x),q=Math.round(l.handles.end.y);if(p<0||q<0||p>=d.image.columns||q>=d.image.rows)return;if(d.image.color)n=""+p+", "+q,m=c.getRGBPixels(d.element,p,q,1,1),o="R: "+m[0]+" G: "+m[1]+" B: "+m[2];else{m=b.getStoredPixels(d.element,p,q,1,1);var r=m[0],s=r*d.image.slope+d.image.intercept;c.calculateSUV(d.image,r);n="X,Y: "+p+", "+q,o="MO : "+parseFloat(s.toFixed(1));var t=Math.max(f.measureText(n).width,f.measureText(o).width)}var u={x:l.handles.end.x+3,y:l.handles.end.y-3},v=b.pixelToCanvas(d.element,u);f.font=i,f.fillStyle=h,c.drawTextBox(f,n,v.x+5,v.y+j+5,h,t),c.drawTextBox(f,o,v.x+5,v.y,h,t),f.restore()}}}var g="probe";c.probe=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g}),c.probeTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return i<5}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,j=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.textStyle.getFontSize(),m=0;m<e.data.length;m++){f.save();var n=e.data[m];h=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.end),q=Math.abs(o.x-p.x),r=Math.abs(o.y-p.y),s=Math.min(o.x,p.x),t=Math.min(o.y,p.y);(o.x+p.x)/2,(o.y+p.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=j,f.rect(s,t,q,r),f.stroke(),d.drawHandles(f,c,n.handles,h);var u=Math.abs(n.handles.start.x-n.handles.end.x),v=Math.abs(n.handles.start.y-n.handles.end.y),w=Math.min(n.handles.start.x,n.handles.end.x),x=Math.min(n.handles.start.y,n.handles.end.y),y=b.getPixels(c.element,w,x,u,v),z={left:w,top:x,width:u,height:v},A=g(y,z),B=u*c.image.columnPixelSpacing*(v*c.image.rowPixelSpacing),C="Area: "+B.toFixed(0)+" mm"+String.fromCharCode(178);f.font=k;var D=(f.measureText(B),p.x>o.x?p.x+10:o.x+10),E=p.y>o.y?p.y+10:o.y+10;f.fillStyle=h;var F="Mean: "+A.mean.toFixed(1),G="StdDev: "+A.stdDev.toFixed(1),H=Math.max(f.measureText(F).width,f.measureText(G).width);H=Math.max(u,f.measureText(C).width),d.drawTextBox(f,"Mean: "+A.mean.toFixed(1),D,E-l-5,h,H),d.drawTextBox(f,"StdDev: "+A.stdDev.toFixed(1),D,E,h,H),d.drawTextBox(f,C,D,E+l+5,h,H),f.restore()}}}var i="rectangleRoi";d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d.rectangleRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=a.element.getBoundingClientRect(a.element),d={x:a.currentPoints.client.x,y:a.currentPoints.client.y},e=a.element.clientWidth,f=a.element.clientHeight,g={x:d.x-c.left-e/2,y:-1*(d.y-c.top-f/2)},h=Math.atan2(g.y,g.x),i=h*(180/Math.PI),j=-1*i+90;a.viewport.rotation=j,b.setViewport(a.element,a.viewport)}function e(a){a.viewport.rotation+=a.deltaPoints.page.x/a.viewport.scale,b.setViewport(a.element,a.viewport)}function f(a){a.viewport.rotation+=a.deltaPoints.page.y/a.viewport.scale,b.setViewport(a.element,a.viewport)}function g(b,c){a(c.element).off("CornerstoneToolsMouseDrag",i),a(c.element).off("CornerstoneToolsMouseUp",g),a(c.element).off("CornerstoneToolsMouseClick",g)}function h(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return a(d.element).on("CornerstoneToolsMouseDrag",i),a(d.element).on("CornerstoneToolsMouseUp",g),a(d.element).on("CornerstoneToolsMouseClick",g),!1}function i(a,d){return c.rotate.strategy(d),b.setViewport(d.element,d.viewport),!1}c.rotate=c.simpleMouseButtonTool(h),c.rotate.strategies={"default":d,horizontal:e,vertical:f},c.rotate.strategy=d,c.rotateTouchDrag=c.touchDragTool(i)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c){return c.viewport.rotation+=c.rotation,b.setViewport(c.element,c.viewport),!1}function e(b){a(b).off("CornerstoneToolsTouchRotate",d)}function f(b){a(b).off("CornerstoneToolsTouchRotate",d),a(b).on("CornerstoneToolsTouchRotate",d)}c.rotateTouch={activate:f,disable:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d=a(b).find("canvas").get(0),e=document.createElement("a");if(e.download=c,e.href=d.toDataURL(),document.createEvent){var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(f)}else e.fireEvent&&e.fireEvent("onclick")}c.saveAs=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},middle:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.middle)},g=c.lineSegment.distanceToPoint(f,e);return g<25||(f.start=b.pixelToCanvas(a,d.handles.middle),f.end=b.pixelToCanvas(a,d.handles.end),g=c.lineSegment.distanceToPoint(f,e),g<25)}function g(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}function h(a,c){var e=d.getToolState(a.currentTarget,k);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),l=d.simpleAngle.getConfiguration(),m=0;m<e.data.length;m++){f.save(),l&&l.shadow&&(f.shadowColor=l.shadowColor||"#000000",f.shadowOffsetX=l.shadowOffsetX||1,f.shadowOffsetY=l.shadowOffsetY||1);var n=e.data[m];h=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=h,f.lineWidth=i;var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.middle);f.moveTo(o.x,o.y),f.lineTo(p.x,p.y);var q=b.pixelToCanvas(c.element,n.handles.end);f.lineTo(q.x,q.y),f.stroke(),d.drawHandles(f,c,n.handles,h),f.fillStyle=h;var r=c.image.columnPixelSpacing||1,s=c.image.rowPixelSpacing||1,t="";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(t=" (isotropic)");var u={x:(Math.ceil(n.handles.middle.x)-Math.ceil(n.handles.start.x))*r,y:(Math.ceil(n.handles.middle.y)-Math.ceil(n.handles.start.y))*s},v={x:(Math.ceil(n.handles.end.x)-Math.ceil(n.handles.middle.x))*r,y:(Math.ceil(n.handles.end.y)-Math.ceil(n.handles.middle.y))*s},w={x:(Math.ceil(n.handles.end.x)-Math.ceil(n.handles.start.x))*r,y:(Math.ceil(n.handles.end.y)-Math.ceil(n.handles.start.y))*s},x=g(u),y=g(v),z=g(w),A=Math.acos((Math.pow(x,2)+Math.pow(y,2)-Math.pow(z,2))/(2*x*y));A*=180/Math.PI;var B=d.roundToDecimal(A,2);if(B){var C="00B0",D=B.toString()+String.fromCharCode(parseInt(C,16))+t,E=15,F=p.x+E,G=p.y+E;f.font=j;var H=f.measureText(D).width;F=p.x-o.x<0?p.x-E-H-10:p.x+E,G=p.y,d.drawTextBox(f,D,F,G,h)}f.restore()}}}function i(c){var f=e(c),g=c.element,h={mouseButtonMask:c.which};d.addToolState(g,k,f),a(g).off("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDown",d.simpleAngle.mouseDownCallback),a(g).off("CornerstoneToolsMouseDownActivate",d.simpleAngle.mouseDownActivateCallback),b.updateImage(g),d.moveNewHandle(c,k,f,f.handles.middle,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),f.handles.end.active=!0,b.updateImage(g),d.moveNewHandle(c,k,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),a(g).on("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDown",h,d.simpleAngle.mouseDownCallback),a(g).on("CornerstoneToolsMouseDownActivate",h,d.simpleAngle.mouseDownActivateCallback),b.updateImage(g)})})}function j(c){var f=e(c),g=c.element;d.addToolState(g,k,f),a(g).off("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).off("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).off("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).off("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),b.updateImage(g),d.moveNewHandleTouch(c,f.handles.middle,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),f.handles.end.active=!0,b.updateImage(g),d.moveNewHandleTouch(c,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),a(g).on("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).on("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).on("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).on("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),b.updateImage(g)})})}var k="simpleAngle";d.simpleAngle=d.mouseButtonTool({createNewMeasurement:e,addNewMeasurement:i,onImageRendered:h,pointNearTool:f,toolType:k}),d.simpleAngleTouch=d.touchTool({createNewMeasurement:e,addNewMeasurement:j,onImageRendered:h,pointNearTool:f,toolType:k})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b=c.textMarker.getConfiguration();if(b.current){var d={visible:!0,active:!0,text:b.current,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}},e=b.markers.indexOf(b.current);return b.ascending?(e+=1,e>=b.markers.length&&(b.loop?e-=b.markers.length:e=-1)):(e-=1,e<0&&(b.loop?e+=b.markers.length:e=-1)),b.current=b.markers[e],d}}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end),f={left:e.x-c.textWidth/2,top:e.y,width:c.textWidth,height:c.textHeight},g=cornerstoneMath.rect.distanceToPoint(f,d);return g<10}function f(a,d){var e=c.getToolState(d.element,i);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g=c.textStyle.getFont(),h=c.textStyle.getFontSize(),j=c.textMarker.getConfiguration(),k=0;k<e.data.length;k++){var l=e.data[k],m=c.toolColors.getToolColor();l.active&&(m=c.toolColors.getActiveColor()),f.save(),j&&j.shadow&&(f.shadowColor=j.shadowColor||"#000000",f.shadowOffsetX=j.shadowOffsetX||1,f.shadowOffsetY=j.shadowOffsetY||1),f.font=g,f.fillStyle=m;var n=f.measureText(l.text);l.textWidth=n.width,l.textHeight=h;var o={x:l.handles.end.x,y:l.handles.end.y},p=b.pixelToCanvas(d.element,o);
c.drawTextBox(f,l.text,p.x-l.textWidth/2,p.y,m),f.restore()}}}function g(d,f){function g(d,e,g){g===!0?c.removeToolState(j,i,d):d.text=e,d.active=!1,b.updateImage(j),a(j).on("CornerstoneToolsMouseMove",f,c.textMarker.mouseMoveCallback),a(j).on("CornerstoneToolsMouseDown",f,c.textMarker.mouseDownCallback),a(j).on("CornerstoneToolsMouseDownActivate",f,c.textMarker.mouseDownActivateCallback),a(j).on("CornerstoneToolsMouseDoubleClick",f,c.textMarker.mouseDoubleClickCallback)}var h,j=f.element;if(d.data&&d.data.mouseButtonMask&&!c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask))return!1;var k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsMouseMove",c.textMarker.mouseMoveCallback),a(j).off("CornerstoneToolsMouseDown",c.textMarker.mouseDownCallback),a(j).off("CornerstoneToolsMouseDownActivate",c.textMarker.mouseDownActivateCallback),a(j).off("CornerstoneToolsMouseDoubleClick",c.textMarker.mouseDoubleClickCallback),k.changeTextCallback(h,g),d.stopImmediatePropagation(),!1;return!1}function h(d,f){function g(d,e,f){f===!0?c.removeToolState(j,i,d):d.text=e,d.active=!1,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),a(j).on("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).on("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).on("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).on("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).on("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback)}var h,j=f.element;if(d.data&&d.data.mouseButtonMask&&!c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask))return!1;var k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),k.changeTextCallback(h,g),d.stopImmediatePropagation(),!1;return!1}var i="textMarker";c.textMarker=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,mouseDoubleClickCallback:g}),c.textMarkerTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,pressCallback:h})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseDrag",g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1}function f(a){var b=a.image.maxPixelValue/maxminScale*a.image.slope+a.image.intercept,c=a.image.minPixelValue/maxminScale*a.image.slope+a.image.intercept,d=b-c,e=d/1024,f=a.deltaPoints.page.x*e,g=a.deltaPoints.page.y*e;a.viewport.voi.windowWidth+=f,a.viewport.voi.windowCenter+=g}function g(a,d){return c.wwwc.strategy(d),b.setViewport(d.element,d.viewport),!1}function h(a,d){a.stopImmediatePropagation();var e=d,f=e.image.maxPixelValue/maxminScale*e.image.slope+e.image.intercept,g=e.image.minPixelValue/maxminScale*e.image.slope+e.image.intercept,h=f-g,i=h/1024,j=e.deltaPoints.page.x*i,k=e.deltaPoints.page.y*i,l=c.wwwc.getConfiguration();l.orientation?0===l.orientation?(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k):(e.viewport.voi.windowWidth+=k,e.viewport.voi.windowCenter+=j):(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k),b.setViewport(e.element,e.viewport)}c.wwwc=c.simpleMouseButtonTool(e),c.wwwc.strategies={"default":f},c.wwwc.strategy=f,c.wwwcTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b,c){var d=a.length;if(d<2)return{min:b,max:c,mean:(b+c)/2};for(var e=c,f=b,g=0,h=0;h<d;h++){var i=a[h];e=Math.min(e,i),f=Math.max(f,i),g+=i}return{min:e,max:f,mean:g/d}}function f(b,c){a(c.element).off("CornerstoneToolsMouseMove",k),a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseClick",f);var e=d.getToolState(c.element,s);if(e&&e.data.length){var h={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=h,g(c);var j={mouseButtonMask:c.which};a(c.element).on("CornerstoneToolsMouseDown",j,i)}}function g(a){var c=d.getToolState(a.element,s);if(c&&c.data.length){var f=c.data[0].startPoint,g=c.data[0].endPoint,h=Math.abs(f.x-g.x),i=Math.abs(f.y-g.y),j=Math.min(f.x,g.x),k=Math.min(f.y,g.y);j=Math.max(j,0),j=Math.min(j,a.image.width),k=Math.max(k,0),k=Math.min(k,a.image.height),h=Math.floor(Math.min(h,Math.abs(a.image.width-j))),i=Math.floor(Math.min(i,Math.abs(a.image.height-k)));var l=d.getLuminance(a.element,j,k,h,i),m=e(l,a.image.minPixelValue,a.image.maxPixelValue),n=d.wwwcRegion.getConfiguration(),o=b.getViewport(a.element);void 0===n.minWindowWidth&&(n.minWindowWidth=10),o.voi.windowWidth=Math.max(Math.abs(m.max-m.min),n.minWindowWidth),o.voi.windowCenter=m.mean,b.setViewport(a.element,o),c.data=[],b.updateImage(a.element)}}function h(b,c){var d=c.element;a(d).off("CornerstoneToolsMouseMove"),a(d).off("CornerstoneToolsMouseDrag"),a(d).on("CornerstoneToolsMouseMove",k),a(d).on("CornerstoneToolsMouseDrag",k),a(d).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===b.type&&a(d).on("CornerstoneToolsMouseUp",f)}function i(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask))return a(c.element).on("CornerstoneToolsMouseDrag",c,h),a(c.element).on("CornerstoneToolsMouseMove",c,h),a(c.element).on("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseDown"),j(c),!1}function j(a){var b=d.getToolState(a.element,s);b&&b.data&&(b.data=[]);var c={startPoint:{x:a.currentPoints.image.x,y:a.currentPoints.image.y}};d.addToolState(a.element,s,c)}function k(a,c){var e=d.getToolState(c.element,s);if(void 0!==e&&e.data.length){var f={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=f,b.updateImage(c.element)}}function l(c,e){var f=d.getToolState(e.element,s);if(f&&f.data.length){var g=f.data[0].startPoint,h=f.data[0].endPoint;if(g&&h){var i=a(e.element).find("canvas").get(0),j=i.getContext("2d");j.setTransform(1,0,0,1,0,0);var k=d.toolColors.getActiveColor(),l=b.pixelToCanvas(e.element,g),m=b.pixelToCanvas(e.element,h),n=Math.min(l.x,m.x),o=Math.min(l.y,m.y),p=Math.abs(l.x-m.x),q=Math.abs(l.y-m.y),r=d.toolStyle.getToolWidth(),t=d.wwwcRegion.getConfiguration();j.save(),t&&t.shadow&&(j.shadowColor=t.shadowColor||"#000000",j.shadowOffsetX=t.shadowOffsetX||1,j.shadowOffsetY=t.shadowOffsetY||1),j.beginPath(),j.strokeStyle=k,j.lineWidth=r,j.rect(n,o,p,q),j.stroke(),j.restore()}}}function m(c){a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneImageRendered",l),b.updateImage(c)}function n(c,e){var g={mouseButtonMask:e},h=d.getToolState(c,s);if(!h){var j=[];d.addToolState(c,s,j)}a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseUp",f),a(c).off("CornerstoneToolsMouseDrag",k),a(c).off("CornerstoneImageRendered",l),a(c).on("CornerstoneToolsMouseDown",g,i),a(c).on("CornerstoneImageRendered",l),b.updateImage(c)}function o(b){a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l)}function p(b){var c=d.getToolState(b,s);if(void 0===c){var e=[];d.addToolState(b,s,e)}a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l),a(b).on("CornerstoneToolsTouchDrag",k),a(b).on("CornerstoneToolsTouchStart",j),a(b).on("CornerstoneToolsDragEnd",g),a(b).on("CornerstoneImageRendered",l)}function q(){return t}function r(a){t=a}var s="wwwcRegion",t={minWindowWidth:10};d.wwwcRegion={activate:n,deactivate:m,disable:m,setConfiguration:r,getConfiguration:q},d.wwwcRegionTouch={activate:p,deactivate:o,disable:o}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=c.zoom.getConfiguration(),e=1.7,f=Math.log(a.scale)/Math.log(e),g=f+b,h=Math.pow(e,g);return d.maxScale&&h>d.maxScale?a.scale=d.maxScale:d.minScale&&h<d.minScale?a.scale=d.minScale:a.scale=h,a}function e(a,b,c){return a.x=Math.max(a.x,0),a.y=Math.max(a.y,0),a.x=Math.min(a.x,b),a.y=Math.min(a.y,c),a}function f(a,b){if(0!==b.rotation){var c=b.rotation*Math.PI/180,d=Math.cos(c),e=Math.sin(c),f=a.x*d-a.y*e,g=a.x*e+a.y*d;a.x=f,a.y=g}return b.hflip&&(a.x*=-1),b.vflip&&(a.y*=-1),a}function g(a,c){var e=a.element,f=d(a.viewport,c);b.setViewport(e,f)}function h(a,g){var h=a.element,i=a.image,j=d(a.viewport,g);b.setViewport(h,j);var k,l,m=c.zoom.getConfiguration(),o=8,p=8,q=3,r=.01;if(g<0){if(k={x:j.scale<q?j.translation.x/o:0,y:j.scale<q?j.translation.y/o:0},Math.abs(j.translation.x)<r)j.translation.x=0,k.x=0;else if(Math.abs(j.translation.y)<r)j.translation.y=0,k.y=0;else if(Math.abs(j.translation.x)<r&&Math.abs(j.translation.y)<r)return b.setViewport(h,j),!1}else{l=b.pageToPixel(h,n.page.x,n.page.y),m&&m.preventZoomOutsideImage&&(n.image=e(n.image,i.width,i.height),l=e(l,i.width,i.height));var s={x:i.width/2-n.image.x,y:i.height/2-n.image.y},t={x:j.translation.x-s.x,y:j.translation.y-s.y};if(k={x:t.x/p,y:t.y/p},Math.abs(t.x)<r)j.translation.x=s.x,k.x=0;else if(Math.abs(t.y)<r)j.translation.y=s.y,k.y=0;else if(Math.abs(t.x)<r&&Math.abs(t.y)<r)return b.setViewport(h,j),!1}return k=f(k,j),!(!k.x&&!k.y)&&(j.translation.x-=k.x,j.translation.y-=k.y,void b.setViewport(h,j))}function i(b,c){a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",i),a(c.element).off("CornerstoneToolsMouseClick",i)}function j(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return n=d.startPoints,a(d.element).on("CornerstoneToolsMouseDrag",k),a(d.element).on("CornerstoneToolsMouseUp",i),a(d.element).on("CornerstoneToolsMouseClick",i),!1}function k(a,b){if(!b.deltaPoints.page.y)return!1;var d=b.deltaPoints.page.y/100;return c.zoom.strategy(b,d),!1}function l(a,c){var e=-c.direction/4,f=d(c.viewport,e);b.setViewport(c.element,f)}function m(a,d){var e=c.zoom.getConfiguration(),g=d.viewport,h=d.element;g.scale+=d.scaleChange*g.scale,e.maxScale&&g.scale>e.maxScale?g.scale=e.maxScale:e.minScale&&g.scale<e.minScale&&(g.scale=e.minScale),b.setViewport(h,g);var i=b.pageToPixel(h,d.startPoints.page.x,d.startPoints.page.y),j={x:d.startPoints.image.x-i.x,y:d.startPoints.image.y-i.y};j=f(j,g),g.translation.x-=j.x,g.translation.y-=j.y,b.setViewport(h,g)}var n;c.zoom=c.simpleMouseButtonTool(j),c.zoom.strategies={"default":g,translate:h},c.zoom.strategy=g,c.zoomWheel=c.mouseWheelTool(l),c.zoomTouchPinch=c.touchPinchTool(m),c.zoomTouchDrag=c.touchDragTool(k)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d=c.currentTarget,e={event:window.event||c,element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,currentPoints:{page:{x:h,y:i},image:b.pageToPixel(d,h,i)},keyCode:c.keyCode,which:c.which};e.currentPoints.canvas=b.pixelToCanvas(d,e.currentPoints.image);var f={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};a(d).trigger(f[c.type],e)}function e(a){h=a.pageX||a.originalEvent.pageX,i=a.pageY||a.originalEvent.pageY}function f(b){g(b),a(b).on(j,d),a(b).on("mousemove",e)}function g(b){a(b).off(j,d),a(b).off("mousemove",e)}var h,i,j="keydown keypress keyup";c.keyboardInput={enable:f,disable:g}}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){var c=Date.now();if(a!==g){if(c-h<=i)return b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),!1;g=a}h=c}function c(a,b,c){var d=c?k:l;b.forEach(function(b){a.addEventListener(b,d,!0)})}function d(a,b,c){var d=c?k:l;b.forEach(function(b){a.removeEventListener(b,d,!0)})}function e(a){d(a,m,j.mouse),d(a,n,j.touch)}function f(a){e(a),c(a,m,j.mouse),c(a,n,j.touch)}var g,h,i=2e3,j={mouse:0,touch:1},k=b.bind(null,j.mouse),l=b.bind(null,j.touch),m=["mousedown","mouseup"],n=["touchstart","touchend"];a.preventGhostClick={enable:f,disable:e}}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b){var d=a.image,e={left:0,top:0,width:d.width,height:d.height},f=!1;return Object.keys(b).forEach(function(a){var d=b[a];d.allowedOutsideImage!==!0&&c.point.insideRect(d,e)===!1&&(f=!0)}),f}d.anyHandlesOutsideImage=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b){"use strict";function c(c,e,f,g,h,i){c.strokeStyle=g,i||(i={}),Object.keys(f).forEach(function(g){var j=f[g];if(j.drawnIndependently!==!0){c.beginPath(),j.active?c.lineWidth=b.toolStyle.getActiveWidth():c.lineWidth=b.toolStyle.getToolWidth();var k=a.pixelToCanvas(e.element,j),l=i.R?i.R:b.handleR||d;c.arc(k.x,k.y,l,0,2*Math.PI),h&&(c.fillStyle=h,c.fill()),c.stroke()}})}var d=6;b.drawHandles=c}(cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,d,e,f){var g;if(d)return Object.keys(d).forEach(function(h){var i=d[h];if(i.hasOwnProperty("pointNearHandle")){if(i.pointNearHandle(a,i,e))return void(g=i)}else{var j=b.pixelToCanvas(a,i),k=c.point.distance(j,e);if(k<=f)return void(g=i)}}),g}d.getHandleNearImagePoint=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b;return Object.keys(a).forEach(function(c){var d=a[c];if(d.active===!0)return void(b=d)}),b}function f(a,b,c,f){f||(f=36);var g=e(b),h=d.getHandleNearImagePoint(a,b,c,f);return g!==h&&(void 0!==h&&(h.active=!0),void 0!==g&&(g.active=!1),!0)}d.handleActivator=f}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y,h.preventHandleOutsideImage===!0&&(b.x=Math.max(b.x,0),b.x=Math.min(b.x,d.image.width),b.y=Math.max(b.y,0),b.y=Math.min(b.y,d.image.height)))}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",i={toolType:g,element:l,measurementData:e};return a(l).trigger(f,i),!1}function k(d,g){if(e.active=!1,e.invalidated=!0,a(l).off("CornerstoneToolsMouseDrag",j),a(l).off("CornerstoneToolsMouseUp",k),a(l).off("CornerstoneToolsMouseClick",k),h.deleteIfHandleOutsideImage===!0){var m=g.image,n=!1,o={top:0,left:0,width:m.width,height:m.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];if(b.active=!1,c.point.insideRect(b,o)===!1)return n=!0,!1}),n){var p=-1;f.data.forEach(function(a,b){if(a===e)return p=b,!1}),p!==-1&&f.data.splice(p,1)}}b.updateImage(l),"function"==typeof i&&i()}var l=d.element;return a(l).on("CornerstoneToolsMouseDrag",j),a(l).on("CornerstoneToolsMouseUp",k),a(l).on("CornerstoneToolsMouseClick",k),!0}d.moveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x+l.x,f.y=g.currentPoints.image.y+l.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(k);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:k,measurementData:e};a(k).trigger(i,j)}function j(){f.active=!1,a(k).off("CornerstoneToolsMouseDrag",i),a(k).off("CornerstoneToolsMouseUp",j),a(k).off("CornerstoneToolsMouseClick",j),b.updateImage(k),"function"==typeof g&&g()}var k=c.element,l={x:f.x-c.currentPoints.image.x,y:f.y-c.currentPoints.image.y};a(k).on("CornerstoneToolsMouseDrag",i),a(k).on("CornerstoneToolsMouseUp",j),a(k).on("CornerstoneToolsMouseClick",j)}c.moveHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x,f.y=g.currentPoints.image.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(m);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:m,measurementData:e};a(m).trigger(i,j)}function j(b){a(m).off("CornerstoneToolsMouseMove"),a(m).off("CornerstoneToolsMouseDrag"),a(m).on("CornerstoneToolsMouseMove",i),a(m).on("CornerstoneToolsMouseDrag",i),a(m).on("CornerstoneToolsMouseClick",l),"CornerstoneToolsMouseDrag"===b.type&&a(m).on("CornerstoneToolsMouseUp",l)}function k(a,b){b.measurementData===e&&l()}function l(){a(m).off("CornerstoneToolsMouseMove",i),a(m).off("CornerstoneToolsMouseDrag",i),a(m).off("CornerstoneToolsMouseClick",l),a(m).off("CornerstoneToolsMouseUp",l),a(m).off("CornerstoneToolsMeasurementRemoved",k),f.active=!1,b.updateImage(m),"function"==typeof g&&g()}var m=c.element;a(m).on("CornerstoneToolsMouseDrag",j),a(m).on("CornerstoneToolsMouseMove",j),a(m).on("CornerstoneToolsMeasurementRemoved",k)}c.moveNewHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x+m.x,f.y=g.currentPoints.image.y+m.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(k);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:k,measurementData:e};a(k).trigger(i,j)}function j(c,d){return a(k).off("CornerstoneToolsTouchDrag",i),a(k).off("CornerstoneToolsTouchPinch",j),a(k).off("CornerstoneToolsTouchPress",j),a(k).off("CornerstoneToolsTouchEnd",j),a(k).off("CornerstoneToolsDragEnd",j),a(k).off("CornerstoneToolsTap",j),"CornerstoneToolsTouchPinch"===c.type||"CornerstoneToolsTouchPress"===c.type?(f.active=!1,b.updateImage(k),void g()):(f.active=!1,f.x=d.currentPoints.image.x+m.x,f.y=d.currentPoints.image.y+m.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,d.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,d.image.height)),b.updateImage(k),void("function"==typeof g&&g()))}var k=c.element,l=b.pageToPixel(k,c.currentPoints.page.x,c.currentPoints.page.y+50),m={x:f.x-l.x,y:f.y-l.y};a(k).on("CornerstoneToolsTouchDrag",i),a(k).on("CornerstoneToolsTouchPinch",j),a(k).on("CornerstoneToolsTouchPress",j),a(k).on("CornerstoneToolsTouchEnd",j),a(k).on("CornerstoneToolsDragEnd",j),a(k).on("CornerstoneToolsTap",j)}c.moveNewHandleTouch=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y)}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",h={toolType:g,element:l,measurementData:e};return a(l).trigger(f,h),!1}function k(d,g){if(e.active=!1,e.invalidated=!1,a(l).off("CornerstoneToolsTouchDrag",j),a(l).off("CornerstoneToolsTouchPinch",k),a(l).off("CornerstoneToolsTouchPress",k),a(l).off("CornerstoneToolsTouchEnd",k),a(l).off("CornerstoneToolsDragEnd",k),a(l).off("CornerstoneToolsTap",k),h===!0){var m=g.image,n=!1,o={top:0,left:0,width:m.width,height:m.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];if(c.point.insideRect(b,o)===!1)return void(n=!0)}),n){for(var p=-1,q=0;q<f.data.length;q++)f.data[q]===e&&(p=q);p!==-1&&f.data.splice(p,1)}}"function"==typeof i&&i(),b.updateImage(l)}var l=d.element;return a(l).on("CornerstoneToolsTouchDrag",j),a(l).on("CornerstoneToolsTouchPinch",k),a(l).on("CornerstoneToolsTouchPress",k),a(l).on("CornerstoneToolsTouchEnd",k),a(l).on("CornerstoneToolsDragEnd",k),a(l).on("CornerstoneToolsTap",k),!0}d.touchMoveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g){function h(c,g){f.active=!0;var h=g;f.x=h.currentPoints.image.x+k.x,f.y=h.currentPoints.image.y+k.y,b.updateImage(j);var i="CornerstoneToolsMeasurementModified",l={toolType:d,element:j,measurementData:e};a(j).trigger(i,l)}function i(){f.active=!1,a(j).off("CornerstoneToolsTouchDrag",h),a(j).off("CornerstoneToolsTouchPinch",i),a(j).off("CornerstoneToolsTouchEnd",i),a(j).off("CornerstoneToolsDragEnd",i),a(j).off("CornerstoneToolsTap",i),b.updateImage(j),"function"==typeof g&&g()}var j=c.element,k={x:f.x-c.currentPoints.image.x,y:f.y-c.currentPoints.image.y};a(j).on("CornerstoneToolsTouchDrag",h),a(j).on("CornerstoneToolsTouchPinch",i),a(j).on("CornerstoneToolsTouchEnd",i),a(j).on("CornerstoneToolsDragEnd",i),a(j).on("CornerstoneToolsTap",i)}c.touchMoveHandle=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.samples=[],this.set=function(c){b.samples=c,a(b).trigger("CornerstoneLineSampleUpdated")}}b.LineSampleMeasurement=c}($,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.measurements=[],this.add=function(c){var d=b.measurements.push(c),e={index:d,measurement:c};a(b).trigger("CornerstoneMeasurementAdded",e)},this.remove=function(c){var d=b.measurements[c];b.measurements.splice(c,1);var e={index:c,measurement:d};a(b).trigger("CornerstoneMeasurementRemoved",e)}}b.MeasurementManager=new c}($,cornerstoneTools),function(a,b,c){"use strict";function d(a){g.push(a)}function e(a){var b=g.indexOf(a);b!==-1&&g.splice(b,1)}function f(b,c){var d;return a.each(g,function(a,e){if(d=e(b,c),void 0!==d)return!0}),d}var g=[];c.metaData={addProvider:d,removeProvider:e,get:f}}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b){for(var c="",d=b.x<0?"R":"L",e=b.y<0?"A":"P",f=b.z<0?"F":"H",g=new a.Vector3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z)),h=0;h<3;h++)if(g.x>1e-4&&g.x>g.y&&g.x>g.z)c+=d,g.x=0;else if(g.y>1e-4&&g.y>g.x&&g.y>g.z)c+=e,g.y=0;else{if(!(g.z>1e-4&&g.z>g.x&&g.z>g.y))break;c+=f,g.z=0}return c}b.orientation.getOrientationString=c}(cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a){var b=a.replace("H","f");return b=b.replace("F","h"),b=b.replace("R","l"),b=b.replace("L","r"),b=b.replace("A","p"),b=b.replace("P","a"),b=b.toUpperCase()}a.orientation.invertOrientationString=b}(cornerstoneTools),function(a){"use strict";function b(b,c){var d=a.planePlaneIntersection(b,c);if(d)return{start:a.projectPatientPointToImagePlane(d.start,b),end:a.projectPatientPointToImagePlane(d.end,b)}}a.referenceLines.calculateReferenceLine=b}(cornerstoneTools),function(a,b,c){"use strict";function d(d,e){var f=c.getToolState(d.currentTarget,g);if(void 0!==f){var h=f.data[0].synchronizationContext,i=h.getSourceElements(),j=f.data[0].renderer,k=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,k),a.each(i,function(a,b){b!==d.currentTarget&&j(k,e,d.currentTarget,b)})}}function e(e,f,h){h=h||c.referenceLines.renderActiveReferenceLine,c.addToolState(e,g,{synchronizationContext:f,renderer:h}),a(e).on("CornerstoneImageRendered",d),b.updateImage(e)}function f(c){a(c).off("CornerstoneImageRendered",d),b.updateImage(c)}var g="referenceLines";c.referenceLines.tool={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){var g=b.getEnabledElement(e).image,h=b.getEnabledElement(f).image;if(g&&h){if(_&&dvStruct&&_.isObject(dvStruct)){var i=dvStruct.viewer.getCheckedWin();if(i){if(dvStruct.viewer.isInWin(e,i)||!dvStruct.viewer.isInWin(f,i))return;if(dvStruct.viewer.isInSameWin(e,f))return}}var j=c.metaData.get("imagePlane",g.imageId),k=c.metaData.get("imagePlane",h.imageId);if(j&&k){var l=j.rowCosines.clone().cross(j.columnCosines),m=k.rowCosines.clone().cross(k.columnCosines),n=l.angleTo(m);if(n=Math.abs(n),!(n<.5)){var o=c.referenceLines.calculateReferenceLine(j,k);if(!o){var p=getObj(j),q=getObj(k);if(o=xloc.LocalCalc(p,q),!o)return}var r=b.pixelToCanvas(d.element,o.start),s=b.pixelToCanvas(d.element,o.end),t=c.toolColors.getActiveColor(),u=c.toolStyle.getToolWidth();if(a.setTransform(1,0,0,1,0,0),i){var v=dvStruct.findSeriesByElement(f);if(v){for(var w=[],x=0;x<v.sideImageIds.length;x++){var y=v.sideImageIds[x].farsideImageId,z=v.sideImageIds[x].nearsideImageId,A=c.metaData.get("imagePlane",y),B=A.rowCosines.clone().cross(A.columnCosines),n=m.angleTo(B);if(n=Math.abs(n),n<.1){w.push(y),w.push(z);break}}if(w.length>0)for(var x=0;x<w.length;x++){var C=c.metaData.get("imagePlane",w[x]);if(C){var D=C.rowCosines.clone().cross(C.columnCosines),n=l.angleTo(D);if(n=Math.abs(n),!(n<.5)){var E=c.referenceLines.calculateReferenceLine(j,C);if(E){var F=b.pixelToCanvas(d.element,E.start),G=b.pixelToCanvas(d.element,E.end);a.save(),a.beginPath(),a.strokeStyle="#FF4600",a.lineWidth=u,a.moveTo(F.x,F.y),a.lineTo(G.x,G.y),a.stroke(),a.restore()}}}}}}a.save(),a.beginPath(),a.strokeStyle=t,a.lineWidth=u,a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.stroke(),a.restore()}}}}c.referenceLines.renderActiveReferenceLine=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function c(b,c,f,g,h,i){if(!e.hasOwnProperty(f))throw"Request type must be one of interaction, thumbnail, or prefetch";if(b&&c){var j={type:f,imageId:c,preventCache:g,doneCallback:h,failCallback:i},k=a.imageCache.getImagePromise(c);if(k)return void k.then(function(a){h(a)},function(a){i(a)});e[f].push(j),"interaction"===f&&(d=b)}}function j(a){if(!e.hasOwnProperty(a))throw"Request type must be one of interaction, thumbnail, or prefetch";e[a]=[]}function k(){h&&setTimeout(function(){var a=n();a&&l(a)},i)}function l(b){var c=b.type;f[c]++,h=!0;var d=b.imageId,e=b.doneCallback,g=b.failCallback,i=a.imageCache.getImagePromise(d);if(i)return void i.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a)});var j;j=b.preventCache===!0?a.loadImage(d):a.loadAndCacheImage(d),j.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a)})}function m(){if(!h){var a=b.getMaxSimultaneousRequests();g={interaction:a,thumbnail:a-2,prefetch:a-1};for(var c=0;c<a;c++){var d=n();d&&l(d)}}}function n(){return e.interaction.length&&f.interaction<g.interaction?e.interaction.shift():e.thumbnail.length&&f.thumbnail<g.thumbnail?e.thumbnail.shift():e.prefetch.length&&f.prefetch<g.prefetch?e.prefetch.shift():(e.interaction.length||e.thumbnail.length||e.prefetch.length||(h=!1),!1)}function o(){return e}var p={addRequest:c,clearRequestStack:j,startGrabbing:m,getRequestPool:o};return p}var d,e={interaction:[],thumbnail:[],prefetch:[]},f={interaction:0,thumbnail:0,prefetch:0},g={interaction:6,thumbnail:6,prefetch:5},h=!1,i=20;b.requestPoolManager=c()}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){if(void 0===d)throw"playClip: element must not be undefined";void 0===e&&(e=30);var g=c.getToolState(d,"stack");if(void 0!==g&&void 0!==g.data&&0!==g.data.length){var h,i=g.data[0],j=c.getToolState(d,f);void 0===j||0===j.data.length?(h={intervalId:void 0,framesPerSecond:e,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},c.addToolState(d,f,h)):(h=j.data[0],h.framesPerSecond=e),void 0===h.intervalId&&(h.intervalId=setInterval(function(){var e=i.currentImageIdIndex;if(h.framesPerSecond>0?e++:e--,!h.loop&&(e>=i.imageIds.length||e<0)){var f={element:d},g=a.Event("CornerstoneToolsClipStopped",f);return a(d).trigger(g,f),clearInterval(h.intervalId),void(h.intervalId=void 0)}if(e>=i.imageIds.length&&(e=0),e<0&&(e=i.imageIds.length-1),e!==i.currentImageIdIndex){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(d);var m,n=b.getViewport(d);m=i.preventCache===!0?b.loadImage(i.imageIds[e]):b.loadAndCacheImage(i.imageIds[e]),m.then(function(a){i.currentImageIdIndex=e,b.displayImage(d,a,n),k&&k(d)},function(a){var b=i.imageIds[e];l&&l(d,b,a)})}},1e3/Math.abs(h.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="playClip";c.playClip=d,c.stopClip=e}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=b.element,f=b.enabledElement.canvas.width,g=b.enabledElement.canvas.height;if(!f||!g)return!1;var h=b.enabledElement.canvas.getContext("2d");h.setTransform(1,0,0,1,0,0),h.save();var i=c.scrollIndicator.getConfiguration();h.fillStyle=i.backgroundColor,h.fillRect(0,g-e,f,e);var j=c.getToolState(d,"stack");if(j&&j.data&&j.data.length){var k=j.data[0].imageIds,l=j.data[0].currentImageIdIndex,m=f/k.length,n=m*l;h.fillStyle=i.fillColor,h.fillRect(n,g-e,m,e),h.restore()}}var e=6,f={backgroundColor:"rgb(19, 63, 141)",fillColor:"white"};c.scrollIndicator=c.displayTool(d),c.scrollIndicator.setConfiguration(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){return a-b}function e(a,b){a=Math.round(a)||0,b=Math.round(b)||0;var c=[],d=b-a+1;if(d<=0)return c;for(;d--;)c[d]=b--;return c}function f(a,b){var c=[],d=[];return a.forEach(function(a){a<b?c.push(a):a>b&&d.push(a)}),{low:a.indexOf(t(c)),high:a.indexOf(u(d))}}function g(a){function e(a){var b=l.indicesToRequest.indexOf(a);b>-1&&l.indicesToRequest.splice(b,1)}function g(a){var b=j.imageIds.indexOf(a.imageId);e(b)}function h(a){console.log("prefetch errored: "+a)}var i=c.getToolState(a,"stack");if(i&&i.data&&i.data.length){var j=i.data[0],k=c.getToolState(a,q);if(k){var l=k.data[0];if(l&&l.indicesToRequest&&l.indicesToRequest.length||(l.enabled=!1),l.enabled!==!1){k.data[0].indicesToRequest.sort(d);var m=l.indicesToRequest.slice();if(m.forEach(function(a){var c=j.imageIds[a];if(c){var d=b.imageCache.getImagePromise(c);d&&"resolved"===d.state()&&e(a)}}),l.indicesToRequest.length){var n=c.requestPoolManager;n.clearRequestStack(r);for(var o,p,s=f(l.indicesToRequest,j.currentImageIdIndex),t=!1,u=s.low,v=s.high;u>0||v<l.indicesToRequest.length;)u>=0&&(p=l.indicesToRequest[u--],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h)),v<l.indicesToRequest.length&&(p=l.indicesToRequest[v++],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h));n.startGrabbing()}}}}}function h(a){var b=a.data.element,d=c.getToolState(b,q);d&&d.data&&d.data.length&&c.requestPoolManager.clearRequestStack(r)}function i(a,b){var d=a.data.element,e=c.getToolState(d,"stack");if(e&&e.data&&e.data.length){var f=e.data[0],g=f.imageIds.indexOf(b.imageId);if(!(g<0)){var h=c.getToolState(d,q);h&&h.data&&h.data.length&&h.data[0].indicesToRequest.push(g)}}}function j(a){clearTimeout(o),o=setTimeout(function(){var b=a.currentTarget;g(b)},p)}function k(d){var f=c.getToolState(d,q);f.data=[];var k=c.getToolState(d,"stack");if(k&&k.data&&k.data.length){var l=k.data[0];if(l.preventCache===!0)return void console.warn("A stack that should not be cached was given the stackPrefetch");var m={indicesToRequest:e(0,l.imageIds.length-1),enabled:!0,direction:1},n=m.indicesToRequest.indexOf(l.currentImageIdIndex);m.indicesToRequest.splice(n,1),c.addToolState(d,q,m),g(d),a(d).off("CornerstoneNewImage",j),a(d).on("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).on("CornerstoneImageCacheFull",{element:d},h),a(b).off("CornerstoneImageCachePromiseRemoved",i),a(b).on("CornerstoneImageCachePromiseRemoved",{element:d},i)}}function l(d){clearTimeout(o),a(d).off("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).off("CornerstoneImageCachePromiseRemoved",i);var e=c.getToolState(d,q);e&&e.data.length&&(e.data[0].enabled=!1,c.requestPoolManager.clearRequestStack(r))}function m(){return s}function n(a){s=a}var o,p,q="stackPrefetch",r="prefetch",s={},t=function(a){return Math.max.apply(null,a);
},u=function(a){return Math.min.apply(null,a)};c.stackPrefetch={enable:k,disable:l,getConfiguration:m,setConfiguration:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var f={deltaY:0};return a(e.element).on("CornerstoneToolsMouseDrag",f,g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(a,b){var d=-b.direction;c.scroll(b.element,d)}function g(b,d){var e=d.element,f=c.getToolState(e,"stack");if(f&&f.data&&f.data.length){var g=f.data[0],h=c.stackScroll.getConfiguration(),i=a(e).height()/Math.max(g.imageIds.length,8);if(h&&h.stackScrollSpeed&&(i=h.stackScrollSpeed),b.data.deltaY=b.data.deltaY||0,b.data.deltaY+=d.deltaPoints.page.y,Math.abs(b.data.deltaY)>=i){var j=b.data.deltaY/i,k=Math.round(j),l=b.data.deltaY%i;b.data.deltaY=l,c.scroll(e,k)}return!1}}c.stackScroll=c.simpleMouseButtonTool(e),c.stackScrollWheel=c.mouseWheelTool(f);var h={eventData:{deltaY:0}};c.stackScrollTouchDrag=c.touchDragTool(g,h)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(b,d){var e=d.keyCode;if(e===c.UP||e===c.DOWN){var f=1;e===c.DOWN&&(f=-1),a.scroll(d.element,f)}}var c={UP:38,DOWN:40};a.stackScrollKeyboard=a.keyboardTool(b)}(cornerstoneTools),function(a,b,c){"use strict";function d(a){var d={imageIdToolState:c.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return a.forEach(function(a){var e=c.getElementToolStateManager(a);e!==c.globalImageIdSpecificToolStateManager&&(d.elementToolState[a.id]=e.saveToolState(),d.elementViewport[a.id]=b.getViewport(a))}),d}function e(a){if(a.hasOwnProperty("imageIdToolState")&&a.hasOwnProperty("elementToolState")&&a.hasOwnProperty("elementViewport"))return c.globalImageIdSpecificToolStateManager.restoreToolState(a.imageIdToolState),Object.keys(a.elementViewport).forEach(function(d){var e=document.getElementById(d);if(e&&a.elementToolState.hasOwnProperty(d)){var f=c.getElementToolStateManager(e);if(f!==c.globalImageIdSpecificToolStateManager){f.restoreToolState(a.elementToolState[d]);var g=a.elementViewport[d];b.setViewport(e,g),b.updateImage(e)}}}),a}c.appState={save:d,restore:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(){function a(a,b,c){d.hasOwnProperty(a)===!1&&(d[a]={});var e=d[a];e.hasOwnProperty(b)===!1&&(e[b]={data:[]});var f=e[b];f.data.push(c)}function b(a,b){if(d.hasOwnProperty(a)!==!1){var c=d[a];if(c.hasOwnProperty(b)!==!1){var e=c[b];return e}}}function c(a,b,c){if(d.hasOwnProperty(a)!==!1){var e=d[a];if(e.hasOwnProperty(b)!==!1){for(var f=e[b],g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);g!==-1&&f.data.splice(g,1)}}}var d={},e={get:b,add:a,remove:c};return e}var e=d();c.newFrameOfReferenceSpecificToolStateManager=d,c.globalFrameOfReferenceSpecificToolStateManager=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function b(a){return i[a]}function c(a,b){i[a]=b}function d(){return i}function e(a){i=a}function f(b,c,d){var e=a.getEnabledElement(b);e.image&&i.hasOwnProperty(e.image.imageId)!==!1||(i[e.image.imageId]={});var f=i[e.image.imageId];f.hasOwnProperty(c)===!1&&(f[c]={data:[]});var g=f[c];g.data.push(d)}function g(b,c){var d=a.getEnabledElement(b);if(d.image&&i.hasOwnProperty(d.image.imageId)!==!1){var e=i[d.image.imageId];if(e.hasOwnProperty(c)!==!1){var f=e[c];return f}}}function h(b){var c=a.getEnabledElement(b);c.image&&i.hasOwnProperty(c.image.imageId)!==!1&&delete i[c.image.imageId]}var i={},j={get:g,add:f,clear:h,saveImageIdToolState:b,restoreImageIdToolState:c,saveToolState:d,restoreToolState:e,toolState:i};return j}var d=c();b.newImageIdSpecificToolStateManager=c,b.globalImageIdSpecificToolStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){g=a}function b(){return g}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}var g,h,i,j={setStartLoadHandler:a,getStartLoadHandler:b,setEndLoadHandler:c,getEndLoadHandler:d,setErrorLoadingHandler:e,getErrorLoadingHandler:f};return j}a.loadHandlerManager=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(){return g}function d(a){g=a}function e(c,d,e){if(!(a.indexOf(d)>=0))return b.add(c,d,e);g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var f=g[d];f.data.push(e)}function f(c,d){if(a.indexOf(d)>=0){g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var e=g[d];return e}return b.get(c,d)}var g={},h={get:f,add:e,saveToolState:c,restoreToolState:d,toolState:g};return h}function d(a){var c=b.getElementToolStateManager(a);c||(c=b.globalImageIdSpecificToolStateManager);var d=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"],f=b.newStackSpecificToolStateManager(d,c);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newStackSpecificToolStateManager=c,b.addStackStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){h=a}function b(){return h}function c(a){g=a}function d(){return g}function e(a){i=a}function f(){return i}var g=15,h=g+"px Arial",i="transparent",j={setFont:a,getFont:b,setFontSize:c,getFontSize:d,setBackgroundColor:e,getBackgroundColor:f};return j}a.textStyle=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(c,d,f){if(!(a.indexOf(d)>=0))return b.add(c,d,f);e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var g=e[d];g.data.push(f)}function d(c,d){if(a.indexOf(d)>=0){e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var f=e[d];return f}return b.get(c,d)}var e={},f={get:d,add:c};return f}function d(a,c){c=c||["timeSeries"];var d=b.getElementToolStateManager(a);void 0===d&&(d=b.globalImageIdSpecificToolStateManager);var f=b.newTimeSeriesSpecificToolStateManager(c,d);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newTimeSeriesSpecificToolStateManager=c,b.addTimeSeriesStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){j=a}function b(){return j}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}function g(a){return a?i:h}var h="greenyellow",i="#E3A000",j="transparent",k={setFillColor:a,getFillColor:b,setToolColor:c,getToolColor:d,setActiveColor:e,getActiveColor:f,getColorIfActive:g};return k}a.toolColors=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a.currentPoints.canvas}function b(){return c}var c="",d={setCoords:a,getCoords:b};return d}a.toolCoordinates=b()}(cornerstoneTools),function(a,b){"use strict";function c(c){var d=a.getEnabledElement(c);return void 0===d.toolStateManager&&(d.toolStateManager=b.globalImageIdSpecificToolStateManager),d.toolStateManager}function d(a,b,d){var e=c(a);e.add(a,b,d);var f="CornerstoneToolsMeasurementAdded",g={toolType:b,element:a,measurementData:d};$(a).trigger(f,g)}function e(a,b){var d=c(a);return d.get(a,b)}function f(a,b,d){for(var e=c(a),f=e.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===d&&(g=h);if(g!==-1){f.data.splice(g,1);var i="CornerstoneToolsMeasurementRemoved",j={toolType:b,element:a,measurementData:d};$(a).trigger(i,j)}}function g(a,b){var d=c(a),e=d.get(a,b);void 0!==e&&(e.data=[])}function h(b,c){var d=a.getEnabledElement(b);d.toolStateManager=c}function i(a,b){var d=c(a);d.get(a,b)}b.addToolState=d,b.getToolState=e,b.removeToolState=f,b.clearToolState=g,b.setElementToolStateManager=h,b.getElementToolStateManager=c,b.delLastMeasurement=i}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){e=a}function b(){return e}function c(a){f=a}function d(){return f}var e=1,f=2,g={setToolWidth:a,getToolWidth:b,setActiveWidth:c,getActiveWidth:d};return g}a.toolStyle=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a}function b(){return c}var c={x:0,y:-55},d={setToolDistanceFromTouch:a,getToolDistanceFromTouch:b};return d}a.touchSettings=b()}(cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.scale===e.scale&&f.translation.x===e.translation.x&&f.translation.y===e.translation.y||(f.scale=e.scale,f.translation.x=e.translation.x,f.translation.y=e.translation.y,a.setViewport(d,f))}}c.panZoomSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){if(e!==d){var f=c.getToolState(d,"stack"),g=f.data[0],h=c.getToolState(e,"stack"),i=h.data[0],j=g.currentImageIdIndex;if(j=Math.min(Math.max(j,0),i.imageIds.length-1),j!==i.currentImageIdIndex){var k=c.loadHandlerManager.getStartLoadHandler(),l=c.loadHandlerManager.getEndLoadHandler(),m=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var n;n=i.preventCache===!0?b.loadImage(i.imageIds[j]):b.loadAndCacheImage(i.imageIds[j]),n.then(function(c){var d=b.getViewport(e);i.currentImageIdIndex=j,a.displayImage(e,c,d),l&&l(e)},function(a){var b=i.imageIds[j];m&&m(e,b,a)})}}}c.stackImageIndexSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f,g){if(e!==d){var h=b.getEnabledElement(d),i=c.metaData.get("imagePlane",h.image.imageId),j=i.imagePositionPatient,k=c.getToolState(e,"stack"),l=k.data[0],m=Number.MAX_VALUE,n=-1;if(g){var o=j.clone().add(g);if(l.imageIds.forEach(function(a,b){var d=c.metaData.get("imagePlane",a),e=d.imagePositionPatient,f=o.distanceToSquared(e);f<m&&(m=f,n=b)}),n!==l.currentImageIdIndex&&n!==-1){var p=c.loadHandlerManager.getStartLoadHandler(),q=c.loadHandlerManager.getEndLoadHandler(),r=c.loadHandlerManager.getErrorLoadingHandler();p&&p(e);var s;s=l.preventCache===!0?b.loadImage(l.imageIds[n]):b.loadAndCacheImage(l.imageIds[n]),s.then(function(c){var d=b.getViewport(e);l.currentImageIdIndex=n,a.displayImage(e,c,d),q&&q(e)},function(a){var b=l.imageIds[n];r&&r(e,b,a)})}}}}c.stackImagePositionOffsetSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e,f){if(f!==e){var g=b.getEnabledElement(e).image,h=c.metaData.get("imagePlane",g.imageId),i=h.imagePositionPatient,j=c.getToolState(f,"stack"),k=j.data[0],l=Number.MAX_VALUE,m=-1;if(a.each(k.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,f=e.distanceToSquared(i);f<l&&(l=f,m=a)}),m!==k.currentImageIdIndex){var n=c.loadHandlerManager.getStartLoadHandler(),o=c.loadHandlerManager.getEndLoadHandler(),p=c.loadHandlerManager.getErrorLoadingHandler();if(n&&n(f),m!==-1){var q;q=k.preventCache===!0?b.loadImage(k.imageIds[m]):b.loadAndCacheImage(k.imageIds[m]),q.then(function(a){var c=b.getViewport(f);k.currentImageIdIndex=m,d.displayImage(f,a,c),o&&o(f)},function(a){var b=k.imageIds[m];p&&p(f,b,a)})}}}}c.stackImagePositionSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){if(d!==e&&f&&f.direction){var g=c.getToolState(e,"stack"),h=g.data[0],i=h.currentImageIdIndex+f.direction;if(i=Math.min(Math.max(i,0),h.imageIds.length-1),h.currentImageIdIndex!==i){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(e);var m;m=h.preventCache===!0?b.loadImage(h.imageIds[i]):b.loadAndCacheImage(h.imageIds[i]),m.then(function(c){var d=b.getViewport(e);h.currentImageIdIndex=i,a.displayImage(e,c,d),k&&k(e)},function(a){var b=h.imageIds[i];l&&l(e,b,a)})}}}c.stackScrollSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){function f(a,b){j.length&&k.length&&(l=!0,k.forEach(function(c){var d=k.indexOf(c);if(d!==-1){var e=m.imageIds.targetElements[d],f=j.indexOf(a);if(f!==-1){var g,h=m.imageIds.sourceElements[f];g=h===e?0:m.distances[h][e],n(i,a,c,b,g)}}}),l=!1)}function g(a,b){l!==!0&&f(a.currentTarget,b)}function h(a,b){var c=b.element;i.remove(c)}var i=this,j=[],k=[],l=!1,m={},n=e;this.setHandler=function(a){n=a},this.getHandler=function(){return n},this.getDistances=function(){j.length&&k.length&&(m.distances={},m.imageIds={sourceElements:[],targetElements:[]},j.forEach(function(a){var d=b.getEnabledElement(a);if(d&&d.image){var e=d.image.imageId,f=c.metaData.get("imagePlane",e);if(f&&f.imagePositionPatient){var g=f.imagePositionPatient;m.hasOwnProperty(d)||(m.distances[e]={},m.imageIds.sourceElements.push(e),k.forEach(function(d){var f=b.getEnabledElement(d);if(f&&f.image){var h=f.image.imageId;if(m.imageIds.targetElements.push(h),a!==d&&e!==h&&!m.distances[e].hasOwnProperty(h)){var i=c.metaData.get("imagePlane",h);if(i&&i.imagePositionPatient){var j=i.imagePositionPatient;m.distances[e][h]=j.clone().sub(g)}}}}),Object.keys(m.distances[e]).length||delete m.distances[e])}}}))},this.addSource=function(b){var c=j.indexOf(b);c===-1&&(j.push(b),a(b).on(d,g),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(a){var b=k.indexOf(a);b===-1&&(k.push(a),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.add=function(a){i.addSource(a),i.addTarget(a)},this.removeSource=function(b){var c=j.indexOf(b);c!==-1&&(j.splice(c,1),a(b).off(d,g),i.getDistances(),f(b),i.updateDisableHandlers())},this.removeTarget=function(a){var b=k.indexOf(a);b!==-1&&(k.splice(b,1),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.remove=function(a){i.removeTarget(a),i.removeSource(a)},this.getSourceElements=function(){return j},this.getTargetElements=function(){return k},this.displayImage=function(a,c,d){l=!0,b.displayImage(a,c,d),l=!1},this.setViewport=function(a,c){l=!0,b.setViewport(a,c),l=!1},this.updateDisableHandlers=function(){var b=a.unique(j.concat(k));b.forEach(function(b){a(b).off("CornerstoneElementDisabled",h),a(b).on("CornerstoneElementDisabled",h)})},this.destroy=function(){var b=a.unique(j.concat(k));b.forEach(function(a){i.remove(a)})}}c.Synchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){d!==c&&b.updateImage(d)}c.updateImageSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.voi.windowWidth===e.voi.windowWidth&&f.voi.windowCenter===e.voi.windowCenter&&f.invert===e.invert||(f.voi.windowWidth=e.voi.windowWidth,f.voi.windowCenter=e.voi.windowCenter,f.invert=e.invert,a.setViewport(d,f))}}c.wwwcSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=[];a.timeSeries.stacks.forEach(function(d){var e;e=d.preventCache===!0?b.loadImage(d.imageIds[a.imageIdIndex]):b.loadAndCacheImage(d.imageIds[a.imageIdIndex]),e.then(function(b){var d=Math.round(a.handles.end.x)+Math.round(a.handles.end.y)*b.width,e=b.getPixelData()[d];c.push(e)})}),a.lineSample.set(c)}function e(a){var b=c.getToolState(a.element,"timeSeries");if(void 0!==b&&void 0!==b.data&&0!==b.data.length){var e=b.data[0],f={timeSeries:e,lineSample:new c.LineSampleMeasurement,imageIdIndex:e.stacks[e.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return d(f),c.MeasurementManager.add(f),f}}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(void 0!==e){var f=d.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(d.enabledElement,f);for(var h="white",i=0;i<e.data.length;i++){f.save();var j=e.data[i];f.beginPath(),c.drawHandles(f,d,j.handles,h),f.stroke();var k=c.setContextToDisplayFontSize(d.enabledElement,d.canvasContext,15);f.font=""+k.fontSize+"px Arial";var l=Math.round(j.handles.end.x),m=Math.round(j.handles.end.y),n=j.handles.end.x+3,o=j.handles.end.y-3;f.fillStyle=h,f.fillText(""+l+","+m,n,o),f.restore()}}}var g="probe4D";c.probeTool4D=c.mouseButtonTool({createNewMeasurement:e,onImageRendered:f,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){var f=c.getToolState(a,"timeSeries");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0],h=g.stacks[g.currentStackIndex],i=h.currentImageIdIndex,j=g.currentStackIndex+d;if(e?(j>=g.stacks.length&&(j=0),j<0&&(j=g.stacks.length-1)):(j=Math.min(g.stacks.length-1,j),j=Math.max(0,j)),j!==g.currentStackIndex){var k=b.getViewport(a),l=g.stacks[j],m=c.loadHandlerManager.getStartLoadHandler(),n=c.loadHandlerManager.getEndLoadHandler(),o=c.loadHandlerManager.getErrorLoadingHandler();m&&m(a);var p;p=l.preventCache===!0?b.loadImage(l.imageIds[i]):b.loadAndCacheImage(l.imageIds[i]),p.then(function(c){g.currentImageIdIndex!==i&&(l.currentImageIdIndex=i,g.currentStackIndex=j,b.displayImage(a,c,k),n&&n(a))},function(b){var c=l.imageIds[i];o&&o(a,c,b)})}}}c.incrementTimePoint=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){if(void 0===a)throw"playClip: element must not be undefined";void 0===b&&(b=30);var d=c.getToolState(a,"timeSeries");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e,g=c.getToolState(a,f);void 0===g||0===g.data.length?(e={intervalId:void 0,framesPerSecond:b,lastFrameTimeStamp:void 0,frameRate:0},c.addToolState(a,f,e)):(e=g.data[0],e.framesPerSecond=b),void 0===e.intervalId&&(e.intervalId=setInterval(function(){e.framesPerSecond>0?c.incrementTimePoint(a,1,!0):c.incrementTimePoint(a,-1,!0)},1e3/Math.abs(e.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="timeSeriesPlayer";c.timeSeriesPlayer={start:d,stop:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var g={deltaY:0,options:b.data.options};return a(e.element).on("CornerstoneToolsMouseDrag",g,f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(b,d){b.data.deltaY+=d.deltaPoints.page.y;var e=c.getToolState(d.element,"timeSeries");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=a(d.element).height()/f.stacks.length;if(void 0!==b.data.options&&void 0!==b.data.options.timeSeriesScrollSpeed&&(g=b.data.options.timeSeriesScrollSpeed),b.data.deltaY>=g||b.data.deltaY<=-g){var h=Math.round(b.data.deltaY/g),i=b.data.deltaY%g;c.incrementTimePoint(d.element,h),b.data.deltaY=i}return!1}}function g(a,b){var d=-b.direction;c.incrementTimePoint(b.element,d)}function h(a){var b=a.originalEvent.detail,d={deltaY:0};d.deltaY+=b.deltaPoints.page.y;var e=c.getToolState(b.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){if(d.deltaY>=3||d.deltaY<=-3){var f=d.deltaY/3,g=d.deltaY%3;c.setTimePoint(d.element,f),d.deltaY=g}return!1}}c.timeSeriesScroll=c.simpleMouseButtonTool(e),c.timeSeriesScrollWheel=c.mouseWheelTool(g),c.timeSeriesScrollTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){if(void 0!==a.data&&"PT"===a.data.string("x00080060")){var c=b*a.slope+a.intercept,d=a.data.floatString("x00101030");if(void 0!==d){var e=a.data.elements.x00540016;if(void 0!==e){e=e.items[0].dataSet;var f=e.time("x00181072"),g=e.floatString("x00181074"),h=e.floatString("x00181075"),i=a.data.time("x00080032");if(f&&g&&h&&i){var j=i.fractionalSeconds+i.seconds+60*i.minutes+60*i.hours*60,k=f.fractionalSeconds+f.seconds+60*f.minutes+60*f.hours*60,l=j-k,m=g*Math.exp(-l*Math.log(2)/h),n=c*d/m*1e3;return n}}}}}a.calculateSUV=b}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=c.point.copy(a.page),d=c.point.copy(a.image),e=c.point.copy(a.client),f=c.point.copy(a.canvas);return{page:b,image:d,client:e,canvas:f}}d.copyPoints=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=10,g=Math.atan2(c.y-b.y,c.x-b.x);a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.lineTo(c.x-f*Math.cos(g+Math.PI/7),c.y-f*Math.sin(g+Math.PI/7)),a.lineTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.fillStyle=d,a.fill()}a.drawArrow=b}(cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}a.drawEllipse=b}(cornerstoneTools),function(a){"use strict";function b(b,c,d,e,f,g){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var h=5,i=a.textStyle.getFont(),j=a.textStyle.getFontSize();a.textStyle.getBackgroundColor();b.save(),b.font=i,b.textBaseline="top",b.strokeStyle=f;var k=0;c.forEach(function(a){var c=b.measureText(a).width;k=Math.max(k,c)}),g&&(k=g+10),b.fillStyle="rgba(0,0,0,0.7)";var l={left:d,top:e,width:k+2*h,height:c.length*(j+(h+1))};return b.fillRect(l.left,l.top,l.width,l.height),c.forEach(function(a,c){b.fillStyle=f,b.fillText(a,d+h,e+j*c+h)}),b.restore(),l}a.drawTextBox=b}(cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getLuminance: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=j.image,l=[],m=0,n=k.getPixelData();if(k.color)for(h=0;h<f;h++)for(i=0;i<e;i++){g=4*((h+d)*k.columns+(i+c));var o=n[g],p=n[g+1],q=n[g+2];l[m++]=.2126*o+.7152*p+.0722*q}else for(h=0;h<f;h++)for(i=0;i<e;i++)g=(h+d)*k.columns+(i+c),l[m++]=n[g]*k.slope+k.intercept;return l}b.getLuminance=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!==a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}function d(){var a=b.stackPrefetch.getConfiguration();if(a.maxSimultaneousRequests)return a.maxSimultaneousRequests;var d=c(),f=d.split(" "),g=f[0],h=f[1],i=e[g];return i?i[h]?i[h]:i["default"]:e["default"]}var e={"default":6,IE:{9:6,10:8,"default":8},Firefox:{"default":6},Opera:{10:8,11:6,12:6,"default":6},Chrome:{"default":6},Safari:{"default":4}};b.getMaxSimultaneousRequests=d,b.getBrowserInfo=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getRGBPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=[],l=0,m=j.image.getPixelData();if(j.image.color)for(h=0;h<f;h++)for(i=0;i<e;i++){g=4*((h+d)*j.image.columns+(i+c));var n=m[g],o=m[g+1],p=m[g+2],q=m[g+3];k[l++]=n,k[l++]=o,k[l++]=p,k[l++]=q}return k}b.getRGBPixels=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,b){var c=1<<a-1;return 0!==(b&c)}b.isMouseButtonEnabled=c}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}c.pauseEvent=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=a.clone().sub(b.imagePositionPatient),d=b.rowCosines.dot(c)/b.columnPixelSpacing,e=b.columnCosines.dot(c)/b.rowPixelSpacing;return{x:d,y:e}}function e(a,b){var c=b.rowCosines.clone().multiplyScalar(a.x);c.multiplyScalar(b.columnPixelSpacing);var d=b.columnCosines.clone().multiplyScalar(a.y);d.multiplyScalar(b.rowPixelSpacing);var e=c.add(d);return e.add(b.imagePositionPatient),e}function f(a){var b=e({x:0,y:0},a),c=e({x:a.columns,y:0},a),d=e({x:0,y:a.rows},a),f=e({x:a.columns,y:a.rows},a),g={top:new cornerstoneMath.Line3(b,c),left:new cornerstoneMath.Line3(b,d),right:new cornerstoneMath.Line3(c,f),bottom:new cornerstoneMath.Line3(d,f)};return g}function g(a,b){var c=[];return Object.keys(b).forEach(function(d){var e=b[d],f=a.intersectLine(e);f&&c.push(f)}),c}function h(a,b){var c=a.rowCosines.clone().cross(a.columnCosines),d=new cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(c,a.imagePositionPatient);var h=b.rowCosines.clone().cross(b.columnCosines),i=new cornerstoneMath.Plane;i.setFromNormalAndCoplanarPoint(h,b.imagePositionPatient);var j=i.clone().intersectPlane(d),k=j.origin,l=j.direction,m=e({x:b.columns,y:b.rows},b),n=b.imagePositionPatient.distanceTo(m),o=new cornerstoneMath.Line3;o.start=k,o.end=k.clone().add(l.multiplyScalar(n));var p=f(b),q=g(o,p);if(2===q.length){var r={start:q[0],end:q[1]};return r}}c.projectPatientPointToImagePlane=d,c.imagePointToPatientPoint=e,c.planePlaneIntersection=h}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}c.roundToDecimal=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,c){var d=b.getToolState(a,"stack");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e=d.data[0],f=e.currentImageIdIndex+c;f=Math.min(e.imageIds.length-1,f),f=Math.max(0,f),b.scrollToIndex(a,f)}}b.scroll=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(c,d){function e(b){h.currentImageIdIndex===d&&(a.displayImage(c,b,l),j&&j(c))}function f(a){var b=h.imageIds[d];k&&k(c,b,a)}var g=b.getToolState(c,"stack");if(void 0!==g&&void 0!==g.data&&0!==g.data.length){var h=g.data[0];d<0&&(d+=h.imageIds.length);var i=b.loadHandlerManager.getStartLoadHandler(),j=b.loadHandlerManager.getEndLoadHandler(),k=b.loadHandlerManager.getErrorLoadingHandler(),l=a.getViewport(c);if(d!==h.currentImageIdIndex){i&&i(c);var m={newImageIdIndex:d,direction:d-h.currentImageIdIndex};h.currentImageIdIndex=d;var n=h.imageIds[d],o=b.stackScroll.getConfiguration();if(o&&o.retryLoadOnScroll===!0){var p=a.imageCache.getImagePromise(n);p&&"rejected"===p.state()&&a.imageCache.removeImagePromise(n)}var q=b.requestPoolManager,r="interaction";b.requestPoolManager.clearRequestStack(r);var s=!!h.preventCache;q.addRequest(c,n,r,s,e,f),q.startGrabbing(),$(c).trigger("CornerstoneStackScroll",m)}}}b.scrollToIndex=c,b.loadHandlers={}}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d){var e=.1;a.setToPixelCoordinateSystem(b,c,e);var f=d/b.viewport.scale/e,g=d/b.viewport.scale/e;return{fontSize:f,lineHeight:g,fontScale:e}}b.setContextToDisplayFontSize=c}(cornerstone,cornerstoneTools),"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}),function(a){"use strict";function b(b,c,d){var e=b.uint16("x00280006");0===e?a.convertRGBColorByPixel(c,d):a.convertRGBColorByPlane(c,d)}function c(c,d,e){var f=d.uint16("x00280010"),g=d.uint16("x00280011"),h=d.string("x00280004");c.height=f,c.width=g;var i=c.getContext("2d"),j=i.createImageData(g,f),k=$.Deferred();try{if("RGB"===h)b(d,e,j.data);else if("YBR_RCT"===h)b(d,e,j.data);else if("YBR_ICT"===h)b(d,e,j.data);else if("PALETTE COLOR"===h)a.convertPALETTECOLOR(e,j.data,d);else if("YBR_FULL_422"===h)a.convertYBRFull(e,j.data);else{if("YBR_FULL"!==h)throw"no color space conversion for photometric interpretation "+h;a.convertYBRFull(e,j.data)}return k.resolve(j),k.promise()}catch(l){return k.reject(l),k.promise()}}a.convertColorSpace=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){for(var d=c.int16("x00281101",0),e=c.int16("x00281101",1),f=c.int16("x00281101",2),g=8===f?0:8,h=c.byteArray.buffer,i=new Uint16Array(h,c.elements.x00281201.dataOffset,d),j=new Uint16Array(h,c.elements.x00281202.dataOffset,d),k=new Uint16Array(h,c.elements.x00281203.dataOffset,d),l=c.uint16("x00280010")*c.uint16("x00280011"),m=0,n=0,o=0;o<l;++o){var p=a[m++];p<e?p=0:p>e+d-1?p=d-1:p-=e,b[n++]=i[p]>>g,b[n++]=j[p]>>g,b[n++]=k[p]>>g,b[n++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0;e<c;e++)for(var f=0,g=c,h=2*c,e=0;e<c;e++)b[d++]=a[f++],b[d++]=a[g++],b[d++]=a[h++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d,e){void 0===d&&(d=0);var f=b.string("x00280004"),g=a.isColorImage(f);return g===!1?a.makeGrayscaleImage(c,b,d,e):a.makeColorImage(c,b,d,e)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.uint16("x00280010"),d=a.uint16("x00280011"),e=dicomParser.readEncapsulatedPixelData(a,a.elements.x7fe00010,b);try{console.log(new JpxImage)}catch(f){console.error(f)}var g=new JpxImage;g.parse(e);var h=g.width,i=g.height;if(h!==d)throw console.log("JPEG2000 decoder returned width of "+h+", when "+d+" is expected"),"JPEG2000 decoder returned width of "+h+", when "+d+" is expected";if(i!==c)throw console.log("JPEG2000 decoder returned width of "+i+", when "+c+" is expected"),"JPEG2000 decoder returned width of "+i+", when "+c+" is expected";var j=g.tiles.length;if(1!==j)throw console.log("JPEG2000 decoder returned a tileCount of "+j+", when 1 is expected"),"JPEG2000 decoder returned a tileCount of "+j+", when 1 is expected";var k=g.tiles[0],l=k.items;return l}c.decodeJPEG2000=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=a.uint16("x00280100"),g=dicomParser.readEncapsulatedPixelData(a,c,b),h=new JpegImage;return h.parse(g),8===f?h.getData(e,d):16===f?h.getData16(e,d):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(a,c,d){var e=$.Deferred(),f=c.uint16("x00280010"),g=c.uint16("x00280011");a.height=f,a.width=g;var h=dicomParser.readEncapsulatedPixelData(c,c.elements.x7fe00010,d),i=new Blob([h],{type:"image/jpeg"}),j=new FileReader;return void 0===j.readAsBinaryString?j.readAsArrayBuffer(i):j.readAsBinaryString(i),j.onload=function(){var c=new Image;c.onload=function(){var b=a.getContext("2d");b.drawImage(this,0,0);var c=b.getImageData(0,0,g,f);e.resolve(c)},c.onerror=function(a){e.reject(a)},void 0===j.readAsBinaryString?c.src="data:image/jpeg;base64,"+window.btoa(b(j.result)):c.src="data:image/jpeg;base64,"+window.btoa(j.result)},e.promise()}function e(a){var b=a.string("x00020010"),c=a.uint16("x00280100");if(8===c&&"1.2.840.10008.1.2.4.50"===b)return!0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(a,b){
var c=a.elements.x7fe00010,d=a.uint16("x00280100"),e=a.uint16("x00280103"),f=dicomParser.readEncapsulatedPixelData(a,c,b),g=d<=8?1:2,h=new jpeg.lossless.Decoder,i=h.decode(f.buffer,f.byteOffset,f.length,g);return 0===e?2===g?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader),function(a){function b(b,e){var f,g=b.uint16("x00280010"),h=b.uint16("x00280011"),i=b.uint16("x00280002"),j=b.elements.x7fe00010,k=dicomParser.readEncapsulatedPixelData(b,j,e),l=a.getPixelFormat(b),m=h*g;return 1===l?(f=new ArrayBuffer(m*i),c(k,f,m,i),new Uint8Array(f)):2===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Uint16Array(f)):3===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Int16Array(f)):void 0}function c(a,b,c,d){for(var e=new DataView(a.buffer,a.byteOffset),f=new DataView(a.buffer,a.byteOffset),g=new DataView(b),h=0,i=e.getInt32(0,!0),j=0;j<i;++j){h=j;var k=e.getInt32(4*(j+1),!0),l=e.getInt32(4*(j+2),!0);0===l&&(l=a.length);for(var m=c*i;k<l;){var n=f.getInt8(k++);if(n>=0&&n<=127)for(var o=0;o<n+1&&h<m;++o)g.setInt8(h,f.getInt8(k++)),h+=d;else if(n<=-1&&n>=-127)for(var p=f.getInt8(k++),q=0;q<-n+1&&h<m;++q)g.setInt8(h,p),h+=d}}}function d(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=d.getInt32(0,!0),h=0;h<g;++h){var i=0,j=0===h?1:0,k=d.getInt32(4*(h+1),!0),l=d.getInt32(4*(h+2),!0);for(0===l&&(l=a.length);k<l;){var m=e.getInt8(k++);if(m>=0&&m<=127)for(var n=0;n<m+1&&i<c;++n)f.setInt8(2*i+j,e.getInt8(k++)),i++;else if(m<=-1&&m>=-127)for(var o=e.getInt8(k++),p=0;p<-m+1&&i<c;++p)f.setInt8(2*i+j,o),i++}}}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=b.string("x00020010");if("1.2.840.10008.1.2"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.1"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.2"===d)return a.extractUncompressedPixels(b,c,!0);if("1.2.840.10008.1.2.4.90"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.4.91"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.5"===d)return a.decodeRLE(b,c);if("1.2.840.10008.1.2.4.50"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.51"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.57"===d)return a.decodeJPEGLossless(b,c);if("1.2.840.10008.1.2.4.70"===d)return a.decodeJPEGLossless(b,c);throw console&&console.log&&console.log("Image cannot be decoded due to Unsupported transfer syntax "+d),"no decoder for transfer syntax "+d}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader);var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},JpegImage=function(){"use strict";function a(){}function b(a,b){for(var c,d,e=0,f=[],g=16;g>0&&!a[g-1];)g--;f.push({children:[],index:0});var h,i=f[0];for(c=0;c<g;c++){for(d=0;d<a[c];d++){for(i=f.pop(),i.children[i.index]=b[e];i.index>0;)i=f.pop();for(i.index++,f.push(i);f.length<=c;)f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h;e++}c+1<g&&(f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h)}return f[0].children}function c(a,b,c){return 64*((a.blocksPerLine+1)*b+c)}function d(a,b,d,e,f,g,i,j,k){function l(){if(H>0)return H--,G>>H&1;if(G=a[b++],255==G){var c=a[b++];if(c)throw"unexpected marker: "+(G<<8|c).toString(16)}return H=7,G>>>7}function m(a){for(var b,c=a;null!==(b=l());){if(c=c[b],"number"==typeof c)return c;if("object"!=typeof c)throw"invalid huffman sequence"}return null}function n(a){for(var b=0;a>0;){var c=l();if(null===c)return;b=b<<1|c,a--}return b}function o(a){var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function p(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c);a.blockData[b]=a.pred+=d;for(var e=1;e<64;){var f=m(a.huffmanTableAC),g=15&f,i=f>>4;if(0!==g){e+=i;var j=h[e];a.blockData[b+j]=o(g),e++}else{if(i<15)break;e+=16}}}function q(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c)<<k;a.blockData[b]=a.pred+=d}function r(a,b){a.blockData[b]|=l()<<k}function s(a,b){if(I>0)return void I--;for(var c=g,d=i;c<=d;){var e=m(a.huffmanTableAC),f=15&e,j=e>>4;if(0!==f){c+=j;var l=h[c];a.blockData[b+l]=o(f)*(1<<k),c++}else{if(j<15){I=n(j)+(1<<j)-1;break}c+=16}}}function t(a,b){for(var c=g,d=i,e=0;c<=d;){var f=h[c];switch(J){case 0:var j=m(a.huffmanTableAC),p=15&j;if(e=j>>4,0===p)e<15?(I=n(e)+(1<<e),J=4):(e=16,J=1);else{if(1!==p)throw"invalid ACn encoding";w=o(p),J=e?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(e--,0===e&&(J=2==J?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(a.blockData[b+f]=w<<k,J=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=l()<<k)}c++}4===J&&(I--,0===I&&(J=0))}function u(a,b,d,e,f){var g=d/D|0,h=d%D,i=g*a.v+e,j=h*a.h+f,k=c(a,i,j);b(a,k)}function v(a,b,d){var e=d/a.blocksPerLine|0,f=d%a.blocksPerLine,g=c(a,e,f);b(a,g)}var w,x,y,z,A,B,C,D=(d.precision,d.samplesPerLine,d.scanLines,d.mcusPerLine),E=d.progressive,F=(d.maxH,d.maxV,b),G=0,H=0,I=0,J=0,K=e.length;C=E?0===g?0===j?q:r:0===j?s:t:p;var L,M,N=0;M=1==K?e[0].blocksPerLine*e[0].blocksPerColumn:D*d.mcusPerColumn,f||(f=M);for(var O,P;N<M;){for(y=0;y<K;y++)e[y].pred=0;if(I=0,1==K)for(x=e[0],B=0;B<f;B++)v(x,C,N),N++;else for(B=0;B<f;B++){for(y=0;y<K;y++)for(x=e[y],O=x.h,P=x.v,z=0;z<P;z++)for(A=0;A<O;A++)u(x,C,N,z,A);N++}if(H=0,L=a[b]<<8|a[b+1],L<=65280)throw"marker was not found";if(!(L>=65488&&L<=65495))break;b+=2}return b-F}function e(a,b,c){var d,e,f,g,h,q,r,s,t,u,v=a.quantizationTable;for(u=0;u<64;u++)c[u]=a.blockData[b+u]*v[u];for(u=0;u<8;++u){var w=8*u;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(d=o*c[0+w]+128>>8,e=o*c[4+w]+128>>8,f=c[2+w],g=c[6+w],h=p*(c[1+w]-c[7+w])+128>>8,s=p*(c[1+w]+c[7+w])+128>>8,q=c[3+w]<<4,r=c[5+w]<<4,t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+128>>8,f=f*m-g*n+128>>8,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+w]=d+s,c[7+w]=d-s,c[1+w]=e+r,c[6+w]=e-r,c[2+w]=f+q,c[5+w]=f-q,c[3+w]=g+h,c[4+w]=g-h):(t=o*c[0+w]+512>>10,c[0+w]=t,c[1+w]=t,c[2+w]=t,c[3+w]=t,c[4+w]=t,c[5+w]=t,c[6+w]=t,c[7+w]=t)}for(u=0;u<8;++u){var x=u;0!==c[8+x]||0!==c[16+x]||0!==c[24+x]||0!==c[32+x]||0!==c[40+x]||0!==c[48+x]||0!==c[56+x]?(d=o*c[0+x]+2048>>12,e=o*c[32+x]+2048>>12,f=c[16+x],g=c[48+x],h=p*(c[8+x]-c[56+x])+2048>>12,s=p*(c[8+x]+c[56+x])+2048>>12,q=c[24+x],r=c[40+x],t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+2048>>12,f=f*m-g*n+2048>>12,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+x]=d+s,c[56+x]=d-s,c[8+x]=e+r,c[48+x]=e-r,c[16+x]=f+q,c[40+x]=f-q,c[24+x]=g+h,c[32+x]=g-h):(t=o*c[u+0]+8192>>14,c[0+x]=t,c[8+x]=t,c[16+x]=t,c[24+x]=t,c[32+x]=t,c[40+x]=t,c[48+x]=t,c[56+x]=t)}for(u=0;u<64;++u){var y=b+u,z=c[u];z=z<=-2056/a.bitConversion?0:z>=2024/a.bitConversion?255/a.bitConversion:z+2056/a.bitConversion>>4,a.blockData[y]=z}}function f(a,b){for(var d=b.blocksPerLine,f=b.blocksPerColumn,g=new Int32Array(64),h=0;h<f;h++)for(var i=0;i<d;i++){var j=c(b,h,i);e(b,j,g)}return b.blockData}function g(a){return a<=0?0:a>=255?255:0|a}var h=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,j=799,k=3406,l=2276,m=1567,n=3784,o=5793,p=2896;return a.prototype={load:function(a){var b=function(a){this.parse(a),this.onload&&this.onload()}.bind(this);if(a.indexOf("data:")>-1){for(var c=a.indexOf("base64,")+7,d=atob(a.substring(c)),e=new Uint8Array(d.length),f=d.length-1;f>=0;f--)e[f]=d.charCodeAt(f);b(d)}else{var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onload=function(){var a=new Uint8Array(g.response);b(a)}.bind(this),g.send(null)}},parse:function(a){function c(){var b=a[k]<<8|a[k+1];return k+=2,b}function e(){var b=c(),d=a.subarray(k,k+b-2);return k+=d.length,d}function g(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){N=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*N.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*N.v/a.maxV),g=b*N.h,h=c*N.v,i=64*h*(g+1);N.blockData=new Int16Array(i),N.blocksPerLine=e,N.blocksPerColumn=f}a.mcusPerLine=b,a.mcusPerColumn=c}var i,j,k=0,l=(a.length,null),m=null,n=[],o=[],p=[],q=c();if(65496!=q)throw"SOI not found";for(q=c();65497!=q;){var r,s,t;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=e();65504===q&&74===u[0]&&70===u[1]&&73===u[2]&&70===u[3]&&0===u[4]&&(l={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])}),65518===q&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&0===u[5]&&(m={version:u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var v=c(),w=v+k-2;k<w;){var x=a[k++],y=new Int32Array(64);if(x>>4===0)for(s=0;s<64;s++){var z=h[s];y[z]=a[k++]}else{if(x>>4!==1)throw"DQT: invalid table spec";for(s=0;s<64;s++){var A=h[s];y[A]=c()}}n[15&x]=y}break;case 65472:case 65473:case 65474:if(i)throw"Only single frame JPEGs supported";c(),i={},i.extended=65473===q,i.progressive=65474===q,i.precision=a[k++],i.scanLines=c(),i.samplesPerLine=c(),i.components=[],i.componentIds={};var B,C=a[k++],D=0,E=0;for(r=0;r<C;r++){B=a[k];var F=a[k+1]>>4,G=15&a[k+1];D<F&&(D=F),E<G&&(E=G);var H=a[k+2];t=i.components.push({h:F,v:G,quantizationTable:n[H],quantizationTableId:H,bitConversion:255/((1<<i.precision)-1)}),i.componentIds[B]=t-1,k+=3}i.maxH=D,i.maxV=E,g(i);break;case 65476:var I=c();for(r=2;r<I;){var J=a[k++],K=new Uint8Array(16),L=0;for(s=0;s<16;s++,k++)L+=K[s]=a[k];var M=new Uint8Array(L);for(s=0;s<L;s++,k++)M[s]=a[k];r+=17+L,(J>>4===0?p:o)[15&J]=b(K,M)}break;case 65501:c(),j=c();break;case 65498:var N,O=(c(),a[k++]),P=[];for(r=0;r<O;r++){var Q=i.componentIds[a[k++]];N=i.components[Q];var R=a[k++];N.huffmanTableDC=p[R>>4],N.huffmanTableAC=o[15&R],P.push(N)}var S=a[k++],T=a[k++],U=a[k++],V=d(a,k,i,P,j,S,T,U>>4,15&U);k+=V;break;default:if(255==a[k-3]&&a[k-2]>=192&&a[k-2]<=254){k-=3;break}throw"unknown JPEG marker "+q.toString(16)}q=c()}switch(this.width=i.samplesPerLine,this.height=i.scanLines,this.jfif=l,this.adobe=m,this.components=[],i.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:this.adobe?this.colorspace=ColorSpace.AdobeRGB:this.colorspace=ColorSpace.RGB;break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var r=0;r<i.components.length;r++){var N=i.components[r];N.quantizationTable||null===N.quantizationTableId||(N.quantizationTable=n[N.quantizationTableId]),this.components.push({output:f(i,N),scaleX:N.h/i.maxH,scaleY:N.v/i.maxV,blocksPerLine:N.blocksPerLine,blocksPerColumn:N.blocksPerColumn,bitConversion:N.bitConversion})}},getData16:function(a,b){if(1!==this.components.length)throw"Unsupported color mode";var d,e,f,g,h,i,j=this.width/a,k=this.height/b,l=0,m=this.components.length,n=a*b*m,o=new Uint16Array(n),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(i=0;i<m;i++){d=this.components[i];for(var q,r,s=d.blocksPerLine,t=d.blocksPerColumn,u=s<<3,v=0,w=0;w<t;w++)for(var x=w<<3,y=0;y<s;y++){var z=c(d,w,y),l=0,A=y<<3;for(q=0;q<8;q++){var v=(x+q)*u;for(r=0;r<8;r++)p[v+A+r]=d.output[z+l++]}}e=d.scaleX*j,f=d.scaleY*k,l=i;var B,C,D;for(h=0;h<b;h++)for(g=0;g<a;g++)C=0|h*f,B=0|g*e,D=C*u+B,o[l]=p[D],l+=m}return o},getData:function(a,b){var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=this.width/a,u=this.height/b,v=0,w=this.components.length,x=a*b*w,y=new Uint8Array(x),z=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(j=0;j<w;j++){d=this.components[j];for(var A,B,C=d.blocksPerLine,D=d.blocksPerColumn,E=C<<3,F=0,G=0;G<D;G++)for(var H=G<<3,I=0;I<C;I++){var J=c(d,G,I),v=0,K=I<<3;for(A=0;A<8;A++){var F=(H+A)*E;for(B=0;B<8;B++)z[F+K+B]=d.output[J+v++]*d.bitConversion}}e=d.scaleX*t,f=d.scaleY*u,v=j;var L,M,N;for(i=0;i<b;i++)for(h=0;h<a;h++)M=0|i*f,L=0|h*e,N=M*E+L,y[v]=z[N],v+=w}switch(w){case 1:case 2:break;case 3:if(s=!0,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;j<x;j+=w)k=y[j],l=y[j+1],m=y[j+2],p=g(k-179.456+1.402*m),q=g(k+135.459-.344*l-.714*m),r=g(k-226.816+1.772*l),y[j]=p,y[j+1]=q,y[j+2]=r;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(s=!1,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;j<x;j+=w)k=y[j],l=y[j+1],m=y[j+2],n=g(434.456-k-1.402*m),o=g(119.541-k+.344*l+.714*m),k=g(481.816-k-1.772*l),y[j]=n,y[j+1]=o,y[j+2]=k;break;default:throw"Unsupported color mode"}return y}},a}();!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.jpeg=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ComponentSpec)},{}],2:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||function(a,b,c){this.buffer=new DataView(a,b,c),this.index=0},d.lossless.DataStream.prototype.get16=function(){var a=this.buffer.getUint16(this.index,!1);return this.index+=2,a},d.lossless.DataStream.prototype.get8=function(){var a=this.buffer.getUint8(this.index);return this.index+=1,a};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.DataStream)},{}],3:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.Decoder=d.lossless.Decoder||function(a,b){this.buffer=a,this.frame=new d.lossless.FrameHeader,this.huffTable=new d.lossless.HuffmanTable,this.quantTable=new d.lossless.QuantizationTable,this.scan=new d.lossless.ScanHeader,this.DU=d.lossless.Utils.createArray(10,4,64),this.HuffTab=d.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=d.lossless.Utils.createArray(10,1),this.dcTab=d.lossless.Utils.createArray(10,1),this.qTab=d.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,"undefined"!=typeof b&&(this.numBytes=b)},d.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],d.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],d.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,d.lossless.Decoder.MSB=2147483648,d.lossless.Decoder.RESTART_MARKER_BEGIN=65488,d.lossless.Decoder.RESTART_MARKER_END=65495,d.lossless.Decoder.prototype.decompress=function(a,b,c){return this.decode(a,b,c).buffer},d.lossless.Decoder.prototype.decode=function(a,b,c,e){var f,g,h,i,j=0,k=[],l=[],m=[];if("undefined"!=typeof a&&(this.buffer=a),"undefined"!=typeof e&&(this.numBytes=e),this.stream=new d.lossless.DataStream(this.buffer,b,c),this.buffer=null,this.xLoc=0,this.yLoc=0,f=this.stream.get16(),65496!==f)throw new Error("Not a JPEG file");for(f=this.stream.get16();f>>4!==4092||65476===f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (decode)")}f=this.stream.get16()}if(f<65472||f>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),f=this.stream.get16();do{for(;65498!==f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}f=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,g=0;g<this.numComp;g+=1)h=this.scanComps[g].scanCompSel,this.qTab[g]=this.quantTables[this.components[h].quantTableSel],this.nBlock[g]=this.components[h].vSamp*this.components[h].hSamp,this.dcTab[g]=this.HuffTab[this.scanComps[g].dcTabSel][0],this.acTab[g]=this.HuffTab[this.scanComps[g].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),j+=1;;){for(l[0]=0,m[0]=0,g=0;g<10;g+=1)k[g]=1<<this.precision-1;if(0===this.restartInterval){for(f=this.decodeUnit(k,l,m);0===f&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(k),f=this.decodeUnit(k,l,m);break}for(i=0;i<this.restartInterval&&(this.restarting=0==i,f=this.decodeUnit(k,l,m),this.output(k),0===f);i+=1);if(0===f&&(0!==this.markerIndex?(f=65280|this.marker,this.markerIndex=0):f=this.stream.get16()),!(f>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&f<=d.lossless.Decoder.RESTART_MARKER_END))break}65500===f&&1===j&&(this.readNumber(),f=this.stream.get16())}while(65497!==f&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===j);return this.outputData},d.lossless.Decoder.prototype.decodeUnit=function(a,b,c){return 1==this.numComp?this.decodeSingle(a,b,c):3==this.numComp?this.decodeRGB(a,b,c):-1},d.lossless.Decoder.prototype.select1=function(a){return this.getPreviousX(a)},d.lossless.Decoder.prototype.select2=function(a){return this.getPreviousY(a)},d.lossless.Decoder.prototype.select3=function(a){return this.getPreviousXY(a)},d.lossless.Decoder.prototype.select4=function(a){return this.getPreviousX(a)+this.getPreviousY(a)-this.getPreviousXY(a)},d.lossless.Decoder.prototype.select5=function(a){return this.getPreviousX(a)+(this.getPreviousY(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select6=function(a){return this.getPreviousY(a)+(this.getPreviousX(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select7=function(a){return(this.getPreviousX(a)+this.getPreviousY(a))/2},d.lossless.Decoder.prototype.decodeRGB=function(a,b,c){var e,f,g,h,i,j,k,l;for(a[0]=this.selector(0),a[1]=this.selector(1),a[2]=this.selector(2),i=0;i<this.numComp;i+=1)for(h=this.qTab[i],f=this.acTab[i],g=this.dcTab[i],j=0;j<this.nBlock[i];j+=1){for(k=0;k<this.IDCT_Source.length;k+=1)this.IDCT_Source[k]=0;if(e=this.getHuffmanValue(g,b,c),e>=65280)return e;for(a[i]=this.IDCT_Source[0]=a[i]+this.getn(c,e,b,c),this.IDCT_Source[0]*=h[0],l=1;l<64;l+=1){if(e=this.getHuffmanValue(f,b,c),e>=65280)return e;if(l+=e>>4,0===(15&e)){if(e>>4===0)break}else this.IDCT_Source[d.lossless.Decoder.IDCT_P[l]]=this.getn(c,15&e,b,c)*h[l]}}return 0},d.lossless.Decoder.prototype.decodeSingle=function(a,b,c){var e,f,g,h;for(this.restarting?(this.restarting=!1,a[0]=1<<this.frame.precision-1):a[0]=this.selector(),f=0;f<this.nBlock[0];f+=1){if(e=this.getHuffmanValue(this.dcTab[0],b,c),e>=65280)return e;if(g=this.getn(a,e,b,c),h=g>>8,h>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&h<=d.lossless.Decoder.RESTART_MARKER_END)return h;a[0]+=g}return 0},d.lossless.Decoder.prototype.getHuffmanValue=function(a,b,c){var e,f,g;if(g=65535,c[0]<8?(b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f):c[0]-=8,e=a[b[0]>>c[0]],0!==(e&d.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;b[0]&=g>>16-c[0],b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f,e=a[256*(255&e)+(b[0]>>c[0])],c[0]+=8}if(c[0]+=8-(e>>8),c[0]<0)throw new Error("index="+c[0]+" temp="+b[0]+" code="+e+" in HuffmanValue()");return c[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(b[0]&=g>>16-c[0],255&e)},d.lossless.Decoder.prototype.getn=function(a,b,c,d){var e,f,g,h,i;if(f=1,g=-1,h=65535,0===b)return 0;if(16===b)return a[0]>=0?-32768:32768;if(d[0]-=b,d[0]>=0){if(d[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}else{if(c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8,d[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8}if(d[0]<0)throw new Error("index="+d[0]+" in getn()");if(d[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}return e<f<<b-1&&(e+=(g<<b)+1),e},d.lossless.Decoder.prototype.getPreviousX=function(a){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,a):this.yLoc>0?this.getPreviousY(a):1<<this.frame.precision-1},d.lossless.Decoder.prototype.getPreviousXY=function(a){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,a):this.getPreviousY(a)},d.lossless.Decoder.prototype.getPreviousY=function(a){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,a):this.getPreviousX(a)},d.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},d.lossless.Decoder.prototype.outputSingle=function(a){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&a[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.outputRGB=function(a){var b=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(b,a[0],0),this.setter(b,a[1],1),this.setter(b,a[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.setValue16=function(a,b){this.outputData.setInt16(2*a,b,!0)},d.lossless.Decoder.prototype.getValue16=function(a){return this.outputData.getInt16(2*a,!0)&this.mask},d.lossless.Decoder.prototype.setValue8=function(a,b){this.outputData.setInt8(a,b)},d.lossless.Decoder.prototype.getValue8=function(a){return this.outputData.getInt8(a)&this.mask},d.lossless.Decoder.prototype.setValueRGB=function(a,b,c){this.outputData.setUint8(3*a+c,b)},d.lossless.Decoder.prototype.getValueRGB=function(a,b){return this.outputData.getUint8(3*a+b)},d.lossless.Decoder.prototype.readApp=function(){var a=0,b=this.stream.get16();for(a+=2;a<b;)this.stream.get8(),a+=1;return b},d.lossless.Decoder.prototype.readComment=function(){var a,b="",c=0;for(a=this.stream.get16(),c+=2;c<a;)b+=this.stream.get8(),c+=1;return b},d.lossless.Decoder.prototype.readNumber=function(){var a=this.stream.get16();if(4!==a)throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Decoder)},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},d.lossless.FrameHeader.prototype.read=function(a){var b,c,e,f,g=0;for(b=a.get16(),g+=2,this.precision=a.get8(),g+=1,this.dimY=a.get16(),g+=2,this.dimX=a.get16(),g+=2,this.numComp=a.get8(),g+=1,c=1;c<=this.numComp;c+=1){if(g>b)throw new Error("ERROR: frame format error");if(e=a.get8(),g+=1,g>=b)throw new Error("ERROR: frame format error [c>=Lf]");f=a.get8(),g+=1,this.components[e]||(this.components[e]=new d.lossless.ComponentSpec),this.components[e].hSamp=f>>4,this.components[e].vSamp=15&f,this.components[e].quantTableSel=a.get8(),g+=1}if(g!==b)throw new Error("ERROR: frame format error [Lf!=count]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.FrameHeader)},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||function(){this.l=d.lossless.Utils.createArray(4,2,16),this.th=[],this.v=d.lossless.Utils.createArray(4,2,16,200),this.tc=d.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},d.lossless.HuffmanTable.MSB=2147483648,d.lossless.HuffmanTable.prototype.read=function(a,b){var c,d,e,f,g,h,i=0;for(c=a.get16(),i+=2;i<c;){if(d=a.get8(),i+=1,e=15&d,e>3)throw new Error("ERROR: Huffman table ID > 3");if(f=d>>4,f>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[e]=1,this.tc[e][f]=1,g=0;g<16;g+=1)this.l[e][f][g]=a.get8(),i+=1;for(g=0;g<16;g+=1)for(h=0;h<this.l[e][f][g];h+=1){if(i>c)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[e][f][g][h]=a.get8(),i+=1}}if(i!==c)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(g=0;g<4;g+=1)for(h=0;h<2;h+=1)0!==this.tc[g][h]&&this.buildHuffTable(b[g][h],this.l[g][h],this.v[g][h]);return 1},d.lossless.HuffmanTable.prototype.buildHuffTable=function(a,b,c){var e,f,g,h,i,j;for(f=256,g=0,h=0;h<8;h+=1)for(i=0;i<b[h];i+=1)for(j=0;j<f>>h+1;j+=1)a[g]=c[h][i]|h+1<<8,g+=1;for(h=1;g<256;h+=1,g+=1)a[g]=h|d.lossless.HuffmanTable.MSB;for(e=1,g=0,h=8;h<16;h+=1)for(i=0;i<b[h];i+=1){for(j=0;j<f>>h-7;j+=1)a[256*e+g]=c[h][i]|h+1<<8,g+=1;if(g>=256){if(g>256)throw new Error("ERROR: Huffman table error(1)!");g=0,e+=1}}};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.HuffmanTable)},{"./data-stream.js":2,"./utils.js":10}],6:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Decoder=d.lossless.Decoder||("undefined"!=typeof a?a("./decoder.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null);var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d)},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=d.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},d.lossless.QuantizationTable.enhanceQuantizationTable=function(a,b){var c;for(c=0;c<8;c+=1)a[b[0+c]]*=90,a[b[32+c]]*=90,a[b[16+c]]*=118,a[b[48+c]]*=49,a[b[40+c]]*=71,a[b[8+c]]*=126,a[b[56+c]]*=25,a[b[24+c]]*=106;for(c=0;c<8;c+=1)a[b[0+8*c]]*=90,a[b[4+8*c]]*=90,a[b[2+8*c]]*=118,a[b[6+8*c]]*=49,a[b[5+8*c]]*=71,a[b[1+8*c]]*=126,a[b[7+8*c]]*=25,a[b[3+8*c]]*=106;for(c=0;c<64;c+=1)a[c]>>=6},d.lossless.QuantizationTable.prototype.read=function(a,b){var c,e,f,g,h=0;for(c=a.get16(),h+=2;h<c;){if(e=a.get8(),h+=1,f=15&e,f>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[f]=e>>4,0===this.precision[f])this.precision[f]=8;else{if(1!==this.precision[f])throw new Error("ERROR: Quantization table precision error");this.precision[f]=16}if(this.tq[f]=1,8===this.precision[f]){for(g=0;g<64;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");this.quantTables[f][g]=a.get8(),h+=1}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}else{for(g=0;g<64;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");
this.quantTables[f][g]=a.get16(),h+=2}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}}if(h!==c)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.QuantizationTable)},{"./data-stream.js":2,"./utils.js":10}],8:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ScanComponent=d.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanComponent)},{}],9:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},d.lossless.ScanHeader.prototype.read=function(a){var b,c,e,f=0;for(b=a.get16(),f+=2,this.numComp=a.get8(),f+=1,c=0;c<this.numComp;c+=1){if(this.components[c]=new d.lossless.ScanComponent,f>b)throw new Error("ERROR: scan header format error");this.components[c].scanCompSel=a.get8(),f+=1,e=a.get8(),f+=1,this.components[c].dcTabSel=e>>4,this.components[c].acTabSel=15&e}if(this.selection=a.get8(),f+=1,this.spectralEnd=a.get8(),f+=1,e=a.get8(),this.ah=e>>4,this.al=15&e,f+=1,f!==b)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanHeader)},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.Utils=d.lossless.Utils||{},d.lossless.Utils.createArray=function(a){var b=new Array(a||0),c=a;if(arguments.length>1)for(var e=Array.prototype.slice.call(arguments,1);c--;)b[a-1-c]=d.lossless.Utils.createArray.apply(this,e);return b},d.lossless.Utils.makeCRCTable=function(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b},d.lossless.Utils.crc32=function(a){for(var b=d.lossless.Utils.crcTable||(d.lossless.Utils.crcTable=d.lossless.Utils.makeCRCTable()),c=-1,e=0;e<a.byteLength;e++)c=c>>>8^b[255&(c^a.getUint8(e))];return(c^-1)>>>0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Utils)},{}]},{},[6])(6)}),function(a,b,c){"use strict";function d(a){return(255&a)<<8|a>>8&255}function e(a,b,e){var g=c.getPixelFormat(a),h=f(a,b,g);if(e&&(2===g||3===g))for(var i=0;i<h.length;i++)h[i]=d(h[i]);return h}function f(a,b,c){var d=a.elements.x7fe00010,e=a.uint16("x00280010"),f=a.uint16("x00280011"),g=a.uint16("x00280002"),h=d.dataOffset,i=f*e*g;if(!i)throw"Sanity check failed when calculating the number of pixels";var j=0;if(1===c)return j=h+b*i,new Uint8Array(a.byteArray.buffer,j,i);if(2===c)return j=h+b*i*2,new Uint16Array(a.byteArray.buffer,j,i);if(3===c)return j=h+b*i*2,new Int16Array(a.byteArray.buffer,j,i);throw"Unknown pixel format"}c.extractUncompressedPixels=e}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;f<d;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return void 0==b&&(console.log("pixelRepresentation undifined"),b=0),0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(""!=b&&null!=b&&void 0!=b||(b=a.string("x00181164")),b&&b.length>0){var c=b.split("\\");if(parseFloat(c[0])&&parseFloat(c[1]))return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1};return a.elements.x00281052&&a.elements.x00281053&&(b.intercept=a.floatString("x00281052")||b.intercept,b.slope=a.floatString("x00281053")||b.slope),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0};return a.elements.x00281050&&a.elements.x00281051&&(b.windowCenter=a.floatString("x00281050"),b.windowWidth=a.floatString("x00281051")),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d,e=a.Deferred(),f=b.indexOf(":"),g=b.substring(f+1),h=g.indexOf("frame=");if(h!==-1){var i=g.substr(h+6);d=parseInt(i),g=g.substr(0,h-1)}if(void 0!==d&&c.internal.multiFrameCacheHack.hasOwnProperty(g)){var j=c.internal.multiFrameCacheHack[g],k=c.createImageObject(j,b,d);return k.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise()}var l=parseInt(g),m=c.fileManager.get(l);if(void 0===m)return e.reject("unknown file index "+g),e.promise();var n=new FileReader;return n.onload=function(a){var f=a.target.result,h=new Uint8Array(f),i=dicomParser.parseDicom(h);if(void 0!==d){var i=c.internal.multiFrameCacheHack[g],j=c.createImageObject(i,b,d);return j.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise()}var j=c.createImageObject(i,b,d);j.then(function(a){e.resolve(a)},function(a){e.reject(a)})},n.readAsArrayBuffer(m),e.promise()}b.registerImageLoader("dicomfile",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.internal.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b]}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim()}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a[e]);return d}a.internal.getImageFrame=function(e,f){f=f||"application/octet-stream";var g=$.Deferred(),h=new XMLHttpRequest;return h.responseType="arraybuffer",h.open("get",e,!0),h.setRequestHeader("Accept","multipart/related;type="+f),h.onreadystatechange=function(e){if(4===h.readyState)if(200===h.status){var f=h.response,i=new Uint8Array(h.response),j=a.internal.findIndexOfString(i,"\n\r\n");j===-1&&g.reject("invalid response - no multipart mime header");var k=d(i,0,j),l=k.split("\r\n"),m=b(l);m||g.reject("invalid response - no boundary marker");var n=j+4,o=a.internal.findIndexOfString(i,m,n);o===-1&&g.reject("invalid response - terminating boundary not found");var p=o-n-1;g.resolve({contentType:c(l),arrayBuffer:f,offset:n,length:p})}else g.reject(h.response)},h.send(),g.promise()}}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"wadors:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.imageManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d){var e=a.Deferred(),f=d.substring(7),g=c.imageManager.get(f);if(void 0===g)return e.reject("unknown imageId"),e.promise();var h;return c.internal.getImageFrame(g.uri,h).then(function(a){var f;16===g.instance.bitsAllocated?f=0===g.instance.pixelRepresentation?new Uint16Array(a.arrayBuffer,a.offset,a.length/2):new Int16Array(a.arrayBuffer,a.offset,a.length/2):8===g.instance.bitsAllocated&&(f=new Uint8Array(a.arrayBuffer,a.offset,a.length));var h=c.getMinMax(f);g.imageId=d,g.minPixelValue=h.min,g.maxPixelValue=h.max,g.render=b.renderGrayscaleImage,g.getPixelData=function(){return f},e.resolve(g)}).fail(function(a){e.reject(a)}),e.promise()}b.registerImageLoader("wadors",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return void 0!==f[a]}function c(b){if(f[b]){var c=$.Deferred();return f[b].cacheCount++,c.resolve(f[b].dataSet),c}if(g[b])return g[b];var d=a.internal.xhrRequest(b);return g[b]=d,d.then(function(a){f[b]={dataSet:a,cacheCount:1},delete g[b]},function(){}).always(function(){delete g[b]}),d}function d(a){f[a]&&(f[a].cacheCount--,0===f[a].cacheCount&&delete f[a])}function e(){f={},g={}}var f={},g={};a.dataSetCacheManager={isLoaded:b,load:c,unload:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(e!==-1){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{url:d,frame:b}}function e(a){a.decache=function(){var b=d(a.imageId);c.dataSetCacheManager.unload(b.url)}}function f(b,d,f,g){var h=a.Deferred();return b.then(function(a){var b=c.createImageObject(a,d,f,g);b.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}function g(b){var g=d(b);if(c.dataSetCacheManager.isLoaded(g.url))return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);if(void 0!==g.frame)return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);var h=a.Deferred(),i=c.internal.xhrRequest(g.url,b);return i.then(function(a){var d=c.createImageObject(a,b,g.frame);d.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}b.registerImageLoader("dicomweb",g),b.registerImageLoader("wadouri",g)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(f,a,b);var d=c.decodeTransferSyntax(a,b);return c.convertColorSpace(f,a,d)}function e(e,h,i,j){var k=c.getPixelSpacing(h),l=h.uint16("x00280010"),m=h.uint16("x00280011"),n=c.getRescaleSlopeAndIntercept(h),o=h.byteArray.length,p=c.getWindowWidthAndCenter(h);g=void 0;var q,r=a.Deferred();try{q=d(h,i)}catch(s){return r.reject(s),r.promise()}return q.then(function(a){function c(){return a.data}function d(){return a}function i(){if(g===e)return f;f.height=l,f.width=m;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var q={imageId:e,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:p.windowCenter,windowWidth:p.windowWidth,render:b.renderColorImage,getPixelData:c,getImageData:d,getCanvas:i,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:h,invert:!1,fakeColor:!1,sizeInBytes:o,sharedCacheKey:j};(void 0===q.windowCenter||isNaN(q.windowCenter)||void 0===q.windowWidth||isNaN(q.windowWidth))&&(q.windowWidth=255,q.windowCenter=128),r.resolve(q)},function(a){r.reject(a)}),r.promise()}var f=document.createElement("canvas"),g="";c.makeColorImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.getPixelFormat(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function e(a,b,c){var d=c.uint16("x00283002",0);0===d&&(d=65535);var e=0;e=0===b?c.uint16("x00283002",1):c.int16("x00283002",1);for(var f=c.uint16("x00283002",2),g={id:"1",firstValueMapped:e,numBitsPerEntry:f,lut:[]},h=0;h<d;h++)0===b?g.lut[h]=c.uint16("x00283006",h):g.lut[h]=c.int16("x00283006",h);return g}function f(f,g,h,i){function j(){return r}var k,l=a.Deferred(),m=c.getPixelSpacing(g),n=g.uint16("x00280010"),o=g.uint16("x00280011"),p=c.getRescaleSlopeAndIntercept(g);try{k=d(g)}catch(q){return l.reject(q),l.promise()}var r,s=g.byteArray.length,t=g.string("x00280004"),u="MONOCHROME1"===t,v=c.getWindowWidthAndCenter(g);try{r=c.decodeTransferSyntax(g,h)}catch(w){return l.reject(w),l.promise()}var x=c.getMinMax(r),y={imageId:f,minPixelValue:x.min,maxPixelValue:x.max,slope:p.slope,intercept:p.intercept,windowCenter:v.windowCenter,windowWidth:v.windowWidth,render:b.renderGrayscaleImage,getPixelData:j,rows:n,columns:o,height:n,width:o,color:!1,columnPixelSpacing:m.column,rowPixelSpacing:m.row,data:g,invert:u,fakeColor:!1,sizeInBytes:s,sharedCacheKey:i},z=g.uint16("x00280103");if(g.elements.x00283000&&(y.modalityLUT=e(y,z,g.elements.x00283000.items[0].dataSet)),g.elements.x00283010&&(z=0,y.minPixelValue*y.slope+y.intercept<0&&(z=1),y.voiLUT=e(y,z,g.elements.x00283010.items[0].dataSet)),void 0===y.windowCenter||isNaN(y.windowCenter)||void 0===y.windowWidth||isNaN(y.windowWidth)){var A=y.maxPixelValue*y.slope+y.intercept,B=y.minPixelValue*y.slope+y.intercept;y.windowWidth=A-B,y.windowCenter=(A+B)/2}return l.resolve(y),l.promise()}c.makeGrayscaleImage=f}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.9.2"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e){var f=a.Deferred(),g=new XMLHttpRequest;return g.open("get",d,!0),g.responseType="arraybuffer",c.internal.options.beforeSend(g),g.onreadystatechange=function(a){if(4===g.readyState)if(200===g.status){var b=g.response,c=new Uint8Array(b),d=dicomParser.parseDicom(c);f.resolve(d)}else f.reject(g.response)},g.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},g.send(),f.promise()}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);var pixelSpacing=1;cornerstone.registerImageLoader("loadAxialSlice",loadAxialSlice),cornerstone.registerImageLoader("loadCoronalSlice",loadCoronalSlice),cornerstone.registerImageLoader("loadSagttialSlice",loadSagttialSlice);var _maxminScale=1;$(function(){document.onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];if(b.altKey&&48==b.keyCode||b.altKey&&96==b.keyCode){var c="Alt+0";enterMprBtn(c)}if(b.altKey&&49==b.keyCode||b.altKey&&97==b.keyCode){var c="Alt+1";enterMprBtn(c)}if(b.altKey&&50==b.keyCode||b.altKey&&98==b.keyCode){var c="Alt+2";enterMprBtn(c)}if(b.altKey&&51==b.keyCode||b.altKey&&99==b.keyCode){var c="Alt+3";enterMprBtn(c)}if(b.altKey&&52==b.keyCode||b.altKey&&100==b.keyCode){var c="Alt+4";enterMprBtn(c)}if(b.altKey&&53==b.keyCode||b.altKey&&101==b.keyCode){var c="Alt+5";enterMprBtn(c)}if(b.altKey&&54==b.keyCode||b.altKey&&102==b.keyCode){var c="Alt+6";enterMprBtn(c)}if(b.altKey&&55==b.keyCode||b.altKey&&103==b.keyCode){var c="Alt+7";enterMprBtn(c)}if(b.altKey&&56==b.keyCode||b.altKey&&104==b.keyCode){var c="Alt+8";enterMprBtn(c)}if(b.altKey&&57==b.keyCode||b.altKey&&105==b.keyCode){var c="Alt+9";enterMprBtn(c)}},$(window).resize(function(){allEleResize()}),$(".closeBtn").click(function(){window.parent.dvStruct.mprOpenFlag=!1;var a=0;window.parent.$(".js-mpr").each(function(){$(this).is(":visible")&&a++}),console.log(a),a>1?window.parent.$(".js-mprClose").click():window.parent.$("#papaFrame").hide()}),$(".wwwcSet").click(function(){window.parent.$(".wwwlBox").css("z-index",1e6),window.parent.$(".wwwlBox").show()}),$(".js-crossline").click(function(){$(".min").click(),$(".wrapperBox").hide(),$(".positionTxt").show(),$(".wwwcBox").hide(),$(".toolM1").hide(),mprH(),mesureMode=!1}),$(".toolM").click(function(){$(".toolM").removeClass("checked"),$(this).addClass("checked")}),$(".max").click(function(){var a,b=$(this).parent(".viewportWrapper").find(".viewport").attr("sliceType");a=$(this).parent(".viewportWrapper").find(".viewport").hasClass("axialSliceOut")?"AXIAL":$(this).parent(".viewportWrapper").find(".viewport").hasClass("sagittalSliceOut")?"SAGITTAL":"CORONAL",magnifySlice(a,b)}),$(".min").click(function(){$(".magnifyBox").hide(),$(".magnifyBox").attr("state","hide")}),$(".js-point").click(function(){measureMode();var a="probe";enableAllEle(a)}),$(".js-length").click(function(){measureMode();var a="length";enableAllEle(a)}),$(".js-angle").click(function(){measureMode();var a="angle";enableAllEle(a)}),$(".js-rect").click(function(){measureMode();var a="rectangleRoi";enableAllEle(a)}),$(".js-ellipse").click(function(){measureMode();var a="ellipticalRoi";enableAllEle(a)}),$(".js-heartScale").click(function(){measureMode();var a="heartScale";enableAllEle(a)}),$(".js-clear").click(function(){if(mesureMode){clearAllMeasure()}}),$(".js-wwwc").click(function(){measureMode();var a="wwwc";enableAllEle(a)}),$(".js-zoom").click(function(){measureMode();var a="zoom";enableAllEle(a)}),$(".js-pan").click(function(){measureMode();var a="pan";enableAllEle(a)}),$(".js-reset").click(function(){if(mesureMode){measureMode();resetAllEle()}}),$(".js-mouse").click(function(){disableAllEle()}),$(".js-nextPage").click(function(){measureMode();var a=$(".active").attr("sliceType");changeSlice(a,"add"),reLoadImage()}),$(".js-prevPage").click(function(){measureMode();var a=$(".active").attr("sliceType");changeSlice(a,"sub"),reLoadImage()}),$(".playBtn").on("click",function(){palyStart=window.setInterval("mprPlay();",playSpeed),$(this).hide(),$(".playTool").show()}),$(".stopBtn").on("click",function(){window.clearInterval(palyStart),$(".playTool").hide(),$(".playBtn").show()}),$(".fast").on("click",function(){window.clearInterval(palyStart),playSpeed-=10,playSpeed<=0&&(playSpeed=10),palyStart=window.setInterval("mprPlay();",playSpeed)}),$(".slow").on("click",function(){window.clearInterval(palyStart),playSpeed+=10,playSpeed>=2e3&&(playSpeed=2e3),palyStart=window.setInterval("mprPlay();",playSpeed)}),$(".viewport").click(function(){}),$(".viewport").on("mousewheel DOMMouseScroll",function(a){var b=$(this).parents(".viewportWrapper").find(".viewport").attr("sliceType");return a.originalEvent.wheelDelta<0||a.originalEvent.detail>0?(changeSlice(b,"add"),reLoadImage()):(changeSlice(b,"sub"),reLoadImage()),!1}),$(".magnifyViewport").on("mousewheel DOMMouseScroll",function(a){var b=$(this).attr("sliceType");return a.originalEvent.wheelDelta<0||a.originalEvent.detail>0?(changeMagnifySlice(b,"add"),reLoadImage(!0,b)):(changeMagnifySlice(b,"sub"),reLoadImage(!0,b)),!1}),$(".wwwcInput").bind("keypress",function(a){if("13"==a.keyCode){var b=$("#windowInput").val(),c=$("#centerInput").val();isNaN(b)||isNaN(c)||quickWwwc(b,c),$(".wwwcInput").blur()}}),$("#swap").on("click",function(){$(".stopBtn").click(),$(".papaya-control-swap").click();var a=sliceTypeArr[0];sliceTypeArr[0]=sliceTypeArr[1],sliceTypeArr[1]=sliceTypeArr[2],sliceTypeArr[2]=a,$(".axialSliceOut").attr("sliceType",sliceTypeArr[0]),$(".coronalSliceOut").attr("sliceType",sliceTypeArr[1]),$(".sagittalSliceOut").attr("sliceType",sliceTypeArr[2])}),$("#center").on("click",function(){$(".papaya-control-goto-center").click()}),$("#origin").on("click",function(){$(".papaya-control-goto-origin").click()});var a=!1,b=["X","Y","Z"];$(".rotateDirectBtn").on("click",function(){var a=parseInt($(this).attr("value"));a++,a=3==a?0:a,$(this).attr("value",a),sliderType=b[a];var c="../src/css/img/"+b[a]+".png";$(this).find("img").attr("src",c)}),$("#back").on("click",function(){$("#ImageButton00").click(),$("#Rotation-00").click();var a=50;$("#rotate").val(a),$("#rotationX0_0Slider").val(a),$("#rotationX0_0Slider").change(),$("#rotationY0_0Slider").val(a),$("#rotationY0_0Slider").change(),$("#rotationZ0_0Slider").val(a),$("#rotationZ0_0Slider").change()}),$(document).on("mousedown","#rotate",function(){$("#ImageButton00").click(),$("#Rotation-00").click(),a=!0}),$(document).on("mousemove","#rotate",function(){if(a){var b=$(this).val();"0"==$(".rotateDirectBtn").attr("value")?($("#rotationX0_0Slider").val(b),$("#rotationX0_0Slider").change()):"1"==$(".rotateDirectBtn").attr("value")?($("#rotationY0_0Slider").val(b),$("#rotationY0_0Slider").change()):($("#rotationZ0_0Slider").val(b),$("#rotationZ0_0Slider").change())}}),$(document).on("mouseup",function(){a=!1}),$("#rotate").change(function(){var a=$(this).val();"0"==$(".rotateDirectBtn").attr("value")?($("#rotationX0_0Slider").val(a),$("#rotationX0_0Slider").change()):"1"==$(".rotateDirectBtn").attr("value")?($("#rotationY0_0Slider").val(a),$("#rotationY0_0Slider").change()):($("#rotationZ0_0Slider").val(a),$("#rotationZ0_0Slider").change())})});var outDivH;$(function(){mprH()}),$(window).resize(function(){mprH()});