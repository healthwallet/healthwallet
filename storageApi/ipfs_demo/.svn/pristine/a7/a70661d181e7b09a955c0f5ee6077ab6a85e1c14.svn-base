function info(a){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+a)}function warn(a){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+a)}function error(a){if(arguments.length>1){var b=["Error:"];b.push.apply(b,arguments),console.log.apply(console,b),a=[].join.call(arguments," ")}else console.log("Error: "+a);throw console.log(backtrace()),UnsupportedManager.notify(UNSUPPORTED_FEATURES.unknown),new Error(a)}function backtrace(){try{throw new Error}catch(a){return a.stack?a.stack.split("\n").slice(2).join("\n"):""}}function assert(a,b){a||error(b)}function combineUrl(a,b){if(!b)return a;if(/^[a-z][a-z0-9+\-.]*:/i.test(b))return b;var c;if("/"===b.charAt(0))return c=a.indexOf("://"),"/"===b.charAt(1)?++c:c=a.indexOf("/",c+3),a.substring(0,c)+b;var d=a.length;c=a.lastIndexOf("#"),d=c>=0?c:d,c=a.lastIndexOf("?",d),d=c>=0?c:d;var e=a.lastIndexOf("/",d);return a.substring(0,e+1)+b}function isValidUrl(a,b){if(!a)return!1;var c=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(a);if(!c)return b;switch(c=c[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function shadow(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!1}),c}function bytesToString(a){assert(null!==a&&"object"==typeof a&&void 0!==a.length,"Invalid argument for bytesToString");var b=a.length,c=8192;if(c>b)return String.fromCharCode.apply(null,a);for(var d=[],e=0;b>e;e+=c){var f=Math.min(e+c,b),g=a.subarray(e,f);d.push(String.fromCharCode.apply(null,g))}return d.join("")}function stringToBytes(a){assert("string"==typeof a,"Invalid argument for stringToBytes");for(var b=a.length,c=new Uint8Array(b),d=0;b>d;++d)c[d]=255&a.charCodeAt(d);return c}function string32(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)}function log2(a){for(var b=1,c=0;a>b;)b<<=1,c++;return c}function readInt8(a,b){return a[b]<<24>>24}function readUint16(a,b){return a[b]<<8|a[b+1]}function readUint32(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}function isLittleEndian(){var a=new Uint8Array(2);a[0]=1;var b=new Uint16Array(a.buffer);return 1===b[0]}function hasCanvasTypedArrays(){var a=document.createElement("canvas");a.width=a.height=1;var b=a.getContext("2d"),c=b.createImageData(1,1);return"undefined"!=typeof c.data.buffer}function stringToPDFString(a){var b,c=a.length,d=[];if("þ"===a[0]&&"ÿ"===a[1])for(b=2;c>b;b+=2)d.push(String.fromCharCode(a.charCodeAt(b)<<8|a.charCodeAt(b+1)));else for(b=0;c>b;++b){var e=PDFStringTranslateTable[a.charCodeAt(b)];d.push(e?String.fromCharCode(e):a.charAt(b))}return d.join("")}function stringToUTF8String(a){return decodeURIComponent(escape(a))}function isEmptyObj(a){for(var b in a)return!1;return!0}function isBool(a){return"boolean"==typeof a}function isInt(a){return"number"==typeof a&&(0|a)===a}function isNum(a){return"number"==typeof a}function isString(a){return"string"==typeof a}function isNull(a){return null===a}function isName(a){return a instanceof Name}function isCmd(a,b){return a instanceof Cmd&&(void 0===b||a.cmd===b)}function isDict(a,b){if(!(a instanceof Dict))return!1;if(!b)return!0;var c=a.get("Type");return isName(c)&&c.name===b}function isArray(a){return a instanceof Array}function isStream(a){return"object"==typeof a&&null!==a&&void 0!==a.getBytes}function isArrayBuffer(a){return"object"==typeof a&&null!==a&&void 0!==a.byteLength}function isRef(a){return a instanceof Ref}function createPromiseCapability(){var a={};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a}function MessageHandler(a,b){this.name=a,this.comObj=b,this.callbackIndex=1,this.postMessageTransfers=!0;var c=this.callbacksCapabilities={},d=this.actionHandler={};d.console_log=[function(a){console.log.apply(console,a)}],d.console_error=[function(a){console.error.apply(console,a)}],d._unsupported_feature=[function(a){UnsupportedManager.notify(a)}],b.onmessage=function(a){var e=a.data;if(e.isReply){var f=e.callbackId;if(e.callbackId in c){var g=c[f];delete c[f],"error"in e?g.reject(e.error):g.resolve(e.data)}else error("Cannot resolve callback "+f)}else if(e.action in d){var h=d[e.action];e.callbackId?Promise.resolve().then(function(){return h[0].call(h[1],e.data)}).then(function(a){b.postMessage({isReply:!0,callbackId:e.callbackId,data:a})},function(a){b.postMessage({isReply:!0,callbackId:e.callbackId,error:a})}):h[0].call(h[1],e.data)}else error("Unknown action from worker: "+e.action)}}function loadJpegStream(a,b,c){var d=new Image;d.onload=function(){c.resolve(a,d)},d.onerror=function(){c.resolve(a,null),warn("Error during JPEG image loading")},d.src=b}function infoFormat(a){if(b){var b=$.trim(a.slice(1,-1));return b.split(":")}}function outputTranslate(a){for(var b=a,c=[],d=0;d<b.length;d++){c.push({No:d,total:b[d].items.length,dicoms:[],suid:b[d].CSeriesID});for(var e=0;e<b[d].items.length;e++){var f=b[d].items[e],g=infoFormat(f.CSpace),h=infoFormat(f.CRect),i=(parseInt(f.ICol)*parseInt(f.IRow),{cutPoint:h?[parseInt(h[1]),parseInt(h[0])]:void 0,iw:h?parseInt(h[2]):void 0,ih:h?parseInt(h[3]):void 0,seriesNo:d,No:e,iCol:parseInt(f.ICol),iRow:parseInt(f.IRow),preview:f.CJpg,rulerX:g?g[0]:void 0,rulerY:g?g[1]:void 0,wl:parseInt(f.IWL),ww:parseInt(f.IWW),maxCt:parseInt(f.IWL)+parseInt(f.IWW)/2,dTime:f.DSJ,age:f.CAge,sex:f.CSex,CPName:f.CPName,CHos:f.CHos,CLocalStr:f.CLocalStr,CVec:f.CVec,CModality:f.CModality,CImageType:f.CImageType,CThick:f.CThick,CTre:f.CTre,CDes:f.CDes,theUrl:f.CZIP?f.CZIP:"",ISNum:f.ISNum,IQNum:f.IQNum,IINum:parseInt(f.IINum),INum:f.INum,CRGB:f.CRGB,CBZ:f.CBZ?f.CBZ:"",imageId:f.CImageID});c[d].dicoms.push(i)}}return c}function outputTranslateEdu(a){for(var b=a,c=[],d=0;d<b.length;d++){c.push({No:d,total:b[d].items.length,dicoms:[],suid:b[d].CSeriesID});for(var e=0;e<b[d].items.length;e++){var f=b[d].items[e],g={seriesNo:d,No:e,theUrl:f.URL?f.URL:"",seriesId:f.SeriesID,imageId:f.ImageID};c[d].dicoms.push(g)}}return c}function searchBackInfo(a){var b;return _.each(dvStruct.outputSeriesArr,function(c){var d=_.find(c.dicoms,function(b){return b.imageId==a});if(d)return b=d,!1}),b}function dvLocalLoader(a){var b=_.find(dvStruct.imgObjArr,function(b){return b.imageId==a});return console.log("dvLocalLoader:",b),b.imagePromise}function dvSeriesLoader(a){var b,c=a.split(":");winId=c[1];var d=_.find(dvStruct.viewer.winArr,function(a){return a.winId==winId});if(_.isObject(d))var b=_.find(d.imgObjArr,function(b){return b.imageId==a});return _.isObject(b)?b.imagePromise:void console.error("dvSeriesLoader:no re no imagePromise")}function handleError(a){a.name&&a.message?alert(a.name+": "+a.message+"."):alert("Error: "+a+"."),a.stack&&console.error(a.stack)}function guid(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[],f=b||"";if(radix=d.length,a)for(c=0;c<a;c++)e[c]=d[0|Math.random()*radix];else{var g;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;c<36;c++)e[c]||(g=0|16*Math.random(),e[c]=d[19==c?3&g|8:g])}var h=new Date,i=Date.UTC(h.getFullYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),h.getSeconds(),h.getMilliseconds());return f+""+i+e.join("")}function createNewImageObject(a,b){var c=b||"oridcm",d=guid(8,c+":");$.Deferred();try{var e=cornerstoneWADOImageLoader.createImageObject(a,d)}catch(f){console.error(f)}return{imageId:d,imagePromise:e}}function compareBySort(a,b){var c=[a,b];return c.sort(),c[0]==b?1:0}function compareByNo(a,b){return parseInt(a)<parseInt(b)?1:0}function firstIsBigger(a,b){for(var c=a.split("."),d=b.split("."),e=0;e<c.length;e++){if(e>=d.length)return!0;if(parseInt(c[e])<parseInt(d[e]))return!1;if(parseInt(c[e])>parseInt(d[e]))return!0}return!0}function updateTotalImgNo(a){for(var b=0;b<a.wrappers.length;b++){var c=a.wrappers[b],d=c.stack.imageIds.length;if(d>0){var e=$(c.element).parent();$(e).find(".js-info-totalNo").text("/"+d)}}}function reDrawWrapper(a){var b=a.stack.imageIds[a.stack.currentImageIdIndex];b&&cornerstone.loadImage(b).then(function(c){try{cornerstone.displayImage(a.element,c),cornerstoneTools.orientationMarkers.enable(a.element)}catch(d){console.error(d),console.error(c,b,a.element)}})}function setAllEle(a){dvStruct.viewer.eachElement({callback:function(b,c){try{var d=cornerstone.getImage(b);_.isObject(d)&&a(b)}catch(e){console.error(e)}}})}function layoutSelectorBuilder(a,b,c){var d={cols:a,rows:b,layoutSelector:void 0,getLayoutSelector:function(){return function(){return d.layoutSelector||function(){for(var a=d,b=23*a.cols+4,e=23*a.rows+4,f='<div style="height:'+e+"px;width:"+b+'px;visibility: hidden" id="'+c+'">',g=0;g<a.cols*a.rows;g++)g%a.cols==0&&(f+='<div class="urow">'),f+='<div class="ucol" colNum='+(g%a.cols+1)+" rowNum="+(parseInt(g/a.cols)+1)+" ></div>",g%a.cols==a.cols-1&&(f+="</div>");return f+="</div>",$(document.body).append(f),d.layoutSelector=document.getElementById(c)}()}}(),show:function(a,b){unit.mask.show();var c=this.getLayoutSelector();if("left"==b)var d=$(c).width(),e=a.y,f=a.x-d;else var e=a.y,f=a.x;$(c).css({top:e+"px",left:f+"px"}),$(c).css("visibility","visible"),this.onSelecting()},hide:function(){var a=this.getLayoutSelector();$(a).css("visibility","hidden"),unit.mask.hide()},onSelecting:function(){var a=this;$(document.body).on("mousemove",function(b){a.getNowColAndRow(b)}),$(document.body).on("mousedown",function(b){$(document.body).off("mousedown"),$(document.body).off("mousemove"),a.endSelecting(b)})},endSelecting:function(a){this.hide();var b=this.getNowColAndRow(a);0!=b.col&&0!=b.row&&this.callback(b)},getNowColAndRow:function(a){var b=this.getLayoutSelector(),c=($(b).offset(),a.pageX),d=a.pageY,e=0,f=0;$(b).find(".ucol").each(function(){var a=$(this).offset();if(c>a.left&&d>a.top){$(this).addClass("lighten");var b=parseInt($(this).attr("colNum")),g=parseInt($(this).attr("rowNum"));b>e&&(e=b),g>f&&(f=g)}else $(this).removeClass("lighten")});var g={col:e,row:f};return g},callback:function(){}};return d}function dicomLocalCovert(a,b){var c=a,d=new Uint8Array(c),e=dicomParser.parseDicom(d);if(!e)return void alert("解析失败");var f=getDicomInfo(e);console.log(f),b(e);var g=createNewImageObject(e);return dvStruct.imgObjArr.push(g),{dataSet:e,infoSet:f,imageId:g.imageId,iid:f.InstanceInfo.InstanceNumber.val}}function dicomLocalCoverUint8(a,b){var c=dicomParser.parseDicom(a);if(!c)return void alert("解析失败");var d=getDicomInfo(c);console.log(d),b(c);var e=createNewImageObject(c);return dvStruct.imgObjArr.push(e),{dataSet:c,infoSet:d,imageId:e.imageId,iid:d.InstanceInfo.InstanceNumber.val}}function getDicomInfo(a){var b={},c=a.string("x00080005");if(c=c?c.toUpperCase():void 0,console.log("encodeWay",c),console.log(a),"ISO_IR 192"==c||"ISO 10646-1"==c||"ISO 10646-2"==c)return infoDecode(a,b,"UTF-8"),b;if(_.isObject(jschardet)){if(c&&c.indexOf("GB")<0){var d=a.string("x00100010"),e=a.string("x00080080"),f=a.string("x00081030"),g=jschardet.detect(d+e+f);_.isObject(g)&&g.confidence>.5?c=g.encoding.toUpperCase():(console.log(g),c="GB18030")}}else c="GB18030";return c&&iconvForUse.encodingExists(c)?(console.log("exsit",iconvForUse.encodingExists(c)),infoDecode(a,b,c)):c&&c.indexOf("GB")>-1?(c="GB18030",infoDecode(a,b,c)):(console.log("没有特别编码  或者为 不能识别的编码方式"),c="GB18030",infoDecode(a,b,c)),b}function infoDecode(a,b,c){b.PatientInfo={PatientName:{tag:"x00100010",val:"",des:"",type:"data-dicom"},PatientID:{tag:"x00100020",val:"",des:"",type:"data-dicom"},PatientBirthDate:{tag:"x00100030",val:"",des:"",type:"data-dicom"},PatientBirthTime:{tag:"x00100032",val:"",des:"",type:"data-dicom"},PatientsAge:{tag:"x00101010",val:"",des:"",type:"data-dicom"},PatientSex:{tag:"x00100040",val:"",des:"",type:"data-dicom"},PatientWeight:{tag:"x00101030",val:"",des:"",type:"data-dicom"},PregnancyStatus:{tag:"x001021c0",val:"",des:"",type:"data-dicom"},AccessionNumber:{tag:"x00080050",val:"",des:"",type:"data-dicom"},PatientPosition:{tag:"x00185100",val:"",des:"",type:"data-dicom"}},b.StudyInfo={StudyDescription:{tag:"x00081030",val:"",des:"",type:"data-dicom"},ProtocolName:{tag:"x00181030",val:"",des:"",type:"data-dicom"},Accession:{tag:"x00080050",val:"",des:"",type:"data-dicom"},StudyId:{tag:"x00200010",val:"",des:"",type:"data-dicom"},StudyDate:{tag:"x00080020",val:"",des:"",type:"data-dicom"},StudyTime:{tag:"x00080030",val:"",des:"",type:"data-dicom"},ModalitiesInStudy:{tag:"x00080061",val:"",des:"",type:"data-dicom"}},b.SeriesInfo={SeriesDescription:{tag:"x0008103e",val:"",des:"",type:"data-dicom"},SeriesNo:{tag:"x00200011",val:"",des:"",type:"data-dicom"},Modality:{tag:"x00080060",val:"",des:"",type:"data-dicom"},BodyPart:{tag:"x00180015",val:"",des:"",type:"data-dicom"},SeriesDate:{tag:"x00080021",val:"",des:"",type:"data-dicom"},SeriesTime:{tag:"x00080031",val:"",des:"",type:"data-dicom"},SliceThickness:{tag:"x00180050",val:"",des:"",type:"data-dicom"},SpacingBetweenSlices:{tag:"x00180088",val:"",des:"",type:"data-dicom"},SliceLocation:{tag:"x00201041",val:"",des:"",type:"data-dicom"},MRAcquisition:{tag:"x00180023",val:"",des:"",type:"data-dicom"},FlipAngle:{tag:"x00181314",val:"",des:"",type:"data-dicom"}},b.InstanceInfo={InstanceNumber:{tag:"x00200013",val:"",des:"",type:"data-dicom"},ContentDate:{tag:"x00080023",val:"",des:"",type:"data-dicom"},ContentTime:{tag:"x00080033",val:"",des:"",type:"data-dicom"},AcquisitionNumber:{tag:"x00200012",val:"",des:"",type:"data-dicom"},AcquisitionDate:{tag:"x00080022",val:"",des:"",type:"data-dicom"},AcquisitionTime:{tag:"x00080032",val:"",des:"",type:"data-dicom"}},b.ImageInfo={Rows:{tag:"x00280010",val:"",des:"",type:"data-dicomUint"},Columns:{tag:"x00280011",val:"",des:"",type:"data-dicomUint"},PhotometricInterpretation:{tag:"x00280004",val:"",des:"",type:"data-dicom"},ImageType:{tag:"x00080008",val:"",des:"",type:"data-dicom"},BitsAllocated:{tag:"x00280100",val:"",des:"",type:"data-dicomUint"},BitsStored:{tag:"x00280101",val:"",des:"",type:"data-dicomUint"},HighBit:{tag:"x00280102",val:"",des:"",type:"data-dicomUint"},PixelRepresentation:{tag:"x00280103",val:"",des:"",type:"data-dicomUint"},RescaleSlope:{tag:"x00281053",val:"",des:"",type:"data-dicom"},RescaleIntercept:{tag:"x00281052",val:"",des:"",type:"data-dicom"},ImagePositionPatient:{tag:"x00200032",val:"",des:"",type:"data-dicom"},ImageOrientationPatient:{tag:"x00200037",val:"",des:"",type:"data-dicom"},PixelSpacing:{tag:"x00280030",val:"",des:"",type:"data-dicom"},SamplesPerPixel:{tag:"x00280002",val:"",des:"",type:"data-dicomUint"},WindowCenter:{tag:"x00281050",val:"",des:"",type:"data-dicomUint"},WindowWidth:{tag:"x00281051",val:"",des:"",type:"data-dicomUint"},RescaleType:{tag:"x00281054",val:"",des:"",type:"data-dicomUint"},FieldofView:{tag:"x00180094",val:"",des:"",type:"data-dicom"}},b.EquipmentInfo={Manufacturer:{tag:"x00080070",val:"",des:"",type:"data-dicom"},Model:{tag:"x00081090",val:"",des:"",type:"data-dicom"},StationName:{tag:"x00081010",val:"",des:"",type:"data-dicom"},AETitle:{tag:"x00020016",val:"",des:"",type:"data-dicom"},InstitutionName:{tag:"x00080080",val:"",des:"",type:"data-dicom"},SoftwareVersion:{tag:"x00181020",val:"",des:"",type:"data-dicom"},ImplementationVersionNam:{tag:"x00020013",val:"",des:"",type:"data-dicom"}},b.UIDS={StudyUID:{tag:"x0020000d",val:"",des:"",type:"data-dicom"},SeriesUID:{tag:"x0020000e",val:"",des:"",type:"data-dicom"},InstanceUID:{tag:"x00080018",val:"",des:"",type:"data-dicom"},SOPClassUID:{tag:"x00080016",val:"",des:"",type:"data-dicom"},TransferSyntaxUID:{tag:"x00020010",val:"",des:"",type:"data-dicom"},FrameOfReferenceUID:{tag:"x00200052",val:"",des:"",type:"data-dicom"}},b.SomeUsefulInfo={MagneticFieldStrength:{tag:"x00180087",val:"",des:"",type:"data-dicom"},RepetitionTime:{tag:"x00180080",val:"",des:"",type:"data-dicom"},EchoTime:{tag:"x00180081",val:"",des:"",type:"data-dicom"},kvp:{tag:"x00180060",val:"",des:"",type:"data-dicom"},mA:{tag:"x00181151",val:"",des:"",type:"data-dicom"}};var d={};for(var e in a.elements){var f=a.elements[e].tag,g=!0;for(var h in b){var i=b[h];for(var j in i)if(i[j].tag==f){g=!1;break}}g&&(d[e]={tag:f,val:"",des:"",type:"data-dicom"})}b.others=d;try{for(var e in b){var i=b[e];for(var h in i){var k=i[h];if("x7fe00010"!=k.tag){matchDict(k);var f=k.tag;if("data-dicom"==k.type){var l=a.elements[f],m="";if(void 0!==l){var n=a.string(f);if(void 0!==n)if(c)if("UTF-8"==c)m=iconvForUse.decode(n,c);else{for(var o=new Uint8Array(n.length),j=0;j<o.length;j++){var p=n.charCodeAt(j);o[j]=p}m=iconvForUse.decode(o,c)}else m=n}k.val=m}else if("data-dicomUint"==k.type){var l=a.elements[f],m="";void 0!==l&&(2===l.length?m+=a.uint16(f):4===l.length&&(m+=a.uint32(f))),k.val=m}}}}}catch(q){console.error("infoSet iconv error"),console.error(q)}}function matchDict(a){var b=a.tag;b&&(b="("+b.substr(1,4).toUpperCase()+","+b.substr(5,4).toUpperCase()+")",TAG_DICT[b]&&_.isObject(TAG_DICT[b])&&(a.des=TAG_DICT[b].name))}function build_dicom_imgViewer_templates(a){a.container=_.template($("#dvContainerTemp").text()),a.viewportWrapper=_.template($("#viewportWrapperTemp").text()),a.preview=_.template($("#dvPreviewTemp").text()),a.seriesWindow=_.template($("#seriesWindowTemp").text())}function onViewportUpdated(a){var b=cornerstone.getViewport(a.target),c=dvStruct.viewer.getWrapperById($(a.target).attr("id")),d=$(a.target).parent();$(d).find(".js-info-wwwl").text("WL/WW: "+Math.round(b.voi.windowCenter)+"/"+Math.round(b.voi.windowWidth)),$(d).find(".js-info-zoom").text("Zoom: "+b.scale.toFixed(2));var e=cornerstoneTools.getToolState(c.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0];$(d).find(".js-info-nowNo").text("Im: "+(parseInt(f.currentImageIdIndex)+1));var g=cornerstone.getImage(a.target).imageId,h=c.suid,i=dvStruct.viewer.findOriInfoByIds(g,h);if(i){var j=i.SeriesInfo.SliceThickness.val,k=i.SeriesInfo.SliceLocation.val;(j||k)&&$(d).find(".js-TL").text("T: "+j+"mm L: "+k+"mm")}}}"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(a){"use strict";function b(b){if(void 0===b)throw"disable: element element must not be undefined";for(var c=a.getEnabledElements(),d=0;d<c.length;d++)if(c[d].element===b){var e={element:b};return $(b).trigger("CornerstoneElementDisabled",e),c[d].element.removeChild(c[d].canvas),void c.splice(d,1)}}a.disable=b}(cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,void 0===f.viewport&&(f.viewport=b.internal.getDefaultViewport(f.canvas,d)),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImage=c}($,cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,f.viewport=b.internal.getDefaultViewport(f.canvas,d),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImageForJpg=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);if(void 0===c.image)throw"draw: image has not been loaded yet";b.drawImage(c)}b.draw=c}($,cornerstone),function(a,b){"use strict";function c(){for(var a=b.getEnabledElements(),c=0;c<a.length;c++){var d=a[c];d.invalid===!0&&b.drawImage(d)}}b.drawInvalidated=c}($,cornerstone),function(a){"use strict";function b(b){if(void 0===b)throw"enable: parameter element cannot be undefined";var c=document.createElement("canvas");b.appendChild(c);var d={element:b,canvas:c,image:void 0,invalid:!1,data:{}};return a.addEnabledElement(d),a.resize(b,!0),b}a.enable=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}a.getElementData=b,a.removeElementData=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}function e(){return f}var f=[];a.getEnabledElement=b,a.addEnabledElement=c,a.getEnabledElementsByImageId=d,a.getEnabledElements=e}(cornerstone),function(a){"use strict";function b(a){return 0===a.viewport.rotation||180===a.viewport.rotation?{width:a.image.width,height:a.image.height}:{width:a.image.height,height:a.image.width}}function c(c){var d=a.getEnabledElement(c),e=b(d),f=d.canvas.height/e.height,g=d.canvas.width/e.width;g<f?d.viewport.scale=g:d.viewport.scale=f,d.viewport.translation.x=0,d.viewport.translation.y=0,a.updateImage(c)}a.fitToWindow=c}(cornerstone),function(a,b){"use strict";function c(a,c){var d=b.getEnabledElement(a),e=b.internal.getDefaultViewport(d.canvas,c);return e}b.getDefaultViewportForImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);return c.image}b.getImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f){var g=a.getStoredPixels(b,c,d,e,f),h=a.getEnabledElement(b),i=a.internal.getModalityLUT(h.image.slope,h.image.intercept,h.viewport.modalityLUT),j=g.map(i);return j}a.getPixels=b}(cornerstone),function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;k<f;k++)for(var l=0;l<e;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}a.getStoredPixels=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=c.viewport;if(void 0!==d)return{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,fakeColor:d.fakeColor,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip,modalityLUT:d.modalityLUT,voiLUT:d.voiLUT}}a.getViewport=b}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";n=a,c()}function c(){function b(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(o<=n)){for(m.sort(b);o>n;){var c=m[m.length-1];o-=c.sizeInBytes,delete k[c.imageId],c.imagePromise.reject(),m.pop(),$(a).trigger("CornerstoneImageCachePromiseRemoved",{imageId:c.imageId})}var d=a.imageCache.getCacheInfo();$(a).trigger("CornerstoneImageCacheFull",d)}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(k.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,sharedCacheKey:void 0,imagePromise:b,timeStamp:new Date,sizeInBytes:0};k[a]=d,m.push(d),b.then(function(a){if(d.loaded=!0,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";a.sharedCacheKey?(d.sizeInBytes=a.sizeInBytes,d.sharedCacheKey=a.sharedCacheKey,l[a.sharedCacheKey]?l[a.sharedCacheKey]++:(l[a.sharedCacheKey]=1,o+=d.sizeInBytes)):(d.sizeInBytes=a.sizeInBytes,o+=d.sizeInBytes),c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=k[a];if(void 0!==b)return b.timeStamp=new Date,b.imagePromise}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=k[a];if(void 0===b)throw"removeImagePromise: imageId must not be undefined";return m.splice(m.indexOf(b),1),m.sharedCacheKey?1===l[m.sharedCacheKey]?(o-=b.sizeInBytes,delete l[m.sharedCacheKey]):l[m.sharedCacheKey]--:o-=b.sizeInBytes,delete k[a],h(b.imagePromise,b.imageId),b.imagePromise}function g(){return{maximumSizeInBytes:n,cacheSizeInBytes:o,numberOfImagesCached:m.length}}function h(a,b){a.then(function(c){c.decache&&c.decache(),a.reject(),delete k[b]}).always(function(){delete k[b]})}function i(){for(;m.length>0;){var a=m.pop();h(a.imagePromise,a.imageId)}o=0}function j(a,b){var c=k[a];c&&c.imagePromise.then(function(a){var c=b-a.sizeInBytes;a.sizeInBytes=b,o+=c})}var k={},l={},m=[],n=1073741824,o=0;a.imageCache={putImagePromise:d,getImagePromise:e,removeImagePromise:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:i,cachedImages:m,changeImageIdCacheSize:j}}(cornerstone),function(a,b){"use strict";function c(c){var d,e=c.indexOf(":"),f=c.substring(0,e),g=i[f];return void 0===g||null===g?void 0!==h?d=h(c):void 0:(d=g(c),d.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),d)}function d(a){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadImage: no image loader for imageId";return d}function e(a){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var d=b.imageCache.getImagePromise(a);if(void 0!==d)return d;if(d=c(a),void 0===d)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,d),d}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}var h,i={};b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g}($,cornerstone),function(a){"use strict";function b(a){var b=$(a.element).find("canvas").get(0),c=(a.image,b.height/a.image.rows),d=b.width/a.image.columns;return d<c?d:c}function c(c,d){var e=new a.internal.Transform;e.translate(c.canvas.width/2,c.canvas.height/2);var f=c.viewport.rotation;0!==f&&e.rotate(f*Math.PI/180);var g=b(c),h=c.viewport.scale*g,i=c.viewport.scale*g;return c.image.rowPixelSpacing<c.image.columnPixelSpacing?h*=c.image.columnPixelSpacing/c.image.rowPixelSpacing:c.image.columnPixelSpacing<c.image.rowPixelSpacing&&(i*=c.image.rowPixelSpacing/c.image.columnPixelSpacing),e.scale(h,i),0!==f&&e.rotate(-f*Math.PI/180),e.translate(c.viewport.translation.x,c.viewport.translation.y),0!==f&&e.rotate(f*Math.PI/180),void 0!==d&&e.scale(d,d),c.viewport.hflip&&e.scale(-1,1),c.viewport.vflip&&e.scale(1,-1),e.translate(-c.image.width/2,-c.image.height/2),e}a.diy||(a.diy={}),a.diy.iniScaleCal=b,a.internal.calculateTransform=c}(cornerstone),function(a,b){"use strict";function c(b,c){var d=new Date;b.image.render(b,c);var e=b.canvas.getContext("2d"),f=new Date,g=f-d,h={viewport:b.viewport,element:b.element,image:b.image,enabledElement:b,canvasContext:e,renderTimeInMs:g};a(b.element).trigger("CornerstoneImageRendered",h),b.invalid=!1}b.internal.drawImage=c,b.drawImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f,g){void 0===b.lut&&(b.lut=new Int16Array(b.maxPixelValue-Math.min(b.minPixelValue,0)+1));var h=b.lut,i=b.maxPixelValue,j=b.minPixelValue,k=a.internal.getModalityLUT(b.slope,b.intercept,f),l=a.internal.getVOILUT(c,d,g),m=0;j<0&&(m=j);var n,o,p,q;for(n=b.minPixelValue;n<=i;n++)o=k(n),p=l(o),q=Math.min(Math.max(p,0),255),e?h[n+-m]=Math.round(255-q):h[n+-m]=Math.round(q);return h}function c(a,c,d,e,f,g){if(f||g)return b(a,c,d,e,f,g);void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)+1));var h,i,j,k,l=a.lut,m=a.maxPixelValue,n=a.minPixelValue,o=a.slope,p=a.intercept,q=c,r=d,s=0;if(n<0&&(s=n),e===!0)for(k=a.minPixelValue;k<=m;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(255-j);else for(k=a.minPixelValue;k<=m;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(j)}a.internal.generateLutNew=b,a.internal.generateLut=c,a.generateLutNew=b,a.generateLut=c}(cornerstone),function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,fakeColor:b.fakeColor,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:b.modalityLUT,voiLUT:void 0};return c}a.internal.getDefaultViewport=b,a.getDefaultViewport=b}(cornerstone),function(a){"use strict";function b(b){var c=a.internal.calculateTransform(b);return c}a.internal.getTransform=b}(cornerstone),function(a,b){"use strict";b.drawImage=b.internal.drawImage,b.generateLut=b.internal.generateLut,b.storedPixelDataToCanvasImageData=b.internal.storedPixelDataToCanvasImageData,b.storedColorPixelDataToCanvasImageData=b.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(a){"use strict";function b(a,b){var c=a,d=b;return function(a){return a*c+d}}function c(a){var b=a.lut[0],c=a.lut[a.lut.length-1],d=a.firstValueMapped+a.lut.length;return function(e){return e<a.firstValueMapped?b:e>=d?c:a.lut[e]}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getModalityLUT=d}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;if(d<0)for(;f<g;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;f<g;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}a.internal.storedColorPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(a,b,d,e){var f=a.getPixelData(),g=a.minPixelValue,h=0,i=f.length,j=f,k=b,l=d,m=e;if(m)if("printBack"==m){var n=3;if(g<0)for(;h<i;)l[n-1]=255,l[n-2]=255,l[n-3]=255,l[n]=k[j[h++]+-g],n+=4;else for(;h<i;)l[n-1]=255,l[n-2]=255,l[n-3]=255,l[n]=k[j[h++]],n+=4}else{var n=0;if(g<0)for(;h<i;){var o=c[255-parseInt(k[j[h++]+-g])];l[n++]=o[0],l[n++]=o[1],l[n++]=o[2],l[n++]=255}else for(;h<i;){var o=c[255-parseInt(k[j[h++]])];l[n++]=o[0],l[n++]=o[1],l[n++]=o[2],l[n++]=255}}else{var n=3;if(g<0)for(;h<i;)l[n]=k[j[h++]+-g],n+=4;else for(;h<i;)l[n]=k[j[h++]],n+=4}}var c=[[0,0,0],[4,4,4],[8,0,8],[16,0,16],[20,0,20],[24,0,24],[33,0,33],[37,0,37],[41,0,41],[44,0,44],[49,0,49],[53,0,53],[57,0,57],[60,0,60],[66,0,66],[70,0,70],[74,0,74],[82,0,82],[90,0,90],[99,0,99],[107,0,107],[115,0,115],[123,0,123],[132,0,132],[140,0,140],[148,0,148],[156,0,156],[165,0,165],[173,0,173],[181,0,181],[189,0,189],[198,0,198],[206,0,206],[214,0,214],[222,0,222],[231,0,231],[239,0,239],[247,0,247],[255,0,255],[255,0,255],[247,0,255],[239,0,255],[231,0,255],[222,0,255],[214,0,255],[206,0,255],[198,0,255],[189,0,255],[181,0,255],[173,0,255],[165,0,255],[156,0,255],[148,0,255],[140,0,255],[132,0,255],[123,0,255],[115,0,255],[107,0,255],[99,0,255],[90,0,255],[82,0,255],[74,0,255],[66,0,255],[57,0,255],[49,0,255],[41,0,255],[33,0,255],[24,0,255],[16,0,255],[8,0,255],[0,0,255],[0,0,255],[0,8,255],[0,16,255],[0,24,255],[0,33,255],[0,41,255],[0,49,255],[0,57,255],[0,66,255],[0,74,255],[0,82,255],[0,90,255],[0,99,255],[0,107,255],[0,115,255],[0,123,255],[0,132,255],[0,140,255],[0,148,255],[0,156,255],[0,165,255],[0,169,255],[0,173,255],[0,181,255],[0,189,255],[0,198,255],[0,206,255],[0,214,255],[0,222,255],[0,231,255],[0,239,255],[0,247,255],[0,255,255],[0,255,247],[0,255,255],[0,247,231],[0,247,239],[0,239,214],[0,239,222],[0,231,198],[0,231,206],[0,222,181],[0,222,189],[0,214,165],[0,214,173],[0,206,148],[0,206,156],[0,198,123],[0,198,132],[0,198,140],[0,189,115],[0,189,123],[0,181,99],[0,181,107],[0,177,94],[0,173,82],[0,173,90],[0,165,66],[0,165,74],[0,156,41],[0,156,49],[0,156,57],[0,148,24],[0,148,33],[0,148,41],[0,140,16],[0,140,24],[0,136,10],[0,132,0],[0,132,8],[0,132,0],[8,132,0],[8,136,0],[8,140,0],[16,140,0],[24,140,0],[24,148,0],[33,148,0],[37,148,0],[41,148,0],[41,156,0],[45,156,0],[49,156,0],[57,156,0],[57,165,0],[66,165,0],[74,165,0],[74,173,0],[82,173,0],[90,173,0],[94,177,0],[99,181,0],[107,181,0],[115,189,0],[123,189,0],[132,198,0],[140,198,0],[144,202,0],[148,206,0],[156,206,0],[165,214,0],[169,214,0],[173,214,0],[181,222,0],[189,222,0],[198,231,0],[202,231,0],[206,231,0],[214,239,0],[222,239,0],[231,247,0],[239,247,0],[247,255,0],[255,255,0],[255,255,0],[255,247,0],[255,239,0],[255,231,0],[255,222,0],[255,214,0],[255,206,0],[255,198,0],[255,189,0],[255,181,0],[255,177,0],[255,173,0],[255,165,0],[255,156,0],[255,148,0],[255,144,0],[255,140,0],[255,132,0],[255,123,0],[255,115,0],[255,107,0],[255,99,0],[255,94,0],[255,90,0],[255,82,0],[255,74,0],[255,66,0],[255,57,0],[255,49,0],[255,41,0],[255,33,0],[255,24,0],[255,16,0],[255,8,0],[255,0,0],[255,0,0],[255,8,8],[255,16,16],[255,24,24],[255,33,33],[255,41,41],[255,49,49],[255,57,57],[255,66,66],[255,74,74],[255,82,82],[255,90,90],[255,99,99],[255,107,107],[255,115,115],[255,123,123],[255,132,132],[255,140,140],[255,144,144],[255,148,148],[255,152,152],[255,156,156],[255,165,165],[255,173,173],[255,181,181],[255,185,185],[255,189,189],[255,198,198],[255,206,206],[255,214,214],[255,222,222],[255,231,231],[255,239,239],[255,247,247],[255,255,255],[255,255,255]];
a.internal.storedPixelDataToCanvasImageData=b,a.storedPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(){this.reset()}b.prototype.reset=function(){this.m=[1,0,0,1,0,0]},b.prototype.clone=function(){var a=new b;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a},b.prototype.multiply=function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},b.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},b.prototype.scale=function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},b.prototype.transformPoint=function(a,b){var c=a,d=b;return a=c*this.m[0]+d*this.m[2]+this.m[4],b=c*this.m[1]+d*this.m[3]+this.m[5],{x:a,y:b}},a.internal.Transform=b}(cornerstone),function(a){"use strict";function b(a,b){return function(c){return 255*((c-b)/a+.5)}}function c(a){var b=a.numBitsPerEntry-8,c=a.lut[0]>>b,d=a.lut[a.lut.length-1]>>b,e=a.firstValueMapped+a.lut.length-1;return function(f){return f<a.firstValueMapped?c:f>=e?d:a.lut[f-a.firstValueMapped]>>b}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getVOILUT=d}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b);c.invalid=!0;var d={element:b};$(c.element).trigger("CornerstoneInvalidated",d)}a.invalidate=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}a.invalidateImageId=b}(cornerstone),function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=(e.image,b.getBoundingClientRect()),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i={x:g,y:h},j=a.internal.getTransform(e);return j.invert(),j.transformPoint(i.x,i.y)}a.pageToPixel=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.transformPoint(c.x,c.y)}a.pixelToCanvas=b}(cornerstone),function(a){"use strict";function b(a){j.width=a.width,j.height=a.height,g=j.getContext("2d"),g.fillStyle="white",g.fillRect(0,0,j.width,j.height),h=g.getImageData(0,0,a.width,a.height)}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){return b.imageId!==i||k.windowCenter!==a.viewport.voi.windowCenter||k.windowWidth!==a.viewport.voi.windowWidth||k.invert!==a.viewport.invert||k.rotation!==a.viewport.rotation||k.hflip!==a.viewport.hflip||k.vflip!==a.viewport.vflip}function e(e,f,i){if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&e.viewport.invert===!1&&f.getCanvas&&f.getCanvas())return f.getCanvas();if(d(e,f)===!1&&i!==!0)return j;j.width===f.width&&j.height==f.height||b(f);var k=c(f,e.viewport);return a.storedColorPixelDataToCanvasImageData(f,k,h.data),g.putImageData(h,0,0),j}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f);var g=e(b,d,c);f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),i=d.imageId,k.windowCenter=b.viewport.voi.windowCenter,k.windowWidth=b.viewport.voi.windowWidth,k.invert=b.viewport.invert,k.rotation=b.viewport.rotation,k.hflip=b.viewport.hflip,k.vflip=b.viewport.vflip}var g,h,i,j=document.createElement("canvas"),k={};a.rendering.colorImage=f,a.renderColorImage=f}(cornerstone),function(a){"use strict";function b(a){k.width=a.width,k.height=a.height,h=k.getContext("2d"),h.fillStyle="white",h.fillRect(0,0,k.width,k.height),i=h.getImageData(0,0,a.width,a.height)}function c(a,b){return!a&&!b||!(!a||!b)&&a.id!==b.id}function d(b,d,e){return void 0!==b.lut&&b.lut.windowCenter===d.voi.windowCenter&&b.lut.windowWidth===d.voi.windowWidth&&c(b.lut.modalityLUT,d.modalityLUT)&&c(b.lut.voiLUT,d.voiLUT)&&b.lut.invert===d.invert&&e!==!0?b.lut:(a.generateLut(b,d.voi.windowWidth,d.voi.windowCenter,d.invert,d.modalityLUT,d.voiLUT),b.lut.windowWidth=d.voi.windowWidth,b.lut.windowCenter=d.voi.windowCenter,b.lut.invert=d.invert,b.lut.voiLUT=d.voiLUT,b.lut.modalityLUT=d.modalityLUT,b.lut)}function e(a,b){return b.imageId!==j||l.windowCenter!==a.viewport.voi.windowCenter||l.windowWidth!==a.viewport.voi.windowWidth||l.invert!==a.viewport.invert||l.rotation!==a.viewport.rotation||l.hflip!==a.viewport.hflip||l.vflip!==a.viewport.vflip||l.modalityLUT!==a.viewport.modalityLUT||l.voiLUT!==a.viewport.voiLUT||l.fakeColor!==a.viewport.fakeColor}function f(c,f,g){if(e(c,f)===!1&&g!==!0)return k;k.width===f.width&&k.height==f.height&&l.fakeColor==f.fakeColor||(b(f),k.fakeColor=f.fakeColor);var j=d(f,c.viewport,g);return"printBack"==c.viewport.fakeColor?(a.storedPixelDataToCanvasImageData(f,j,i.data,c.viewport.fakeColor),"false"==c.viewport.fakeColor):a.storedPixelDataToCanvasImageData(f,j,i.data,c.viewport.fakeColor),h.putImageData(i,0,0),k}function g(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e);var g=f(b,d,c);e.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),j=d.imageId,l.windowCenter=b.viewport.voi.windowCenter,l.windowWidth=b.viewport.voi.windowWidth,l.invert=b.viewport.invert,l.fakeColor=b.viewport.fakeColor,l.rotation=b.viewport.rotation,l.hflip=b.viewport.hflip,l.vflip=b.viewport.vflip,l.modalityLUT=b.viewport.modalityLUT,l.voiLUT=b.viewport.voiLUT}var h,i,j,k=document.createElement("canvas"),l={};a.rendering.grayscaleImage=g,a.renderGrayscaleImage=g,a.initializeGrayscaleRenderCanvas=b}(cornerstone),function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}a.rendering.webImage=b,a.renderWebImage=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.internal.getDefaultViewport(c.canvas,c.image);c.viewport=d,a.updateImage(b)}a.reset=b}(cornerstone),function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas),void 0!==e.image&&a.updateImage(c)}a.resize=c}(cornerstone),function(a){"use strict";function b(b,c,d){if(void 0===b)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===c)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var e=a.internal.calculateTransform(b,d);c.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5],e.m[6])}a.setToPixelCoordinateSystem=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.fakeColor=c.fakeColor,d.viewport.pixelReplication=c.pixelReplication,d.viewport.rotation=c.rotation,d.viewport.hflip=c.hflip,d.viewport.vflip=c.vflip,d.viewport.modalityLUT=c.modalityLUT,d.viewport.voiLUT=c.voiLUT,d.viewport.voi.windowWidth<1e-6&&(d.viewport.voi.windowWidth=1e-6),d.viewport.scale<1e-4&&(d.viewport.scale=.25),360!==d.viewport.rotation&&d.viewport.rotation!==-360||(d.viewport.rotation=0),a.updateImage(b)}a.setViewport=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}a.updateImage=b}(cornerstone);var cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},a.Vector3.prototype={constructor:a.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyAxisAngle:function(){var b;return function(c,d){return void 0===b&&(b=new a.Quaternion),this.applyQuaternion(b.setFromAxisAngle(c,d)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var b,c;return function(d,e){return void 0===b&&(b=new a.Vector3,c=new a.Vector3),b.set(d,d,d),c.set(e,e,e),this.clamp(b,c)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var b,c;return function(d){return void 0===b&&(b=new a.Vector3),b.copy(d).normalize(),c=this.dot(b),this.copy(b).multiplyScalar(c)}}(),projectOnPlane:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),b.copy(this).projectOnVector(c),this.sub(b)}}(),reflect:function(){var b;return function(c){return void 0===b&&(b=new a.Vector3),this.sub(b.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(b){var c=this.dot(b)/(this.length()*b.length());return Math.acos(a.clamp(c,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(a,b){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a){return this.x=a[0],this.y=a[1],this.z=a[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Line3=function(b,c){this.start=void 0!==b?b:new a.Vector3,this.end=void 0!==c?c:new a.Vector3},a.Line3.prototype={constructor:a.Line3,set:function(a,b){return this.start.copy(a),this.end.copy(b),this},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},center:function(b){var c=b||new a.Vector3;return c.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(b){var c=b||new a.Vector3;return c.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(b,c){var d=c||new a.Vector3;return this.delta(d).multiplyScalar(b).add(this.start)},closestPointToPointParameter:function(){var b=new a.Vector3,c=new a.Vector3;return function(d,e){b.subVectors(d,this.start),c.subVectors(this.end,this.start);var f=c.dot(c),g=c.dot(b),h=g/f;return e&&(h=a.Math.clamp(h,0,1)),h}}(),closestPointToPoint:function(b,c,d){var e=this.closestPointToPointParameter(b,c),f=d||new a.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new a.Line3).copy(this)},intersectLine:function(a){var b=this.end.clone().sub(this.start),c=a.end.clone().sub(a.start),d=a.start.clone().sub(this.start),e=b.clone().cross(c),f=d.clone().cross(c);if(0!==d.dot(b)){var g=f.dot(e)/e.lengthSq();if(!(g>1||isNaN(g))){var h=this.start.clone().add(b.clone().multiplyScalar(g)),i=h.clone().sub(a.start).lengthSq()+h.clone().sub(a.end).lengthSq();return i<=a.distanceSq()?h:void 0}}}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){return a*a}function c(a,c){return b(a.x-c.x)+b(a.y-c.y)}function d(a,b){var d=c(a.start,a.end);if(0===d)return c(b,a.start);var e=((b.x-a.start.x)*(a.end.x-a.start.x)+(b.y-a.start.y)*(a.end.y-a.start.y))/d;if(0>e)return c(b,a.start);if(e>1)return c(b,a.end);var f={x:a.start.x+e*(a.end.x-a.start.x),y:a.start.y+e*(a.end.y-a.start.y)};return c(b,f)}function e(a,b){return Math.sqrt(d(a,b))}function f(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p={},q=b.start.x,r=b.start.y,s=b.end.x,t=b.end.y,u=c.start.x,v=c.start.y,w=c.end.x,x=c.end.y;if(d=t-r,f=q-s,h=s*r-q*t,l=d*u+f*v+h,m=d*w+f*x+h,(0===l||0===m||a.sign(l)!==a.sign(m))&&(e=x-v,g=u-w,i=w*v-u*x,j=e*q+g*r+i,k=e*s+g*t+i,0===j||0===k||a.sign(j)!==a.sign(k))){n=d*g-e*f,o=f*i-g*h;var y=parseFloat(o/n);o=e*h-d*i;var z=parseFloat(o/n);return p.x=y,p.y=z,p}}return void 0===a&&(a={}),a.lineSegment={distanceToPoint:e,intersectLine:f},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a,b,c){return b>a?b:a>c?c:a}function c(a){var b=Math.PI/180;return a*b}function d(a){var b=180/Math.PI;return a*b}function e(a){return"number"==typeof a?a?0>a?-1:1:a===a?0:NaN:NaN}return void 0===a&&(a={}),a.clamp=b,a.degToRad=c,a.radToDeg=d,a.sign=e,a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.elements=new Float32Array(16);var q=this.elements;q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},a.Matrix4.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},a.Matrix4.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},a.Matrix4.prototype.multiply=function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},a.Matrix4.prototype.getInverse=function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0===u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},a.Matrix4.prototype.applyToVector3Array=function(){var b=new a.Vector3;return function(a,c,d){void 0===c&&(c=0),void 0===d&&(d=a.length);for(var e=0,f=c;d>e;e+=3,f+=3)b.x=a[f],b.y=a[f+1],b.z=a[f+2],b.applyMatrix4(this),a[f]=b.x,a[f+1]=b.y,a[f+2]=b.z;return a}},a.Matrix4.prototype.makeTranslation=function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},a.Matrix4.prototype.multiplyScalar=function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},a.Matrix4.prototype.set=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},a.Matrix4.prototype.makeScale=function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Plane=function(b,c){this.normal=void 0!==b?b:new a.Vector3(1,0,0),this.constant=void 0!==c?c:0},a.Plane.prototype={constructor:a.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var b=new a.Vector3,c=new a.Vector3;return function(a,d,e){var f=b.subVectors(e,d).cross(c.subVectors(a,d)).normalize();return this.setFromNormalAndCoplanarPoint(f,a),this}}(),copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(b,c){var d=this.distanceToPoint(b),e=c||new a.Vector3;return e.copy(this.normal).multiplyScalar(d)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return 0>b&&c>0||0>c&&b>0},intersectLine:function(){var b=new a.Vector3;return function(c,d){var e=d||new a.Vector3,f=c.delta(b),g=this.normal.dot(f);if(0===g)return 0===this.distanceToPoint(c.start)?e.copy(c.start):void 0;var h=-(c.start.dot(this.normal)+this.constant)/g;return 0>h||h>1?void 0:e.copy(f).multiplyScalar(h).add(c.start)}}(),intersectPlane:function(b){var c=this.normal.clone().cross(b.normal),d=new a.Vector3,e={origin:d,direction:c};if(this.normal.clone().cross(b.normal).length<1e-10)return e.direction=new a.Vector3,e;var f=this.constant,g=b.constant,h=this.normal.clone().dot(b.normal),i=-(f-g*h)/(1-h*h),j=-(g-f*h)/(1-h*h);return e.origin=this.normal.clone().multiplyScalar(i).add(b.normal.clone().multiplyScalar(j)),e},coplanarPoint:function(b){var c=b||new a.Vector3;return c.copy(this.normal).multiplyScalar(-this.constant)},translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new a.Plane).copy(this)}},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){return{x:a.pageX,y:a.pageY}}function c(a,b){return{x:a.x-b.x,y:a.y-b.y}}function d(a){return{x:a.x,y:a.y}}function e(a,b){return Math.sqrt(f(a,b))}function f(a,b){var d=c(a,b);return d.x*d.x+d.y*d.y}function g(a,b){return!(a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height)}function h(b,c){var d,e=[];b.forEach(function(b,f){var g=a.point.distance(b,c);e.push(g),d=0===f?g:Math.min(g,d)});var f=e.indexOf(d);return b[f]}return void 0===a&&(a={}),a.point={subtract:c,copy:d,pageToPoint:b,distance:e,distanceSquared:f,insideRect:g,findClosestPoint:h},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";return void 0===a&&(a={}),a.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},a.Quaternion.prototype.setFromAxisAngle=function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},a.Quaternion.prototype.multiplyQuaternions=function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},a.Quaternion.prototype.setFromRotationMatrix=function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},a}(cornerstoneMath),cornerstoneMath=function(a){"use strict";function b(a){var b={start:{x:a.left,y:a.top},end:{x:a.left+a.width,y:a.top}},c={start:{x:a.left+a.width,y:a.top},end:{x:a.left+a.width,y:a.top+a.height}},d={start:{x:a.left+a.width,y:a.top+a.height},end:{x:a.left,y:a.top+a.height}},e={start:{x:a.left,y:a.top+a.height},end:{x:a.left,y:a.top}},f=[b,c,d,e];return f}function c(c,d){var e=655535,f=b(c);return f.forEach(function(b){var c=a.lineSegment.distanceToPoint(b,d);e>c&&(e=c)}),e}function d(a){var b={topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}};return b}function e(a,b){var c,e,f=d(a),g=d(b);return c=a.width>=0?b.width>=0?!(f.bottomRight.x<=g.topLeft.x||g.bottomRight.x<=f.topLeft.x):!(f.bottomRight.x<=g.bottomRight.x||g.topLeft.x<=f.topLeft.x):b.width>=0?!(f.topLeft.x<=g.topLeft.x||g.bottomRight.x<=f.bottomRight.x):!(f.topLeft.x<=g.bottomRight.x||g.topLeft.x<=f.bottomRight.x),e=a.height>=0?b.height>=0?!(f.bottomRight.y<=g.topLeft.y||g.bottomRight.y<=f.topLeft.y):!(f.bottomRight.y<=g.bottomRight.y||g.topLeft.y<=f.topLeft.y):b.height>=0?!(f.topLeft.y<=g.topLeft.y||g.bottomRight.y<=f.bottomRight.y):!(f.topLeft.y<=g.bottomRight.y||g.top<=f.bottomRight.y),c&&e}function f(a,b){var c={topLeft:{},bottomRight:{}};if(e(a,b)){var f=d(a),g=d(b);return a.width>=0?b.width>=0?(c.topLeft.x=Math.max(f.topLeft.x,g.topLeft.x),c.bottomRight.x=Math.min(f.bottomRight.x,g.bottomRight.x)):(c.topLeft.x=Math.max(f.topLeft.x,g.bottomRight.x),c.bottomRight.x=Math.min(f.bottomRight.x,g.topLeft.x)):b.width>=0?(c.topLeft.x=Math.min(f.topLeft.x,g.bottomRight.x),c.bottomRight.x=Math.max(f.bottomRight.x,g.topLeft.x)):(c.topLeft.x=Math.min(f.topLeft.x,g.topLeft.x),c.bottomRight.x=Math.max(f.bottomRight.x,g.bottomRight.x)),a.height>=0?b.height>=0?(c.topLeft.y=Math.max(f.topLeft.y,g.topLeft.y),c.bottomRight.y=Math.min(f.bottomRight.y,g.bottomRight.y)):(c.topLeft.y=Math.max(f.topLeft.y,g.bottomRight.y),c.bottomRight.y=Math.min(f.bottomRight.y,g.topLeft.y)):b.height>=0?(c.topLeft.y=Math.min(f.topLeft.y,g.bottomRight.y),c.bottomRight.y=Math.max(f.bottomRight.y,g.topLeft.y)):(c.topLeft.y=Math.min(f.topLeft.y,g.topLeft.y),c.bottomRight.y=Math.max(f.bottomRight.y,g.bottomRight.y)),c}}return void 0===a&&(a={}),a.rect={distanceToPoint:c,getIntersectionRect:f},a}(cornerstoneMath);"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(a,b,c){"use strict";function d(c){if(!("mousewheel"===c.originalEvent.type&&0===c.originalEvent.wheelDeltaY||"DOMMouseScroll"===c.originalEvent.type&&1===c.originalEvent.axis)){var d=c.currentTarget,e=b.pageToPixel(d,c.pageX||c.originalEvent.pageX,c.pageY||c.originalEvent.pageY);c=window.event||c;var f=c.wheelDelta||-c.detail||-c.originalEvent.detail,g=Math.max(-1,Math.min(1,f)),h={element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,direction:g,pageX:c.pageX||c.originalEvent.pageX,pageY:c.pageY||c.originalEvent.pageY,imageX:e.x,imageY:e.y};a(d).trigger("CornerstoneToolsMouseWheel",h)}}function e(b){f(b),a(b).on(g,d)}function f(b){a(b).unbind(g,d)}var g="mousewheel DOMMouseScroll";c.mouseWheelInput={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(){l=!1}function f(b){a(b.element).trigger("CornerstoneToolsMouseDownActivate",b)}function g(e){var f=e.currentTarget,g="CornerstoneToolsMouseDoubleClick",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j={event:e,which:e.which,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:h,deltaPoints:{
x:0,y:0},type:g},k=a.Event(g,j);a(j.element).trigger(k,j)}function h(g){function h(e){var f="CornerstoneToolsMouseDrag",g={page:c.point.pageToPoint(e),image:b.pageToPixel(k,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=b.pixelToCanvas(k,g.image);var h={page:c.point.subtract(g.page,q.page),image:c.point.subtract(g.image,q.image),client:c.point.subtract(g.client,q.client),canvas:c.point.subtract(g.canvas,q.canvas)},i={which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:g,deltaPoints:h,type:f};return a(i.element).trigger(f,i),q=d.copyPoints(g),d.pauseEvent(e)}function j(d){clearTimeout(m);var e="CornerstoneToolsMouseUp";l&&(e="CornerstoneToolsMouseClick");var f={page:c.point.pageToPoint(d),image:b.pageToPixel(k,d.pageX,d.pageY),client:{x:d.clientX,y:d.clientY}};f.canvas=b.pixelToCanvas(k,f.image);var g={page:c.point.subtract(f.page,q.page),image:c.point.subtract(f.image,q.image),client:c.point.subtract(f.client,q.client),canvas:c.point.subtract(f.canvas,q.canvas)},n={event:d,which:t,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:f,deltaPoints:g,type:e},o=a.Event(e,n);a(n.element).trigger(o,n),a(document).off("mousemove",h),a(document).off("mouseup",j),a(n.element).on("mousemove",i),l=!0}m=setTimeout(e,n);var k=g.currentTarget,o="CornerstoneToolsMouseDown";a(k).off("mousemove",i);var p={page:c.point.pageToPoint(g),image:b.pageToPixel(k,g.pageX,g.pageY),client:{x:g.clientX,y:g.clientY}};p.canvas=b.pixelToCanvas(k,p.image);var q=d.copyPoints(p),r={event:g,which:g.which,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:p,lastPoints:q,currentPoints:p,deltaPoints:{x:0,y:0},type:o},s=a.Event(o,r);if(a(r.element).trigger(s,r),s.isImmediatePropagationStopped()===!1&&f(r)===!0)return d.pauseEvent(g);var t=g.which;return a(document).on("mousemove",h),a(document).on("mouseup",j),d.pauseEvent(g)}function i(e){var f=e.currentTarget,g="CornerstoneToolsMouseMove",h={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};h.canvas=b.pixelToCanvas(f,h.image);var i=d.copyPoints(h),j=e.which,k={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};k.canvas=b.pixelToCanvas(f,k.image);var l={page:c.point.subtract(k.page,i.page),image:c.point.subtract(k.image,i.image),client:c.point.subtract(k.client,i.client),canvas:c.point.subtract(k.canvas,i.canvas)},m={which:j,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:h,lastPoints:i,currentPoints:k,deltaPoints:l,type:g};a(f).trigger(g,m),i=d.copyPoints(k)}function j(b){a(b).off("mousedown",h),a(b).off("mousemove",i),a(b).off("dblclick",g)}function k(b){j(b),a(b).on("mousedown",h),a(b).on("mousemove",i),a(b).on("dblclick",g)}var l,m,n=200;d.mouseInput={enable:k,disable:j}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(e){var f,g,v=e.target.parentNode;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(s=!1,clearTimeout(n)),e.type){case"tap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"doubletap":s=!1,clearTimeout(n),i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),g="CornerstoneToolsDoubleTap",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"pinchstart":s=!1,clearTimeout(n),p=1;break;case"pinchmove":if(s=!1,clearTimeout(n),u===!0){p=e.scale,u=!1;break}var w=(e.scale-p)/p;h={page:e.center,image:b.pageToPixel(v,e.center.x,e.center.y)},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPinch",l={event:e,startPoints:h,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,direction:e.scale<1?1:-1,scaleChange:w,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),p=e.scale;break;case"touchstart":p=1,clearTimeout(n),clearTimeout(m),m=setTimeout(function(){h={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStart"),l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),f.isImmediatePropagationStopped()===!1&&(g="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(g="CornerstoneToolsMultiTouchStartActive"),l.type=g,a(v).trigger(g,l)),j=d.copyPoints(h)},50),s=!0,o=0,n=setTimeout(function(){s&&(i={page:c.point.pageToPoint(e.originalEvent.touches[0]),image:b.pageToPixel(v,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},i.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchPress",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,currentPoints:i,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l))},r);break;case"touchend":p=1,s=!1,clearTimeout(n),h={page:c.point.pageToPoint(e.originalEvent.changedTouches[0]),image:b.pageToPixel(v,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},h.canvas=b.pixelToCanvas(v,h.image),g="CornerstoneToolsTouchEnd",l={event:e,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,currentPoints:h,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);break;case"panmove":i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},o+=Math.sqrt(k.page.x*k.page.x+k.page.y*k.page.y),o>t&&(s=!1,clearTimeout(n)),g="CornerstoneToolsTouchDrag",e.pointers.length>1&&(g="CornerstoneToolsMultiTouchDrag"),l={viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,numPointers:e.pointers.length,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l),j=d.copyPoints(i);break;case"panstart":i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),j=d.copyPoints(i);break;case"panend":if(s=!1,clearTimeout(n),!j)return!1;i={page:c.point.pageToPoint(e.pointers[0]),image:b.pageToPixel(v,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},i.canvas=b.pixelToCanvas(v,i.image),k={page:c.point.subtract(i.page,j.page),image:c.point.subtract(i.image,j.image),client:c.point.subtract(i.client,j.client),canvas:c.point.subtract(i.canvas,j.canvas)},g="CornerstoneToolsDragEnd",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,startPoints:h,lastPoints:j,currentPoints:i,deltaPoints:k,type:g,isTouchEvent:!0},f=a.Event(g,l),a(v).trigger(f,l);var x=e.pointers.length-e.changedPointers.length;return 2===x&&(u=!0),d.pauseEvent(e);case"rotatemove":s=!1,clearTimeout(n);var y=e.rotation-q;q=e.rotation,g="CornerstoneToolsTouchRotate",l={event:e.srcEvent,viewport:b.getViewport(v),image:b.getEnabledElement(v).image,element:v,rotation:y,type:g},f=a.Event(g,l),a(v).trigger(f,l)}return!1}function f(b){g(b);var c={inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput},f=new Hammer.Manager(b,c),h={pointers:0,direction:Hammer.DIRECTION_ALL,threshold:0},i=new Hammer.Pan(h),j=new Hammer.Pinch({threshold:0}),k=new Hammer.Rotate({threshold:0});j.recognizeWith(i),j.recognizeWith(k),f.add([i,k,j]),f.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",e),d.preventGhostClick.enable(b),a(b).on("touchstart touchend",e),a(b).data("hammer",f)}function g(b){d.preventGhostClick.disable(b),a(b).off("touchstart touchend",e);var c=a(b).data("hammer");c&&c.off("tap doubletap panstart panmove panend pinchmove rotatemove",e)}var h,i,j,k,l,m,n,o,p=1,q=0,r=700,s=!1,t=5,u=!1;d.touchInput={enable:f,disable:g}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c,d,e){a(c).off("CornerstoneToolsMouseDownActivate",b);var f={mouseButtonMask:d,options:e};a(c).on("CornerstoneToolsMouseDownActivate",f,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.simpleMouseButtonTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c){function e(e){var i=e.element,j=c.createNewMeasurement(e);if(j){var k={mouseButtonMask:e.which};d.addToolState(e.element,c.toolType,j),a(i).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(i).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(i).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(i);var l;l=1===Object.keys(j.handles).length?d.moveHandle:d.moveNewHandle;var m;m=!(!c.options||void 0===c.options.preventHandleOutsideImage)&&c.options.preventHandleOutsideImage,l(e,c.toolType,j,j.handles.end,function(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(e,j.handles)&&d.removeToolState(i,c.toolType,j),a(i).on("CornerstoneToolsMouseMove",k,c.mouseMoveCallback||g),a(i).on("CornerstoneToolsMouseDown",k,c.mouseDownCallback||h),a(i).on("CornerstoneToolsMouseDownActivate",k,c.mouseDownActivateCallback||f),c.mouseDoubleClickCallback&&a(i).on("CornerstoneToolsMouseDoubleClick",k,c.mouseDoubleClickCallback),b.updateImage(i)},m)}}function f(a,b){if(d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask))return c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1}function g(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(f){for(var g=!1,h=0;h<f.data.length;h++){var i=e.currentPoints.canvas,j=f.data[h];d.handleActivator(e.element,j.handles,i)===!0&&(g=!0),(c.pointNearTool(e.element,j,i)&&!j.active||!c.pointNearTool(e.element,j,i)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function h(e,f){function h(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(f,i.handles)&&d.removeToolState(j,c.toolType,i),b.updateImage(j),a(j).on("CornerstoneToolsMouseMove",f,c.mouseMoveCallback||g)}var i,j=f.element;if(d.isMouseButtonEnabled(f.which,e.data.mouseButtonMask)){var k,l=f.startPoints.canvas,m=d.getToolState(e.currentTarget,c.toolType);if(m){var n;for(n=!(!c.options||void 0===c.options.preventHandleOutsideImage)&&c.options.preventHandleOutsideImage,k=0;k<m.data.length;k++){i=m.data[k];var o=d.distanceSqR||25,p=d.getHandleNearImagePoint(j,i.handles,l,o);if(p)return a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),i.active=!0,d.moveHandle(f,c.toolType,i,p,h,n),e.stopImmediatePropagation(),!1}}if(m&&c.pointNearTool){var q=c.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(k=0;k<m.data.length;k++)if(i=m.data[k],c.pointNearTool(j,i,l))return a(j).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),d.moveAllHandles(e,i,m,c.toolType,q,h),e.stopImmediatePropagation(),!1}}}function i(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseUpCallback&&a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),c.mouseClickCallback&&a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),b.updateImage(d)}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),c.mouseUpCallback&&a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),c.mouseClickCallback&&a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),c.mouseDoubleClickCallback&&a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function k(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),a(d).on("CornerstoneToolsMouseDownActivate",i,c.mouseDownActivateCallback||f),c.mouseUpCallback&&(a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),a(d).on("CornerstoneToolsMouseUp",i,c.mouseUpCallback)),c.mouseClickCallback&&(a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),a(d).on("CornerstoneToolsMouseClick",i,c.mouseClickCallback)),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function l(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",c.mouseMoveCallback||g),a(d).off("CornerstoneToolsMouseDown",c.mouseDownCallback||h),a(d).off("CornerstoneToolsMouseDownActivate",c.mouseDownActivateCallback||f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,c.mouseMoveCallback||g),a(d).on("CornerstoneToolsMouseDown",i,c.mouseDownCallback||h),c.mouseUpCallback&&(a(d).off("CornerstoneToolsMouseUp",c.mouseUpCallback),a(d).on("CornerstoneToolsMouseUp",i,c.mouseUpCallback)),c.mouseClickCallback&&(a(d).off("CornerstoneToolsMouseClick",c.mouseClickCallback),a(d).on("CornerstoneToolsMouseClick",i,c.mouseClickCallback)),c.mouseDoubleClickCallback&&(a(d).off("CornerstoneToolsMouseDoubleClick",c.mouseDoubleClickCallback),a(d).on("CornerstoneToolsMouseDoubleClick",i,c.mouseDoubleClickCallback)),b.updateImage(d)}function m(){return o}function n(a){o=a}var o={},p={enable:j,disable:i,activate:k,deactivate:l,getConfiguration:m,setConfiguration:n,mouseDownCallback:h,mouseMoveCallback:g,mouseDownActivateCallback:f};return c.pointNearTool&&(p.pointNearTool=c.pointNearTool),c.mouseDoubleClickCallback&&(p.mouseDoubleClickCallback=c.mouseDoubleClickCallback),c.addNewMeasurement&&(p.addNewMeasurement=c.addNewMeasurement),p}d.mouseButtonTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e){function f(b){var f=c.createNewMeasurement(b);f&&(d.addToolState(b.element,c.toolType,f),a(b.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(b,c.toolType,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(b,f.handles)&&d.removeToolState(b.element,c.toolType,f),a(b.element).on("CornerstoneToolsMouseMove",h)},e))}function g(a,b){if(d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask))return f(b),!1}function h(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=e.currentPoints.canvas,i=0;i<f.data.length;i++){var j=f.data[i];d.handleActivator(e.element,j.handles,h)===!0&&(g=!0),(c.pointInsideRect(e.element,j,h)&&!j.active||!c.pointInsideRect(e.element,j,h)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function i(f,g){function i(){j.active=!1,d.anyHandlesOutsideImage(g,j.handles)&&d.removeToolState(g.element,c.toolType,j),b.updateImage(g.element),a(g.element).on("CornerstoneToolsMouseMove",h)}var j;if(d.isMouseButtonEnabled(g.which,f.data.mouseButtonMask)){var k,l=g.startPoints.canvas,m=d.getToolState(f.currentTarget,c.toolType),n=25;if(void 0!==m)for(k=0;k<m.data.length;k++){j=m.data[k];var o=d.getHandleNearImagePoint(g.element,j.handles,l,n);if(void 0!==o)return a(g.element).off("CornerstoneToolsMouseMove",h),j.active=!0,d.moveHandle(g,c.toolType,j,o,i,e),f.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:e};if(void 0!==m&&void 0!==c.pointInsideRect)for(k=0;k<m.data.length;k++)if(j=m.data[k],c.pointInsideRect(g.element,j,l))return a(g.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(f,j,m,c.toolType,p,i),a(g.element).on("CornerstoneToolsMouseMove",h),f.stopImmediatePropagation(),!1}}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function l(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),a(d).on("CornerstoneToolsMouseDownActivate",f,g),b.updateImage(d)}function m(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m};return n}d.mouseButtonRectangleTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}c.mouseWheelTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d="CornerstoneToolsTouchDrag";c&&c.fireOnTouchStart===!0&&(d+=" CornerstoneToolsTouchStart");var e={activate:function(e){a(e).off(d,b),c&&c.eventData?a(e).on(d,c.eventData,b):a(e).on(d,b),c&&c.activateCallback&&c.activateCallback(e)},disable:function(e){a(e).off(d,b),c&&c.disableCallback&&c.disableCallback(e)},enable:function(e){a(e).off(d,b),c&&c.enableCallback&&c.enableCallback(e)},deactivate:function(e){a(e).off(d,b),c&&c.deactivateCallback&&c.deactivateCallback(e)}};return e}c.touchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}c.touchPinchTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){Object.keys(a).forEach(function(b){var c=a[b];c.active=!1})}function f(a){if(a)for(var b=0;b<a.data.length;b++){var c=a.data[b];c.active=!1,c.handles&&e(c.handles)}}function g(c){function e(e){var f=e.element,i=c.createNewMeasurement(e);if(i){if(d.addToolState(f,c.toolType,i),1===Object.keys(i.handles).length&&"CornerstoneToolsTap"===e.type)return i.active=!1,i.handles.end.active=!1,i.handles.end.highlight=!1,i.invalidated=!0,d.anyHandlesOutsideImage(e,i.handles)&&d.removeToolState(f,c.toolType,i),void b.updateImage(f);a(f).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).off("CornerstoneToolsTap",c.tapCallback||h),b.updateImage(f),d.moveNewHandleTouch(e,c.toolType,i,i.handles.end,function(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(e,i.handles)&&d.removeToolState(f,c.toolType,i),a(f).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(f).on("CornerstoneToolsTap",c.tapCallback||h),b.updateImage(f)})}}function g(a,b){return c.addNewMeasurement?c.addNewMeasurement(b):e(b),!1}function h(e,i){function j(){console.log("touchTool tapCallback doneMovingCallback"),f(o),d.anyHandlesOutsideImage(i,k.handles)&&d.removeToolState(m,c.toolType,k),b.updateImage(m),a(m).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).on("CornerstoneToolsTap",c.tapCallback||h)}var k,l,m=i.element,n=i.currentPoints.canvas,o=d.getToolState(e.currentTarget,c.toolType);if(f(o),o)for(l=0;l<o.data.length;l++){k=o.data[l];var p=25,q=d.getHandleNearImagePoint(m,k.handles,n,p);if(q)return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,q.active=!0,b.updateImage(m),d.touchMoveHandle(e,c.toolType,k,q,j),e.stopImmediatePropagation(),!1}if(o&&c.pointNearTool)for(l=0;l<o.data.length;l++)if(k=o.data[l],c.pointNearTool(m,k,n))return a(m).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(m).off("CornerstoneToolsTap",c.tapCallback||h),k.active=!0,b.updateImage(m),d.touchMoveAllHandles(e,k,o,c.toolType,!0,j),e.stopImmediatePropagation(),!1;return c.touchDownActivateCallback?c.touchDownActivateCallback(e,i):g(e,i),!1}function i(e,f){function i(){j.active=!1,j.invalidated=!0,d.anyHandlesOutsideImage(f,j.handles)&&d.removeToolState(f.element,c.toolType,j),b.updateImage(f.element),a(l).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).on("CornerstoneToolsTap",c.tapCallback||h)}var j,k,l=f.element,m=f.startPoints.canvas,n=d.getToolState(e.currentTarget,c.toolType),o=d.touchSettings.getToolDistanceFromTouch(),p=Math.max(Math.abs(o.x),Math.abs(o.y));if(n)for(k=0;k<n.data.length;k++){j=n.data[k];var q=d.getHandleNearImagePoint(f.element,j.handles,m,p);if(q)return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),j.active=!0,d.touchMoveHandle(e,c.toolType,j,q,i),e.stopImmediatePropagation(),!1}if(n&&c.pointNearTool)for(k=0;k<n.data.length;k++)if(j=n.data[k],c.pointNearTool(f.element,j,m))return a(l).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(l).off("CornerstoneToolsTap",c.tapCallback||h),d.touchMoveAllHandles(e,j,n,c.toolType,!0,i),e.stopImmediatePropagation(),!1}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),c.pressCallback&&a(d).off("CornerstoneToolsTouchPress",c.pressCallback),b.updateImage(d)}function l(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).on("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).on("CornerstoneToolsTap",c.tapCallback||h),c.doubleTapCallback&&(a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),a(d).on("CornerstoneToolsDoubleTap",c.doubleTapCallback)),c.pressCallback&&(a(d).off("CornerstoneToolsTouchPress",c.pressCallback),a(d).on("CornerstoneToolsTouchPress",c.pressCallback)),b.updateImage(d)}function m(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchStart",c.touchStartCallback||i),a(d).off("CornerstoneToolsTouchStartActive",c.touchDownActivateCallback||g),a(d).off("CornerstoneToolsTap",c.tapCallback||h),a(d).on("CornerstoneImageRendered",c.onImageRendered),c.doubleTapCallback&&(a(d).off("CornerstoneToolsDoubleTap",c.doubleTapCallback),a(d).on("CornerstoneToolsDoubleTap",c.doubleTapCallback)),c.pressCallback&&(a(d).off("CornerstoneToolsTouchPress",c.pressCallback),a(d).on("CornerstoneToolsTouchPress",c.pressCallback)),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m,touchStartCallback:c.touchStartCallback||i,touchDownActivateCallback:c.touchDownActivateCallback||g,tapCallback:c.tapCallback||h};return c.pointNearTool&&(n.pointNearTool=c.pointNearTool),c.doubleTapCallback&&(n.doubleTapCallback=c.doubleTapCallback),c.pressCallback&&(n.pressCallback=c.pressCallback),c.addNewMeasurement&&(n.addNewMeasurement=c.addNewMeasurement),n}d.touchTool=g}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},start2:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:a.currentPoints.image.x,y:a.currentPoints.image.y+20,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return g<5||(f.start=b.pixelToCanvas(a,d.handles.start2),f.end=b.pixelToCanvas(a,d.handles.end2),g=c.lineSegment.distanceToPoint(f,e),g<5)}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.angle.getConfiguration(),l=0;l<e.data.length;l++){f.save(),k&&k.shadow&&(f.shadowColor=k.shadowColor||"#000000",f.shadowOffsetX=k.shadowOffsetX||1,f.shadowOffsetY=k.shadowOffsetY||1);var m=e.data[l];g=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=g,f.lineWidth=i;var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),n=b.pixelToCanvas(c.element,m.handles.start2),o=b.pixelToCanvas(c.element,m.handles.end2),f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,m.handles),f.fillStyle=g;var p=(Math.ceil(m.handles.start.x)-Math.ceil(m.handles.end.x))*c.image.columnPixelSpacing,q=(Math.ceil(m.handles.start.y)-Math.ceil(m.handles.end.y))*c.image.rowPixelSpacing,r=(Math.ceil(m.handles.start2.x)-Math.ceil(m.handles.end2.x))*c.image.columnPixelSpacing,s=(Math.ceil(m.handles.start2.y)-Math.ceil(m.handles.end2.y))*c.image.rowPixelSpacing,t=Math.acos(Math.abs((p*r+q*s)/(Math.sqrt(p*p+q*q)*Math.sqrt(r*r+s*s))));t*=180/Math.PI;var u=d.roundToDecimal(t,1),v="00B0",w=u.toString()+String.fromCharCode(parseInt(v,16)),x=(n.x+o.x)/2,y=(n.y+o.y)/2;f.font=j,d.drawTextBox(f,w,x+15,y+15,g),f.restore()}}}var h="angle";d.angle=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.angleTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){a(prompt("Enter your annotation:"))}function f(a,b){b(prompt("Change your annotation:"))}function g(c){function e(a){null!==a?f.text=a:d.removeToolState(c.element,n,f),f.active=!1,b.updateImage(c.element)}var f=h(c),g={mouseButtonMask:c.which};d.addToolState(c.element,n,f),a(c.element).off("CornerstoneToolsMouseMove",d.arrowAnnotate.mouseMoveCallback),a(c.element).off("CornerstoneToolsMouseDown",d.arrowAnnotate.mouseDownCallback),a(c.element).off("CornerstoneToolsMouseDownActivate",d.arrowAnnotate.mouseDownActivateCallback),b.updateImage(c.element),d.moveNewHandle(c,n,f,f.handles.end,function(){d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,n,f);var h=d.arrowAnnotate.getConfiguration();void 0===f.text&&h.getTextCallback(e),a(c.element).on("CornerstoneToolsMouseMove",g,d.arrowAnnotate.mouseMoveCallback),a(c.element).on("CornerstoneToolsMouseDown",g,d.arrowAnnotate.mouseDownCallback),a(c.element).on("CornerstoneToolsMouseDownActivate",g,d.arrowAnnotate.mouseDownActivateCallback),b.updateImage(c.element)})}function h(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1}}};return b}function i(a,e,f){var g={start:b.pixelToCanvas(a,e.handles.start),end:b.pixelToCanvas(a,e.handles.end)},h=c.lineSegment.distanceToPoint(g,f);if(h<25)return!0;if(e.textCoords){var i=5,j=d.textStyle.getFontSize(),k={left:e.textCoords.x,top:e.textCoords.y,width:e.textWidth+2*i,height:j+2*i},l=c.rect.distanceToPoint(k,f);return l<25}}function j(a,c){var e=d.getToolState(a.currentTarget,n);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,h=d.toolStyle.getToolWidth(),i=d.textStyle.getFont(),j=d.arrowAnnotate.getConfiguration(),k=0;k<e.data.length;k++){f.save(),j&&j.shadow&&(f.shadowColor=j.shadowColor||"#000000",f.shadowOffsetX=j.shadowOffsetX||1,f.shadowOffsetY=j.shadowOffsetY||1);var l=e.data[k];g=l.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var m=b.pixelToCanvas(c.element,l.handles.start),o=b.pixelToCanvas(c.element,l.handles.end);if(j.arrowFirst?d.drawArrow(f,o,m,g,h):d.drawArrow(f,m,o,g,h),j.drawHandles?d.drawHandles(f,c,l.handles,g):j.drawHandlesOnHover&&l.handles.start.active?d.drawHandles(f,c,[l.handles.start],g):j.drawHandlesOnHover&&l.handles.end.active&&d.drawHandles(f,c,[l.handles.end],g),l.text&&""!==l.text){f.font=i;var p,q=13,r={x:q,y:q/2};p={x:o.x-m.x,y:o.y-m.y};var s,t=f.measureText(l.text).width;j.arrowFirst?(p.x<0&&(r.x=-r.x-t),s={x:p.x+m.x+r.x,y:p.y+m.y+r.y}):(p.x>0&&(r.x=-r.x-t),s={x:-p.x+o.x+r.x,y:-p.y+o.y+r.y}),l.textCoords=s,
l.textWidth=t,d.drawTextBox(f,l.text,s.x,s.y,g)}f.restore()}}}function k(c){function e(a){null!==a?g.text=a:d.removeToolState(f,n,g),g.active=!1,b.updateImage(f)}var f=c.element,g=h(c);d.addToolState(f,n,g),a(f).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).off("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback),b.updateImage(f),d.moveNewHandleTouch(c,n,g,g.handles.end,function(){b.updateImage(f),d.anyHandlesOutsideImage(c,g.handles)&&d.removeToolState(f,n,g);var h=d.arrowAnnotate.getConfiguration();void 0===g.text&&h.getTextCallback(e),a(f).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),a(f).on("CornerstoneToolsTap",d.arrowAnnotateTouch.tapCallback)})}function l(a,c){function e(a,c,e){e===!0?d.removeToolState(g,n,a):a.text=c,a.active=!1,b.updateImage(g)}var f,g=c.element;if(a.data&&a.data.mouseButtonMask&&!d.isMouseButtonEnabled(c.which,a.data.mouseButtonMask))return!1;var h=d.arrowAnnotate.getConfiguration(),j=c.currentPoints.canvas,k=d.getToolState(g,n);if(!k)return!1;for(var l=0;l<k.data.length;l++)if(f=k.data[l],i(g,f,j))return f.active=!0,b.updateImage(g),h.changeTextCallback(f,e),a.stopImmediatePropagation(),!1;return!1}function m(c,e){function f(c,e,f){f===!0?d.removeToolState(h,n,c):c.text=e,c.active=!1,b.updateImage(h),a(h).on("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).on("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback)}var g,h=e.element;if(c.data&&c.data.mouseButtonMask&&!d.isMouseButtonEnabled(e.which,c.data.mouseButtonMask))return!1;var j=d.arrowAnnotate.getConfiguration(),k=e.currentPoints.canvas,l=d.getToolState(h,n);if(!l)return!1;for(var m=0;m<l.data.length;m++)if(g=l.data[m],i(h,g,k))return g.active=!0,b.updateImage(h),a(h).off("CornerstoneToolsTouchStart",d.arrowAnnotateTouch.touchStartCallback),a(h).off("CornerstoneToolsTouchStartActive",d.arrowAnnotateTouch.touchDownActivateCallback),j.changeTextCallback(g,f),c.stopImmediatePropagation(),!1;return!1}var n="arrowAnnotate",o={getTextCallback:e,changeTextCallback:f,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};d.arrowAnnotate=d.mouseButtonTool({addNewMeasurement:g,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,mouseDoubleClickCallback:l}),d.arrowAnnotate.setConfiguration(o),d.arrowAnnotateTouch=d.touchTool({addNewMeasurement:k,createNewMeasurement:h,onImageRendered:j,pointNearTool:i,toolType:n,pressCallback:m})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){d.stopImmediatePropagation();var f=c.getToolState(d.currentTarget,o);if(f){var g=d.currentTarget,h=b.getEnabledElement(g),i=h.image.imageId,j=c.metaData.get("imagePlane",i),k=e.currentPoints.image,l=c.imagePointToPatientPoint(k,j),m=f.data[0].synchronizationContext,n=m.getSourceElements();a.each(n,function(d,e){if(e!==g){var f=Number.MAX_VALUE,h=-1,i=c.getToolState(e,"stack");if(void 0!==i){var j=i.data[0];if(a.each(j.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,g=d.rowCosines.clone(),i=d.columnCosines.clone(),j=i.clone().cross(g.clone()),k=Math.abs(j.clone().dot(e)-j.clone().dot(l));k<f&&(f=k,h=a)}),h!==j.currentImageIdIndex&&h!==-1&&void 0!==j.imageIds[h]){var k=c.loadHandlerManager.getStartLoadHandler(),m=c.loadHandlerManager.getEndLoadHandler(),n=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var o;o=j.preventCache===!0?b.loadImage(j.imageIds[h]):b.loadAndCacheImage(j.imageIds[h]),o.then(function(a){var c=b.getViewport(e);j.currentImageIdIndex=h,b.displayImage(e,a,c),m&&m(e)},function(a){var b=j.imageIds[h];n&&n(e,b,a)})}}}})}}function e(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b,f){if(c.isMouseButtonEnabled(f.which,b.data.mouseButtonMask))return a(f.element).on("CornerstoneToolsMouseDrag",g),a(f.element).on("CornerstoneToolsMouseUp",e),d(b,f),!1}function g(a,b){return d(a,b),!1}function h(b,d,e){var g={mouseButtonMask:d},h=c.getToolState(b,o);h=[],c.addToolState(b,o,{synchronizationContext:e}),a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",g,f)}function i(b){a(b).off("CornerstoneToolsMouseDown",f)}function j(b,c){a(c.element).off("CornerstoneToolsTouchDrag",l),a(c.element).off("CornerstoneToolsDragEnd",j)}function k(b,c){return a(c.element).on("CornerstoneToolsTouchDrag",l),a(c.element).on("CornerstoneToolsDragEnd",j),d(b,c),!1}function l(a,b){return d(a,b),!1}function m(b,d){var e=c.getToolState(b,o);e=[],c.addToolState(b,o,{synchronizationContext:d}),a(b).off("CornerstoneToolsTouchStart",k),a(b).on("CornerstoneToolsTouchStart",k)}function n(b){a(b).off("CornerstoneToolsTouchStart",k)}var o="crosshairs";c.crosshairs={activate:h,deactivate:i,enable:h,disable:i},c.crosshairsTouch={activate:m,deactivate:n,enable:m,disable:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d={},e={disable:function(b){a(b).off("CornerstoneImageRendered",c)},enable:function(d){a(d).off("CornerstoneImageRendered",c),a(d).on("CornerstoneImageRendered",c),b.updateImage(d)},getConfiguration:function(){return d},setConfiguration:function(a){d=a}};return e}c.displayTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a.element);b.updateImage(a.element);var e=d.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0);var f=c.toolColors.getActiveColor(),g=c.textStyle.getFont(),h=c.textStyle.getFontSize(),i=c.dragProbe.getConfiguration();e.save(),i&&i.shadow&&(e.shadowColor=i.shadowColor||"#000000",e.shadowOffsetX=i.shadowOffsetX||1,e.shadowOffsetY=i.shadowOffsetY||1);var j,k,l,m=Math.round(a.currentPoints.image.x),n=Math.round(a.currentPoints.image.y);if(!(m<0||n<0||m>=a.image.columns||n>=a.image.rows)){if(a.image.color)j=c.getRGBPixels(a.element,m,n,1,1),k=""+m+", "+n,l="R: "+j[0]+" G: "+j[1]+" B: "+j[2]+" A: "+j[3];else{j=b.getStoredPixels(a.element,m,n,1,1);var o=j[0],p=o*a.image.slope+a.image.intercept,q=c.calculateSUV(a.image,o);k=""+m+", "+n,l="SP: "+o+" MO: "+parseFloat(p.toFixed(3)),q&&(l+=" SUV: "+parseFloat(q.toFixed(3)))}var r={x:a.currentPoints.image.x+3,y:a.currentPoints.image.y-3},s=b.pixelToCanvas(a.element,r);e.font=g,e.fillStyle=f,c.drawTextBox(e,l,s.x,s.y+h+5,f),c.drawTextBox(e,k,s.x,s.y,f),e.restore()}}function e(a){var d=a.element,e=b.getEnabledElement(d),f=e.image;b.updateImage(d);var g=e.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);var h=c.toolColors.getActiveColor(),i=c.textStyle.getFont(),j=c.dragProbe.getConfiguration();g.save(),j&&j.shadow&&(g.shadowColor=j.shadowColor||"#000000",g.shadowOffsetX=j.shadowOffsetX||1,g.shadowOffsetY=j.shadowOffsetY||1);var k;k=a.isTouchEvent===!0?b.pageToPixel(d,a.currentPoints.page.x,a.currentPoints.page.y-4*c.textStyle.getFontSize()):a.currentPoints.image;var l,m;if(!(k.x<0||k.y<0||k.x>=f.columns||k.y>=f.rows)){if(f.color)l=b.getStoredPixels(d,k.x,k.y,3,1),m="R: "+l[0]+" G: "+l[1]+" B: "+l[2];else{l=b.getStoredPixels(d,k.x,k.y,1,1);var n=l[0]*f.slope+f.intercept;m=parseFloat(n.toFixed(3))}var o=b.pixelToCanvas(d,k);g.font=i,g.fillStyle=h;var p;if(a.isTouchEvent===!0){var q=g.measureText(m).width;p={x:-q/2-5,y:1.5*-c.textStyle.getFontSize()};var r=6;g.beginPath(),g.strokeStyle=h,g.arc(o.x,o.y,r,0,2*Math.PI),g.stroke()}else p={x:4,y:-4};c.drawTextBox(g,m,o.x+p.x,o.y+p.y,h),g.restore()}}function f(c,d){a(d.element).off("CornerstoneToolsMouseDrag",h),a(d.element).off("CornerstoneToolsMouseUp",f),a(d.element).off("CornerstoneToolsMouseClick",f),b.updateImage(d.element)}function g(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return a(d.element).on("CornerstoneToolsMouseDrag",h),a(d.element).on("CornerstoneToolsMouseUp",f),a(d.element).on("CornerstoneToolsMouseClick",f),c.dragProbe.strategy(d),!1}function h(a,b){return c.dragProbe.strategy(b),!1}c.dragProbe=c.simpleMouseButtonTool(g),c.dragProbe.strategies={"default":d,minimal:e},c.dragProbe.strategy=d;var i={fireOnTouchStart:!0};c.dragProbeTouch=c.touchDragTool(h,i)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,invalidated:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var c=a.width/2,d=a.height/2;if(c<=0||d<=0)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.x/(c*c)+f.y*f.y/(d*d)<=1;return g}function g(a,b){for(var c=0,d=0,e=0,g=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)f(b,{x:i,y:h})===!0&&(c+=a[g],d+=a[g]*a[g],e++),g++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function h(a,c,d,e){var g=b.pixelToCanvas(a,c.handles.start),h=b.pixelToCanvas(a,c.handles.end),i={left:Math.min(g.x,h.x)+e/2,top:Math.min(g.y,h.y)+e/2,width:Math.abs(g.x-h.x)-e,height:Math.abs(g.y-h.y)-e},j={left:Math.min(g.x,h.x)-e/2,top:Math.min(g.y,h.y)-e/2,width:Math.abs(g.x-h.x)+e,height:Math.abs(g.y-h.y)+e},k=f(i,d),l=f(j,d);return!(!l||k)}function i(a,b,c){return h(a,b,c,15)}function j(a,b,c){return h(a,b,c,25)}function k(a,c){var e=d.getToolState(a.currentTarget,l);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.textStyle.getFontSize(),m=d.ellipticalRoi.getConfiguration(),n=0;n<e.data.length;n++){f.save(),m&&m.shadow&&(f.shadowColor=m.shadowColor||"#000000",f.shadowOffsetX=m.shadowOffsetX||1,f.shadowOffsetY=m.shadowOffsetY||1);var o=e.data[n];h=o.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var p=b.pixelToCanvas(c.element,o.handles.start),q=b.pixelToCanvas(c.element,o.handles.end),r=Math.abs(p.x-q.x),s=Math.abs(p.y-q.y),t=Math.min(p.x,q.x),u=Math.min(p.y,q.y);(p.x+q.x)/2,(p.y+q.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=i,d.drawEllipse(f,t,u,r,s),f.closePath(),d.drawHandles(f,c,o.handles,h),f.font=j;var v,w,x,y;if(o.invalidated){var z=Math.abs(o.handles.start.x-o.handles.end.x),A=Math.abs(o.handles.start.y-o.handles.end.y),B=Math.min(o.handles.start.x,o.handles.end.x),C=Math.min(o.handles.start.y,o.handles.end.y),D=b.getPixels(c.element,B,C,z,A),E={left:B,top:C,width:z,height:A};y=g(D,E),x=Math.PI*(z*c.image.columnPixelSpacing/2)*(A*c.image.rowPixelSpacing/2),o.invalidated=!1,isNaN(x)||(o.area=x),isNaN(y.mean)||isNaN(y.stdDev)||(o.meanStdDev=y)}else v=o.textX,w=o.textY,y=o.meanStdDev,x=o.area;var F,G=0;void 0!==x&&(F="Area: "+x.toFixed(0)+" mm"+String.fromCharCode(178),G=f.measureText(F).width);var H="Mean: "+y.mean.toFixed(1),I=f.measureText(H).width,J="StdDev: "+y.stdDev.toFixed(1),K=f.measureText(J).width;Math.max(I,G,K);v=q.x>p.x?q.x+10:p.x+10,w=q.y>p.y?q.y+10:p.y+10,f.fillStyle=h;var L;y&&(L=Math.max(f.measureText(H).width,f.measureText(J).width)),void 0===x||isNaN(x)||(L=Math.max(L,f.measureText(F).width)),y&&(d.drawTextBox(f,H,v,w-k-5,h,L),d.drawTextBox(f,J,v,w,h,L)),void 0===x||isNaN(x)||d.drawTextBox(f,F,v,w+k+5,h,L),f.restore()}}}var l="ellipticalRoi";d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:k,pointNearTool:i,toolType:l}),d.ellipticalRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:k,pointNearTool:j,toolType:l})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var c=d.getToolState(a.element,t);if(void 0!==c){var e=d.freehand.getConfiguration(),f=c.data[e.currentTool],g={x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0,lines:[]};f.handles.length&&f.handles[e.currentHandle-1].lines.push(a.currentPoints.image),f.handles.push(g),e.currentHandle+=1,e.freehand=!1,b.updateImage(a.element)}}function f(a,e){var f=d.getToolState(a.element,t);if(void 0!==f){var g=f.data[e];if(void 0!==g.handles)for(var h=a.currentPoints.canvas,i=0;i<g.handles.length;i++){var j=b.pixelToCanvas(a.element,g.handles[i]);if(c.point.distance(j,h)<5)return i}}}function g(a){var b=d.getToolState(a.element,t);if(b)for(var c,e=0;e<b.data.length;e++)if(c=f(a,e),void 0!==c)return{handleNearby:c,toolIndex:e}}function h(c,e){a(e.element).off("CornerstoneToolsMouseUp",h);var f=d.getToolState(e.element,t);if(void 0!==f){var g=d.freehand.getConfiguration();e.event.shiftKey||(g.freehand=!1),b.updateImage(e.element)}}function i(a,c){var e=d.getToolState(c.element,t);if(e){var g=d.freehand.getConfiguration(),h=e.data[g.currentTool],i=Math.max(c.currentPoints.image.x,0);i=Math.min(i,c.image.width),g.mouseLocation.handles.start.x=i;var j=Math.max(c.currentPoints.image.y,0);j=Math.min(j,c.image.height),g.mouseLocation.handles.start.y=j;var k=g.currentHandle;if(g.modifying&&(h.active=!0,h.highlight=!0,h.handles[k].x=g.mouseLocation.handles.start.x,h.handles[k].y=g.mouseLocation.handles.start.y,k)){var l=h.handles[k-1].lines.length-1,m=h.handles[k-1].lines[l];m.x=g.mouseLocation.handles.start.x,m.y=g.mouseLocation.handles.start.y}if(g.freehand)h.handles[k-1].lines.push(c.currentPoints.image);else{var n=f(c,g.currentTool);void 0!==n&&n<h.handles.length-1&&(g.mouseLocation.handles.start.x=h.handles[n].x,g.mouseLocation.handles.start.y=h.handles[n].y)}b.updateImage(c.element)}}function j(b){a(b.element).on("CornerstoneToolsMouseMove",i),a(b.element).on("CornerstoneToolsMouseUp",h);var c={visible:!0,active:!0,handles:[]},e=d.freehand.getConfiguration();e.mouseLocation.handles.start.x=b.currentPoints.image.x,e.mouseLocation.handles.start.y=b.currentPoints.image.y,d.addToolState(b.element,t,c);var f=d.getToolState(b.element,t);e.currentTool=f.data.length-1}function k(c,e){var f=d.getToolState(c.element,t);if(f){var g=d.freehand.getConfiguration(),h=f.data[g.currentTool];h.active=!1,h.highlight=!1,void 0!==e&&h.handles[g.currentHandle-1].lines.push(h.handles[e]),g.modifying&&(g.modifying=!1),g.currentHandle=0,g.currentTool=-1,a(c.element).off("CornerstoneToolsMouseMove",i),b.updateImage(c.element)}}function l(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)){var l,m,n=d.getToolState(c.element,t),o=d.freehand.getConfiguration(),p=o.currentTool;if(o.modifying)return void k(c);if(p<0){var q=g(c);q?(l=q.handleNearby,m=q.toolIndex,void 0!==l&&(a(c.element).on("CornerstoneToolsMouseMove",i),a(c.element).on("CornerstoneToolsMouseUp",h),o.modifying=!0,o.currentHandle=l,o.currentTool=m)):(j(c),e(c))}else p>=0&&n.data[p].active&&(l=f(c,p),void 0!==l?k(c,l):c.event.shiftKey?o.freehand=!0:e(c));return!1}}function m(a,c){var e=d.getToolState(a.currentTarget,t);if(void 0!==e){var f=d.freehand.getConfiguration(),g=c.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.toolColors.getFillColor(),k=0;k<e.data.length;k++){g.save();var l=e.data[k];l.active?(h=d.toolColors.getActiveColor(),j=d.toolColors.getFillColor()):(h=d.toolColors.getToolColor(),j=d.toolColors.getToolColor());var m;if(l.handles.length)for(var n=0;n<l.handles.length;n++){m=l.handles[n];var o=b.pixelToCanvas(c.element,m);g.beginPath(),g.strokeStyle=h,g.lineWidth=i,g.moveTo(o.x,o.y);for(var p=0;p<l.handles[n].lines.length;p++){var q=b.pixelToCanvas(c.element,l.handles[n].lines[p]);g.lineTo(q.x,q.y),g.stroke()}var r=b.pixelToCanvas(c.element,f.mouseLocation.handles.start);n===l.handles.length-1&&(!l.active||f.freehand||f.modifying||(g.lineTo(r.x,r.y),g.stroke()))}l.active&&d.drawHandles(g,c,f.mouseLocation.handles,h,j),d.drawHandles(g,c,l.handles,h,j),g.restore()}}}function n(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function o(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneToolsMouseDown",e,l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseDown",e,l),b.updateImage(c)}function q(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function r(){return u}function s(a){u=a}var t="freehand",u={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};d.freehand={enable:n,disable:o,activate:p,deactivate:q,getConfiguration:r,setConfiguration:s}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=d.getToolState(a.event.currentTarget,i);if(!(b&&b.data&&b.data.length>0)){var c={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return c}}function f(a,c,d){var e=b.pixelToCanvas(a,c.handles.start),f=b.pixelToCanvas(a,c.handles.end),g={left:Math.min(e.x,f.x),top:Math.min(e.y,f.y),width:Math.abs(e.x-f.x),height:Math.abs(e.y-f.y)},h=!1;return d.x>=g.left&&d.x<=g.left+g.width&&d.y>=g.top&&d.y<=g.top+g.height&&(h=!0),h}function g(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return i<5}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);var g,h=d.toolStyle.getToolWidth();f.save();var j=e.data[0];if(j){g=j.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var k=b.pixelToCanvas(c.element,j.handles.start),l=b.pixelToCanvas(c.element,j.handles.end),m={left:Math.min(k.x,l.x),top:Math.min(k.y,l.y),width:Math.abs(k.x-l.x),height:Math.abs(k.y-l.y)};f.beginPath(),f.strokeStyle="transparent",f.rect(0,0,f.canvas.clientWidth,f.canvas.clientHeight),f.rect(m.width+m.left,m.top,-m.width,m.height),f.stroke(),f.fillStyle="rgba(0,0,0,0.7)",f.fill(),f.closePath(),f.beginPath(),f.strokeStyle=g,f.lineWidth=h,f.setLineDash([4]),f.strokeRect(m.left,m.top,m.width,m.height),f.setLineDash([]),d.drawHandles(f,c,j.handles,g),f.restore()}}}var i="highlight",j=!0;d.highlight=d.mouseButtonRectangleTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j),d.highlightTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c){a(c).off("CornerstoneToolsKeyDown",b),a(c).on("CornerstoneToolsKeyDown",b)},disable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},enable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},deactivate:function(c){a(c).off("CornerstoneToolsKeyDown",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.keyboardTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,e,f){var g,h={start:b.pixelToCanvas(a,e.handles.start),end:b.pixelToCanvas(a,e.handles.end)},i=c.lineSegment.distanceToPoint(h,f);return g=void 0===d.recognizeR?25:d.recognizeR,i<g}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g=d.toolStyle.getToolWidth(),i=d.length.getConfiguration(),j=0;j<e.data.length;j++){f.save(),i&&i.shadow&&(f.shadowColor=i.shadowColor||"#000000",f.shadowOffsetX=i.shadowOffsetX||1,f.shadowOffsetY=i.shadowOffsetY||1);var k=e.data[j],l=d.toolColors.getColorIfActive(k.active),m=b.pixelToCanvas(c.element,k.handles.start),n=b.pixelToCanvas(c.element,k.handles.end);f.beginPath(),f.strokeStyle=l,f.lineWidth=g,f.moveTo(m.x,m.y),f.lineTo(n.x,n.y),f.stroke(),d.drawHandles(f,c,k.handles,l),f.fillStyle=l;var o=(k.handles.end.x-k.handles.start.x)*(c.image.columnPixelSpacing||1),p=(k.handles.end.y-k.handles.start.y)*(c.image.rowPixelSpacing||1),q=Math.sqrt(o*o+p*p),r=" mm";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(r=" pixels");var s=""+q.toFixed(1)+r,t=d.textStyle.getFontSize(),u={x:Math.max(m.x,n.x)};u.x===m.x?u.y=m.y:u.y=n.y,u.x+=10,u.y-=t/2+7,d.drawTextBox(f,s,u.x,u.y,l),f.restore()}}}var h="length";d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.lengthTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",h),a(c.element).off("CornerstoneToolsMouseUp",d),e(c)}function e(b){a(b.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function f(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseDrag",e,h),a(e.element).on("CornerstoneToolsMouseUp",e,d),i(e),!1}function g(b,c){a(c.element).off("CornerstoneToolsDragEnd",g),a(c.element).off("CornerstoneToolsTouchEnd",g),e(c)}function h(b,c){return i(c),c.isTouchEvent===!0&&(a(c.element).on("CornerstoneToolsDragEnd",g),a(c.element).on("CornerstoneToolsTouchEnd",g)),!1}function i(d){var e=a(d.element).find(".magnifyTool").get(0);e||j(d.element);var f=c.magnify.getConfiguration(),g=f.magnifySize,h=f.magnificationLevel,i=a(d.element).find("canvas").not(".magnifyTool").get(0),k=i.getContext("2d");k.setTransform(1,0,0,1,0,0);var l=e.getContext("2d");l.setTransform(1,0,0,1,0,0);var m=g/h,n=b.pixelToCanvas(d.element,d.currentPoints.image);d.isTouchEvent===!0&&(n.y-=1.25*m),n.x=Math.max(n.x,0),n.x=Math.min(n.x,i.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,i.height),l.clearRect(0,0,g,g),l.fillStyle="transparent",l.fillRect(0,0,g,g);var o={x:n.x-.5*m,y:n.y-.5*m};"Safari"===q&&(o.x=Math.max(o.x,0),o.y=Math.max(o.y,0)),o.x=Math.min(o.x,i.width),o.y=Math.min(o.y,i.height);var p={x:(i.width-o.x)*h,y:(i.height-o.y)*h};l.drawImage(i,o.x,o.y,i.width-o.x,i.height-o.y,0,0,p.x,p.y),e.style.top=n.y-.5*g+"px",e.style.left=n.x-.5*g+"px",e.style.display="block",document.body.style.cursor="none"}function j(b){if(0===a(b).find(".magnifyTool").length){var d=document.createElement("canvas");d.classList.add("magnifyTool");var e=c.magnify.getConfiguration();d.width=e.magnifySize,d.height=e.magnifySize,d.style.position="absolute",b.appendChild(d)}}function k(b){a(b).find(".magnifyTool").remove()}function l(b){a(b).off("CornerstoneToolsMouseDown",f),k(b)}function m(a){var b=c.magnify.getConfiguration(b);if(!q){var d=c.getBrowserInfo(),e=d.split(" ");q=e[0]}j(a)}function n(b,c){var d={mouseButtonMask:c};a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",d,f),j(b)}function o(){return r}function p(a){r=a}var q,r={magnifySize:100,magnificationLevel:2};c.magnify={enable:m,activate:n,deactivate:l,disable:l,getConfiguration:o,setConfiguration:p};var s={fireOnTouchStart:!0,activateCallback:j,disableCallback:k};c.magnifyTouchDrag=c.touchDragTool(h,s)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d="CornerstoneToolsMultiTouchDrag",e={activate:function(c){a(c).off(d,b),a(c).on(d,b)},disable:function(c){a(c).off(d,b)},enable:function(c){a(c).off(d,b)},deactivate:function(c){a(c).off(d,b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return e}c.multiTouchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a),e=c.metaData.get("imagePlane",d.image.imageId);if(e&&e.rowCosines&&e.columnCosines){var f=c.orientation.getOrientationString(e.rowCosines),g=c.orientation.getOrientationString(e.columnCosines),h=c.orientation.invertOrientationString(f),i=c.orientation.invertOrientationString(g);return{top:i,bottom:g,left:h,right:f}}}function e(a){var c,d=b.getEnabledElement(a);c={x:d.image.width/2,y:5};var e=b.pixelToCanvas(a,c);c={x:d.image.width/2,y:d.image.height-5};var f=b.pixelToCanvas(a,c);c={x:5,y:d.image.height/2};var g=b.pixelToCanvas(a,c);c={x:d.image.width-10,y:d.image.height/2};var h=b.pixelToCanvas(a,c);return{top:e,bottom:f,left:g,right:h}}function f(a,b){var f=b.element,g=d(f);if(g){var h=e(f,g),i=b.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var j=c.toolColors.getToolColor();j="white";var k={top:i.measureText(g.top).width,left:i.measureText(g.left).width,right:i.measureText(g.right).width,bottom:i.measureText(g.bottom).width};c.drawTextBox(i,g.top,h.top.x-k.top/2,h.top.y,j),c.drawTextBox(i,g.left,h.left.x-k.left/2,h.left.y,j);var l=c.orientationMarkers.getConfiguration();l&&l.drawAllMarkers&&(c.drawTextBox(i,g.right,h.right.x-k.right/2,h.right.y,j),c.drawTextBox(i,g.bottom,h.bottom.x-k.bottom/2,h.bottom.y,j))}}c.orientationMarkers=c.displayTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1}function f(a,c){var d=c.viewport.scale*b.diy.iniScaleCal(c);return c.viewport.translation.x+=c.deltaPoints.page.x/d,c.viewport.translation.y+=c.deltaPoints.page.y/d,b.setViewport(c.element,c.viewport),!1}c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d){var e=c.panMultiTouch.getConfiguration();if(e&&e.testPointers(d)){var f=d.viewport.scale*b.diy.iniScaleCal(d);return d.viewport.translation.x+=d.deltaPoints.page.x/f,d.viewport.translation.y+=d.deltaPoints.page.y/f,b.setViewport(d.element,d.viewport),!1}}var e={testPointers:function(a){return a.numPointers>=2}};c.panMultiTouch=c.multiTouchDragTool(d),c.panMultiTouch.setConfiguration(e)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b={visible:!0,active:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end);return cornerstoneMath.point.distance(e,d)<1.2}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=c.textStyle.getFont(),j=c.textStyle.getFontSize(),k=0;k<e.data.length;k++){f.save();var l=e.data[k];h=l.active?c.toolColors.getActiveColor():c.toolColors.getToolColor(),c.drawHandles(f,d,l.handles,h,void 0,{R:1.2});var m,n,o,p=Math.round(l.handles.end.x),q=Math.round(l.handles.end.y);if(p<0||q<0||p>=d.image.columns||q>=d.image.rows)return;if(d.image.color)n=""+p+", "+q,m=c.getRGBPixels(d.element,p,q,1,1),o="R: "+m[0]+" G: "+m[1]+" B: "+m[2];else{m=b.getStoredPixels(d.element,p,q,1,1);var r=m[0],s=r*d.image.slope+d.image.intercept;c.calculateSUV(d.image,r);n="X,Y: "+p+", "+q,o="MO : "+parseFloat(s.toFixed(1));var t=Math.max(f.measureText(n).width,f.measureText(o).width)}var u={x:l.handles.end.x+3,y:l.handles.end.y-3},v=b.pixelToCanvas(d.element,u);f.font=i,f.fillStyle=h,c.drawTextBox(f,n,v.x+5,v.y+j+5,h,t),c.drawTextBox(f,o,v.x+5,v.y,h,t),f.restore()}}}var g="probe";c.probe=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g}),c.probeTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return i<5}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,j=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.textStyle.getFontSize(),m=0;m<e.data.length;m++){f.save();var n=e.data[m];h=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.end),q=Math.abs(o.x-p.x),r=Math.abs(o.y-p.y),s=Math.min(o.x,p.x),t=Math.min(o.y,p.y);(o.x+p.x)/2,(o.y+p.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=j,f.rect(s,t,q,r),f.stroke(),d.drawHandles(f,c,n.handles,h);var u=Math.abs(n.handles.start.x-n.handles.end.x),v=Math.abs(n.handles.start.y-n.handles.end.y),w=Math.min(n.handles.start.x,n.handles.end.x),x=Math.min(n.handles.start.y,n.handles.end.y),y=b.getPixels(c.element,w,x,u,v),z={left:w,top:x,width:u,height:v},A=g(y,z),B=u*c.image.columnPixelSpacing*(v*c.image.rowPixelSpacing),C="Area: "+B.toFixed(0)+" mm"+String.fromCharCode(178);f.font=k;var D=(f.measureText(B),p.x>o.x?p.x+10:o.x+10),E=p.y>o.y?p.y+10:o.y+10;f.fillStyle=h;var F="Mean: "+A.mean.toFixed(1),G="StdDev: "+A.stdDev.toFixed(1),H=Math.max(f.measureText(F).width,f.measureText(G).width);H=Math.max(u,f.measureText(C).width),d.drawTextBox(f,"Mean: "+A.mean.toFixed(1),D,E-l-5,h,H),d.drawTextBox(f,"StdDev: "+A.stdDev.toFixed(1),D,E,h,H),d.drawTextBox(f,C,D,E+l+5,h,H),f.restore()}}}var i="rectangleRoi";d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d.rectangleRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=a.element.getBoundingClientRect(a.element),d={x:a.currentPoints.client.x,y:a.currentPoints.client.y},e=a.element.clientWidth,f=a.element.clientHeight,g={x:d.x-c.left-e/2,y:-1*(d.y-c.top-f/2)},h=Math.atan2(g.y,g.x),i=h*(180/Math.PI),j=-1*i+90;a.viewport.rotation=j,b.setViewport(a.element,a.viewport)}function e(a){a.viewport.rotation+=a.deltaPoints.page.x/a.viewport.scale,b.setViewport(a.element,a.viewport)}function f(a){a.viewport.rotation+=a.deltaPoints.page.y/a.viewport.scale,b.setViewport(a.element,a.viewport)}function g(b,c){a(c.element).off("CornerstoneToolsMouseDrag",i),a(c.element).off("CornerstoneToolsMouseUp",g),a(c.element).off("CornerstoneToolsMouseClick",g)}function h(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return a(d.element).on("CornerstoneToolsMouseDrag",i),a(d.element).on("CornerstoneToolsMouseUp",g),a(d.element).on("CornerstoneToolsMouseClick",g),!1}function i(a,d){return c.rotate.strategy(d),b.setViewport(d.element,d.viewport),!1}c.rotate=c.simpleMouseButtonTool(h),c.rotate.strategies={"default":d,horizontal:e,vertical:f},c.rotate.strategy=d,c.rotateTouchDrag=c.touchDragTool(i)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c){return c.viewport.rotation+=c.rotation,b.setViewport(c.element,c.viewport),!1}function e(b){a(b).off("CornerstoneToolsTouchRotate",d)}function f(b){a(b).off("CornerstoneToolsTouchRotate",d),a(b).on("CornerstoneToolsTouchRotate",d);
}c.rotateTouch={activate:f,disable:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d=a(b).find("canvas").get(0),e=document.createElement("a");if(e.download=c,e.href=d.toDataURL(),document.createEvent){var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(f)}else e.fireEvent&&e.fireEvent("onclick")}c.saveAs=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},middle:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.middle)},g=c.lineSegment.distanceToPoint(f,e);return g<25||(f.start=b.pixelToCanvas(a,d.handles.middle),f.end=b.pixelToCanvas(a,d.handles.end),g=c.lineSegment.distanceToPoint(f,e),g<25)}function g(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}function h(a,c){var e=d.getToolState(a.currentTarget,k);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),l=d.simpleAngle.getConfiguration(),m=0;m<e.data.length;m++){f.save(),l&&l.shadow&&(f.shadowColor=l.shadowColor||"#000000",f.shadowOffsetX=l.shadowOffsetX||1,f.shadowOffsetY=l.shadowOffsetY||1);var n=e.data[m];h=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=h,f.lineWidth=i;var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.middle);f.moveTo(o.x,o.y),f.lineTo(p.x,p.y);var q=b.pixelToCanvas(c.element,n.handles.end);f.lineTo(q.x,q.y),f.stroke(),d.drawHandles(f,c,n.handles,h),f.fillStyle=h;var r=c.image.columnPixelSpacing||1,s=c.image.rowPixelSpacing||1,t="";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(t=" (isotropic)");var u={x:(Math.ceil(n.handles.middle.x)-Math.ceil(n.handles.start.x))*r,y:(Math.ceil(n.handles.middle.y)-Math.ceil(n.handles.start.y))*s},v={x:(Math.ceil(n.handles.end.x)-Math.ceil(n.handles.middle.x))*r,y:(Math.ceil(n.handles.end.y)-Math.ceil(n.handles.middle.y))*s},w={x:(Math.ceil(n.handles.end.x)-Math.ceil(n.handles.start.x))*r,y:(Math.ceil(n.handles.end.y)-Math.ceil(n.handles.start.y))*s},x=g(u),y=g(v),z=g(w),A=Math.acos((Math.pow(x,2)+Math.pow(y,2)-Math.pow(z,2))/(2*x*y));A*=180/Math.PI;var B=d.roundToDecimal(A,2);if(B){var C="00B0",D=B.toString()+String.fromCharCode(parseInt(C,16))+t,E=15,F=p.x+E,G=p.y+E;f.font=j;var H=f.measureText(D).width;F=p.x-o.x<0?p.x-E-H-10:p.x+E,G=p.y,d.drawTextBox(f,D,F,G,h)}f.restore()}}}function i(c){var f=e(c),g=c.element,h={mouseButtonMask:c.which};d.addToolState(g,k,f),a(g).off("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).off("CornerstoneToolsMouseDown",d.simpleAngle.mouseDownCallback),a(g).off("CornerstoneToolsMouseDownActivate",d.simpleAngle.mouseDownActivateCallback),b.updateImage(g),d.moveNewHandle(c,k,f,f.handles.middle,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),f.handles.end.active=!0,b.updateImage(g),d.moveNewHandle(c,k,f,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),a(g).on("CornerstoneToolsMouseMove",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDrag",d.simpleAngle.mouseMoveCallback),a(g).on("CornerstoneToolsMouseDown",h,d.simpleAngle.mouseDownCallback),a(g).on("CornerstoneToolsMouseDownActivate",h,d.simpleAngle.mouseDownActivateCallback),b.updateImage(g)})})}function j(c){var f=e(c),g=c.element;d.addToolState(g,k,f),a(g).off("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).off("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).off("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).off("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),b.updateImage(g),d.moveNewHandleTouch(c,f.handles.middle,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),f.handles.end.active=!0,b.updateImage(g),d.moveNewHandleTouch(c,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(g,k,f),a(g).on("CornerstoneToolsTouchDrag",d.simpleAngleTouch.touchMoveCallback),a(g).on("CornerstoneToolsTouchStart",d.simpleAngleTouch.touchStartCallback),a(g).on("CornerstoneToolsTouchStartActive",d.simpleAngleTouch.touchDownActivateCallback),a(g).on("CornerstoneToolsTap",d.simpleAngleTouch.tapCallback),b.updateImage(g)})})}var k="simpleAngle";d.simpleAngle=d.mouseButtonTool({createNewMeasurement:e,addNewMeasurement:i,onImageRendered:h,pointNearTool:f,toolType:k}),d.simpleAngleTouch=d.touchTool({createNewMeasurement:e,addNewMeasurement:j,onImageRendered:h,pointNearTool:f,toolType:k})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b=c.textMarker.getConfiguration();if(b.current){var d={visible:!0,active:!0,text:b.current,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}},e=b.markers.indexOf(b.current);return b.ascending?(e+=1,e>=b.markers.length&&(b.loop?e-=b.markers.length:e=-1)):(e-=1,e<0&&(b.loop?e+=b.markers.length:e=-1)),b.current=b.markers[e],d}}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end),f={left:e.x-c.textWidth/2,top:e.y,width:c.textWidth,height:c.textHeight},g=cornerstoneMath.rect.distanceToPoint(f,d);return g<10}function f(a,d){var e=c.getToolState(d.element,i);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g=c.textStyle.getFont(),h=c.textStyle.getFontSize(),j=c.textMarker.getConfiguration(),k=0;k<e.data.length;k++){var l=e.data[k],m=c.toolColors.getToolColor();l.active&&(m=c.toolColors.getActiveColor()),f.save(),j&&j.shadow&&(f.shadowColor=j.shadowColor||"#000000",f.shadowOffsetX=j.shadowOffsetX||1,f.shadowOffsetY=j.shadowOffsetY||1),f.font=g,f.fillStyle=m;var n=f.measureText(l.text);l.textWidth=n.width,l.textHeight=h;var o={x:l.handles.end.x,y:l.handles.end.y},p=b.pixelToCanvas(d.element,o);c.drawTextBox(f,l.text,p.x-l.textWidth/2,p.y,m),f.restore()}}}function g(d,f){function g(d,e,g){g===!0?c.removeToolState(j,i,d):d.text=e,d.active=!1,b.updateImage(j),a(j).on("CornerstoneToolsMouseMove",f,c.textMarker.mouseMoveCallback),a(j).on("CornerstoneToolsMouseDown",f,c.textMarker.mouseDownCallback),a(j).on("CornerstoneToolsMouseDownActivate",f,c.textMarker.mouseDownActivateCallback),a(j).on("CornerstoneToolsMouseDoubleClick",f,c.textMarker.mouseDoubleClickCallback)}var h,j=f.element;if(d.data&&d.data.mouseButtonMask&&!c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask))return!1;var k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsMouseMove",c.textMarker.mouseMoveCallback),a(j).off("CornerstoneToolsMouseDown",c.textMarker.mouseDownCallback),a(j).off("CornerstoneToolsMouseDownActivate",c.textMarker.mouseDownActivateCallback),a(j).off("CornerstoneToolsMouseDoubleClick",c.textMarker.mouseDoubleClickCallback),k.changeTextCallback(h,g),d.stopImmediatePropagation(),!1;return!1}function h(d,f){function g(d,e,f){f===!0?c.removeToolState(j,i,d):d.text=e,d.active=!1,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),a(j).on("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).on("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).on("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).on("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).on("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback)}var h,j=f.element;if(d.data&&d.data.mouseButtonMask&&!c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask))return!1;var k=c.textMarker.getConfiguration(),l=f.currentPoints.canvas,m=c.getToolState(j,i);if(!m)return!1;for(var n=0;n<m.data.length;n++)if(h=m.data[n],e(j,h,l))return h.active=!0,b.updateImage(j),a(j).off("CornerstoneToolsTouchDrag",c.textMarkerTouch.touchMoveCallback),a(j).off("CornerstoneToolsTouchStartActive",c.textMarkerTouch.touchDownActivateCallback),a(j).off("CornerstoneToolsTouchStart",c.textMarkerTouch.touchStartCallback),a(j).off("CornerstoneToolsTap",c.textMarkerTouch.tapCallback),a(j).off("CornerstoneToolsTouchPress",c.textMarkerTouch.pressCallback),k.changeTextCallback(h,g),d.stopImmediatePropagation(),!1;return!1}var i="textMarker";c.textMarker=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,mouseDoubleClickCallback:g}),c.textMarkerTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:i,pressCallback:h})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask))return a(e.element).on("CornerstoneToolsMouseDrag",g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),!1}function f(a){var b=a.image.maxPixelValue*a.image.slope+a.image.intercept,c=a.image.minPixelValue*a.image.slope+a.image.intercept,d=b-c,e=d/1024,f=a.deltaPoints.page.x*e,g=a.deltaPoints.page.y*e;a.viewport.voi.windowWidth+=f,a.viewport.voi.windowCenter+=g}function g(a,d){return c.wwwc.strategy(d),b.setViewport(d.element,d.viewport),!1}function h(a,d){a.stopImmediatePropagation();var e=d,f=e.image.maxPixelValue*e.image.slope+e.image.intercept,g=e.image.minPixelValue*e.image.slope+e.image.intercept,h=f-g,i=h/1024,j=e.deltaPoints.page.x*i,k=e.deltaPoints.page.y*i,l=c.wwwc.getConfiguration();l.orientation?0===l.orientation?(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k):(e.viewport.voi.windowWidth+=k,e.viewport.voi.windowCenter+=j):(e.viewport.voi.windowWidth+=j,e.viewport.voi.windowCenter+=k),b.setViewport(e.element,e.viewport)}c.wwwc=c.simpleMouseButtonTool(e),c.wwwc.strategies={"default":f},c.wwwc.strategy=f,c.wwwcTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b,c){var d=a.length;if(d<2)return{min:b,max:c,mean:(b+c)/2};for(var e=c,f=b,g=0,h=0;h<d;h++){var i=a[h];e=Math.min(e,i),f=Math.max(f,i),g+=i}return{min:e,max:f,mean:g/d}}function f(b,c){a(c.element).off("CornerstoneToolsMouseMove",k),a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseClick",f);var e=d.getToolState(c.element,s);if(e&&e.data.length){var h={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=h,g(c);var j={mouseButtonMask:c.which};a(c.element).on("CornerstoneToolsMouseDown",j,i)}}function g(a){var c=d.getToolState(a.element,s);if(c&&c.data.length){var f=c.data[0].startPoint,g=c.data[0].endPoint,h=Math.abs(f.x-g.x),i=Math.abs(f.y-g.y),j=Math.min(f.x,g.x),k=Math.min(f.y,g.y);j=Math.max(j,0),j=Math.min(j,a.image.width),k=Math.max(k,0),k=Math.min(k,a.image.height),h=Math.floor(Math.min(h,Math.abs(a.image.width-j))),i=Math.floor(Math.min(i,Math.abs(a.image.height-k)));var l=d.getLuminance(a.element,j,k,h,i),m=e(l,a.image.minPixelValue,a.image.maxPixelValue),n=d.wwwcRegion.getConfiguration(),o=b.getViewport(a.element);void 0===n.minWindowWidth&&(n.minWindowWidth=10),o.voi.windowWidth=Math.max(Math.abs(m.max-m.min),n.minWindowWidth),o.voi.windowCenter=m.mean,b.setViewport(a.element,o),c.data=[],b.updateImage(a.element)}}function h(b,c){var d=c.element;a(d).off("CornerstoneToolsMouseMove"),a(d).off("CornerstoneToolsMouseDrag"),a(d).on("CornerstoneToolsMouseMove",k),a(d).on("CornerstoneToolsMouseDrag",k),a(d).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===b.type&&a(d).on("CornerstoneToolsMouseUp",f)}function i(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask))return a(c.element).on("CornerstoneToolsMouseDrag",c,h),a(c.element).on("CornerstoneToolsMouseMove",c,h),a(c.element).on("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseDown"),j(c),!1}function j(a){var b=d.getToolState(a.element,s);b&&b.data&&(b.data=[]);var c={startPoint:{x:a.currentPoints.image.x,y:a.currentPoints.image.y}};d.addToolState(a.element,s,c)}function k(a,c){var e=d.getToolState(c.element,s);if(void 0!==e&&e.data.length){var f={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=f,b.updateImage(c.element)}}function l(c,e){var f=d.getToolState(e.element,s);if(f&&f.data.length){var g=f.data[0].startPoint,h=f.data[0].endPoint;if(g&&h){var i=a(e.element).find("canvas").get(0),j=i.getContext("2d");j.setTransform(1,0,0,1,0,0);var k=d.toolColors.getActiveColor(),l=b.pixelToCanvas(e.element,g),m=b.pixelToCanvas(e.element,h),n=Math.min(l.x,m.x),o=Math.min(l.y,m.y),p=Math.abs(l.x-m.x),q=Math.abs(l.y-m.y),r=d.toolStyle.getToolWidth(),t=d.wwwcRegion.getConfiguration();j.save(),t&&t.shadow&&(j.shadowColor=t.shadowColor||"#000000",j.shadowOffsetX=t.shadowOffsetX||1,j.shadowOffsetY=t.shadowOffsetY||1),j.beginPath(),j.strokeStyle=k,j.lineWidth=r,j.rect(n,o,p,q),j.stroke(),j.restore()}}}function m(c){a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneImageRendered",l),b.updateImage(c)}function n(c,e){var g={mouseButtonMask:e},h=d.getToolState(c,s);if(!h){var j=[];d.addToolState(c,s,j)}a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseUp",f),a(c).off("CornerstoneToolsMouseDrag",k),a(c).off("CornerstoneImageRendered",l),a(c).on("CornerstoneToolsMouseDown",g,i),a(c).on("CornerstoneImageRendered",l),b.updateImage(c)}function o(b){a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l)}function p(b){var c=d.getToolState(b,s);if(void 0===c){var e=[];d.addToolState(b,s,e)}a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsTouchStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l),a(b).on("CornerstoneToolsTouchDrag",k),a(b).on("CornerstoneToolsTouchStart",j),a(b).on("CornerstoneToolsDragEnd",g),a(b).on("CornerstoneImageRendered",l)}function q(){return t}function r(a){t=a}var s="wwwcRegion",t={minWindowWidth:10};d.wwwcRegion={activate:n,deactivate:m,disable:m,setConfiguration:r,getConfiguration:q},d.wwwcRegionTouch={activate:p,deactivate:o,disable:o}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=c.zoom.getConfiguration(),e=1.7,f=Math.log(a.scale)/Math.log(e),g=f+b,h=Math.pow(e,g);return d.maxScale&&h>d.maxScale?a.scale=d.maxScale:d.minScale&&h<d.minScale?a.scale=d.minScale:a.scale=h,a}function e(a,b,c){return a.x=Math.max(a.x,0),a.y=Math.max(a.y,0),a.x=Math.min(a.x,b),a.y=Math.min(a.y,c),a}function f(a,b){if(0!==b.rotation){var c=b.rotation*Math.PI/180,d=Math.cos(c),e=Math.sin(c),f=a.x*d-a.y*e,g=a.x*e+a.y*d;a.x=f,a.y=g}return b.hflip&&(a.x*=-1),b.vflip&&(a.y*=-1),a}function g(a,c){var e=a.element,g=d(a.viewport,c);b.setViewport(e,g);var h=b.pageToPixel(e,a.startPoints.page.x,a.startPoints.page.y),i={x:a.startPoints.image.x-h.x,y:a.startPoints.image.y-h.y};i=f(i,g),g.translation.x-=i.x,g.translation.y-=i.y,b.setViewport(e,g)}function h(a,g){var h=a.element,i=a.image,j=d(a.viewport,g);b.setViewport(h,j);var k,l,m=c.zoom.getConfiguration(),o=8,p=8,q=3,r=.01;if(g<0){if(k={x:j.scale<q?j.translation.x/o:0,y:j.scale<q?j.translation.y/o:0},Math.abs(j.translation.x)<r)j.translation.x=0,k.x=0;else if(Math.abs(j.translation.y)<r)j.translation.y=0,k.y=0;else if(Math.abs(j.translation.x)<r&&Math.abs(j.translation.y)<r)return b.setViewport(h,j),!1}else{l=b.pageToPixel(h,n.page.x,n.page.y),m&&m.preventZoomOutsideImage&&(n.image=e(n.image,i.width,i.height),l=e(l,i.width,i.height));var s={x:i.width/2-n.image.x,y:i.height/2-n.image.y},t={x:j.translation.x-s.x,y:j.translation.y-s.y};if(k={x:t.x/p,y:t.y/p},Math.abs(t.x)<r)j.translation.x=s.x,k.x=0;else if(Math.abs(t.y)<r)j.translation.y=s.y,k.y=0;else if(Math.abs(t.x)<r&&Math.abs(t.y)<r)return b.setViewport(h,j),!1}return k=f(k,j),!(!k.x&&!k.y)&&(j.translation.x-=k.x,j.translation.y-=k.y,void b.setViewport(h,j))}function i(b,c){a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",i),a(c.element).off("CornerstoneToolsMouseClick",i)}function j(b,d){if(c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask))return n=d.startPoints,a(d.element).on("CornerstoneToolsMouseDrag",k),a(d.element).on("CornerstoneToolsMouseUp",i),a(d.element).on("CornerstoneToolsMouseClick",i),!1}function k(a,b){if(!b.deltaPoints.page.y)return!1;var d=b.deltaPoints.page.y/100;return c.zoom.strategy(b,d),!1}function l(a,c){var e=-c.direction/4,f=d(c.viewport,e);b.setViewport(c.element,f)}function m(a,d){var e=c.zoom.getConfiguration(),g=d.viewport,h=d.element;g.scale+=d.scaleChange*g.scale,e.maxScale&&g.scale>e.maxScale?g.scale=e.maxScale:e.minScale&&g.scale<e.minScale&&(g.scale=e.minScale),b.setViewport(h,g);var i=b.pageToPixel(h,d.startPoints.page.x,d.startPoints.page.y),j={x:d.startPoints.image.x-i.x,y:d.startPoints.image.y-i.y};j=f(j,g),g.translation.x-=j.x,g.translation.y-=j.y,b.setViewport(h,g)}var n;c.zoom=c.simpleMouseButtonTool(j),c.zoom.strategies={"default":g,translate:h},c.zoom.strategy=g,c.zoomWheel=c.mouseWheelTool(l),c.zoomTouchPinch=c.touchPinchTool(m),c.zoomTouchDrag=c.touchDragTool(k)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d=c.currentTarget,e={event:window.event||c,element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,currentPoints:{page:{x:h,y:i},image:b.pageToPixel(d,h,i)},keyCode:c.keyCode,which:c.which};e.currentPoints.canvas=b.pixelToCanvas(d,e.currentPoints.image);var f={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};a(d).trigger(f[c.type],e)}function e(a){h=a.pageX||a.originalEvent.pageX,i=a.pageY||a.originalEvent.pageY}function f(b){g(b),a(b).on(j,d),a(b).on("mousemove",e)}function g(b){a(b).off(j,d),a(b).off("mousemove",e)}var h,i,j="keydown keypress keyup";c.keyboardInput={enable:f,disable:g}}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){var c=Date.now();if(a!==g){if(c-h<=i)return b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),!1;g=a}h=c}function c(a,b,c){var d=c?k:l;b.forEach(function(b){a.addEventListener(b,d,!0)})}function d(a,b,c){var d=c?k:l;b.forEach(function(b){a.removeEventListener(b,d,!0)})}function e(a){d(a,m,j.mouse),d(a,n,j.touch)}function f(a){e(a),c(a,m,j.mouse),c(a,n,j.touch)}var g,h,i=2e3,j={mouse:0,touch:1},k=b.bind(null,j.mouse),l=b.bind(null,j.touch),m=["mousedown","mouseup"],n=["touchstart","touchend"];a.preventGhostClick={enable:f,disable:e}}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b){var d=a.image,e={left:0,top:0,width:d.width,height:d.height},f=!1;return Object.keys(b).forEach(function(a){var d=b[a];d.allowedOutsideImage!==!0&&c.point.insideRect(d,e)===!1&&(f=!0)}),f}d.anyHandlesOutsideImage=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b){"use strict";function c(c,e,f,g,h,i){c.strokeStyle=g,i||(i={}),Object.keys(f).forEach(function(g){var j=f[g];if(j.drawnIndependently!==!0){c.beginPath(),j.active?c.lineWidth=b.toolStyle.getActiveWidth():c.lineWidth=b.toolStyle.getToolWidth();var k=a.pixelToCanvas(e.element,j),l=i.R?i.R:b.handleR||d;c.arc(k.x,k.y,l,0,2*Math.PI),h&&(c.fillStyle=h,c.fill()),c.stroke()}})}var d=6;b.drawHandles=c}(cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,d,e,f){var g;if(d)return Object.keys(d).forEach(function(h){var i=d[h];if(i.hasOwnProperty("pointNearHandle")){if(i.pointNearHandle(a,i,e))return void(g=i)}else{var j=b.pixelToCanvas(a,i),k=c.point.distance(j,e);if(k<=f)return void(g=i)}}),g}d.getHandleNearImagePoint=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b;return Object.keys(a).forEach(function(c){var d=a[c];if(d.active===!0)return void(b=d)}),b}function f(a,b,c,f){f||(f=36);var g=e(b),h=d.getHandleNearImagePoint(a,b,c,f);return g!==h&&(void 0!==h&&(h.active=!0),void 0!==g&&(g.active=!1),!0)}d.handleActivator=f}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y,h.preventHandleOutsideImage===!0&&(b.x=Math.max(b.x,0),b.x=Math.min(b.x,d.image.width),b.y=Math.max(b.y,0),b.y=Math.min(b.y,d.image.height)))}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",i={toolType:g,element:l,measurementData:e};return a(l).trigger(f,i),!1}function k(d,g){if(e.active=!1,e.invalidated=!0,a(l).off("CornerstoneToolsMouseDrag",j),a(l).off("CornerstoneToolsMouseUp",k),a(l).off("CornerstoneToolsMouseClick",k),h.deleteIfHandleOutsideImage===!0){var m=g.image,n=!1,o={top:0,left:0,width:m.width,height:m.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];if(b.active=!1,c.point.insideRect(b,o)===!1)return n=!0,!1}),n){var p=-1;f.data.forEach(function(a,b){if(a===e)return p=b,!1}),p!==-1&&f.data.splice(p,1)}}b.updateImage(l),"function"==typeof i&&i()}var l=d.element;return a(l).on("CornerstoneToolsMouseDrag",j),a(l).on("CornerstoneToolsMouseUp",k),a(l).on("CornerstoneToolsMouseClick",k),!0}d.moveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x+l.x,f.y=g.currentPoints.image.y+l.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(k);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:k,measurementData:e};a(k).trigger(i,j)}function j(){f.active=!1,a(k).off("CornerstoneToolsMouseDrag",i),a(k).off("CornerstoneToolsMouseUp",j),a(k).off("CornerstoneToolsMouseClick",j),b.updateImage(k),"function"==typeof g&&g()}var k=c.element,l={x:f.x-c.currentPoints.image.x,y:f.y-c.currentPoints.image.y};a(k).on("CornerstoneToolsMouseDrag",i),a(k).on("CornerstoneToolsMouseUp",j),a(k).on("CornerstoneToolsMouseClick",j)}c.moveHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x,f.y=g.currentPoints.image.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(m);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:m,measurementData:e};a(m).trigger(i,j)}function j(b){a(m).off("CornerstoneToolsMouseMove"),a(m).off("CornerstoneToolsMouseDrag"),a(m).on("CornerstoneToolsMouseMove",i),a(m).on("CornerstoneToolsMouseDrag",i),a(m).on("CornerstoneToolsMouseClick",l),"CornerstoneToolsMouseDrag"===b.type&&a(m).on("CornerstoneToolsMouseUp",l)}function k(a,b){b.measurementData===e&&l()}function l(){a(m).off("CornerstoneToolsMouseMove",i),a(m).off("CornerstoneToolsMouseDrag",i),a(m).off("CornerstoneToolsMouseClick",l),a(m).off("CornerstoneToolsMouseUp",l),a(m).off("CornerstoneToolsMeasurementRemoved",k),f.active=!1,b.updateImage(m),"function"==typeof g&&g()}var m=c.element;a(m).on("CornerstoneToolsMouseDrag",j),a(m).on("CornerstoneToolsMouseMove",j),a(m).on("CornerstoneToolsMeasurementRemoved",k)}c.moveNewHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g,h){function i(c,g){f.active=!0,f.x=g.currentPoints.image.x+m.x,f.y=g.currentPoints.image.y+m.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,g.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,g.image.height)),b.updateImage(k);var i="CornerstoneToolsMeasurementModified",j={toolType:d,element:k,measurementData:e};a(k).trigger(i,j)}function j(c,d){return a(k).off("CornerstoneToolsTouchDrag",i),a(k).off("CornerstoneToolsTouchPinch",j),a(k).off("CornerstoneToolsTouchPress",j),a(k).off("CornerstoneToolsTouchEnd",j),a(k).off("CornerstoneToolsDragEnd",j),a(k).off("CornerstoneToolsTap",j),"CornerstoneToolsTouchPinch"===c.type||"CornerstoneToolsTouchPress"===c.type?(f.active=!1,b.updateImage(k),void g()):(f.active=!1,f.x=d.currentPoints.image.x+m.x,f.y=d.currentPoints.image.y+m.y,h&&(f.x=Math.max(f.x,0),f.x=Math.min(f.x,d.image.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,d.image.height)),b.updateImage(k),void("function"==typeof g&&g()))}var k=c.element,l=b.pageToPixel(k,c.currentPoints.page.x,c.currentPoints.page.y+50),m={x:f.x-l.x,y:f.y-l.y};a(k).on("CornerstoneToolsTouchDrag",i),a(k).on("CornerstoneToolsTouchPinch",j),a(k).on("CornerstoneToolsTouchPress",j),a(k).on("CornerstoneToolsTouchEnd",j),a(k).on("CornerstoneToolsDragEnd",j),a(k).on("CornerstoneToolsTap",j)}c.moveNewHandleTouch=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g,h,i){function j(c,d){e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.movesIndependently!==!0&&(b.x+=d.deltaPoints.image.x,b.y+=d.deltaPoints.image.y)}),b.updateImage(l);var f="CornerstoneToolsMeasurementModified",h={toolType:g,element:l,measurementData:e};return a(l).trigger(f,h),!1}function k(d,g){if(e.active=!1,e.invalidated=!1,a(l).off("CornerstoneToolsTouchDrag",j),a(l).off("CornerstoneToolsTouchPinch",k),a(l).off("CornerstoneToolsTouchPress",k),a(l).off("CornerstoneToolsTouchEnd",k),a(l).off("CornerstoneToolsDragEnd",k),a(l).off("CornerstoneToolsTap",k),h===!0){var m=g.image,n=!1,o={top:0,left:0,width:m.width,height:m.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];if(c.point.insideRect(b,o)===!1)return void(n=!0)}),n){for(var p=-1,q=0;q<f.data.length;q++)f.data[q]===e&&(p=q);p!==-1&&f.data.splice(p,1)}}"function"==typeof i&&i(),b.updateImage(l)}var l=d.element;return a(l).on("CornerstoneToolsTouchDrag",j),a(l).on("CornerstoneToolsTouchPinch",k),a(l).on("CornerstoneToolsTouchPress",k),a(l).on("CornerstoneToolsTouchEnd",k),a(l).on("CornerstoneToolsDragEnd",k),a(l).on("CornerstoneToolsTap",k),!0}d.touchMoveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f,g){function h(c,g){f.active=!0;var h=g;f.x=h.currentPoints.image.x+k.x,f.y=h.currentPoints.image.y+k.y,b.updateImage(j);var i="CornerstoneToolsMeasurementModified",l={toolType:d,element:j,measurementData:e};a(j).trigger(i,l)}function i(){f.active=!1,a(j).off("CornerstoneToolsTouchDrag",h),a(j).off("CornerstoneToolsTouchPinch",i),a(j).off("CornerstoneToolsTouchEnd",i),a(j).off("CornerstoneToolsDragEnd",i),a(j).off("CornerstoneToolsTap",i),b.updateImage(j),"function"==typeof g&&g()}var j=c.element,k={x:f.x-c.currentPoints.image.x,y:f.y-c.currentPoints.image.y};a(j).on("CornerstoneToolsTouchDrag",h),a(j).on("CornerstoneToolsTouchPinch",i),a(j).on("CornerstoneToolsTouchEnd",i),a(j).on("CornerstoneToolsDragEnd",i),a(j).on("CornerstoneToolsTap",i)}c.touchMoveHandle=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.samples=[],this.set=function(c){b.samples=c,a(b).trigger("CornerstoneLineSampleUpdated")}}b.LineSampleMeasurement=c}($,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.measurements=[],this.add=function(c){var d=b.measurements.push(c),e={index:d,measurement:c};a(b).trigger("CornerstoneMeasurementAdded",e)},this.remove=function(c){var d=b.measurements[c];b.measurements.splice(c,1);var e={index:c,measurement:d};a(b).trigger("CornerstoneMeasurementRemoved",e)}}b.MeasurementManager=new c}($,cornerstoneTools),function(a,b,c){"use strict";function d(a){g.push(a)}function e(a){var b=g.indexOf(a);b!==-1&&g.splice(b,1)}function f(b,c){var d;return a.each(g,function(a,e){if(d=e(b,c),void 0!==d)return!0}),d}var g=[];c.metaData={addProvider:d,removeProvider:e,get:f}}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b){for(var c="",d=b.x<0?"R":"L",e=b.y<0?"A":"P",f=b.z<0?"F":"H",g=new a.Vector3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z)),h=0;h<3;h++)if(g.x>1e-4&&g.x>g.y&&g.x>g.z)c+=d,g.x=0;else if(g.y>1e-4&&g.y>g.x&&g.y>g.z)c+=e,g.y=0;else{if(!(g.z>1e-4&&g.z>g.x&&g.z>g.y))break;c+=f,g.z=0}return c}b.orientation.getOrientationString=c}(cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a){var b=a.replace("H","f");return b=b.replace("F","h"),b=b.replace("R","l"),b=b.replace("L","r"),b=b.replace("A","p"),b=b.replace("P","a"),b=b.toUpperCase()}a.orientation.invertOrientationString=b}(cornerstoneTools),function(a){"use strict";function b(b,c){var d=a.planePlaneIntersection(b,c);if(d)return{start:a.projectPatientPointToImagePlane(d.start,b),end:a.projectPatientPointToImagePlane(d.end,b)}}a.referenceLines.calculateReferenceLine=b}(cornerstoneTools),function(a,b,c){"use strict";function d(d,e){var f=c.getToolState(d.currentTarget,g);if(void 0!==f){var h=f.data[0].synchronizationContext,i=h.getSourceElements(),j=f.data[0].renderer,k=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,k),a.each(i,function(a,b){b!==d.currentTarget&&j(k,e,d.currentTarget,b)})}}function e(e,f,h){h=h||c.referenceLines.renderActiveReferenceLine,c.addToolState(e,g,{synchronizationContext:f,renderer:h}),a(e).on("CornerstoneImageRendered",d),b.updateImage(e)}function f(c){a(c).off("CornerstoneImageRendered",d),b.updateImage(c)}var g="referenceLines";c.referenceLines.tool={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){var g=b.getEnabledElement(e).image,h=b.getEnabledElement(f).image;if(g&&h){if(_&&dvStruct&&_.isObject(dvStruct)){var i=dvStruct.viewer.getCheckedWin();if(i){if(dvStruct.viewer.isInWin(e,i)||!dvStruct.viewer.isInWin(f,i))return;if(dvStruct.viewer.isInSameWin(e,f))return}}var j=c.metaData.get("imagePlane",g.imageId),k=c.metaData.get("imagePlane",h.imageId);if(j&&k){var l=j.rowCosines.clone().cross(j.columnCosines),m=k.rowCosines.clone().cross(k.columnCosines),n=l.angleTo(m);if(n=Math.abs(n),!(n<.5)){var o=c.referenceLines.calculateReferenceLine(j,k);if(!o){var p=getObj(j),q=getObj(k);if(o=xloc.LocalCalc(p,q),!o)return}var r=b.pixelToCanvas(d.element,o.start),s=b.pixelToCanvas(d.element,o.end),t=c.toolColors.getActiveColor(),u=c.toolStyle.getToolWidth();if(a.setTransform(1,0,0,1,0,0),i){var v=dvStruct.findSeriesByElement(f);if(v){for(var w=[],x=0;x<v.sideImageIds.length;x++){var y=v.sideImageIds[x].farsideImageId,z=v.sideImageIds[x].nearsideImageId,A=c.metaData.get("imagePlane",y),B=A.rowCosines.clone().cross(A.columnCosines),n=m.angleTo(B);if(n=Math.abs(n),n<.1){w.push(y),w.push(z);break}}if(w.length>0)for(var x=0;x<w.length;x++){var C=c.metaData.get("imagePlane",w[x]);if(C){var D=C.rowCosines.clone().cross(C.columnCosines),n=l.angleTo(D);if(n=Math.abs(n),!(n<.5)){var E=c.referenceLines.calculateReferenceLine(j,C);if(E){var F=b.pixelToCanvas(d.element,E.start),G=b.pixelToCanvas(d.element,E.end);a.save(),a.beginPath(),a.strokeStyle="#FF4600",a.lineWidth=u,a.moveTo(F.x,F.y),a.lineTo(G.x,G.y),a.stroke(),a.restore()}}}}}}a.save(),a.beginPath(),a.strokeStyle=t,a.lineWidth=u,a.moveTo(r.x,r.y),a.lineTo(s.x,s.y),a.stroke(),a.restore()}}}}c.referenceLines.renderActiveReferenceLine=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function c(b,c,f,g,h,i){if(!e.hasOwnProperty(f))throw"Request type must be one of interaction, thumbnail, or prefetch";
if(b&&c){var j={type:f,imageId:c,preventCache:g,doneCallback:h,failCallback:i},k=a.imageCache.getImagePromise(c);if(k)return void k.then(function(a){h(a)},function(a){i(a)});e[f].push(j),"interaction"===f&&(d=b)}}function j(a){if(!e.hasOwnProperty(a))throw"Request type must be one of interaction, thumbnail, or prefetch";e[a]=[]}function k(){h&&setTimeout(function(){var a=n();a&&l(a)},i)}function l(b){var c=b.type;f[c]++,h=!0;var d=b.imageId,e=b.doneCallback,g=b.failCallback,i=a.imageCache.getImagePromise(d);if(i)return void i.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a)});var j;j=b.preventCache===!0?a.loadImage(d):a.loadAndCacheImage(d),j.then(function(a){f[c]--,e(a),k()},function(a){f[c]--,g(a)})}function m(){if(!h){var a=b.getMaxSimultaneousRequests();g={interaction:a,thumbnail:a-2,prefetch:a-1};for(var c=0;c<a;c++){var d=n();d&&l(d)}}}function n(){return e.interaction.length&&f.interaction<g.interaction?e.interaction.shift():e.thumbnail.length&&f.thumbnail<g.thumbnail?e.thumbnail.shift():e.prefetch.length&&f.prefetch<g.prefetch?e.prefetch.shift():(e.interaction.length||e.thumbnail.length||e.prefetch.length||(h=!1),!1)}function o(){return e}var p={addRequest:c,clearRequestStack:j,startGrabbing:m,getRequestPool:o};return p}var d,e={interaction:[],thumbnail:[],prefetch:[]},f={interaction:0,thumbnail:0,prefetch:0},g={interaction:6,thumbnail:6,prefetch:5},h=!1,i=20;b.requestPoolManager=c()}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){if(void 0===d)throw"playClip: element must not be undefined";void 0===e&&(e=30);var g=c.getToolState(d,"stack");if(void 0!==g&&void 0!==g.data&&0!==g.data.length){var h,i=g.data[0],j=c.getToolState(d,f);void 0===j||0===j.data.length?(h={intervalId:void 0,framesPerSecond:e,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},c.addToolState(d,f,h)):(h=j.data[0],h.framesPerSecond=e),void 0===h.intervalId&&(h.intervalId=setInterval(function(){var e=i.currentImageIdIndex;if(h.framesPerSecond>0?e++:e--,!h.loop&&(e>=i.imageIds.length||e<0)){var f={element:d},g=a.Event("CornerstoneToolsClipStopped",f);return a(d).trigger(g,f),clearInterval(h.intervalId),void(h.intervalId=void 0)}if(e>=i.imageIds.length&&(e=0),e<0&&(e=i.imageIds.length-1),e!==i.currentImageIdIndex){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(d);var m,n=b.getViewport(d);m=i.preventCache===!0?b.loadImage(i.imageIds[e]):b.loadAndCacheImage(i.imageIds[e]),m.then(function(a){i.currentImageIdIndex=e,b.displayImage(d,a,n),k&&k(d)},function(a){var b=i.imageIds[e];l&&l(d,b,a)})}},1e3/Math.abs(h.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="playClip";c.playClip=d,c.stopClip=e}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var d=b.element,f=b.enabledElement.canvas.width,g=b.enabledElement.canvas.height;if(!f||!g)return!1;var h=b.enabledElement.canvas.getContext("2d");h.setTransform(1,0,0,1,0,0),h.save();var i=c.scrollIndicator.getConfiguration();h.fillStyle=i.backgroundColor,h.fillRect(0,g-e,f,e);var j=c.getToolState(d,"stack");if(j&&j.data&&j.data.length){var k=j.data[0].imageIds,l=j.data[0].currentImageIdIndex,m=f/k.length,n=m*l;h.fillStyle=i.fillColor,h.fillRect(n,g-e,m,e),h.restore()}}var e=6,f={backgroundColor:"rgb(19, 63, 141)",fillColor:"white"};c.scrollIndicator=c.displayTool(d),c.scrollIndicator.setConfiguration(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){return a-b}function e(a,b){a=Math.round(a)||0,b=Math.round(b)||0;var c=[],d=b-a+1;if(d<=0)return c;for(;d--;)c[d]=b--;return c}function f(a,b){var c=[],d=[];return a.forEach(function(a){a<b?c.push(a):a>b&&d.push(a)}),{low:a.indexOf(t(c)),high:a.indexOf(u(d))}}function g(a){function e(a){var b=l.indicesToRequest.indexOf(a);b>-1&&l.indicesToRequest.splice(b,1)}function g(a){var b=j.imageIds.indexOf(a.imageId);e(b)}function h(a){console.log("prefetch errored: "+a)}var i=c.getToolState(a,"stack");if(i&&i.data&&i.data.length){var j=i.data[0],k=c.getToolState(a,q);if(k){var l=k.data[0];if(l&&l.indicesToRequest&&l.indicesToRequest.length||(l.enabled=!1),l.enabled!==!1){k.data[0].indicesToRequest.sort(d);var m=l.indicesToRequest.slice();if(m.forEach(function(a){var c=j.imageIds[a];if(c){var d=b.imageCache.getImagePromise(c);d&&"resolved"===d.state()&&e(a)}}),l.indicesToRequest.length){var n=c.requestPoolManager;n.clearRequestStack(r);for(var o,p,s=f(l.indicesToRequest,j.currentImageIdIndex),t=!1,u=s.low,v=s.high;u>0||v<l.indicesToRequest.length;)u>=0&&(p=l.indicesToRequest[u--],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h)),v<l.indicesToRequest.length&&(p=l.indicesToRequest[v++],o=j.imageIds[p],n.addRequest(a,o,r,t,g,h));n.startGrabbing()}}}}}function h(a){var b=a.data.element,d=c.getToolState(b,q);d&&d.data&&d.data.length&&c.requestPoolManager.clearRequestStack(r)}function i(a,b){var d=a.data.element,e=c.getToolState(d,"stack");if(e&&e.data&&e.data.length){var f=e.data[0],g=f.imageIds.indexOf(b.imageId);if(!(g<0)){var h=c.getToolState(d,q);h&&h.data&&h.data.length&&h.data[0].indicesToRequest.push(g)}}}function j(a){clearTimeout(o),o=setTimeout(function(){var b=a.currentTarget;g(b)},p)}function k(d){var f=c.getToolState(d,q);f.data=[];var k=c.getToolState(d,"stack");if(k&&k.data&&k.data.length){var l=k.data[0];if(l.preventCache===!0)return void console.warn("A stack that should not be cached was given the stackPrefetch");var m={indicesToRequest:e(0,l.imageIds.length-1),enabled:!0,direction:1},n=m.indicesToRequest.indexOf(l.currentImageIdIndex);m.indicesToRequest.splice(n,1),c.addToolState(d,q,m),g(d),a(d).off("CornerstoneNewImage",j),a(d).on("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).on("CornerstoneImageCacheFull",{element:d},h),a(b).off("CornerstoneImageCachePromiseRemoved",i),a(b).on("CornerstoneImageCachePromiseRemoved",{element:d},i)}}function l(d){clearTimeout(o),a(d).off("CornerstoneNewImage",j),a(b).off("CornerstoneImageCacheFull",h),a(b).off("CornerstoneImageCachePromiseRemoved",i);var e=c.getToolState(d,q);e&&e.data.length&&(e.data[0].enabled=!1,c.requestPoolManager.clearRequestStack(r))}function m(){return s}function n(a){s=a}var o,p,q="stackPrefetch",r="prefetch",s={},t=function(a){return Math.max.apply(null,a)},u=function(a){return Math.min.apply(null,a)};c.stackPrefetch={enable:k,disable:l,getConfiguration:m,setConfiguration:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var f={deltaY:0};return a(e.element).on("CornerstoneToolsMouseDrag",f,g),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(a,b){var d=-b.direction;c.scroll(b.element,d)}function g(b,d){var e=d.element,f=c.getToolState(e,"stack");if(f&&f.data&&f.data.length){var g=f.data[0],h=c.stackScroll.getConfiguration(),i=a(e).height()/Math.max(g.imageIds.length,8);if(h&&h.stackScrollSpeed&&(i=h.stackScrollSpeed),b.data.deltaY=b.data.deltaY||0,b.data.deltaY+=d.deltaPoints.page.y,Math.abs(b.data.deltaY)>=i){var j=b.data.deltaY/i,k=Math.round(j),l=b.data.deltaY%i;b.data.deltaY=l,c.scroll(e,k)}return!1}}c.stackScroll=c.simpleMouseButtonTool(e),c.stackScrollWheel=c.mouseWheelTool(f);var h={eventData:{deltaY:0}};c.stackScrollTouchDrag=c.touchDragTool(g,h)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(b,d){var e=d.keyCode;if(e===c.UP||e===c.DOWN){var f=1;e===c.DOWN&&(f=-1),a.scroll(d.element,f)}}var c={UP:38,DOWN:40};a.stackScrollKeyboard=a.keyboardTool(b)}(cornerstoneTools),function(a,b,c){"use strict";function d(a){var d={imageIdToolState:c.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return a.forEach(function(a){var e=c.getElementToolStateManager(a);e!==c.globalImageIdSpecificToolStateManager&&(d.elementToolState[a.id]=e.saveToolState(),d.elementViewport[a.id]=b.getViewport(a))}),d}function e(a){if(a.hasOwnProperty("imageIdToolState")&&a.hasOwnProperty("elementToolState")&&a.hasOwnProperty("elementViewport"))return c.globalImageIdSpecificToolStateManager.restoreToolState(a.imageIdToolState),Object.keys(a.elementViewport).forEach(function(d){var e=document.getElementById(d);if(e&&a.elementToolState.hasOwnProperty(d)){var f=c.getElementToolStateManager(e);if(f!==c.globalImageIdSpecificToolStateManager){f.restoreToolState(a.elementToolState[d]);var g=a.elementViewport[d];b.setViewport(e,g),b.updateImage(e)}}}),a}c.appState={save:d,restore:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(){function a(a,b,c){d.hasOwnProperty(a)===!1&&(d[a]={});var e=d[a];e.hasOwnProperty(b)===!1&&(e[b]={data:[]});var f=e[b];f.data.push(c)}function b(a,b){if(d.hasOwnProperty(a)!==!1){var c=d[a];if(c.hasOwnProperty(b)!==!1){var e=c[b];return e}}}function c(a,b,c){if(d.hasOwnProperty(a)!==!1){var e=d[a];if(e.hasOwnProperty(b)!==!1){for(var f=e[b],g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);g!==-1&&f.data.splice(g,1)}}}var d={},e={get:b,add:a,remove:c};return e}var e=d();c.newFrameOfReferenceSpecificToolStateManager=d,c.globalFrameOfReferenceSpecificToolStateManager=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function b(a){return i[a]}function c(a,b){i[a]=b}function d(){return i}function e(a){i=a}function f(b,c,d){var e=a.getEnabledElement(b);e.image&&i.hasOwnProperty(e.image.imageId)!==!1||(i[e.image.imageId]={});var f=i[e.image.imageId];f.hasOwnProperty(c)===!1&&(f[c]={data:[]});var g=f[c];g.data.push(d)}function g(b,c){var d=a.getEnabledElement(b);if(d.image&&i.hasOwnProperty(d.image.imageId)!==!1){var e=i[d.image.imageId];if(e.hasOwnProperty(c)!==!1){var f=e[c];return f}}}function h(b){var c=a.getEnabledElement(b);c.image&&i.hasOwnProperty(c.image.imageId)!==!1&&delete i[c.image.imageId]}var i={},j={get:g,add:f,clear:h,saveImageIdToolState:b,restoreImageIdToolState:c,saveToolState:d,restoreToolState:e,toolState:i};return j}var d=c();b.newImageIdSpecificToolStateManager=c,b.globalImageIdSpecificToolStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){g=a}function b(){return g}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}var g,h,i,j={setStartLoadHandler:a,getStartLoadHandler:b,setEndLoadHandler:c,getEndLoadHandler:d,setErrorLoadingHandler:e,getErrorLoadingHandler:f};return j}a.loadHandlerManager=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(){return g}function d(a){g=a}function e(c,d,e){if(!(a.indexOf(d)>=0))return b.add(c,d,e);g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var f=g[d];f.data.push(e)}function f(c,d){if(a.indexOf(d)>=0){g.hasOwnProperty(d)===!1&&(g[d]={data:[]});var e=g[d];return e}return b.get(c,d)}var g={},h={get:f,add:e,saveToolState:c,restoreToolState:d,toolState:g};return h}function d(a){var c=b.getElementToolStateManager(a);c||(c=b.globalImageIdSpecificToolStateManager);var d=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"],f=b.newStackSpecificToolStateManager(d,c);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newStackSpecificToolStateManager=c,b.addStackStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){h=a}function b(){return h}function c(a){g=a}function d(){return g}function e(a){i=a}function f(){return i}var g=15,h=g+"px Arial",i="transparent",j={setFont:a,getFont:b,setFontSize:c,getFontSize:d,setBackgroundColor:e,getBackgroundColor:f};return j}a.textStyle=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(c,d,f){if(!(a.indexOf(d)>=0))return b.add(c,d,f);e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var g=e[d];g.data.push(f)}function d(c,d){if(a.indexOf(d)>=0){e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var f=e[d];return f}return b.get(c,d)}var e={},f={get:d,add:c};return f}function d(a,c){c=c||["timeSeries"];var d=b.getElementToolStateManager(a);void 0===d&&(d=b.globalImageIdSpecificToolStateManager);var f=b.newTimeSeriesSpecificToolStateManager(c,d);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newTimeSeriesSpecificToolStateManager=c,b.addTimeSeriesStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){j=a}function b(){return j}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}function g(a){return a?i:h}var h="greenyellow",i="#E3A000",j="transparent",k={setFillColor:a,getFillColor:b,setToolColor:c,getToolColor:d,setActiveColor:e,getActiveColor:f,getColorIfActive:g};return k}a.toolColors=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a.currentPoints.canvas}function b(){return c}var c="",d={setCoords:a,getCoords:b};return d}a.toolCoordinates=b()}(cornerstoneTools),function(a,b){"use strict";function c(c){var d=a.getEnabledElement(c);return void 0===d.toolStateManager&&(d.toolStateManager=b.globalImageIdSpecificToolStateManager),d.toolStateManager}function d(a,b,d){var e=c(a);e.add(a,b,d);var f="CornerstoneToolsMeasurementAdded",g={toolType:b,element:a,measurementData:d};$(a).trigger(f,g)}function e(a,b){var d=c(a);return d.get(a,b)}function f(a,b,d){for(var e=c(a),f=e.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===d&&(g=h);if(g!==-1){f.data.splice(g,1);var i="CornerstoneToolsMeasurementRemoved",j={toolType:b,element:a,measurementData:d};$(a).trigger(i,j)}}function g(a,b){var d=c(a),e=d.get(a,b);void 0!==e&&(e.data=[])}function h(b,c){var d=a.getEnabledElement(b);d.toolStateManager=c}function i(a,b){var d=c(a);d.get(a,b);console.log(d)}b.addToolState=d,b.getToolState=e,b.removeToolState=f,b.clearToolState=g,b.setElementToolStateManager=h,b.getElementToolStateManager=c,b.delLastMeasurement=i}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){e=a}function b(){return e}function c(a){f=a}function d(){return f}var e=1,f=2,g={setToolWidth:a,getToolWidth:b,setActiveWidth:c,getActiveWidth:d};return g}a.toolStyle=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a}function b(){return c}var c={x:0,y:-55},d={setToolDistanceFromTouch:a,getToolDistanceFromTouch:b};return d}a.touchSettings=b()}(cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.scale===e.scale&&f.translation.x===e.translation.x&&f.translation.y===e.translation.y||(f.scale=e.scale,f.translation.x=e.translation.x,f.translation.y=e.translation.y,a.setViewport(d,f))}}c.panZoomSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){if(e!==d){var f=c.getToolState(d,"stack"),g=f.data[0],h=c.getToolState(e,"stack"),i=h.data[0],j=g.currentImageIdIndex;if(j=Math.min(Math.max(j,0),i.imageIds.length-1),j!==i.currentImageIdIndex){var k=c.loadHandlerManager.getStartLoadHandler(),l=c.loadHandlerManager.getEndLoadHandler(),m=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e);var n;n=i.preventCache===!0?b.loadImage(i.imageIds[j]):b.loadAndCacheImage(i.imageIds[j]),n.then(function(c){var d=b.getViewport(e);i.currentImageIdIndex=j,a.displayImage(e,c,d),l&&l(e)},function(a){var b=i.imageIds[j];m&&m(e,b,a)})}}}c.stackImageIndexSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f,g){if(e!==d){var h=b.getEnabledElement(d),i=c.metaData.get("imagePlane",h.image.imageId),j=i.imagePositionPatient,k=c.getToolState(e,"stack"),l=k.data[0],m=Number.MAX_VALUE,n=-1;if(g){var o=j.clone().add(g);if(l.imageIds.forEach(function(a,b){var d=c.metaData.get("imagePlane",a),e=d.imagePositionPatient,f=o.distanceToSquared(e);f<m&&(m=f,n=b)}),n!==l.currentImageIdIndex&&n!==-1){var p=c.loadHandlerManager.getStartLoadHandler(),q=c.loadHandlerManager.getEndLoadHandler(),r=c.loadHandlerManager.getErrorLoadingHandler();p&&p(e);var s;s=l.preventCache===!0?b.loadImage(l.imageIds[n]):b.loadAndCacheImage(l.imageIds[n]),s.then(function(c){var d=b.getViewport(e);l.currentImageIdIndex=n,a.displayImage(e,c,d),q&&q(e)},function(a){var b=l.imageIds[n];r&&r(e,b,a)})}}}}c.stackImagePositionOffsetSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e,f){if(f!==e){var g=b.getEnabledElement(e).image,h=c.metaData.get("imagePlane",g.imageId),i=h.imagePositionPatient,j=c.getToolState(f,"stack"),k=j.data[0],l=Number.MAX_VALUE,m=-1;if(a.each(k.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,f=e.distanceToSquared(i);f<l&&(l=f,m=a)}),m!==k.currentImageIdIndex){var n=c.loadHandlerManager.getStartLoadHandler(),o=c.loadHandlerManager.getEndLoadHandler(),p=c.loadHandlerManager.getErrorLoadingHandler();if(n&&n(f),m!==-1){var q;q=k.preventCache===!0?b.loadImage(k.imageIds[m]):b.loadAndCacheImage(k.imageIds[m]),q.then(function(a){var c=b.getViewport(f);k.currentImageIdIndex=m,d.displayImage(f,a,c),o&&o(f)},function(a){var b=k.imageIds[m];p&&p(f,b,a)})}}}}c.stackImagePositionSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){if(d!==e&&f&&f.direction){var g=c.getToolState(e,"stack"),h=g.data[0],i=h.currentImageIdIndex+f.direction;if(i=Math.min(Math.max(i,0),h.imageIds.length-1),h.currentImageIdIndex!==i){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(e);var m;m=h.preventCache===!0?b.loadImage(h.imageIds[i]):b.loadAndCacheImage(h.imageIds[i]),m.then(function(c){var d=b.getViewport(e);h.currentImageIdIndex=i,a.displayImage(e,c,d),k&&k(e)},function(a){var b=h.imageIds[i];l&&l(e,b,a)})}}}c.stackScrollSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){function f(a,b){j.length&&k.length&&(l=!0,k.forEach(function(c){var d=k.indexOf(c);if(d!==-1){var e=m.imageIds.targetElements[d],f=j.indexOf(a);if(f!==-1){var g,h=m.imageIds.sourceElements[f];g=h===e?0:m.distances[h][e],n(i,a,c,b,g)}}}),l=!1)}function g(a,b){l!==!0&&f(a.currentTarget,b)}function h(a,b){var c=b.element;i.remove(c)}var i=this,j=[],k=[],l=!1,m={},n=e;this.setHandler=function(a){n=a},this.getHandler=function(){return n},this.getDistances=function(){j.length&&k.length&&(m.distances={},m.imageIds={sourceElements:[],targetElements:[]},j.forEach(function(a){var d=b.getEnabledElement(a);if(d&&d.image){var e=d.image.imageId,f=c.metaData.get("imagePlane",e);if(f&&f.imagePositionPatient){var g=f.imagePositionPatient;m.hasOwnProperty(d)||(m.distances[e]={},m.imageIds.sourceElements.push(e),k.forEach(function(d){var f=b.getEnabledElement(d);if(f&&f.image){var h=f.image.imageId;if(m.imageIds.targetElements.push(h),a!==d&&e!==h&&!m.distances[e].hasOwnProperty(h)){var i=c.metaData.get("imagePlane",h);if(i&&i.imagePositionPatient){var j=i.imagePositionPatient;m.distances[e][h]=j.clone().sub(g)}}}}),Object.keys(m.distances[e]).length||delete m.distances[e])}}}))},this.addSource=function(b){var c=j.indexOf(b);c===-1&&(j.push(b),a(b).on(d,g),i.getDistances(),i.updateDisableHandlers())},this.addTarget=function(a){var b=k.indexOf(a);b===-1&&(k.push(a),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.add=function(a){i.addSource(a),i.addTarget(a)},this.removeSource=function(b){var c=j.indexOf(b);c!==-1&&(j.splice(c,1),a(b).off(d,g),i.getDistances(),f(b),i.updateDisableHandlers())},this.removeTarget=function(a){var b=k.indexOf(a);b!==-1&&(k.splice(b,1),i.getDistances(),n(i,a,a,0),i.updateDisableHandlers())},this.remove=function(a){i.removeTarget(a),i.removeSource(a)},this.getSourceElements=function(){return j},this.getTargetElements=function(){return k},this.displayImage=function(a,c,d){l=!0,b.displayImage(a,c,d),l=!1},this.setViewport=function(a,c){l=!0,b.setViewport(a,c),l=!1},this.updateDisableHandlers=function(){var b=a.unique(j.concat(k));b.forEach(function(b){a(b).off("CornerstoneElementDisabled",h),a(b).on("CornerstoneElementDisabled",h)})},this.destroy=function(){var b=a.unique(j.concat(k));b.forEach(function(a){i.remove(a)})}}c.Synchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){d!==c&&b.updateImage(d)}c.updateImageSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);f.voi.windowWidth===e.voi.windowWidth&&f.voi.windowCenter===e.voi.windowCenter&&f.invert===e.invert||(f.voi.windowWidth=e.voi.windowWidth,f.voi.windowCenter=e.voi.windowCenter,f.invert=e.invert,a.setViewport(d,f))}}c.wwwcSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=[];a.timeSeries.stacks.forEach(function(d){var e;e=d.preventCache===!0?b.loadImage(d.imageIds[a.imageIdIndex]):b.loadAndCacheImage(d.imageIds[a.imageIdIndex]),e.then(function(b){var d=Math.round(a.handles.end.x)+Math.round(a.handles.end.y)*b.width,e=b.getPixelData()[d];c.push(e)})}),a.lineSample.set(c)}function e(a){var b=c.getToolState(a.element,"timeSeries");if(void 0!==b&&void 0!==b.data&&0!==b.data.length){var e=b.data[0],f={timeSeries:e,lineSample:new c.LineSampleMeasurement,imageIdIndex:e.stacks[e.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return d(f),c.MeasurementManager.add(f),f}}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(void 0!==e){var f=d.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(d.enabledElement,f);for(var h="white",i=0;i<e.data.length;i++){f.save();var j=e.data[i];f.beginPath(),c.drawHandles(f,d,j.handles,h),f.stroke();var k=c.setContextToDisplayFontSize(d.enabledElement,d.canvasContext,15);f.font=""+k.fontSize+"px Arial";var l=Math.round(j.handles.end.x),m=Math.round(j.handles.end.y),n=j.handles.end.x+3,o=j.handles.end.y-3;f.fillStyle=h,f.fillText(""+l+","+m,n,o),f.restore()}}}var g="probe4D";c.probeTool4D=c.mouseButtonTool({createNewMeasurement:e,onImageRendered:f,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){var f=c.getToolState(a,"timeSeries");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0],h=g.stacks[g.currentStackIndex],i=h.currentImageIdIndex,j=g.currentStackIndex+d;if(e?(j>=g.stacks.length&&(j=0),j<0&&(j=g.stacks.length-1)):(j=Math.min(g.stacks.length-1,j),j=Math.max(0,j)),j!==g.currentStackIndex){var k=b.getViewport(a),l=g.stacks[j],m=c.loadHandlerManager.getStartLoadHandler(),n=c.loadHandlerManager.getEndLoadHandler(),o=c.loadHandlerManager.getErrorLoadingHandler();m&&m(a);var p;p=l.preventCache===!0?b.loadImage(l.imageIds[i]):b.loadAndCacheImage(l.imageIds[i]),p.then(function(c){g.currentImageIdIndex!==i&&(l.currentImageIdIndex=i,g.currentStackIndex=j,b.displayImage(a,c,k),n&&n(a))},function(b){var c=l.imageIds[i];o&&o(a,c,b)})}}}c.incrementTimePoint=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){if(void 0===a)throw"playClip: element must not be undefined";void 0===b&&(b=30);var d=c.getToolState(a,"timeSeries");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e,g=c.getToolState(a,f);void 0===g||0===g.data.length?(e={intervalId:void 0,framesPerSecond:b,lastFrameTimeStamp:void 0,frameRate:0},c.addToolState(a,f,e)):(e=g.data[0],e.framesPerSecond=b),void 0===e.intervalId&&(e.intervalId=setInterval(function(){e.framesPerSecond>0?c.incrementTimePoint(a,1,!0):c.incrementTimePoint(a,-1,!0)},1e3/Math.abs(e.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="timeSeriesPlayer";c.timeSeriesPlayer={start:d,stop:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d),a(c.element).off("CornerstoneToolsMouseClick",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var g={deltaY:0,options:b.data.options};return a(e.element).on("CornerstoneToolsMouseDrag",g,f),a(e.element).on("CornerstoneToolsMouseUp",d),a(e.element).on("CornerstoneToolsMouseClick",d),b.stopImmediatePropagation(),!1}}function f(b,d){b.data.deltaY+=d.deltaPoints.page.y;var e=c.getToolState(d.element,"timeSeries");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=a(d.element).height()/f.stacks.length;if(void 0!==b.data.options&&void 0!==b.data.options.timeSeriesScrollSpeed&&(g=b.data.options.timeSeriesScrollSpeed),b.data.deltaY>=g||b.data.deltaY<=-g){var h=Math.round(b.data.deltaY/g),i=b.data.deltaY%g;c.incrementTimePoint(d.element,h),b.data.deltaY=i}return!1}}function g(a,b){var d=-b.direction;c.incrementTimePoint(b.element,d)}function h(a){var b=a.originalEvent.detail,d={deltaY:0};d.deltaY+=b.deltaPoints.page.y;var e=c.getToolState(b.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){if(d.deltaY>=3||d.deltaY<=-3){var f=d.deltaY/3,g=d.deltaY%3;c.setTimePoint(d.element,f),d.deltaY=g}return!1}}c.timeSeriesScroll=c.simpleMouseButtonTool(e),c.timeSeriesScrollWheel=c.mouseWheelTool(g),c.timeSeriesScrollTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){if(void 0!==a.data&&"PT"===a.data.string("x00080060")){var c=b*a.slope+a.intercept,d=a.data.floatString("x00101030");if(void 0!==d){var e=a.data.elements.x00540016;if(void 0!==e){e=e.items[0].dataSet;var f=e.time("x00181072"),g=e.floatString("x00181074"),h=e.floatString("x00181075"),i=a.data.time("x00080032");if(f&&g&&h&&i){var j=i.fractionalSeconds+i.seconds+60*i.minutes+60*i.hours*60,k=f.fractionalSeconds+f.seconds+60*f.minutes+60*f.hours*60,l=j-k,m=g*Math.exp(-l*Math.log(2)/h),n=c*d/m*1e3;return n}}}}}a.calculateSUV=b}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=c.point.copy(a.page),d=c.point.copy(a.image),e=c.point.copy(a.client),f=c.point.copy(a.canvas);return{page:b,image:d,client:e,canvas:f}}d.copyPoints=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=10,g=Math.atan2(c.y-b.y,c.x-b.x);a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.lineTo(c.x-f*Math.cos(g+Math.PI/7),c.y-f*Math.sin(g+Math.PI/7)),a.lineTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.fillStyle=d,a.fill()}a.drawArrow=b}(cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}a.drawEllipse=b}(cornerstoneTools),function(a){"use strict";function b(b,c,d,e,f,g){"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var h=5,i=a.textStyle.getFont(),j=a.textStyle.getFontSize();a.textStyle.getBackgroundColor();b.save(),b.font=i,b.textBaseline="top",b.strokeStyle=f;var k=0;c.forEach(function(a){var c=b.measureText(a).width;k=Math.max(k,c)}),g&&(k=g+10),b.fillStyle="rgba(0,0,0,0.7)";var l={left:d,top:e,width:k+2*h,height:c.length*(j+(h+1))};return b.fillRect(l.left,l.top,l.width,l.height),c.forEach(function(a,c){b.fillStyle=f,b.fillText(a,d+h,e+j*c+h)}),b.restore(),l}a.drawTextBox=b}(cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getLuminance: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=j.image,l=[],m=0,n=k.getPixelData();if(k.color)for(h=0;h<f;h++)for(i=0;i<e;i++){g=4*((h+d)*k.columns+(i+c));var o=n[g],p=n[g+1],q=n[g+2];l[m++]=.2126*o+.7152*p+.0722*q}else for(h=0;h<f;h++)for(i=0;i<e;i++)g=(h+d)*k.columns+(i+c),l[m++]=n[g]*k.slope+k.intercept;return l}b.getLuminance=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!==a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}function d(){var a=b.stackPrefetch.getConfiguration();if(a.maxSimultaneousRequests)return a.maxSimultaneousRequests;var d=c(),f=d.split(" "),g=f[0],h=f[1],i=e[g];return i?i[h]?i[h]:i["default"]:e["default"]}var e={"default":6,IE:{9:6,10:8,"default":8},Firefox:{"default":6},Opera:{10:8,11:6,12:6,"default":6},Chrome:{"default":6},Safari:{"default":4}};b.getMaxSimultaneousRequests=d,b.getBrowserInfo=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d,e,f){if(!b)throw"getRGBPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);var g,h,i,j=a.getEnabledElement(b),k=[],l=0,m=j.image.getPixelData();if(j.image.color)for(h=0;h<f;h++)for(i=0;i<e;i++){g=4*((h+d)*j.image.columns+(i+c));var n=m[g],o=m[g+1],p=m[g+2],q=m[g+3];k[l++]=n,k[l++]=o,k[l++]=p,k[l++]=q}return k}b.getRGBPixels=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,b){var c=1<<a-1;return 0!==(b&c)}b.isMouseButtonEnabled=c}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}c.pauseEvent=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=a.clone().sub(b.imagePositionPatient),d=b.rowCosines.dot(c)/b.columnPixelSpacing,e=b.columnCosines.dot(c)/b.rowPixelSpacing;return{x:d,y:e}}function e(a,b){var c=b.rowCosines.clone().multiplyScalar(a.x);c.multiplyScalar(b.columnPixelSpacing);var d=b.columnCosines.clone().multiplyScalar(a.y);d.multiplyScalar(b.rowPixelSpacing);var e=c.add(d);return e.add(b.imagePositionPatient),e}function f(a){var b=e({x:0,y:0},a),c=e({x:a.columns,y:0},a),d=e({x:0,y:a.rows},a),f=e({x:a.columns,y:a.rows},a),g={top:new cornerstoneMath.Line3(b,c),left:new cornerstoneMath.Line3(b,d),right:new cornerstoneMath.Line3(c,f),bottom:new cornerstoneMath.Line3(d,f)};return g}function g(a,b){var c=[];return Object.keys(b).forEach(function(d){var e=b[d],f=a.intersectLine(e);f&&c.push(f)}),c}function h(a,b){var c=a.rowCosines.clone().cross(a.columnCosines),d=new cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(c,a.imagePositionPatient);var h=b.rowCosines.clone().cross(b.columnCosines),i=new cornerstoneMath.Plane;i.setFromNormalAndCoplanarPoint(h,b.imagePositionPatient);var j=i.clone().intersectPlane(d),k=j.origin,l=j.direction,m=e({x:b.columns,y:b.rows},b),n=b.imagePositionPatient.distanceTo(m),o=new cornerstoneMath.Line3;o.start=k,o.end=k.clone().add(l.multiplyScalar(n));var p=f(b),q=g(o,p);if(2!==q.length)return void console.log(o,p);var r={start:q[0],end:q[1]};return r}c.projectPatientPointToImagePlane=d,c.imagePointToPatientPoint=e,c.planePlaneIntersection=h}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}c.roundToDecimal=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,c){var d=b.getToolState(a,"stack");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e=d.data[0],f=e.currentImageIdIndex+c;f=Math.min(e.imageIds.length-1,f),f=Math.max(0,f),b.scrollToIndex(a,f)}}b.scroll=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(c,d){function e(b){h.currentImageIdIndex===d&&(a.displayImage(c,b,l),
j&&j(c))}function f(a){var b=h.imageIds[d];k&&k(c,b,a)}var g=b.getToolState(c,"stack");if(void 0!==g&&void 0!==g.data&&0!==g.data.length){var h=g.data[0];d<0&&(d+=h.imageIds.length);var i=b.loadHandlerManager.getStartLoadHandler(),j=b.loadHandlerManager.getEndLoadHandler(),k=b.loadHandlerManager.getErrorLoadingHandler(),l=a.getViewport(c);if(d!==h.currentImageIdIndex){i&&i(c);var m={newImageIdIndex:d,direction:d-h.currentImageIdIndex};h.currentImageIdIndex=d;var n=h.imageIds[d],o=b.stackScroll.getConfiguration();if(o&&o.retryLoadOnScroll===!0){var p=a.imageCache.getImagePromise(n);p&&"rejected"===p.state()&&a.imageCache.removeImagePromise(n)}var q=b.requestPoolManager,r="interaction";b.requestPoolManager.clearRequestStack(r);var s=!!h.preventCache;q.addRequest(c,n,r,s,e,f),q.startGrabbing(),$(c).trigger("CornerstoneStackScroll",m)}}}b.scrollToIndex=c,b.loadHandlers={}}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d){var e=.1;a.setToPixelCoordinateSystem(b,c,e);var f=d/b.viewport.scale/e,g=d/b.viewport.scale/e;return{fontSize:f,lineHeight:g,fontScale:e}}b.setContextToDisplayFontSize=c}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d){a.stopImmediatePropagation();var e=(c.panMultiTouch.getConfiguration(),d.viewport.scale*b.diy.iniScaleCal(d));return d.viewport.translation.x+=d.deltaPoints.page.x/e,d.viewport.translation.y+=d.deltaPoints.page.y/e,b.setViewport(d.element,d.viewport),!1}c.touchDragTool=c.touchDragTool(d)}($,cornerstone,cornerstoneTools);var JpxImage=function(){function a(){this.failOnCorruptedImage=!1}function b(a,b){a.x0=Math.ceil(b.XOsiz/a.XRsiz),a.x1=Math.ceil(b.Xsiz/a.XRsiz),a.y0=Math.ceil(b.YOsiz/a.YRsiz),a.y1=Math.ceil(b.Ysiz/a.YRsiz),a.width=a.x1-a.x0,a.height=a.y1-a.y0}function c(a,b){for(var c,d=a.SIZ,e=[],f=Math.ceil((d.Xsiz-d.XTOsiz)/d.XTsiz),g=Math.ceil((d.Ysiz-d.YTOsiz)/d.YTsiz),h=0;g>h;h++)for(var i=0;f>i;i++)c={},c.tx0=Math.max(d.XTOsiz+i*d.XTsiz,d.XOsiz),c.ty0=Math.max(d.YTOsiz+h*d.YTsiz,d.YOsiz),c.tx1=Math.min(d.XTOsiz+(i+1)*d.XTsiz,d.Xsiz),c.ty1=Math.min(d.YTOsiz+(h+1)*d.YTsiz,d.Ysiz),c.width=c.tx1-c.tx0,c.height=c.ty1-c.ty0,c.components=[],e.push(c);a.tiles=e;for(var j=d.Csiz,k=0,l=j;l>k;k++)for(var m=b[k],n=0,o=e.length;o>n;n++){var p={};c=e[n],p.tcx0=Math.ceil(c.tx0/m.XRsiz),p.tcy0=Math.ceil(c.ty0/m.YRsiz),p.tcx1=Math.ceil(c.tx1/m.XRsiz),p.tcy1=Math.ceil(c.ty1/m.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,c.components[k]=p}}function d(a,b,c){var d=b.codingStyleParameters,e={};return d.entropyCoderWithCustomPrecincts?(e.PPx=d.precinctsSizes[c].PPx,e.PPy=d.precinctsSizes[c].PPy):(e.PPx=15,e.PPy=15),e.xcb_=c>0?Math.min(d.xcb,e.PPx-1):Math.min(d.xcb,e.PPx),e.ycb_=c>0?Math.min(d.ycb,e.PPy-1):Math.min(d.ycb,e.PPy),e}function e(a,b,c){var d=1<<c.PPx,e=1<<c.PPy,f=0===b.resLevel,g=1<<c.PPx+(f?0:-1),h=1<<c.PPy+(f?0:-1),i=b.trx1>b.trx0?Math.ceil(b.trx1/d)-Math.floor(b.trx0/d):0,j=b.try1>b.try0?Math.ceil(b.try1/e)-Math.floor(b.try0/e):0,k=i*j;b.precinctParameters={precinctWidth:d,precinctHeight:e,numprecinctswide:i,numprecinctshigh:j,numprecincts:k,precinctWidthInSubband:g,precinctHeightInSubband:h}}function f(a,b,c){var d,e,f,g,h=c.xcb_,i=c.ycb_,j=1<<h,k=1<<i,l=b.tbx0>>h,m=b.tby0>>i,n=b.tbx1+j-1>>h,o=b.tby1+k-1>>i,p=b.resolution.precinctParameters,q=[],r=[];for(e=m;o>e;e++)for(d=l;n>d;d++){f={cbx:d,cby:e,tbx0:j*d,tby0:k*e,tbx1:j*(d+1),tby1:k*(e+1)},f.tbx0_=Math.max(b.tbx0,f.tbx0),f.tby0_=Math.max(b.tby0,f.tby0),f.tbx1_=Math.min(b.tbx1,f.tbx1),f.tby1_=Math.min(b.tby1,f.tby1);var s=Math.floor((f.tbx0_-b.tbx0)/p.precinctWidthInSubband),t=Math.floor((f.tby0_-b.tby0)/p.precinctHeightInSubband);if(g=s+t*p.numprecinctswide,f.precinctNumber=g,f.subbandType=b.type,f.Lblock=3,!(f.tbx1_<=f.tbx0_||f.tby1_<=f.tby0_)){q.push(f);var u=r[g];void 0!==u?(d<u.cbxMin?u.cbxMin=d:d>u.cbxMax&&(u.cbxMax=d),e<u.cbyMin?u.cbxMin=e:e>u.cbyMax&&(u.cbyMax=e)):r[g]=u={cbxMin:d,cbyMin:e,cbxMax:d,cbyMax:e},f.precinct=u}}b.codeblockParameters={codeblockWidth:h,codeblockHeight:i,numcodeblockwide:n-l+1,numcodeblockhigh:o-m+1},b.codeblocks=q,b.precincts=r}function g(a,b,c){for(var d=[],e=a.subbands,f=0,g=e.length;g>f;f++)for(var h=e[f],i=h.codeblocks,j=0,k=i.length;k>j;j++){var l=i[j];l.precinctNumber===b&&d.push(l)}return{layerNumber:c,codeblocks:d}}function h(a){for(var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=0,i=0;f>i;i++)h=Math.max(h,d.components[i].codingStyleParameters.decompositionLevelsCount);var j=0,k=0,l=0,m=0;this.nextPacket=function(){for(;e>j;j++){for(;h>=k;k++){for(;f>l;l++){var a=d.components[l];if(!(k>a.codingStyleParameters.decompositionLevelsCount)){for(var b=a.resolutions[k],c=b.precinctParameters.numprecincts;c>m;){var i=g(b,m,j);return m++,i}m=0}}l=0}k=0}}}function i(a){for(var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=0,i=0;f>i;i++)h=Math.max(h,d.components[i].codingStyleParameters.decompositionLevelsCount);var j=0,k=0,l=0,m=0;this.nextPacket=function(){for(;h>=j;j++){for(;e>k;k++){for(;f>l;l++){var a=d.components[l];if(!(j>a.codingStyleParameters.decompositionLevelsCount)){for(var b=a.resolutions[j],c=b.precinctParameters.numprecincts;c>m;){var i=g(b,m,k);return m++,i}m=0}}l=0}k=0}}}function j(a){var b,c,d,e,f=a.SIZ,h=a.currentTile.index,i=a.tiles[h],j=i.codingStyleDefaultParameters.layersCount,k=f.Csiz,l=0;for(d=0;k>d;d++){var m=i.components[d];l=Math.max(l,m.codingStyleParameters.decompositionLevelsCount)}var n=new Int32Array(l+1);for(c=0;l>=c;++c){var o=0;for(d=0;k>d;++d){var p=i.components[d].resolutions;c<p.length&&(o=Math.max(o,p[c].precinctParameters.numprecincts))}n[c]=o}b=0,c=0,d=0,e=0,this.nextPacket=function(){for(;l>=c;c++){for(;e<n[c];e++){for(;k>d;d++){var a=i.components[d];if(!(c>a.codingStyleParameters.decompositionLevelsCount)){var f=a.resolutions[c],h=f.precinctParameters.numprecincts;if(!(e>=h)){for(;j>b;){var m=g(f,e,b);return b++,m}b=0}}}d=0}e=0}}}function k(a){var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=n(d),i=h,j=0,k=0,l=0,o=0,p=0;this.nextPacket=function(){for(;p<i.maxNumHigh;p++){for(;o<i.maxNumWide;o++){for(;f>l;l++){for(var a=d.components[l],b=a.codingStyleParameters.decompositionLevelsCount;b>=k;k++){var c=a.resolutions[k],n=h.components[l].resolutions[k],q=m(o,p,n,i,c);if(null!==q){for(;e>j;){var r=g(c,q,j);return j++,r}j=0}}k=0}l=0}o=0}}}function l(a){var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=n(d),i=0,j=0,k=0,l=0,o=0;this.nextPacket=function(){for(;f>k;++k){for(var a=d.components[k],b=h.components[k],c=a.codingStyleParameters.decompositionLevelsCount;o<b.maxNumHigh;o++){for(;l<b.maxNumWide;l++){for(;c>=j;j++){var n=a.resolutions[j],p=b.resolutions[j],q=m(l,o,p,b,n);if(null!==q){for(;e>i;){var r=g(n,q,i);return i++,r}i=0}}j=0}l=0}o=0}}}function m(a,b,c,d,e){var f=a*d.minWidth,g=b*d.minHeight;if(f%c.width!==0||g%c.height!==0)return null;var h=g/c.width*e.precinctParameters.numprecinctswide;return f/c.height+h}function n(a){for(var b=a.components.length,c=Number.MAX_VALUE,d=Number.MAX_VALUE,e=0,f=0,g=new Array(b),h=0;b>h;h++){for(var i=a.components[h],j=i.codingStyleParameters.decompositionLevelsCount,k=new Array(j+1),l=Number.MAX_VALUE,m=Number.MAX_VALUE,n=0,o=0,p=1,q=j;q>=0;--q){var r=i.resolutions[q],s=p*r.precinctParameters.precinctWidth,t=p*r.precinctParameters.precinctHeight;l=Math.min(l,s),m=Math.min(m,t),n=Math.max(n,r.precinctParameters.numprecinctswide),o=Math.max(o,r.precinctParameters.numprecinctshigh),k[q]={width:s,height:t},p<<=1}c=Math.min(c,l),d=Math.min(d,m),e=Math.max(e,n),f=Math.max(f,o),g[h]={resolutions:k,minWidth:l,minHeight:m,maxNumWide:n,maxNumHigh:o}}return{components:g,minWidth:c,minHeight:d,maxNumWide:e,maxNumHigh:f}}function o(a){for(var b=a.SIZ,c=a.currentTile.index,g=a.tiles[c],m=b.Csiz,n=0;m>n;n++){for(var o=g.components[n],p=o.codingStyleParameters.decompositionLevelsCount,q=[],r=[],s=0;p>=s;s++){var t=d(a,o,s),u={},v=1<<p-s;u.trx0=Math.ceil(o.tcx0/v),u.try0=Math.ceil(o.tcy0/v),u.trx1=Math.ceil(o.tcx1/v),u.try1=Math.ceil(o.tcy1/v),u.resLevel=s,e(a,u,t),q.push(u);var w;if(0===s)w={},w.type="LL",w.tbx0=Math.ceil(o.tcx0/v),w.tby0=Math.ceil(o.tcy0/v),w.tbx1=Math.ceil(o.tcx1/v),w.tby1=Math.ceil(o.tcy1/v),w.resolution=u,f(a,w,t),r.push(w),u.subbands=[w];else{var x=1<<p-s+1,y=[];w={},w.type="HL",w.tbx0=Math.ceil(o.tcx0/x-.5),w.tby0=Math.ceil(o.tcy0/x),w.tbx1=Math.ceil(o.tcx1/x-.5),w.tby1=Math.ceil(o.tcy1/x),w.resolution=u,f(a,w,t),r.push(w),y.push(w),w={},w.type="LH",w.tbx0=Math.ceil(o.tcx0/x),w.tby0=Math.ceil(o.tcy0/x-.5),w.tbx1=Math.ceil(o.tcx1/x),w.tby1=Math.ceil(o.tcy1/x-.5),w.resolution=u,f(a,w,t),r.push(w),y.push(w),w={},w.type="HH",w.tbx0=Math.ceil(o.tcx0/x-.5),w.tby0=Math.ceil(o.tcy0/x-.5),w.tbx1=Math.ceil(o.tcx1/x-.5),w.tby1=Math.ceil(o.tcy1/x-.5),w.resolution=u,f(a,w,t),r.push(w),y.push(w),u.subbands=y}}o.resolutions=q,o.subbands=r}var z=g.codingStyleDefaultParameters.progressionOrder;switch(z){case 0:g.packetsIterator=new h(a);break;case 1:g.packetsIterator=new i(a);break;case 2:g.packetsIterator=new j(a);break;case 3:g.packetsIterator=new k(a);break;case 4:g.packetsIterator=new l(a);break;default:throw new Error("JPX Error: Unsupported progression order "+z)}}function p(a,b,c,d){function e(a){for(;a>l;){if(c+k>=b.length)throw new Error("Unexpected EOF");var d=b[c+k];k++,m?(j=j<<7|d,l+=7,m=!1):(j=j<<8|d,l+=8),255===d&&(m=!0)}return l-=a,j>>>l&(1<<a)-1}function f(a){return 255===b[c+k-1]&&b[c+k]===a?(g(1),!0):255===b[c+k]&&b[c+k+1]===a&&(g(2),!0)}function g(a){k+=a}function h(){l=0,m&&(k++,m=!1)}function i(){if(0===e(1))return 1;if(0===e(1))return 2;var a=e(2);return 3>a?a+3:(a=e(5),31>a?a+6:(a=e(7),a+37))}for(var j,k=0,l=0,m=!1,n=a.currentTile.index,o=a.tiles[n],p=a.COD.sopMarkerUsed,q=a.COD.ephMarkerUsed,r=o.packetsIterator;d>k;)try{h(),p&&f(145)&&g(4);var s=r.nextPacket();if(void 0===s)return;if(!e(1))continue;for(var t,u=s.layerNumber,x=[],y=0,z=s.codeblocks.length;z>y;y++){t=s.codeblocks[y];var A,B=t.precinct,C=t.cbx-B.cbxMin,D=t.cby-B.cbyMin,E=!1,F=!1;if(void 0!==t.included)E=!!e(1);else{B=t.precinct;var G,H;if(void 0!==B.inclusionTree)G=B.inclusionTree;else{var I=B.cbxMax-B.cbxMin+1,J=B.cbyMax-B.cbyMin+1;G=new w(I,J),H=new v(I,J),B.inclusionTree=G,B.zeroBitPlanesTree=H}for(G.reset(C,D,u);;){if(k>=b.length)return;if(G.isAboveThreshold())break;if(G.isKnown())G.nextLevel();else if(e(1)){if(G.setKnown(),G.isLeaf()){t.included=!0,E=F=!0;break}G.nextLevel()}else G.incrementValue()}}if(E){if(F){for(H=B.zeroBitPlanesTree,H.reset(C,D);;){if(k>=b.length)return;if(e(1)){if(A=!H.nextLevel())break}else H.incrementValue()}t.zeroBitPlanes=H.value}for(var K=i();e(1);)t.Lblock++;var L=log2(K),M=(1<<L>K?L-1:L)+t.Lblock,N=e(M);x.push({codeblock:t,codingpasses:K,dataLength:N})}}for(h(),q&&f(146);x.length>0;){var O=x.shift();t=O.codeblock,void 0===t.data&&(t.data=[]),t.data.push({data:b,start:c+k,end:c+k+O.dataLength,codingpasses:O.codingpasses}),k+=O.dataLength}}catch(P){return}return k}function q(a,b,c,d,e,f,g,h){for(var i=d.tbx0,j=d.tby0,k=d.tbx1-d.tbx0,l=d.codeblocks,m="H"===d.type.charAt(0)?1:0,n="H"===d.type.charAt(1)?b:0,o=0,p=l.length;p>o;++o){var q=l[o],r=q.tbx1_-q.tbx0_,s=q.tby1_-q.tby0_;if(0!==r&&0!==s&&void 0!==q.data){var t,u;t=new x(r,s,q.subbandType,q.zeroBitPlanes,f),u=2;var v,w,y,z=q.data,A=0,B=0;for(v=0,w=z.length;w>v;v++)y=z[v],A+=y.end-y.start,B+=y.codingpasses;var C=new Int16Array(A),D=0;for(v=0,w=z.length;w>v;v++){y=z[v];var E=y.data.subarray(y.start,y.end);C.set(E,D),D+=E.length}var F=new ArithmeticDecoder(C,0,A);for(t.setDecoder(F),v=0;B>v;v++){switch(u){case 0:t.runSignificancePropogationPass();break;case 1:t.runMagnitudeRefinementPass();break;case 2:t.runCleanupPass(),h&&t.checkSegmentationSymbol()}u=(u+1)%3}var G,H,I,J=q.tbx0_-i+(q.tby0_-j)*k,K=t.coefficentsSign,L=t.coefficentsMagnitude,M=t.bitsDecoded,N=g?0:.5;D=0;var O="LL"!==d.type;for(v=0;s>v;v++){var P=J/k|0,Q=2*P*(b-k)+m+n;for(G=0;r>G;G++){if(H=L[D],0!==H){H=(H+N)*e,0!==K[D]&&(H=-H),I=M[D];var R=O?Q+(J<<1):J;g&&I>=f?a[R]=H:a[R]=H*(1<<f-I)}J++,D++}J+=k-r}}}}function r(a,b,c){for(var d=b.components[c],e=d.codingStyleParameters,f=d.quantizationParameters,g=e.decompositionLevelsCount,h=f.SPqcds,i=f.scalarExpounded,j=f.guardBits,k=e.segmentationSymbolUsed,l=a.components[c].precision,m=e.reversibleTransformation,n=m?new A:new z,o=[],p=0,r=0;g>=r;r++){for(var s=d.resolutions[r],t=s.trx1-s.trx0,v=s.try1-s.try0,w=new Float32Array(t*v),x=0,y=s.subbands.length;y>x;x++){var B,C;i?(B=h[p].mu,C=h[p].epsilon,p++):(B=h[0].mu,C=h[0].epsilon+(r>0?1-r:0));var D=s.subbands[x],E=u[D.type],F=m?1:Math.pow(2,l+E-C)*(1+B/2048),G=j+C-1;q(w,t,v,D,F,G,m,k)}o.push({width:t,height:v,items:w})}var H=n.calculate(o,d.tcx0,d.tcy0);return{left:d.tcx0,top:d.tcy0,width:H.width,height:H.height,items:H.items}}function s(a){for(var b=a.SIZ,c=a.components,d=b.Csiz,e=[],f=0,g=a.tiles.length;g>f;f++){var h,i=a.tiles[f],j=[];for(h=0;d>h;h++)j[h]=r(a,i,h);var k=j[0],l=c[0].isSigned;if(l)var m=new Int16Array(k.items.length*d);else var m=new Uint16Array(k.items.length*d);var n,o,p,q,s,t,u,v,w,x,y,z,A,B,C,D={left:k.left,top:k.top,width:k.width,height:k.height,items:m},E=0;if(i.codingStyleDefaultParameters.multipleComponentTransform){var F=4===d,G=j[0].items,H=j[1].items,I=j[2].items,J=F?j[3].items:null;n=c[0].precision-8,o=(128<<n)+.5,p=255*(1<<n),s=.5*p,q=-s;var K=i.components[0],L=d-3;if(u=G.length,K.codingStyleParameters.reversibleTransformation)for(t=0;u>t;t++,E+=L)v=G[t]+o,w=H[t],x=I[t],z=v-(x+w>>2),y=z+x,A=z+w,m[E++]=0>=y?0:y>=p?255:y>>n,m[E++]=0>=z?0:z>=p?255:z>>n,m[E++]=0>=A?0:A>=p?255:A>>n;else for(t=0;u>t;t++,E+=L)v=G[t]+o,w=H[t],x=I[t],y=v+1.402*x,z=v-.34413*w-.71414*x,A=v+1.772*w,m[E++]=0>=y?0:y>=p?255:y>>n,m[E++]=0>=z?0:z>=p?255:z>>n,m[E++]=0>=A?0:A>=p?255:A>>n;if(F)for(t=0,E=3;u>t;t++,E+=4)B=J[t],m[E]=q>=B?0:B>=s?255:B+o>>n}else for(h=0;d>h;h++)if(8===c[h].precision){var M=j[h].items;for(n=c[h].precision-8,o=(128<<n)+.5,p=127.5*(1<<n),q=-p,E=h,t=0,u=M.length;u>t;t++)C=M[t],m[E]=q>=C?0:C>=p?255:C+o>>n,E+=d}else{var l=c[h].isSigned,M=j[h].items;if(l)for(E=h,t=0,u=M.length;u>t;t++)m[E]=M[t],E+=d;else{n=c[h].precision-8,o=(128<<n)+.5;var N=Math.pow(2,c[h].precision)-1;for(E=h,t=0,u=M.length;u>t;t++)C=M[t],m[E]=Math.max(Math.min(C+o,N),0),E+=d}}e.push(D)}return e}function t(a,b){for(var c=a.SIZ,d=c.Csiz,e=a.tiles[b],f=0;d>f;f++){var g=e.components[f],h=void 0!==a.currentTile.QCC[f]?a.currentTile.QCC[f]:a.currentTile.QCD;g.quantizationParameters=h;var i=void 0!==a.currentTile.COC[f]?a.currentTile.COC[f]:a.currentTile.COD;g.codingStyleParameters=i}e.codingStyleDefaultParameters=a.currentTile.COD}var u={LL:0,LH:1,HL:1,HH:2};a.prototype={parse:function(a){var b=readUint16(a,0);if(65359===b)return void this.parseCodestream(a,0,a.length);for(var c=0,d=a.length;d>c;){var e=8,f=readUint32(a,c),g=readUint32(a,c+4);if(c+=e,1===f&&(f=4294967296*readUint32(a,c)+readUint32(a,c+4),c+=8,e+=8),0===f&&(f=d-c+e),e>f)throw new Error("JPX Error: Invalid box field size");var h=f-e,i=!0;switch(g){case 1785737832:i=!1;break;case 1668246642:var j=a[c];if(a[c+1],a[c+2],1===j){var k=readUint32(a,c+3);switch(k){case 16:case 17:case 18:break;default:warn("Unknown colorspace "+k)}}else 2===j&&info("ICC profile not supported");break;case 1785737827:this.parseCodestream(a,c,c+h);break;case 1783636e3:218793738!==readUint32(a,c)&&warn("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var l=String.fromCharCode(g>>24&255,g>>16&255,g>>8&255,255&g);warn("Unsupported header type "+g+" ("+l+")")}i&&(c+=h)}},parseImageProperties:function(a){for(var b=a.getByte();b>=0;){var c=b;b=a.getByte();var d=c<<8|b;if(65361===d){a.skip(4);var e=a.getInt32()>>>0,f=a.getInt32()>>>0,g=a.getInt32()>>>0,h=a.getInt32()>>>0;a.skip(16);var i=a.getUint16();return this.width=e-g,this.height=f-h,this.componentsCount=i,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(a,d,e){var f={};try{for(var g=!1,h=d;e>h+1;){var i=readUint16(a,h);h+=2;var j,k,l,m,n,q,r=0;switch(i){case 65359:f.mainHeader=!0;break;case 65497:break;case 65361:r=readUint16(a,h);var u={};u.Xsiz=readUint32(a,h+4),u.Ysiz=readUint32(a,h+8),u.XOsiz=readUint32(a,h+12),u.YOsiz=readUint32(a,h+16),u.XTsiz=readUint32(a,h+20),u.YTsiz=readUint32(a,h+24),u.XTOsiz=readUint32(a,h+28),u.YTOsiz=readUint32(a,h+32);var v=readUint16(a,h+36);u.Csiz=v;var w=[];j=h+38;for(var x=0;v>x;x++){var y={precision:(127&a[j])+1,isSigned:!!(128&a[j]),XRsiz:a[j+1],YRsiz:a[j+1]};b(y,u),w.push(y)}f.SIZ=u,f.components=w,c(f,w),f.QCC=[],f.COC=[];break;case 65372:r=readUint16(a,h);var z={};switch(j=h+2,k=a[j++],31&k){case 0:m=8,n=!0;break;case 1:m=16,n=!1;break;case 2:m=16,n=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+k)}for(z.noQuantization=8===m,z.scalarExpounded=n,z.guardBits=k>>5,l=[];r+h>j;){var A={};8===m?(A.epsilon=a[j++]>>3,A.mu=0):(A.epsilon=a[j]>>3,A.mu=(7&a[j])<<8|a[j+1],j+=2),l.push(A)}z.SPqcds=l,f.mainHeader?f.QCD=z:(f.currentTile.QCD=z,f.currentTile.QCC=[]);break;case 65373:r=readUint16(a,h);var B={};j=h+2;var C;switch(f.SIZ.Csiz<257?C=a[j++]:(C=readUint16(a,j),j+=2),k=a[j++],31&k){case 0:m=8,n=!0;break;case 1:m=16,n=!1;break;case 2:m=16,n=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+k)}for(B.noQuantization=8===m,B.scalarExpounded=n,B.guardBits=k>>5,l=[];r+h>j;)A={},8===m?(A.epsilon=a[j++]>>3,A.mu=0):(A.epsilon=a[j]>>3,A.mu=(7&a[j])<<8|a[j+1],j+=2),l.push(A);B.SPqcds=l,f.mainHeader?f.QCC[C]=B:f.currentTile.QCC[C]=B;break;case 65362:r=readUint16(a,h);var D={};j=h+2;var E=a[j++];D.entropyCoderWithCustomPrecincts=!!(1&E),D.sopMarkerUsed=!!(2&E),D.ephMarkerUsed=!!(4&E),D.progressionOrder=a[j++],D.layersCount=readUint16(a,j),j+=2,D.multipleComponentTransform=a[j++],D.decompositionLevelsCount=a[j++],D.xcb=(15&a[j++])+2,D.ycb=(15&a[j++])+2;var F=a[j++];if(D.selectiveArithmeticCodingBypass=!!(1&F),D.resetContextProbabilities=!!(2&F),D.terminationOnEachCodingPass=!!(4&F),D.verticalyStripe=!!(8&F),D.predictableTermination=!!(16&F),D.segmentationSymbolUsed=!!(32&F),D.reversibleTransformation=a[j++],D.entropyCoderWithCustomPrecincts){for(var G=[];r+h>j;){var H=a[j++];G.push({PPx:15&H,PPy:H>>4})}D.precinctsSizes=G}var I=[];if(D.selectiveArithmeticCodingBypass&&I.push("selectiveArithmeticCodingBypass"),D.resetContextProbabilities&&I.push("resetContextProbabilities"),D.terminationOnEachCodingPass&&I.push("terminationOnEachCodingPass"),D.verticalyStripe&&I.push("verticalyStripe"),D.predictableTermination&&I.push("predictableTermination"),I.length>0)throw g=!0,new Error("JPX Error: Unsupported COD options ("+I.join(", ")+")");f.mainHeader?f.COD=D:(f.currentTile.COD=D,f.currentTile.COC=[]);break;case 65424:r=readUint16(a,h),q={},q.index=readUint16(a,h+2),q.length=readUint32(a,h+4),q.dataEnd=q.length+h-2,q.partIndex=a[h+8],q.partsCount=a[h+9],f.mainHeader=!1,0===q.partIndex&&(q.COD=f.COD,q.COC=f.COC.slice(0),q.QCD=f.QCD,q.QCC=f.QCC.slice(0)),f.currentTile=q;break;case 65427:q=f.currentTile,0===q.partIndex&&(t(f,q.index),o(f)),r=q.dataEnd-h,p(f,a,h,r);break;case 65365:case 65367:case 65368:case 65380:r=readUint16(a,h);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+i.toString(16))}h+=r}}catch(J){if(g||this.failOnCorruptedImage)throw J;warn("Trying to recover from "+J.message)}this.tiles=s(f),this.width=f.SIZ.Xsiz-f.SIZ.XOsiz,this.height=f.SIZ.Ysiz-f.SIZ.YOsiz,this.componentsCount=f.SIZ.Csiz}};var v=function(){function a(a,b){var c=log2(Math.max(a,b))+1;this.levels=[];for(var d=0;c>d;d++){var e={width:a,height:b,items:[]};this.levels.push(e),a=Math.ceil(a/2),b=Math.ceil(b/2)}}return a.prototype={reset:function(a,b){for(var c,d=0,e=0;d<this.levels.length;){c=this.levels[d];var f=a+b*c.width;if(void 0!==c.items[f]){e=c.items[f];break}c.index=f,a>>=1,b>>=1,d++}d--,c=this.levels[d],c.items[c.index]=e,this.currentLevel=d,delete this.value},incrementValue:function(){var a=this.levels[this.currentLevel];a.items[a.index]++},nextLevel:function(){var a=this.currentLevel,b=this.levels[a],c=b.items[b.index];return a--,0>a?(this.value=c,!1):(this.currentLevel=a,b=this.levels[a],b.items[b.index]=c,!0)}},a}(),w=function(){function a(a,b){var c=log2(Math.max(a,b))+1;this.levels=[];for(var d=0;c>d;d++){for(var e=new Uint8Array(a*b),f=new Uint8Array(a*b),g=0,h=e.length;h>g;g++)e[g]=0,f[g]=0;var i={width:a,height:b,items:e,status:f};this.levels.push(i),a=Math.ceil(a/2),b=Math.ceil(b/2)}}return a.prototype={reset:function(a,b,c){this.currentStopValue=c;for(var d=0;d<this.levels.length;){var e=this.levels[d],f=a+b*e.width;e.index=f,a>>=1,b>>=1,d++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var a=this.levels[this.currentLevel];a.items[a.index]=a.items[a.index]+1,a.items[a.index]>this.minValue&&(this.minValue=a.items[a.index])},nextLevel:function(){var a=this.currentLevel;if(a--,0>a)return!1;this.currentLevel=a;var b=this.levels[a];return b.items[b.index]<this.minValue?b.items[b.index]=this.minValue:b.items[b.index]>this.minValue&&(this.minValue=b.items[b.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var a=this.currentLevel,b=this.levels[a];return b.items[b.index]>this.currentStopValue},isKnown:function(){var a=this.currentLevel,b=this.levels[a];return b.status[b.index]>0},setKnown:function(){var a=this.currentLevel,b=this.levels[a];b.status[b.index]=1}},a}(),x=function(){function a(a,b,c,g,h){this.width=a,this.height=b,this.contextLabelTable="HH"===c?f:"HL"===c?e:d;var i=a*b;this.neighborsSignificance=new Uint8Array(i),this.coefficentsSign=new Uint8Array(i),this.coefficentsMagnitude=h>14?new Uint32Array(i):h>6?new Uint16Array(i):new Uint8Array(i),this.processingFlags=new Uint8Array(i);var j=new Uint8Array(i);if(0!==g)for(var k=0;i>k;k++)j[k]=g;this.bitsDecoded=j,this.reset()}var b=17,c=18,d=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),e=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),f=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return a.prototype={setDecoder:function(a){this.decoder=a},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[b]=92,this.contexts[c]=6},setNeighborsSignificance:function(a,b,c){var d,e=this.neighborsSignificance,f=this.width,g=this.height,h=b>0,i=f>b+1;a>0&&(d=c-f,h&&(e[d-1]+=16),i&&(e[d+1]+=16),e[d]+=4),g>a+1&&(d=c+f,h&&(e[d-1]+=16),i&&(e[d+1]+=16),e[d]+=4),h&&(e[c-1]+=1),i&&(e[c+1]+=1),e[c]|=128},runSignificancePropogationPass:function(){for(var a=this.decoder,b=this.width,c=this.height,d=this.coefficentsMagnitude,e=this.coefficentsSign,f=this.neighborsSignificance,g=this.processingFlags,h=this.contexts,i=this.contextLabelTable,j=this.bitsDecoded,k=-2,l=1,m=2,n=0;c>n;n+=4)for(var o=0;b>o;o++)for(var p=n*b+o,q=0;4>q;q++,p+=b){var r=n+q;if(r>=c)break;if(g[p]&=k,!d[p]&&f[p]){var s=i[f[p]],t=a.readBit(h,s);if(t){var u=this.decodeSignBit(r,o,p);e[p]=u,d[p]=1,this.setNeighborsSignificance(r,o,p),g[p]|=m}j[p]++,g[p]|=l}}},decodeSignBit:function(a,b,c){var d,e,f,g,h,i,j=this.width,k=this.height,l=this.coefficentsMagnitude,m=this.coefficentsSign;g=b>0&&0!==l[c-1],j>b+1&&0!==l[c+1]?(f=m[c+1],g?(e=m[c-1],d=1-f-e):d=1-f-f):g?(e=m[c-1],d=1-e-e):d=0;var n=3*d;return g=a>0&&0!==l[c-j],k>a+1&&0!==l[c+j]?(f=m[c+j],g?(e=m[c-j],d=1-f-e+n):d=1-f-f+n):g?(e=m[c-j],d=1-e-e+n):d=n,d>=0?(h=9+d,i=this.decoder.readBit(this.contexts,h)):(h=9-d,i=1^this.decoder.readBit(this.contexts,h)),i},runMagnitudeRefinementPass:function(){for(var a,b=this.decoder,c=this.width,d=this.height,e=this.coefficentsMagnitude,f=this.neighborsSignificance,g=this.contexts,h=this.bitsDecoded,i=this.processingFlags,j=1,k=2,l=c*d,m=4*c,n=0;l>n;n=a){a=Math.min(l,n+m);for(var o=0;c>o;o++)for(var p=n+o;a>p;p+=c)if(e[p]&&0===(i[p]&j)){var q=16;if(0!==(i[p]&k)){i[p]^=k;var r=127&f[p];q=0===r?15:14}var s=b.readBit(g,q);e[p]=e[p]<<1|s,h[p]++,i[p]|=j}}},runCleanupPass:function(){for(var a,d=this.decoder,e=this.width,f=this.height,g=this.neighborsSignificance,h=this.coefficentsMagnitude,i=this.coefficentsSign,j=this.contexts,k=this.contextLabelTable,l=this.bitsDecoded,m=this.processingFlags,n=1,o=2,p=e,q=2*e,r=3*e,s=0;f>s;s=a){a=Math.min(s+4,f);for(var t=s*e,u=f>s+3,v=0;e>v;v++){var w,x=t+v,y=u&&0===m[x]&&0===m[x+p]&&0===m[x+q]&&0===m[x+r]&&0===g[x]&&0===g[x+p]&&0===g[x+q]&&0===g[x+r],z=0,A=x,B=s;if(y){var C=d.readBit(j,c);if(!C){l[x]++,l[x+p]++,l[x+q]++,l[x+r]++;continue}z=d.readBit(j,b)<<1|d.readBit(j,b),0!==z&&(B=s+z,A+=z*e),w=this.decodeSignBit(B,v,A),i[A]=w,h[A]=1,this.setNeighborsSignificance(B,v,A),m[A]|=o,A=x;for(var D=s;B>=D;D++,A+=e)l[A]++;z++}for(B=s+z;a>B;B++,A+=e)if(!h[A]&&0===(m[A]&n)){var E=k[g[A]],F=d.readBit(j,E);1===F&&(w=this.decodeSignBit(B,v,A),i[A]=w,h[A]=1,this.setNeighborsSignificance(B,v,A),m[A]|=o),l[A]++}}}},checkSegmentationSymbol:function(){var a=this.decoder,c=this.contexts,d=a.readBit(c,b)<<3|a.readBit(c,b)<<2|a.readBit(c,b)<<1|a.readBit(c,b);if(10!==d)throw new Error("JPX Error: Invalid segmentation symbol")}},a}(),y=function(){function a(){}return a.prototype.calculate=function(a,b,c){for(var d=a[0],e=1,f=a.length;f>e;e++)d=this.iterate(d,a[e],b,c);return d},a.prototype.extend=function(a,b,c){var d=b-1,e=b+1,f=b+c-2,g=b+c;a[d--]=a[e++],a[g++]=a[f--],a[d--]=a[e++],a[g++]=a[f--],a[d--]=a[e++],a[g++]=a[f--],a[d]=a[e],a[g]=a[f]},a.prototype.iterate=function(a,b,c,d){var e,f,g,h,i,j,k=a.width,l=a.height,m=a.items,n=b.width,o=b.height,p=b.items;for(g=0,e=0;l>e;e++)for(h=2*e*n,f=0;k>f;f++,g++,h+=2)p[h]=m[g];m=a.items=null;var q=4,r=new Float32Array(n+2*q);if(1===n){if(0!==(1&c))for(j=0,g=0;o>j;j++,g+=n)p[g]*=.5}else for(j=0,g=0;o>j;j++,g+=n)r.set(p.subarray(g,g+n),q),this.extend(r,q,n),this.filter(r,q,n),p.set(r.subarray(q,q+n),g);var s=16,t=[];for(e=0;s>e;e++)t.push(new Float32Array(o+2*q));var u,v=0;if(a=q+o,1===o){if(0!==(1&d))for(i=0;n>i;i++)p[i]*=.5}else for(i=0;n>i;i++){if(0===v){for(s=Math.min(n-i,s),g=i,h=q;a>h;g+=n,h++)for(u=0;s>u;u++)t[u][h]=p[g+u];v=s}v--;var w=t[v];if(this.extend(w,q,o),this.filter(w,q,o),0===v)for(g=i-s+1,h=q;a>h;g+=n,h++)for(u=0;s>u;u++)p[g+u]=t[u][h]}return{width:n,height:o,items:p}},a}(),z=function(){function a(){y.call(this)}return a.prototype=Object.create(y.prototype),a.prototype.filter=function(a,b,c){var d=c>>1;b=0|b;var e,f,g,h,i=-1.586134342059924,j=-.052980118572961,k=.882911075530934,l=.443506852043971,m=1.230174104914001,n=1/m;for(e=b-3,f=d+4;f--;e+=2)a[e]*=n;for(e=b-2,g=l*a[e-1],f=d+3;f--&&(h=l*a[e+1],a[e]=m*a[e]-g-h,f--);e+=2)e+=2,g=l*a[e+1],a[e]=m*a[e]-g-h;for(e=b-1,g=k*a[e-1],f=d+2;f--&&(h=k*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=k*a[e+1],a[e]-=g+h;for(e=b,g=j*a[e-1],f=d+1;f--&&(h=j*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=j*a[e+1],a[e]-=g+h;if(0!==d)for(e=b+1,g=i*a[e-1],f=d;f--&&(h=i*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=i*a[e+1],a[e]-=g+h},a}(),A=function(){function a(){y.call(this)}return a.prototype=Object.create(y.prototype),a.prototype.filter=function(a,b,c){var d=c>>1;b=0|b;var e,f;for(e=b,f=d+1;f--;e+=2)a[e]-=a[e-1]+a[e+1]+2>>2;for(e=b+1,f=d;f--;e+=2)a[e]+=a[e-1]+a[e+1]>>1},a}();return a}(),ArithmeticDecoder=function(){function a(a,b,c){this.data=a,this.bp=b,this.dataEnd=c,this.chigh=a[b],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var b=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return a.prototype={byteIn:function(){var a=this.data,b=this.bp;if(255===a[b]){var c=a[b+1];c>143?(this.clow+=65280,this.ct=8):(b++,this.clow+=a[b]<<9,this.ct=7,this.bp=b)}else b++,this.clow+=b<this.dataEnd?a[b]<<8:65280,this.ct=8,this.bp=b;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(a,c){var d,e=a[c]>>1,f=1&a[c],g=b[e],h=g.qe,i=this.a-h;if(this.chigh<h)h>i?(i=h,d=f,e=g.nmps):(i=h,d=1^f,1===g.switchFlag&&(f=d),e=g.nlps);else{if(this.chigh-=h,0!==(32768&i))return this.a=i,f;h>i?(d=1^f,1===g.switchFlag&&(f=d),e=g.nlps):(d=f,e=g.nmps)}do 0===this.ct&&this.byteIn(),i<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&i));return this.a=i,a[c]=e<<1|f,d}},a}(),globalScope="undefined"==typeof window?this:window,isWorker="undefined"==typeof window,FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType={WIDGET:1,TEXT:2,LINK:3},StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10};globalScope.PDFJS||(globalScope.PDFJS={}),globalScope.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var OPS=PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,
setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},UNSUPPORTED_FEATURES=PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},UnsupportedManager=PDFJS.UnsupportedManager=function(){var a=[];return{listen:function(b){a.push(b)},notify:function(b){warn('Unsupported feature "'+b+'"');for(var c=0,d=a.length;d>c;c++)a[c](b)}}}();PDFJS.isValidUrl=isValidUrl,PDFJS.shadow=shadow;var PasswordResponses=PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PasswordException=function(){function a(a,b){this.name="PasswordException",this.message=a,this.code=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.PasswordException=PasswordException;var UnknownErrorException=function(){function a(a,b){this.name="UnknownErrorException",this.message=a,this.details=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.UnknownErrorException=UnknownErrorException;var InvalidPDFException=function(){function a(a){this.name="InvalidPDFException",this.message=a}return a.prototype=new Error,a.constructor=a,a}();PDFJS.InvalidPDFException=InvalidPDFException;var MissingPDFException=function(){function a(a){this.name="MissingPDFException",this.message=a}return a.prototype=new Error,a.constructor=a,a}();PDFJS.MissingPDFException=MissingPDFException;var UnexpectedResponseException=function(){function a(a,b){this.name="UnexpectedResponseException",this.message=a,this.status=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.UnexpectedResponseException=UnexpectedResponseException;var NotImplementedException=function(){function a(a){this.message=a}return a.prototype=new Error,a.prototype.name="NotImplementedException",a.constructor=a,a}(),MissingDataException=function(){function a(a,b){this.begin=a,this.end=b,this.message="Missing data ["+a+", "+b+")"}return a.prototype=new Error,a.prototype.name="MissingDataException",a.constructor=a,a}(),XRefParseException=function(){function a(a){this.message=a}return a.prototype=new Error,a.prototype.name="XRefParseException",a.constructor=a,a}();Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return shadow(PDFJS,"isLittleEndian",isLittleEndian())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return shadow(PDFJS,"hasCanvasTypedArrays",hasCanvasTypedArrays())}});var Uint32ArrayView=function(){function a(a,b){this.buffer=a,this.byteLength=a.length,this.length=void 0===b?this.byteLength>>2:b,c(this.length)}function b(a){return{get:function(){var b=this.buffer,c=a<<2;return(b[c]|b[c+1]<<8|b[c+2]<<16|b[c+3]<<24)>>>0},set:function(b){var c=this.buffer,d=a<<2;c[d]=255&b,c[d+1]=b>>8&255,c[d+2]=b>>16&255,c[d+3]=b>>>24&255}}}function c(c){for(;c>d;)Object.defineProperty(a.prototype,d,b(d)),d++}a.prototype=Object.create(null);var d=0;return a}(),IDENTITY_MATRIX=[1,0,0,1,0,0],Util=PDFJS.Util=function(){function a(){}var b=["rgb(",0,",",0,",",0,")"];return a.makeCssRgb=function(a,c,d){return b[1]=a,b[3]=c,b[5]=d,b.join("")},a.transform=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},a.applyTransform=function(a,b){var c=a[0]*b[0]+a[1]*b[2]+b[4],d=a[0]*b[1]+a[1]*b[3]+b[5];return[c,d]},a.applyInverseTransform=function(a,b){var c=b[0]*b[3]-b[1]*b[2],d=(a[0]*b[3]-a[1]*b[2]+b[2]*b[5]-b[4]*b[3])/c,e=(-a[0]*b[1]+a[1]*b[0]+b[4]*b[1]-b[5]*b[0])/c;return[d,e]},a.getAxialAlignedBoundingBox=function(b,c){var d=a.applyTransform(b,c),e=a.applyTransform(b.slice(2,4),c),f=a.applyTransform([b[0],b[3]],c),g=a.applyTransform([b[2],b[1]],c);return[Math.min(d[0],e[0],f[0],g[0]),Math.min(d[1],e[1],f[1],g[1]),Math.max(d[0],e[0],f[0],g[0]),Math.max(d[1],e[1],f[1],g[1])]},a.inverseTransform=function(a){var b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]},a.apply3dTransform=function(a,b){return[a[0]*b[0]+a[1]*b[1]+a[2]*b[2],a[3]*b[0]+a[4]*b[1]+a[5]*b[2],a[6]*b[0]+a[7]*b[1]+a[8]*b[2]]},a.singularValueDecompose2dScale=function(a){var b=[a[0],a[2],a[1],a[3]],c=a[0]*b[0]+a[1]*b[2],d=a[0]*b[1]+a[1]*b[3],e=a[2]*b[0]+a[3]*b[2],f=a[2]*b[1]+a[3]*b[3],g=(c+f)/2,h=Math.sqrt((c+f)*(c+f)-4*(c*f-e*d))/2,i=g+h||1,j=g-h||1;return[Math.sqrt(i),Math.sqrt(j)]},a.normalizeRect=function(a){var b=a.slice(0);return a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]),a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]),b},a.intersect=function(b,c){function d(a,b){return a-b}var e=[b[0],b[2],c[0],c[2]].sort(d),f=[b[1],b[3],c[1],c[3]].sort(d),g=[];return b=a.normalizeRect(b),c=a.normalizeRect(c),(e[0]===b[0]&&e[1]===c[0]||e[0]===c[0]&&e[1]===b[0])&&(g[0]=e[1],g[2]=e[2],(f[0]===b[1]&&f[1]===c[1]||f[0]===c[1]&&f[1]===b[1])&&(g[1]=f[1],g[3]=f[2],g))},a.sign=function(a){return 0>a?-1:1},a.appendToArray=function(a,b){Array.prototype.push.apply(a,b)},a.prependToArray=function(a,b){Array.prototype.unshift.apply(a,b)},a.extendObj=function(a,b){for(var c in b)a[c]=b[c]},a.getInheritableProperty=function(a,b){for(;a&&!a.has(b);)a=a.get("Parent");return a?a.get(b):null},a.inherit=function(a,b,c){a.prototype=Object.create(b.prototype),a.prototype.constructor=a;for(var d in c)a.prototype[d]=c[d]},a.loadScript=function(a,b){var c=document.createElement("script"),d=!1;c.setAttribute("src",a),b&&(c.onload=function(){d||b(),d=!0}),document.getElementsByTagName("head")[0].appendChild(c)},a}(),PageViewport=PDFJS.PageViewport=function(){function a(a,b,c,d,e,f){this.viewBox=a,this.scale=b,this.rotation=c,this.offsetX=d,this.offsetY=e;var g,h,i,j,k=(a[2]+a[0])/2,l=(a[3]+a[1])/2;switch(c%=360,c=0>c?c+360:c){case 180:g=-1,h=0,i=0,j=1;break;case 90:g=0,h=1,i=1,j=0;break;case 270:g=0,h=-1,i=-1,j=0;break;default:g=1,h=0,i=0,j=-1}f&&(i=-i,j=-j);var m,n,o,p;0===g?(m=Math.abs(l-a[1])*b+d,n=Math.abs(k-a[0])*b+e,o=Math.abs(a[3]-a[1])*b,p=Math.abs(a[2]-a[0])*b):(m=Math.abs(k-a[0])*b+d,n=Math.abs(l-a[1])*b+e,o=Math.abs(a[2]-a[0])*b,p=Math.abs(a[3]-a[1])*b),this.transform=[g*b,h*b,i*b,j*b,m-g*b*k-i*b*l,n-h*b*k-j*b*l],this.width=o,this.height=p,this.fontScale=b}return a.prototype={clone:function(b){b=b||{};var c="scale"in b?b.scale:this.scale,d="rotation"in b?b.rotation:this.rotation;return new a(this.viewBox.slice(),c,d,this.offsetX,this.offsetY,b.dontFlip)},convertToViewportPoint:function(a,b){return Util.applyTransform([a,b],this.transform)},convertToViewportRectangle:function(a){var b=Util.applyTransform([a[0],a[1]],this.transform),c=Util.applyTransform([a[2],a[3]],this.transform);return[b[0],b[1],c[0],c[1]]},convertToPdfPoint:function(a,b){return Util.applyInverseTransform([a,b],this.transform)}},a}(),PDFStringTranslateTable=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];PDFJS.createPromiseCapability=createPromiseCapability,function(){function a(a){this._status=b,this._handlers=[];try{a.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(c){this._reject(c)}}if(globalScope.Promise)return"function"!=typeof globalScope.Promise.all&&(globalScope.Promise.all=function(a){var b,c,d=0,e=[],f=new globalScope.Promise(function(a,d){b=a,c=d});return a.forEach(function(a,f){d++,a.then(function(a){e[f]=a,d--,0===d&&b(e)},c)}),0===d&&b(e),f}),"function"!=typeof globalScope.Promise.resolve&&(globalScope.Promise.resolve=function(a){return new globalScope.Promise(function(b){b(a)})}),"function"!=typeof globalScope.Promise.reject&&(globalScope.Promise.reject=function(a){return new globalScope.Promise(function(b,c){c(a)})}),void("function"!=typeof globalScope.Promise.prototype["catch"]&&(globalScope.Promise.prototype["catch"]=function(a){return globalScope.Promise.prototype.then(void 0,a)}));var b=0,c=1,d=2,e=500,f={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(a){a._status!==b&&(this.handlers=this.handlers.concat(a._handlers),a._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var a=1,b=Date.now()+a;this.handlers.length>0;){var e=this.handlers.shift(),f=e.thisPromise._status,g=e.thisPromise._value;try{f===c?"function"==typeof e.onResolve&&(g=e.onResolve(g)):"function"==typeof e.onReject&&(g=e.onReject(g),f=c,e.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(e.thisPromise))}catch(h){f=d,g=h}if(e.nextPromise._updateStatus(f,g),Date.now()>=b)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(a){this.unhandledRejections.push({promise:a,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(a){a._unhandledRejection=!1;for(var b=0;b<this.unhandledRejections.length;b++)this.unhandledRejections[b].promise===a&&(this.unhandledRejections.splice(b),b--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var a=Date.now(),b=0;b<this.unhandledRejections.length;b++)if(a-this.unhandledRejections[b].time>e){var c=this.unhandledRejections[b].promise._value,d="Unhandled rejection: "+c;c.stack&&(d+="\n"+c.stack),warn(d),this.unhandledRejections.splice(b),b--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),e))}};a.all=function(b){function c(a){g._status!==d&&(i=[],f(a))}var e,f,g=new a(function(a,b){e=a,f=b}),h=b.length,i=[];if(0===h)return e(i),g;for(var j=0,k=b.length;k>j;++j){var l=b[j],m=function(a){return function(b){g._status!==d&&(i[a]=b,h--,0===h&&e(i))}}(j);a.isPromise(l)?l.then(m,c):m(l)}return g},a.isPromise=function(a){return a&&"function"==typeof a.then},a.resolve=function(b){return new a(function(a){a(b)})},a.reject=function(b){return new a(function(a,c){c(b)})},a.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(b,e){if(this._status!==c&&this._status!==d){if(b===c&&a.isPromise(e))return void e.then(this._updateStatus.bind(this,c),this._updateStatus.bind(this,d));this._status=b,this._value=e,b===d&&0===this._handlers.length&&(this._unhandledRejection=!0,f.addUnhandledRejection(this)),f.scheduleHandlers(this)}},_resolve:function(a){this._updateStatus(c,a)},_reject:function(a){this._updateStatus(d,a)},then:function(b,c){var d=new a(function(a,b){this.resolve=a,this.reject=b});return this._handlers.push({thisPromise:this,onResolve:b,onReject:c,nextPromise:d}),f.scheduleHandlers(this),d},"catch":function(a){return this.then(void 0,a)}},globalScope.Promise=a}();var StatTimer=function(){function a(a,b,c){for(;a.length<c;)a+=b;return a}function b(){this.started={},this.times=[],this.enabled=!0}return b.prototype={time:function(a){this.enabled&&(a in this.started&&warn("Timer is already running for "+a),this.started[a]=Date.now())},timeEnd:function(a){this.enabled&&(a in this.started||warn("Timer has not been started for "+a),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a])},toString:function(){var b,c,d=this.times,e="",f=0;for(b=0,c=d.length;c>b;++b){var g=d[b].name;g.length>f&&(f=g.length)}for(b=0,c=d.length;c>b;++b){var h=d[b],i=h.end-h.start;e+=a(h.name," ",f)+" "+i+"ms\n"}return e}},b}();PDFJS.createBlob=function(a,b){if("undefined"!=typeof Blob)return new Blob([a],{type:b});var c=new MozBlobBuilder;return c.append(a),c.getBlob(b)},PDFJS.createObjectURL=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(b,c){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var d=PDFJS.createBlob(b,c);return URL.createObjectURL(d)}for(var e="data:"+c+";base64,",f=0,g=b.length;g>f;f+=3){var h=255&b[f],i=255&b[f+1],j=255&b[f+2],k=h>>2,l=(3&h)<<4|i>>4,m=g>f+1?(15&i)<<2|j>>6:64,n=g>f+2?63&j:64;e+=a[k]+a[l]+a[m]+a[n]}return e}}(),MessageHandler.prototype={on:function(a,b,c){var d=this.actionHandler;d[a]&&error('There is already an actionName called "'+a+'"'),d[a]=[b,c]},send:function(a,b,c){var d={action:a,data:b};this.postMessage(d,c)},sendWithPromise:function(a,b,c){var d=this.callbackIndex++,e={action:a,data:b,callbackId:d},f=createPromiseCapability();this.callbacksCapabilities[d]=f;try{this.postMessage(e,c)}catch(g){f.reject(g)}return f.promise},postMessage:function(a,b){b&&this.postMessageTransfers?this.comObj.postMessage(a,b):this.comObj.postMessage(a)}},"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}),function(a){"use strict";function b(b,c,d){var e=b.uint16("x00280006");0===e?a.convertRGBColorByPixel(c,d):a.convertRGBColorByPlane(c,d)}function c(c,d,e){var f=d.uint16("x00280010"),g=d.uint16("x00280011"),h=d.string("x00280004");c.height=f,c.width=g;var i=c.getContext("2d"),j=i.createImageData(g,f),k=$.Deferred();try{if("RGB"===h)b(d,e,j.data);else if("YBR_RCT"===h)b(d,e,j.data);else if("YBR_ICT"===h)b(d,e,j.data);else if("PALETTE COLOR"===h)a.convertPALETTECOLOR(e,j.data,d);else if("YBR_FULL_422"===h)a.convertYBRFull(e,j.data);else{if("YBR_FULL"!==h)throw"no color space conversion for photometric interpretation "+h;a.convertYBRFull(e,j.data)}return k.resolve(j),k.promise()}catch(l){return k.reject(l),k.promise()}}a.convertColorSpace=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){for(var d=c.int16("x00281101",0),e=c.int16("x00281101",1),f=c.int16("x00281101",2),g=8===f?0:8,h=c.byteArray.buffer,i=new Uint16Array(h,c.elements.x00281201.dataOffset,d),j=new Uint16Array(h,c.elements.x00281202.dataOffset,d),k=new Uint16Array(h,c.elements.x00281203.dataOffset,d),l=c.uint16("x00280010")*c.uint16("x00280011"),m=0,n=0,o=0;o<l;++o){var p=a[m++];p<e?p=0:p>e+d-1?p=d-1:p-=e,b[n++]=i[p]>>g,b[n++]=j[p]>>g,b[n++]=k[p]>>g,b[n++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0;e<c;e++)for(var f=0,g=c,h=2*c,e=0;e<c;e++)b[d++]=a[f++],b[d++]=a[g++],b[d++]=a[h++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;f<c;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d,e){void 0===d&&(d=0);var f=b.string("x00280004"),g=a.isColorImage(f);return g===!1?a.makeGrayscaleImage(c,b,d,e):a.makeColorImage(c,b,d,e)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.uint16("x00280010"),d=a.uint16("x00280011"),e=dicomParser.readEncapsulatedPixelData(a,a.elements.x7fe00010,b);try{console.log(new JpxImage)}catch(f){console.error(f)}var g=new JpxImage;g.parse(e);var h=g.width,i=g.height;if(h!==d)throw console.log("JPEG2000 decoder returned width of "+h+", when "+d+" is expected"),"JPEG2000 decoder returned width of "+h+", when "+d+" is expected";if(i!==c)throw console.log("JPEG2000 decoder returned width of "+i+", when "+c+" is expected"),"JPEG2000 decoder returned width of "+i+", when "+c+" is expected";var j=g.tiles.length;if(1!==j)throw console.log("JPEG2000 decoder returned a tileCount of "+j+", when 1 is expected"),"JPEG2000 decoder returned a tileCount of "+j+", when 1 is expected";var k=g.tiles[0],l=k.items;return l}c.decodeJPEG2000=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=a.uint16("x00280100"),g=dicomParser.readEncapsulatedPixelData(a,c,b),h=new JpegImage;return h.parse(g),8===f?h.getData(e,d):16===f?h.getData16(e,d):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(a,c,d){var e=$.Deferred(),f=c.uint16("x00280010"),g=c.uint16("x00280011");a.height=f,a.width=g;var h=dicomParser.readEncapsulatedPixelData(c,c.elements.x7fe00010,d),i=new Blob([h],{type:"image/jpeg"}),j=new FileReader;return void 0===j.readAsBinaryString?j.readAsArrayBuffer(i):j.readAsBinaryString(i),j.onload=function(){var c=new Image;c.onload=function(){var b=a.getContext("2d");b.drawImage(this,0,0);var c=b.getImageData(0,0,g,f);e.resolve(c)},c.onerror=function(a){e.reject(a)},void 0===j.readAsBinaryString?c.src="data:image/jpeg;base64,"+window.btoa(b(j.result)):c.src="data:image/jpeg;base64,"+window.btoa(j.result)},e.promise()}function e(a){var b=a.string("x00020010"),c=a.uint16("x00280100");if(8===c&&"1.2.840.10008.1.2.4.50"===b)return!0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280100"),e=a.uint16("x00280103"),f=dicomParser.readEncapsulatedPixelData(a,c,b),g=d<=8?1:2,h=new jpeg.lossless.Decoder,i=h.decode(f.buffer,f.byteOffset,f.length,g);return 0===e?2===g?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader),function(a){function b(b,e){var f,g=b.uint16("x00280010"),h=b.uint16("x00280011"),i=b.uint16("x00280002"),j=b.elements.x7fe00010,k=dicomParser.readEncapsulatedPixelData(b,j,e),l=a.getPixelFormat(b),m=h*g;return 1===l?(f=new ArrayBuffer(m*i),c(k,f,m,i),new Uint8Array(f)):2===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Uint16Array(f)):3===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Int16Array(f)):void 0}function c(a,b,c,d){for(var e=new DataView(a.buffer,a.byteOffset),f=new DataView(a.buffer,a.byteOffset),g=new DataView(b),h=0,i=e.getInt32(0,!0),j=0;j<i;++j){h=j;var k=e.getInt32(4*(j+1),!0),l=e.getInt32(4*(j+2),!0);0===l&&(l=a.length);for(var m=c*i;k<l;){var n=f.getInt8(k++);if(n>=0&&n<=127)for(var o=0;o<n+1&&h<m;++o)g.setInt8(h,f.getInt8(k++)),h+=d;else if(n<=-1&&n>=-127)for(var p=f.getInt8(k++),q=0;q<-n+1&&h<m;++q)g.setInt8(h,p),h+=d}}}function d(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=d.getInt32(0,!0),h=0;h<g;++h){var i=0,j=0===h?1:0,k=d.getInt32(4*(h+1),!0),l=d.getInt32(4*(h+2),!0);for(0===l&&(l=a.length);k<l;){var m=e.getInt8(k++);if(m>=0&&m<=127)for(var n=0;n<m+1&&i<c;++n)f.setInt8(2*i+j,e.getInt8(k++)),i++;else if(m<=-1&&m>=-127)for(var o=e.getInt8(k++),p=0;p<-m+1&&i<c;++p)f.setInt8(2*i+j,o),i++}}}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=b.string("x00020010");if("1.2.840.10008.1.2"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.1"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.2"===d)return a.extractUncompressedPixels(b,c,!0);if("1.2.840.10008.1.2.4.90"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.4.91"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.5"===d)return a.decodeRLE(b,c);if("1.2.840.10008.1.2.4.50"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.51"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.57"===d)return a.decodeJPEGLossless(b,c);if("1.2.840.10008.1.2.4.70"===d)return a.decodeJPEGLossless(b,c);throw console&&console.log&&console.log("Image cannot be decoded due to Unsupported transfer syntax "+d),"no decoder for transfer syntax "+d}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader);var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},JpegImage=function(){"use strict";function a(){}function b(a,b){for(var c,d,e=0,f=[],g=16;g>0&&!a[g-1];)g--;f.push({children:[],index:0});var h,i=f[0];for(c=0;c<g;c++){for(d=0;d<a[c];d++){for(i=f.pop(),i.children[i.index]=b[e];i.index>0;)i=f.pop();for(i.index++,f.push(i);f.length<=c;)f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h;e++}c+1<g&&(f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h)}return f[0].children}function c(a,b,c){return 64*((a.blocksPerLine+1)*b+c)}function d(a,b,d,e,f,g,i,j,k){function l(){if(H>0)return H--,G>>H&1;if(G=a[b++],255==G){var c=a[b++];if(c)throw"unexpected marker: "+(G<<8|c).toString(16)}return H=7,G>>>7}function m(a){for(var b,c=a;null!==(b=l());){if(c=c[b],"number"==typeof c)return c;if("object"!=typeof c)throw"invalid huffman sequence"}return null}function n(a){for(var b=0;a>0;){var c=l();if(null===c)return;b=b<<1|c,a--}return b}function o(a){var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function p(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c);a.blockData[b]=a.pred+=d;for(var e=1;e<64;){var f=m(a.huffmanTableAC),g=15&f,i=f>>4;if(0!==g){e+=i;var j=h[e];a.blockData[b+j]=o(g),e++}else{if(i<15)break;e+=16}}}function q(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c)<<k;a.blockData[b]=a.pred+=d}function r(a,b){a.blockData[b]|=l()<<k}function s(a,b){if(I>0)return void I--;for(var c=g,d=i;c<=d;){var e=m(a.huffmanTableAC),f=15&e,j=e>>4;if(0!==f){c+=j;var l=h[c];a.blockData[b+l]=o(f)*(1<<k),c++}else{if(j<15){I=n(j)+(1<<j)-1;break}c+=16}}}function t(a,b){for(var c=g,d=i,e=0;c<=d;){var f=h[c];switch(J){case 0:var j=m(a.huffmanTableAC),p=15&j;if(e=j>>4,0===p)e<15?(I=n(e)+(1<<e),J=4):(e=16,J=1);else{if(1!==p)throw"invalid ACn encoding";w=o(p),J=e?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(e--,0===e&&(J=2==J?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(a.blockData[b+f]=w<<k,J=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=l()<<k)}c++}4===J&&(I--,0===I&&(J=0))}function u(a,b,d,e,f){var g=d/D|0,h=d%D,i=g*a.v+e,j=h*a.h+f,k=c(a,i,j);b(a,k)}function v(a,b,d){var e=d/a.blocksPerLine|0,f=d%a.blocksPerLine,g=c(a,e,f);b(a,g)}var w,x,y,z,A,B,C,D=(d.precision,d.samplesPerLine,d.scanLines,d.mcusPerLine),E=d.progressive,F=(d.maxH,d.maxV,b),G=0,H=0,I=0,J=0,K=e.length;C=E?0===g?0===j?q:r:0===j?s:t:p;var L,M,N=0;M=1==K?e[0].blocksPerLine*e[0].blocksPerColumn:D*d.mcusPerColumn,f||(f=M);for(var O,P;N<M;){for(y=0;y<K;y++)e[y].pred=0;if(I=0,1==K)for(x=e[0],B=0;B<f;B++)v(x,C,N),N++;else for(B=0;B<f;B++){for(y=0;y<K;y++)for(x=e[y],O=x.h,P=x.v,z=0;z<P;z++)for(A=0;A<O;A++)u(x,C,N,z,A);N++}if(H=0,L=a[b]<<8|a[b+1],L<=65280)throw"marker was not found";if(!(L>=65488&&L<=65495))break;b+=2}return b-F}function e(a,b,c){var d,e,f,g,h,q,r,s,t,u,v=a.quantizationTable;for(u=0;u<64;u++)c[u]=a.blockData[b+u]*v[u];for(u=0;u<8;++u){var w=8*u;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(d=o*c[0+w]+128>>8,e=o*c[4+w]+128>>8,f=c[2+w],g=c[6+w],h=p*(c[1+w]-c[7+w])+128>>8,s=p*(c[1+w]+c[7+w])+128>>8,q=c[3+w]<<4,r=c[5+w]<<4,t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+128>>8,f=f*m-g*n+128>>8,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+w]=d+s,c[7+w]=d-s,c[1+w]=e+r,c[6+w]=e-r,c[2+w]=f+q,c[5+w]=f-q,c[3+w]=g+h,c[4+w]=g-h):(t=o*c[0+w]+512>>10,c[0+w]=t,c[1+w]=t,c[2+w]=t,c[3+w]=t,c[4+w]=t,c[5+w]=t,c[6+w]=t,c[7+w]=t)}for(u=0;u<8;++u){var x=u;0!==c[8+x]||0!==c[16+x]||0!==c[24+x]||0!==c[32+x]||0!==c[40+x]||0!==c[48+x]||0!==c[56+x]?(d=o*c[0+x]+2048>>12,e=o*c[32+x]+2048>>12,f=c[16+x],g=c[48+x],h=p*(c[8+x]-c[56+x])+2048>>12,s=p*(c[8+x]+c[56+x])+2048>>12,q=c[24+x],r=c[40+x],t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+2048>>12,f=f*m-g*n+2048>>12,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+x]=d+s,c[56+x]=d-s,c[8+x]=e+r,c[48+x]=e-r,c[16+x]=f+q,c[40+x]=f-q,c[24+x]=g+h,c[32+x]=g-h):(t=o*c[u+0]+8192>>14,c[0+x]=t,c[8+x]=t,c[16+x]=t,c[24+x]=t,c[32+x]=t,c[40+x]=t,c[48+x]=t,c[56+x]=t)}for(u=0;u<64;++u){var y=b+u,z=c[u];z=z<=-2056/a.bitConversion?0:z>=2024/a.bitConversion?255/a.bitConversion:z+2056/a.bitConversion>>4,a.blockData[y]=z}}function f(a,b){for(var d=b.blocksPerLine,f=b.blocksPerColumn,g=new Int32Array(64),h=0;h<f;h++)for(var i=0;i<d;i++){var j=c(b,h,i);e(b,j,g)}return b.blockData}function g(a){return a<=0?0:a>=255?255:0|a}var h=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,j=799,k=3406,l=2276,m=1567,n=3784,o=5793,p=2896;return a.prototype={load:function(a){var b=function(a){this.parse(a),this.onload&&this.onload()}.bind(this);if(a.indexOf("data:")>-1){for(var c=a.indexOf("base64,")+7,d=atob(a.substring(c)),e=new Uint8Array(d.length),f=d.length-1;f>=0;f--)e[f]=d.charCodeAt(f);b(d)}else{var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onload=function(){var a=new Uint8Array(g.response);b(a)}.bind(this),g.send(null)}},parse:function(a){function c(){var b=a[k]<<8|a[k+1];return k+=2,b}function e(){var b=c(),d=a.subarray(k,k+b-2);return k+=d.length,d}function g(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){N=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*N.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*N.v/a.maxV),g=b*N.h,h=c*N.v,i=64*h*(g+1);N.blockData=new Int16Array(i),N.blocksPerLine=e,N.blocksPerColumn=f}a.mcusPerLine=b,a.mcusPerColumn=c}var i,j,k=0,l=(a.length,null),m=null,n=[],o=[],p=[],q=c();if(65496!=q)throw"SOI not found";for(q=c();65497!=q;){var r,s,t;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=e();65504===q&&74===u[0]&&70===u[1]&&73===u[2]&&70===u[3]&&0===u[4]&&(l={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])}),65518===q&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&0===u[5]&&(m={version:u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var v=c(),w=v+k-2;k<w;){var x=a[k++],y=new Int32Array(64);if(x>>4===0)for(s=0;s<64;s++){var z=h[s];y[z]=a[k++]}else{if(x>>4!==1)throw"DQT: invalid table spec";for(s=0;s<64;s++){var A=h[s];y[A]=c()}}n[15&x]=y}break;case 65472:case 65473:case 65474:if(i)throw"Only single frame JPEGs supported";c(),i={},i.extended=65473===q,i.progressive=65474===q,i.precision=a[k++],i.scanLines=c(),i.samplesPerLine=c(),i.components=[],i.componentIds={};var B,C=a[k++],D=0,E=0;for(r=0;r<C;r++){B=a[k];var F=a[k+1]>>4,G=15&a[k+1];D<F&&(D=F),E<G&&(E=G);var H=a[k+2];t=i.components.push({h:F,v:G,quantizationTable:n[H],quantizationTableId:H,bitConversion:255/((1<<i.precision)-1)}),i.componentIds[B]=t-1,k+=3}i.maxH=D,i.maxV=E,g(i);break;case 65476:var I=c();for(r=2;r<I;){var J=a[k++],K=new Uint8Array(16),L=0;for(s=0;s<16;s++,k++)L+=K[s]=a[k];var M=new Uint8Array(L);for(s=0;s<L;s++,k++)M[s]=a[k];r+=17+L,(J>>4===0?p:o)[15&J]=b(K,M)}break;case 65501:c(),j=c();break;case 65498:var N,O=(c(),a[k++]),P=[];for(r=0;r<O;r++){var Q=i.componentIds[a[k++]];N=i.components[Q];var R=a[k++];N.huffmanTableDC=p[R>>4],N.huffmanTableAC=o[15&R],P.push(N)}var S=a[k++],T=a[k++],U=a[k++],V=d(a,k,i,P,j,S,T,U>>4,15&U);k+=V;break;default:if(255==a[k-3]&&a[k-2]>=192&&a[k-2]<=254){k-=3;break}throw"unknown JPEG marker "+q.toString(16)}q=c()}switch(this.width=i.samplesPerLine,this.height=i.scanLines,this.jfif=l,this.adobe=m,this.components=[],i.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:this.adobe?this.colorspace=ColorSpace.AdobeRGB:this.colorspace=ColorSpace.RGB;break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var r=0;r<i.components.length;r++){var N=i.components[r];N.quantizationTable||null===N.quantizationTableId||(N.quantizationTable=n[N.quantizationTableId]),this.components.push({output:f(i,N),scaleX:N.h/i.maxH,scaleY:N.v/i.maxV,blocksPerLine:N.blocksPerLine,blocksPerColumn:N.blocksPerColumn,bitConversion:N.bitConversion})}},getData16:function(a,b){if(1!==this.components.length)throw"Unsupported color mode";var d,e,f,g,h,i,j=this.width/a,k=this.height/b,l=0,m=this.components.length,n=a*b*m,o=new Uint16Array(n),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(i=0;i<m;i++){d=this.components[i];for(var q,r,s=d.blocksPerLine,t=d.blocksPerColumn,u=s<<3,v=0,w=0;w<t;w++)for(var x=w<<3,y=0;y<s;y++){var z=c(d,w,y),l=0,A=y<<3;for(q=0;q<8;q++){var v=(x+q)*u;for(r=0;r<8;r++)p[v+A+r]=d.output[z+l++]}}e=d.scaleX*j,f=d.scaleY*k,l=i;var B,C,D;for(h=0;h<b;h++)for(g=0;g<a;g++)C=0|h*f,B=0|g*e,D=C*u+B,o[l]=p[D],l+=m}return o},getData:function(a,b){var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=this.width/a,u=this.height/b,v=0,w=this.components.length,x=a*b*w,y=new Uint8Array(x),z=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(j=0;j<w;j++){d=this.components[j];for(var A,B,C=d.blocksPerLine,D=d.blocksPerColumn,E=C<<3,F=0,G=0;G<D;G++)for(var H=G<<3,I=0;I<C;I++){var J=c(d,G,I),v=0,K=I<<3;for(A=0;A<8;A++){var F=(H+A)*E;for(B=0;B<8;B++)z[F+K+B]=d.output[J+v++]*d.bitConversion}}e=d.scaleX*t,f=d.scaleY*u,v=j;var L,M,N;for(i=0;i<b;i++)for(h=0;h<a;h++)M=0|i*f,L=0|h*e,N=M*E+L,y[v]=z[N],v+=w}switch(w){case 1:case 2:break;case 3:if(s=!0,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;j<x;j+=w)k=y[j],l=y[j+1],m=y[j+2],p=g(k-179.456+1.402*m),q=g(k+135.459-.344*l-.714*m),r=g(k-226.816+1.772*l),y[j]=p,y[j+1]=q,y[j+2]=r;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(s=!1,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;j<x;j+=w)k=y[j],l=y[j+1],m=y[j+2],n=g(434.456-k-1.402*m),o=g(119.541-k+.344*l+.714*m),k=g(481.816-k-1.772*l),y[j]=n,y[j+1]=o,y[j+2]=k;break;default:throw"Unsupported color mode"}return y}},a}();!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.jpeg=a()}}(function(){return function a(b,c,d){function e(g,h){
if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ComponentSpec)},{}],2:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||function(a,b,c){this.buffer=new DataView(a,b,c),this.index=0},d.lossless.DataStream.prototype.get16=function(){var a=this.buffer.getUint16(this.index,!1);return this.index+=2,a},d.lossless.DataStream.prototype.get8=function(){var a=this.buffer.getUint8(this.index);return this.index+=1,a};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.DataStream)},{}],3:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.Decoder=d.lossless.Decoder||function(a,b){this.buffer=a,this.frame=new d.lossless.FrameHeader,this.huffTable=new d.lossless.HuffmanTable,this.quantTable=new d.lossless.QuantizationTable,this.scan=new d.lossless.ScanHeader,this.DU=d.lossless.Utils.createArray(10,4,64),this.HuffTab=d.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=d.lossless.Utils.createArray(10,1),this.dcTab=d.lossless.Utils.createArray(10,1),this.qTab=d.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,"undefined"!=typeof b&&(this.numBytes=b)},d.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],d.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],d.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,d.lossless.Decoder.MSB=2147483648,d.lossless.Decoder.RESTART_MARKER_BEGIN=65488,d.lossless.Decoder.RESTART_MARKER_END=65495,d.lossless.Decoder.prototype.decompress=function(a,b,c){return this.decode(a,b,c).buffer},d.lossless.Decoder.prototype.decode=function(a,b,c,e){var f,g,h,i,j=0,k=[],l=[],m=[];if("undefined"!=typeof a&&(this.buffer=a),"undefined"!=typeof e&&(this.numBytes=e),this.stream=new d.lossless.DataStream(this.buffer,b,c),this.buffer=null,this.xLoc=0,this.yLoc=0,f=this.stream.get16(),65496!==f)throw new Error("Not a JPEG file");for(f=this.stream.get16();f>>4!==4092||65476===f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (decode)")}f=this.stream.get16()}if(f<65472||f>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),f=this.stream.get16();do{for(;65498!==f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}f=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,g=0;g<this.numComp;g+=1)h=this.scanComps[g].scanCompSel,this.qTab[g]=this.quantTables[this.components[h].quantTableSel],this.nBlock[g]=this.components[h].vSamp*this.components[h].hSamp,this.dcTab[g]=this.HuffTab[this.scanComps[g].dcTabSel][0],this.acTab[g]=this.HuffTab[this.scanComps[g].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),j+=1;;){for(l[0]=0,m[0]=0,g=0;g<10;g+=1)k[g]=1<<this.precision-1;if(0===this.restartInterval){for(f=this.decodeUnit(k,l,m);0===f&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(k),f=this.decodeUnit(k,l,m);break}for(i=0;i<this.restartInterval&&(this.restarting=0==i,f=this.decodeUnit(k,l,m),this.output(k),0===f);i+=1);if(0===f&&(0!==this.markerIndex?(f=65280|this.marker,this.markerIndex=0):f=this.stream.get16()),!(f>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&f<=d.lossless.Decoder.RESTART_MARKER_END))break}65500===f&&1===j&&(this.readNumber(),f=this.stream.get16())}while(65497!==f&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===j);return this.outputData},d.lossless.Decoder.prototype.decodeUnit=function(a,b,c){return 1==this.numComp?this.decodeSingle(a,b,c):3==this.numComp?this.decodeRGB(a,b,c):-1},d.lossless.Decoder.prototype.select1=function(a){return this.getPreviousX(a)},d.lossless.Decoder.prototype.select2=function(a){return this.getPreviousY(a)},d.lossless.Decoder.prototype.select3=function(a){return this.getPreviousXY(a)},d.lossless.Decoder.prototype.select4=function(a){return this.getPreviousX(a)+this.getPreviousY(a)-this.getPreviousXY(a)},d.lossless.Decoder.prototype.select5=function(a){return this.getPreviousX(a)+(this.getPreviousY(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select6=function(a){return this.getPreviousY(a)+(this.getPreviousX(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select7=function(a){return(this.getPreviousX(a)+this.getPreviousY(a))/2},d.lossless.Decoder.prototype.decodeRGB=function(a,b,c){var e,f,g,h,i,j,k,l;for(a[0]=this.selector(0),a[1]=this.selector(1),a[2]=this.selector(2),i=0;i<this.numComp;i+=1)for(h=this.qTab[i],f=this.acTab[i],g=this.dcTab[i],j=0;j<this.nBlock[i];j+=1){for(k=0;k<this.IDCT_Source.length;k+=1)this.IDCT_Source[k]=0;if(e=this.getHuffmanValue(g,b,c),e>=65280)return e;for(a[i]=this.IDCT_Source[0]=a[i]+this.getn(c,e,b,c),this.IDCT_Source[0]*=h[0],l=1;l<64;l+=1){if(e=this.getHuffmanValue(f,b,c),e>=65280)return e;if(l+=e>>4,0===(15&e)){if(e>>4===0)break}else this.IDCT_Source[d.lossless.Decoder.IDCT_P[l]]=this.getn(c,15&e,b,c)*h[l]}}return 0},d.lossless.Decoder.prototype.decodeSingle=function(a,b,c){var e,f,g,h;for(this.restarting?(this.restarting=!1,a[0]=1<<this.frame.precision-1):a[0]=this.selector(),f=0;f<this.nBlock[0];f+=1){if(e=this.getHuffmanValue(this.dcTab[0],b,c),e>=65280)return e;if(g=this.getn(a,e,b,c),h=g>>8,h>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&h<=d.lossless.Decoder.RESTART_MARKER_END)return h;a[0]+=g}return 0},d.lossless.Decoder.prototype.getHuffmanValue=function(a,b,c){var e,f,g;if(g=65535,c[0]<8?(b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f):c[0]-=8,e=a[b[0]>>c[0]],0!==(e&d.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;b[0]&=g>>16-c[0],b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f,e=a[256*(255&e)+(b[0]>>c[0])],c[0]+=8}if(c[0]+=8-(e>>8),c[0]<0)throw new Error("index="+c[0]+" temp="+b[0]+" code="+e+" in HuffmanValue()");return c[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(b[0]&=g>>16-c[0],255&e)},d.lossless.Decoder.prototype.getn=function(a,b,c,d){var e,f,g,h,i;if(f=1,g=-1,h=65535,0===b)return 0;if(16===b)return a[0]>=0?-32768:32768;if(d[0]-=b,d[0]>=0){if(d[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}else{if(c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8,d[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8}if(d[0]<0)throw new Error("index="+d[0]+" in getn()");if(d[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}return e<f<<b-1&&(e+=(g<<b)+1),e},d.lossless.Decoder.prototype.getPreviousX=function(a){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,a):this.yLoc>0?this.getPreviousY(a):1<<this.frame.precision-1},d.lossless.Decoder.prototype.getPreviousXY=function(a){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,a):this.getPreviousY(a)},d.lossless.Decoder.prototype.getPreviousY=function(a){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,a):this.getPreviousX(a)},d.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},d.lossless.Decoder.prototype.outputSingle=function(a){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&a[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.outputRGB=function(a){var b=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(b,a[0],0),this.setter(b,a[1],1),this.setter(b,a[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.setValue16=function(a,b){this.outputData.setInt16(2*a,b,!0)},d.lossless.Decoder.prototype.getValue16=function(a){return this.outputData.getInt16(2*a,!0)&this.mask},d.lossless.Decoder.prototype.setValue8=function(a,b){this.outputData.setInt8(a,b)},d.lossless.Decoder.prototype.getValue8=function(a){return this.outputData.getInt8(a)&this.mask},d.lossless.Decoder.prototype.setValueRGB=function(a,b,c){this.outputData.setUint8(3*a+c,b)},d.lossless.Decoder.prototype.getValueRGB=function(a,b){return this.outputData.getUint8(3*a+b)},d.lossless.Decoder.prototype.readApp=function(){var a=0,b=this.stream.get16();for(a+=2;a<b;)this.stream.get8(),a+=1;return b},d.lossless.Decoder.prototype.readComment=function(){var a,b="",c=0;for(a=this.stream.get16(),c+=2;c<a;)b+=this.stream.get8(),c+=1;return b},d.lossless.Decoder.prototype.readNumber=function(){var a=this.stream.get16();if(4!==a)throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Decoder)},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},d.lossless.FrameHeader.prototype.read=function(a){var b,c,e,f,g=0;for(b=a.get16(),g+=2,this.precision=a.get8(),g+=1,this.dimY=a.get16(),g+=2,this.dimX=a.get16(),g+=2,this.numComp=a.get8(),g+=1,c=1;c<=this.numComp;c+=1){if(g>b)throw new Error("ERROR: frame format error");if(e=a.get8(),g+=1,g>=b)throw new Error("ERROR: frame format error [c>=Lf]");f=a.get8(),g+=1,this.components[e]||(this.components[e]=new d.lossless.ComponentSpec),this.components[e].hSamp=f>>4,this.components[e].vSamp=15&f,this.components[e].quantTableSel=a.get8(),g+=1}if(g!==b)throw new Error("ERROR: frame format error [Lf!=count]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.FrameHeader)},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||function(){this.l=d.lossless.Utils.createArray(4,2,16),this.th=[],this.v=d.lossless.Utils.createArray(4,2,16,200),this.tc=d.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},d.lossless.HuffmanTable.MSB=2147483648,d.lossless.HuffmanTable.prototype.read=function(a,b){var c,d,e,f,g,h,i=0;for(c=a.get16(),i+=2;i<c;){if(d=a.get8(),i+=1,e=15&d,e>3)throw new Error("ERROR: Huffman table ID > 3");if(f=d>>4,f>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[e]=1,this.tc[e][f]=1,g=0;g<16;g+=1)this.l[e][f][g]=a.get8(),i+=1;for(g=0;g<16;g+=1)for(h=0;h<this.l[e][f][g];h+=1){if(i>c)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[e][f][g][h]=a.get8(),i+=1}}if(i!==c)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(g=0;g<4;g+=1)for(h=0;h<2;h+=1)0!==this.tc[g][h]&&this.buildHuffTable(b[g][h],this.l[g][h],this.v[g][h]);return 1},d.lossless.HuffmanTable.prototype.buildHuffTable=function(a,b,c){var e,f,g,h,i,j;for(f=256,g=0,h=0;h<8;h+=1)for(i=0;i<b[h];i+=1)for(j=0;j<f>>h+1;j+=1)a[g]=c[h][i]|h+1<<8,g+=1;for(h=1;g<256;h+=1,g+=1)a[g]=h|d.lossless.HuffmanTable.MSB;for(e=1,g=0,h=8;h<16;h+=1)for(i=0;i<b[h];i+=1){for(j=0;j<f>>h-7;j+=1)a[256*e+g]=c[h][i]|h+1<<8,g+=1;if(g>=256){if(g>256)throw new Error("ERROR: Huffman table error(1)!");g=0,e+=1}}};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.HuffmanTable)},{"./data-stream.js":2,"./utils.js":10}],6:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Decoder=d.lossless.Decoder||("undefined"!=typeof a?a("./decoder.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null);var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d)},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=d.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},d.lossless.QuantizationTable.enhanceQuantizationTable=function(a,b){var c;for(c=0;c<8;c+=1)a[b[0+c]]*=90,a[b[32+c]]*=90,a[b[16+c]]*=118,a[b[48+c]]*=49,a[b[40+c]]*=71,a[b[8+c]]*=126,a[b[56+c]]*=25,a[b[24+c]]*=106;for(c=0;c<8;c+=1)a[b[0+8*c]]*=90,a[b[4+8*c]]*=90,a[b[2+8*c]]*=118,a[b[6+8*c]]*=49,a[b[5+8*c]]*=71,a[b[1+8*c]]*=126,a[b[7+8*c]]*=25,a[b[3+8*c]]*=106;for(c=0;c<64;c+=1)a[c]>>=6},d.lossless.QuantizationTable.prototype.read=function(a,b){var c,e,f,g,h=0;for(c=a.get16(),h+=2;h<c;){if(e=a.get8(),h+=1,f=15&e,f>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[f]=e>>4,0===this.precision[f])this.precision[f]=8;else{if(1!==this.precision[f])throw new Error("ERROR: Quantization table precision error");this.precision[f]=16}if(this.tq[f]=1,8===this.precision[f]){for(g=0;g<64;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");this.quantTables[f][g]=a.get8(),h+=1}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}else{for(g=0;g<64;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");this.quantTables[f][g]=a.get16(),h+=2}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}}if(h!==c)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.QuantizationTable)},{"./data-stream.js":2,"./utils.js":10}],8:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ScanComponent=d.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanComponent)},{}],9:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},d.lossless.ScanHeader.prototype.read=function(a){var b,c,e,f=0;for(b=a.get16(),f+=2,this.numComp=a.get8(),f+=1,c=0;c<this.numComp;c+=1){if(this.components[c]=new d.lossless.ScanComponent,f>b)throw new Error("ERROR: scan header format error");this.components[c].scanCompSel=a.get8(),f+=1,e=a.get8(),f+=1,this.components[c].dcTabSel=e>>4,this.components[c].acTabSel=15&e}if(this.selection=a.get8(),f+=1,this.spectralEnd=a.get8(),f+=1,e=a.get8(),this.ah=e>>4,this.al=15&e,f+=1,f!==b)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanHeader)},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.Utils=d.lossless.Utils||{},d.lossless.Utils.createArray=function(a){var b=new Array(a||0),c=a;if(arguments.length>1)for(var e=Array.prototype.slice.call(arguments,1);c--;)b[a-1-c]=d.lossless.Utils.createArray.apply(this,e);return b},d.lossless.Utils.makeCRCTable=function(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b},d.lossless.Utils.crc32=function(a){for(var b=d.lossless.Utils.crcTable||(d.lossless.Utils.crcTable=d.lossless.Utils.makeCRCTable()),c=-1,e=0;e<a.byteLength;e++)c=c>>>8^b[255&(c^a.getUint8(e))];return(c^-1)>>>0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Utils)},{}]},{},[6])(6)}),function(a,b,c){"use strict";function d(a){return(255&a)<<8|a>>8&255}function e(a,b,e){var g=c.getPixelFormat(a),h=f(a,b,g);if(e&&(2===g||3===g))for(var i=0;i<h.length;i++)h[i]=d(h[i]);return h}function f(a,b,c){var d=a.elements.x7fe00010,e=a.uint16("x00280010"),f=a.uint16("x00280011"),g=a.uint16("x00280002"),h=d.dataOffset,i=f*e*g;if(!i)throw"Sanity check failed when calculating the number of pixels";var j=0;if(1===c)return j=h+b*i,new Uint8Array(a.byteArray.buffer,j,i);if(2===c)return j=h+b*i*2,new Uint16Array(a.byteArray.buffer,j,i);if(3===c)return j=h+b*i*2,new Int16Array(a.byteArray.buffer,j,i);throw"Unknown pixel format"}c.extractUncompressedPixels=e}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;f<d;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return void 0==b&&(console.log("pixelRepresentation undifined"),b=0),0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");if(parseFloat(c[0])&&parseFloat(c[1]))return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1};return a.elements.x00281052&&a.elements.x00281053&&(b.intercept=a.floatString("x00281052")||b.intercept,b.slope=a.floatString("x00281053")||b.slope),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0};return a.elements.x00281050&&a.elements.x00281051&&(b.windowCenter=a.floatString("x00281050"),b.windowWidth=a.floatString("x00281051")),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d,e=a.Deferred(),f=b.indexOf(":"),g=b.substring(f+1),h=g.indexOf("frame=");if(h!==-1){var i=g.substr(h+6);d=parseInt(i),g=g.substr(0,h-1)}if(void 0!==d&&c.internal.multiFrameCacheHack.hasOwnProperty(g)){var j=c.internal.multiFrameCacheHack[g],k=c.createImageObject(j,b,d);return k.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise()}var l=parseInt(g),m=c.fileManager.get(l);if(void 0===m)return e.reject("unknown file index "+g),e.promise();var n=new FileReader;return n.onload=function(a){var f=a.target.result,h=new Uint8Array(f),i=dicomParser.parseDicom(h);if(void 0!==d){var i=c.internal.multiFrameCacheHack[g],j=c.createImageObject(i,b,d);return j.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise()}var j=c.createImageObject(i,b,d);j.then(function(a){e.resolve(a)},function(a){e.reject(a)})},n.readAsArrayBuffer(m),e.promise()}b.registerImageLoader("dicomfile",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.internal.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b]}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim()}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a[e]);return d}a.internal.getImageFrame=function(e,f){f=f||"application/octet-stream";var g=$.Deferred(),h=new XMLHttpRequest;return h.responseType="arraybuffer",h.open("get",e,!0),h.setRequestHeader("Accept","multipart/related;type="+f),h.onreadystatechange=function(e){if(4===h.readyState)if(200===h.status){var f=h.response,i=new Uint8Array(h.response),j=a.internal.findIndexOfString(i,"\n\r\n");j===-1&&g.reject("invalid response - no multipart mime header");var k=d(i,0,j),l=k.split("\r\n"),m=b(l);m||g.reject("invalid response - no boundary marker");var n=j+4,o=a.internal.findIndexOfString(i,m,n);o===-1&&g.reject("invalid response - terminating boundary not found");var p=o-n-1;g.resolve({contentType:c(l),arrayBuffer:f,offset:n,length:p})}else g.reject(h.response)},h.send(),g.promise()}}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"wadors:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.imageManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d){var e=a.Deferred(),f=d.substring(7),g=c.imageManager.get(f);if(void 0===g)return e.reject("unknown imageId"),e.promise();var h;return c.internal.getImageFrame(g.uri,h).then(function(a){var f;16===g.instance.bitsAllocated?f=0===g.instance.pixelRepresentation?new Uint16Array(a.arrayBuffer,a.offset,a.length/2):new Int16Array(a.arrayBuffer,a.offset,a.length/2):8===g.instance.bitsAllocated&&(f=new Uint8Array(a.arrayBuffer,a.offset,a.length));var h=c.getMinMax(f);g.imageId=d,g.minPixelValue=h.min,g.maxPixelValue=h.max,g.render=b.renderGrayscaleImage,g.getPixelData=function(){return f},e.resolve(g)}).fail(function(a){e.reject(a)}),e.promise()}b.registerImageLoader("wadors",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return void 0!==f[a]}function c(b){if(f[b]){var c=$.Deferred();return f[b].cacheCount++,c.resolve(f[b].dataSet),c}if(g[b])return g[b];var d=a.internal.xhrRequest(b);return g[b]=d,d.then(function(a){f[b]={dataSet:a,cacheCount:1},delete g[b]},function(){}).always(function(){delete g[b]}),d}function d(a){f[a]&&(f[a].cacheCount--,0===f[a].cacheCount&&delete f[a])}function e(){f={},g={}}var f={},g={};a.dataSetCacheManager={isLoaded:b,load:c,unload:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(e!==-1){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{url:d,frame:b}}function e(a){a.decache=function(){var b=d(a.imageId);c.dataSetCacheManager.unload(b.url)}}function f(b,d,f,g){var h=a.Deferred();return b.then(function(a){var b=c.createImageObject(a,d,f,g);b.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}function g(b){var g=d(b);if(c.dataSetCacheManager.isLoaded(g.url))return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);if(void 0!==g.frame)return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);var h=a.Deferred(),i=c.internal.xhrRequest(g.url,b);return i.then(function(a){var d=c.createImageObject(a,b,g.frame);d.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}b.registerImageLoader("dicomweb",g),b.registerImageLoader("wadouri",g)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(f,a,b);var d=c.decodeTransferSyntax(a,b);return c.convertColorSpace(f,a,d)}function e(e,h,i,j){var k=c.getPixelSpacing(h),l=h.uint16("x00280010"),m=h.uint16("x00280011"),n=c.getRescaleSlopeAndIntercept(h),o=h.byteArray.length,p=c.getWindowWidthAndCenter(h);g=void 0;var q,r=a.Deferred();try{q=d(h,i)}catch(s){return r.reject(s),r.promise()}return q.then(function(a){function c(){return a.data}function d(){return a}function i(){if(g===e)return f;f.height=l,f.width=m;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var q={imageId:e,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:p.windowCenter,windowWidth:p.windowWidth,render:b.renderColorImage,getPixelData:c,getImageData:d,getCanvas:i,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:h,invert:!1,fakeColor:!1,sizeInBytes:o,sharedCacheKey:j};(void 0===q.windowCenter||isNaN(q.windowCenter)||void 0===q.windowWidth||isNaN(q.windowWidth))&&(q.windowWidth=255,q.windowCenter=128),r.resolve(q)},function(a){r.reject(a)}),r.promise()}var f=document.createElement("canvas"),g="";c.makeColorImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.getPixelFormat(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function e(a,b,c){var d=c.uint16("x00283002",0);0===d&&(d=65535);var e=0;e=0===b?c.uint16("x00283002",1):c.int16("x00283002",1);for(var f=c.uint16("x00283002",2),g={id:"1",firstValueMapped:e,numBitsPerEntry:f,lut:[]},h=0;h<d;h++)0===b?g.lut[h]=c.uint16("x00283006",h):g.lut[h]=c.int16("x00283006",h);return g}function f(f,g,h,i){function j(){return r}var k,l=a.Deferred(),m=c.getPixelSpacing(g),n=g.uint16("x00280010"),o=g.uint16("x00280011"),p=c.getRescaleSlopeAndIntercept(g);try{k=d(g)}catch(q){return l.reject(q),l.promise()}var r,s=g.byteArray.length,t=g.string("x00280004"),u="MONOCHROME1"===t,v=c.getWindowWidthAndCenter(g);try{r=c.decodeTransferSyntax(g,h)}catch(w){return l.reject(w),l.promise()}var x=c.getMinMax(r),y={imageId:f,minPixelValue:x.min,maxPixelValue:x.max,slope:p.slope,intercept:p.intercept,windowCenter:v.windowCenter,windowWidth:v.windowWidth,render:b.renderGrayscaleImage,getPixelData:j,rows:n,columns:o,height:n,width:o,color:!1,columnPixelSpacing:m.column,rowPixelSpacing:m.row,data:g,invert:u,fakeColor:!1,sizeInBytes:s,sharedCacheKey:i},z=g.uint16("x00280103");if(g.elements.x00283000&&(y.modalityLUT=e(y,z,g.elements.x00283000.items[0].dataSet)),g.elements.x00283010&&(z=0,y.minPixelValue*y.slope+y.intercept<0&&(z=1),y.voiLUT=e(y,z,g.elements.x00283010.items[0].dataSet)),void 0===y.windowCenter||isNaN(y.windowCenter)||void 0===y.windowWidth||isNaN(y.windowWidth)){var A=y.maxPixelValue*y.slope+y.intercept,B=y.minPixelValue*y.slope+y.intercept;y.windowWidth=A-B,y.windowCenter=(A+B)/2}return l.resolve(y),l.promise()}c.makeGrayscaleImage=f}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.9.2"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e){var f=a.Deferred(),g=new XMLHttpRequest;return g.open("get",d,!0),g.responseType="arraybuffer",c.internal.options.beforeSend(g),g.onreadystatechange=function(a){if(4===g.readyState)if(200===g.status){var b=g.response,c=new Uint8Array(b),d=dicomParser.parseDicom(c);
f.resolve(d)}else f.reject(g.response)},g.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},g.send(),f.promise()}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader),!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(a.dicomParser=dicomParser)),dicomParser=b())}(this,function(){var a=function(a){return void 0===a&&(a={}),a.parseDicom=function(b,c){function d(c){if(void 0===c.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var d=c.elements.x00020010;return a.readFixedString(b,d.dataOffset,d.length)}function e(a){return"1.2.840.10008.1.2"!==a}function f(d,e){if("1.2.840.10008.1.2.1.99"===d){if(c&&c.inflater){var f=c.inflater(b,e);return new a.ByteStream(a.littleEndianByteArrayParser,f,0)}if("undefined"!=typeof module&&this.module!==module){var g=require("zlib"),h=a.sharedCopy(b,e,b.length-e),i=g.inflateRawSync(h),j=a.alloc(b,i.length+e);return b.copy(j,0,0,e),i.copy(j,e),new a.ByteStream(a.littleEndianByteArrayParser,j,0)}if("undefined"!=typeof pako){var k=b.slice(e),l=pako.inflateRaw(k),m=a.alloc(b,l.length+e);return m.set(b.slice(0,e),0),m.set(l,e),new a.ByteStream(a.littleEndianByteArrayParser,m,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===d?new a.ByteStream(a.bigEndianByteArrayParser,b,e):new a.ByteStream(a.littleEndianByteArrayParser,b,e)}function g(a,b){for(var c in a.elements)a.elements.hasOwnProperty(c)&&(b.elements[c]=a.elements[c]);return void 0!==a.warnings&&(b.warnings=a.warnings.concat(b.warnings)),b}function h(b){var g=d(b),h=e(g),i=f(g,b.position),j={},k=new a.DataSet(i.byteArrayParser,i.byteArray,j);k.warnings=i.warnings;try{h?a.parseDicomDataSetExplicit(k,i,i.byteArray.length,c):a.parseDicomDataSetImplicit(k,i,i.byteArray.length,c)}catch(l){var m={exception:l,dataSet:k};throw m}return k}function i(){var d=a.readPart10Header(b,c),e=h(d);return g(d,e)}if(void 0===b)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return i()},a}(a),a=function(a){"use strict";function b(a,b){return 255===a.byteArray[b]&&217===a.byteArray[b+1]}function c(a,c,d){var e=c.fragments[d];return!(!b(a,e.position+e.length-2)&&!b(a,e.position+e.length-3))}function d(a,b,d){for(var e=d;e<b.fragments.length;e++)if(c(a,b,e))return e}return void 0===a&&(a={}),a.createJPEGBasicOffsetTable=function(a,b,c){if(void 0===a)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===b)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==b.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(b.encapsulatedPixelData!==!0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(b.hadUndefinedLength!==!0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===b.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===b.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(b.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(c&&c.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";c=c||b.fragments;for(var e=[],f=0;;){e.push(b.fragments[f].offset);var g=d(a,b,f);if(void 0===g||g===b.fragments.length-1)return e;f=g+1}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.explicitDataSetToJS=function(b,c){if(void 0===b)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";c=c||{omitPrivateAttibutes:!0,maxElementLength:128};var d={};for(var e in b.elements){var f=b.elements[e];if(c.omitPrivateAttibutes!==!0||!a.isPrivateTag(e))if(f.items){for(var g=[],h=0;h<f.items.length;h++)g.push(a.explicitDataSetToJS(f.items[h].dataSet,c));d[e]=g}else{var i;i=void 0,f.length<c.maxElementLength&&(i=a.explicitElementToString(b,f)),void 0!==i?d[e]=i:d[e]={dataOffset:f.dataOffset,length:f.length}}}return d},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.explicitElementToString=function(b,c){function d(a,c){for(var d="",e=0;e<a;e++)0!==e&&(d+="/"),d+=c.call(b,g,e).toString();return d}if(void 0===b||void 0===c)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===c.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var e,f=c.vr,g=c.tag;if(a.isStringVr(f)===!0)e=b.string(g);else{if("AT"==f){var h=b.uint32(g);if(void 0===h)return;return h<0&&(h=4294967295+h+1),"x"+h.toString(16).toUpperCase()}"US"==f?e=d(c.length/2,b.uint16):"SS"===f?e=d(c.length/2,b.int16):"UL"==f?e=d(c.length/4,b.uint32):"SL"===f?e=d(c.length/4,b.int32):"FD"==f?e=d(c.length/8,b["double"]):"FL"==f&&(e=d(c.length/4,b["float"]))}return e},a}(a),a=function(a){"use strict";function b(a,b){switch(a){case 2:return b%4==0&&b%100||b%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}function c(a,c,d){return!isNaN(d)&&c>0&&c<=12&&a>0&&a<=b(c,d)}return void 0===a&&(a={}),a.parseDA=function(a,b){if(a&&8===a.length){var d=parseInt(a.substring(0,4),10),e=parseInt(a.substring(4,6),10),f=parseInt(a.substring(6,8),10);if(b&&c(f,e,d)!==!0)throw"invalid DA '"+a+"'";return{year:d,month:e,day:f}}if(b)throw"invalid DA '"+a+"'"},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.parseTM=function(a,b){if(a.length>=2){var c=parseInt(a.substring(0,2),10),d=a.length>=4?parseInt(a.substring(2,4),10):void 0,e=a.length>=6?parseInt(a.substring(4,6),10):void 0,f=a.length>=8?parseInt(a.substring(7,13),10):void 0;if(b&&(isNaN(c)||void 0!==d&&isNaN(d)||void 0!==e&&isNaN(e)||void 0!==f&&isNaN(f)||c<0||c>23||d&&(d<0||d>59)||e&&(e<0||e>59)||f&&(f<0||f>999999)))throw"invalid TM '"+a+"'";return{hours:c,minutes:d,seconds:e,fractionalSeconds:f}}if(b)throw"invalid TM '"+a+"'"},a}(a),a=function(a){"use strict";void 0===a&&(a={});var b={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return a.isStringVr=function(a){return b[a]},a.isPrivateTag=function(a){var b=parseInt(a[4]),c=b%2===1;return c},a.parsePN=function(a){if(void 0!==a){var b=a.split("^");return{familyName:b[0],givenName:b[1],middleName:b[2],prefix:b[3],suffix:b[4]}}},a}(a),a=function(a){"use strict";void 0===a&&(a={});var b=!1;return a.readEncapsulatedPixelData=function(c,d,e){if(b||(b=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===c)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===d)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==d.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(d.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(d.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===d.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===d.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(e<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==d.basicOffsetTable.length?a.readEncapsulatedImageFrame(c,d,e):a.readEncapsulatedPixelDataFromFragments(c,d,0,d.fragments.length)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.alloc=function(a,b){if("undefined"!=typeof Buffer&&a instanceof Buffer)return Buffer.alloc(b);if(a instanceof Uint8Array)return new Uint8Array(b);throw"dicomParser.alloc: unknown type for byteArray"},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.bigEndianByteArrayParser={readUint16:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(b+2>a.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(a[b]<<8)+a[b+1]},readInt16:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(b+2>a.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var c=(a[b]<<8)+a[b+1];return 32768&c&&(c=c-65535-1),c},readUint32:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var c=256*(256*(256*a[b]+a[b+1])+a[b+2])+a[b+3];return c},readInt32:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var c=(a[b]<<24)+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3];return c},readFloat:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var c=new Uint8Array(4);c[3]=a[b],c[2]=a[b+1],c[1]=a[b+2],c[0]=a[b+3];var d=new Float32Array(c.buffer);return d[0]},readDouble:function(a,b){if(b<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(b+8>a.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var c=new Uint8Array(8);c[7]=a[b],c[6]=a[b+1],c[5]=a[b+2],c[4]=a[b+3],c[3]=a[b+4],c[2]=a[b+5],c[1]=a[b+6],c[0]=a[b+7];var d=new Float64Array(c.buffer);return d[0]}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readFixedString=function(a,b,c){if(c<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(b+c>a.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var d,e="",f=0;f<c;f++){if(d=a[b+f],0===d)return b+=c,e;e+=String.fromCharCode(d)}return e},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.ByteStream=function(a,b,c){if(void 0===a)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===b)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(b instanceof Uint8Array==0&&b instanceof Buffer==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(c<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(c>=b.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=a,this.byteArray=b,this.position=c?c:0,this.warnings=[]},a.ByteStream.prototype.seek=function(a){if(this.position+a<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=a},a.ByteStream.prototype.readByteStream=function(b){if(this.position+b>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var c=a.sharedCopy(this.byteArray,this.position,b);return this.position+=b,new a.ByteStream(this.byteArrayParser,c)},a.ByteStream.prototype.readUint16=function(){var a=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,a},a.ByteStream.prototype.readUint32=function(){var a=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,a},a.ByteStream.prototype.readFixedString=function(b){var c=a.readFixedString(this.byteArray,this.position,b);return this.position+=b,c},a}(a),a=function(a){"use strict";function b(a,b){return void 0!==a.parser?a.parser:b}return void 0===a&&(a={}),a.DataSet=function(a,b,c){this.byteArrayParser=a,this.byteArray=b,this.elements=c},a.DataSet.prototype.uint16=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readUint16(this.byteArray,d.dataOffset+2*c)},a.DataSet.prototype.int16=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readInt16(this.byteArray,d.dataOffset+2*c)},a.DataSet.prototype.uint32=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readUint32(this.byteArray,d.dataOffset+4*c)},a.DataSet.prototype.int32=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readInt32(this.byteArray,d.dataOffset+4*c)},a.DataSet.prototype["float"]=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readFloat(this.byteArray,d.dataOffset+4*c)},a.DataSet.prototype["double"]=function(a,c){var d=this.elements[a];if(c=void 0!==c?c:0,d&&0!==d.length)return b(d,this.byteArrayParser).readDouble(this.byteArray,d.dataOffset+8*c)},a.DataSet.prototype.numStringValues=function(b){var c=this.elements[b];if(c&&c.length>0){var d=a.readFixedString(this.byteArray,c.dataOffset,c.length),e=d.match(/\\/g);return null===e?1:e.length+1}},a.DataSet.prototype.string=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].trim()}return e.trim()}},a.DataSet.prototype.text=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].replace(/ +$/,"")}return e.replace(/ +$/,"")}},a.DataSet.prototype.floatString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseFloat(d)}},a.DataSet.prototype.intString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseInt(d)}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.findEndOfEncapsulatedElement=function(b,c,d){if(void 0===b)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===c)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";c.encapsulatedPixelData=!0,c.basicOffsetTable=[],c.fragments=[];var e=a.readTag(b);if("xfffee000"!==e)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var f=b.readUint32(),g=f/4,h=0;h<g;h++){var i=b.readUint32();c.basicOffsetTable.push(i)}for(var j=b.position;b.position<b.byteArray.length;){var k=a.readTag(b),l=b.readUint32();if("xfffee0dd"===k)return b.seek(l),void(c.length=b.position-c.dataOffset);if("xfffee000"!==k)return d&&d.push("unexpected tag "+k+" while searching for end of pixel data element with undefined length"),l>b.byteArray.length-b.position&&(l=b.byteArray.length-b.position),c.fragments.push({offset:b.position-j-8,position:b.position,length:l}),b.seek(l),void(c.length=b.position-c.dataOffset);c.fragments.push({offset:b.position-j-8,position:b.position,length:l}),b.seek(l)}d&&d.push("pixel data element "+c.tag+" missing sequence delimiter tag xfffee0dd")},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.findItemDelimitationItemAndSetElementLength=function(a,b){if(void 0===a)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var c=8,d=a.byteArray.length-c;a.position<=d;){var e=a.readUint16();if(65534===e){var f=a.readUint16();if(57357===f){var g=a.readUint32();return 0!==g&&a.warnings("encountered non zero length following item delimiter at position"+a.position-4+" while reading element of undefined length with tag ' + element.tag"),void(b.length=a.position-b.dataOffset)}}}b.length=a.byteArray.length-b.dataOffset,a.seek(a.byteArray.length-a.position)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.littleEndianByteArrayParser={readUint16:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(b+2>a.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return a[b]+256*a[b+1]},readInt16:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(b+2>a.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8);return 32768&c&&(c=c-65535-1),c},readUint32:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var c=a[b]+256*a[b+1]+256*a[b+2]*256+256*a[b+3]*256*256;return c},readInt32:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},readFloat:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var c=new Uint8Array(4);c[0]=a[b],c[1]=a[b+1],c[2]=a[b+2],c[3]=a[b+3];var d=new Float32Array(c.buffer);return d[0]},readDouble:function(a,b){if(b<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(b+8>a.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var c=new Uint8Array(8);c[0]=a[b],c[1]=a[b+1],c[2]=a[b+2],c[3]=a[b+3],c[4]=a[b+4],c[5]=a[b+5],c[6]=a[b+6],c[7]=a[b+7];var d=new Float64Array(c.buffer);return d[0]}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.parseDicomDataSetExplicit=function(b,c,d,e){if(d=void 0===d?c.byteArray.length:d,e=e||{},void 0===c)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(d<c.position||d>c.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var f=b.elements;c.position<d;){var g=a.readDicomElementExplicit(c,b.warnings,e.untilTag);if(f[g.tag]=g,g.tag===e.untilTag)return}if(c.position>d)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},a.parseDicomDataSetImplicit=function(b,c,d,e){if(d=void 0===d?b.byteArray.length:d,e=e||{},void 0===c)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(d<c.position||d>c.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var f=b.elements;c.position<d;){var g=a.readDicomElementImplicit(c,e.untilTag,e.vrCallback);if(f[g.tag]=g,g.tag===e.untilTag)return}},a}(a),a=function(a){"use strict";function b(a){return"OB"===a||"OW"===a||"SQ"===a||"OF"===a||"UT"===a||"UN"===a?4:2}return void 0===a&&(a={}),a.readDicomElementExplicit=function(c,d,e){if(void 0===c)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var f={tag:a.readTag(c),vr:c.readFixedString(2)},g=b(f.vr);return 2===g?(f.length=c.readUint16(),f.dataOffset=c.position):(c.seek(2),f.length=c.readUint32(),f.dataOffset=c.position),4294967295===f.length&&(f.hadUndefinedLength=!0),f.tag===e?f:"SQ"===f.vr?(a.readSequenceItemsExplicit(c,f,d),f):4294967295===f.length?"x7fe00010"===f.tag?(a.findEndOfEncapsulatedElement(c,f,d),f):(a.findItemDelimitationItemAndSetElementLength(c,f),f):(c.seek(f.length),f)},a}(a),a=function(a){"use strict";function b(b,c,d){if("undefined"!=typeof d)return"SQ"===d(b.tag);if(c.position+4<=c.byteArray.length){var e=a.readTag(c);return c.seek(-4),"xfffee000"===e||"xfffee0dd"===e}return c.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}return void 0===a&&(a={}),a.readDicomElementImplicit=function(c,d,e){if(void 0===c)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var f={tag:a.readTag(c),length:c.readUint32(),dataOffset:c.position};return 4294967295===f.length&&(f.hadUndefinedLength=!0),f.tag===d?f:b(f,c,e)?(a.readSequenceItemsImplicit(c,f),f):f.hadUndefinedLength?(a.findItemDelimitationItemAndSetElementLength(c,f),f):(c.seek(f.length),f)},a}(a),a=function(a){"use strict";function b(a,b){for(var c=0;c<a.length;c++)if(a[c].offset===b)return c}function c(a,b,c,d){if(a===b.length-1)return c.length-d;for(var e=b[a+1],f=d+1;f<c.length;f++)if(c[f].offset===e)return f-d;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}return void 0===a&&(a={}),a.readEncapsulatedImageFrame=function(d,e,f,g,h){if(g=g||e.basicOffsetTable,h=h||e.fragments,void 0===d)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===f)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===g)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==e.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(e.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===e.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===g.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(f<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(f>=g.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var i=g[f],j=b(h,i);if(void 0===j)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var k=c(f,g,h,j);return a.readEncapsulatedPixelDataFromFragments(d,e,j,k,h)},a}(a),a=function(a){"use strict";function b(a,b,c){for(var d=0,e=b;e<b+c;e++)d+=a[e].length;return d}return void 0===a&&(a={}),a.readEncapsulatedPixelDataFromFragments=function(c,d,e,f,g){if(f=f||1,g=g||d.fragments,void 0===c)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===d)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===f)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==d.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(d.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(d.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===d.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===d.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(d.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(e>=d.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(f<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(e+f>d.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var h=new a.ByteStream(c.byteArrayParser,c.byteArray,d.dataOffset),i=a.readSequenceItem(h);if("xfffee000"!==i.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";h.seek(i.length);var j=h.position,k=8;if(1===f)return a.sharedCopy(h.byteArray,j+g[e].offset+k,g[e].length);for(var l=b(g,e,f),m=a.alloc(h.byteArray,l),n=0,o=e;o<e+f;o++)for(var p=j+g[o].offset+k,q=0;q<g[o].length;q++)m[n++]=h.byteArray[p++];return m},a}(a),a=function(a){return void 0===a&&(a={}),a.readPart10Header=function(b,c){function d(){f.seek(128);var a=f.readFixedString(4);if("DICM"!==a)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}function e(){d();for(var b=[],c={};f.position<f.byteArray.length;){var e=f.position,g=a.readDicomElementExplicit(f,b);if(g.tag>"x0002ffff"){f.position=e;break}g.parser=a.littleEndianByteArrayParser,c[g.tag]=g}var h=new a.DataSet(f.byteArrayParser,f.byteArray,c);return h.warnings=f.warnings,h.position=f.position,h}if(void 0===b)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var f=new a.ByteStream(a.littleEndianByteArrayParser,b);return e()},a}(a),a=function(a){"use strict";function b(b,c){for(var d={};b.position<b.byteArray.length;){var e=a.readDicomElementExplicit(b,c);if(d[e.tag]=e,"xfffee00d"===e.tag)return new a.DataSet(b.byteArrayParser,b.byteArray,d)}return c.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new a.DataSet(b.byteArrayParser,b.byteArray,d)}function c(c,d){var e=a.readSequenceItem(c);return 4294967295===e.length?(e.hadUndefinedLength=!0,e.dataSet=b(c,d),e.length=c.position-e.dataOffset):(e.dataSet=new a.DataSet(c.byteArrayParser,c.byteArray,{}),a.parseDicomDataSetExplicit(e.dataSet,c,c.position+e.length)),e}function d(b,d,e){for(;b.position+4<=b.byteArray.length;){var f=a.readTag(b);if(b.seek(-4),"xfffee0dd"===f)return d.length=b.position-d.dataOffset,b.seek(8),d;var g=c(b,e);d.items.push(g)}e.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),d.length=b.position-d.dataOffset}function e(a,b,d){for(var e=b.dataOffset+b.length;a.position<e;){var f=c(a,d);b.items.push(f)}}return void 0===a&&(a={}),a.readSequenceItemsExplicit=function(a,b,c){if(void 0===a)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b,c):e(a,b,c)},a}(a),a=function(a){"use strict";function b(b,c){for(var d={};b.position<b.byteArray.length;){var e=a.readDicomElementImplicit(b,void 0,c);if(d[e.tag]=e,"xfffee00d"===e.tag)return new a.DataSet(b.byteArrayParser,b.byteArray,d)}return b.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new a.DataSet(b.byteArrayParser,b.byteArray,d)}function c(c,d){var e=a.readSequenceItem(c);return 4294967295===e.length?(e.hadUndefinedLength=!0,e.dataSet=b(c,d),e.length=c.position-e.dataOffset):(e.dataSet=new a.DataSet(c.byteArrayParser,c.byteArray,{}),a.parseDicomDataSetImplicit(e.dataSet,c,c.position+e.length,{vrCallback:d})),e}function d(b,d,e){for(;b.position+4<=b.byteArray.length;){var f=a.readTag(b);if(b.seek(-4),"xfffee0dd"===f)return d.length=b.position-d.dataOffset,b.seek(8),d;var g=c(b,e);d.items.push(g)}b.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),d.length=b.byteArray.length-d.dataOffset}function e(a,b,d){for(var e=b.dataOffset+b.length;a.position<e;){var f=c(a,d);b.items.push(f)}}return void 0===a&&(a={}),a.readSequenceItemsImplicit=function(a,b,c){if(void 0===a)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b,c):e(a,b,c)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readSequenceItem=function(b){if(void 0===b)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var c={tag:a.readTag(b),length:b.readUint32(),dataOffset:b.position};if("xfffee000"!==c.tag){var d=b.position;throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+d}return c},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readTag=function(a){if(void 0===a)throw"dicomParser.readTag: missing required parameter 'byteStream'";var b=256*a.readUint16()*256,c=a.readUint16(),d="x"+("00000000"+(b+c).toString(16)).substr(-8);return d},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.sharedCopy=function(a,b,c){if("undefined"!=typeof Buffer&&a instanceof Buffer)return a.slice(b,b+c);if(a instanceof Uint8Array)return new Uint8Array(a.buffer,a.byteOffset+b,c);throw"dicomParser.from: unknown type for byteArray"},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.version="1.7.2",a}(a);return a}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var m=3*a.length/4;a.charAt(a.length-1)===f.charAt(64)&&m--,a.charAt(a.length-2)===f.charAt(64)&&m--;var n;for(n=e.uint8array?new Uint8Array(m):new Array(m);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),
i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,n[l++]=b,64!==i&&(n[l++]=c),64!==j&&(n[l++]=d);return n}},{"./support":27,"./utils":29}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":29}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){"use strict";var d=a("es6-promise").Promise;b.exports={Promise:d}},{"es6-promise":37}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=new f[a]({raw:!0,level:b.level||-1}),this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:38}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){if(this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name,this.streamFiles&&!a.file.dir){var b=m(a,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=m(a,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),this.streamFiles&&!a.file.dir)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":12,"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(a,b,c){(function(a){"use strict";b.exports={isNode:"undefined"!=typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b);c=f.extend(c||{},i),c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(a=q(a)),c.createFolders&&(d=p(a))&&r.call(this,d,!0);var h="string"===e&&c.binary===!1&&c.base64===!1;c.binary=!h;var l=b instanceof j&&0===b.uncompressedSize;(l||c.dir||!b||0===b.length)&&(c.base64=!1,c.binary=!0,b="",c.compression="STORE",e="string");var o=null;o=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);var s=new k(a,o,c);this.files[a]=s},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==a.platform&&"freebsd"!==a.platform&&"linux"!==a.platform&&"sunos"!==a.platform||(a.platform="UNIX"),"win32"===a.platform&&(a.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(i){b=new g("error"),b.error(i)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":35,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(a,b,c){"use strict";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./DataReader":15}],15:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":29}],16:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./DataReader":15}],18:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./ArrayReader":14}],19:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],21:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":29,"./GenericWorker":25}],22:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe")}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":29,"./GenericWorker":25}],24:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":29,"./GenericWorker":25}],25:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],26:[function(a,b,c){(function(c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var d,e=0,f=null,g=0;for(d=0;d<b.length;d++)g+=b[d].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(f=new Uint8Array(g),d=0;d<b.length;d++)f.set(b[d],e),e+=b[d].length;return f;case"nodebuffer":return c.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j("error"),this._worker.error(e)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../nodejs/NodejsStreamOutputAdapter"),m=a("../external");g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":35,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],27:[function(a,b,c){(function(b){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof b,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(e){try{var f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob("application/zip").size}catch(e){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"./nodejs/NodejsStreamOutputAdapter":35}],28:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBuffer(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("asap"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.newBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.newBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBuffer(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);
return c},c.prepareContent=function(a,b,e,f,g){var h=null;return h=i.blob&&b instanceof Blob&&"undefined"!=typeof FileReader?new m.Promise(function(a,c){var d=new FileReader;d.onload=function(b){a(b.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(b)}):m.Promise.resolve(b),h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("The data of '"+a+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,asap:33}],30:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug : unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=a.toLowerCase(),c="string"===b||"text"===b;"binarystring"!==b&&"text"!==b||(b="string");var e=this._decompressWorker(),g=!this._dataBinary;return g&&!c&&(e=e.pipe(new f.Utf8EncodeWorker)),!g&&c&&(e=e.pipe(new f.Utf8DecodeWorker)),new d(e,b,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],33:[function(a,b,c){"use strict";function d(){if(i.length)throw i.shift()}function e(a){var b;b=h.length?h.pop():new f,b.task=a,g(b)}function f(){this.task=null}var g=a("./raw"),h=[],i=[],j=g.makeRequestCallFromTimer(d);b.exports=e,f.prototype.call=function(){try{this.task.call()}catch(a){e.onerror?e.onerror(a):(i.push(a),j())}finally{this.task=null,h[h.length]=this}}},{"./raw":34}],34:[function(a,b,c){(function(a){"use strict";function c(a){h.length||(g(),i=!0),h[h.length]=a}function d(){for(;j<h.length;){var a=j;if(j+=1,h[a].call(),j>k){for(var b=0,c=h.length-j;b<c;b++)h[b]=h[b+j];h.length-=j,j=0}}h.length=0,j=0,i=!1}function e(a){var b=1,c=new l(a),d=document.createTextNode("");return c.observe(d,{characterData:!0}),function(){b=-b,d.data=b}}function f(a){return function(){function b(){clearTimeout(c),clearInterval(d),a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var g,h=[],i=!1,j=0,k=1024,l=a.MutationObserver||a.WebKitMutationObserver;g="function"==typeof l?e(d):f(d),c.requestFlush=g,c.makeRequestCallFromTimer=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){},{}],36:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],37:[function(b,c,d){(function(d,e){(function(){"use strict";function f(a){return"function"==typeof a||"object"==typeof a&&null!==a}function g(a){return"function"==typeof a}function h(a){return"object"==typeof a&&null!==a}function i(a){U=a}function j(a){Y=a}function k(){return function(){d.nextTick(p)}}function l(){return function(){T(p)}}function m(){var a=0,b=new _(p),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function n(){var a=new MessageChannel;return a.port1.onmessage=p,function(){a.port2.postMessage(0)}}function o(){return function(){setTimeout(p,1)}}function p(){for(var a=0;a<X;a+=2){var b=ca[a],c=ca[a+1];b(c),ca[a]=void 0,ca[a+1]=void 0}X=0}function q(){try{var a=b,c=a("vertx");return T=c.runOnLoop||c.runOnContext,l()}catch(d){return o()}}function r(){}function s(){return new TypeError("You cannot resolve a promise with itself")}function t(){return new TypeError("A promises callback cannot return that same promise.")}function u(a){try{return a.then}catch(b){return ga.error=b,ga}}function v(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function w(a,b,c){Y(function(a){var d=!1,e=v(c,b,function(c){d||(d=!0,b!==c?z(a,c):B(a,c))},function(b){d||(d=!0,C(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,C(a,e))},a)}function x(a,b){b._state===ea?B(a,b._result):b._state===fa?C(a,b._result):D(b,void 0,function(b){z(a,b)},function(b){C(a,b)})}function y(a,b){if(b.constructor===a.constructor)x(a,b);else{var c=u(b);c===ga?C(a,ga.error):void 0===c?B(a,b):g(c)?w(a,b,c):B(a,b)}}function z(a,b){a===b?C(a,s()):f(b)?y(a,b):B(a,b)}function A(a){a._onerror&&a._onerror(a._result),E(a)}function B(a,b){a._state===da&&(a._result=b,a._state=ea,0!==a._subscribers.length&&Y(E,a))}function C(a,b){a._state===da&&(a._state=fa,a._result=b,Y(A,a))}function D(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+ea]=c,e[f+fa]=d,0===f&&a._state&&Y(E,a)}function E(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?H(c,d,e,f):e(f);a._subscribers.length=0}}function F(){this.error=null}function G(a,b){try{return a(b)}catch(c){return ha.error=c,ha}}function H(a,b,c,d){var e,f,h,i,j=g(c);if(j){if(e=G(c,d),e===ha?(i=!0,f=e.error,e=null):h=!0,b===e)return void C(b,t())}else e=d,h=!0;b._state!==da||(j&&h?z(b,e):i?C(b,f):a===ea?B(b,e):a===fa&&C(b,e))}function I(a,b){try{b(function(b){z(a,b)},function(b){C(a,b)})}catch(c){C(a,c)}}function J(a,b){var c=this;c._instanceConstructor=a,c.promise=new a(r),c._validateInput(b)?(c._input=b,c.length=b.length,c._remaining=b.length,c._init(),0===c.length?B(c.promise,c._result):(c.length=c.length||0,c._enumerate(),0===c._remaining&&B(c.promise,c._result))):C(c.promise,c._validationError())}function K(a){return new ia(this,a).promise}function L(a){function b(a){z(e,a)}function c(a){C(e,a)}var d=this,e=new d(r);if(!W(a))return C(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===da&&g<f;g++)D(d.resolve(a[g]),void 0,b,c);return e}function M(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(r);return z(c,a),c}function N(a){var b=this,c=new b(r);return C(c,a),c}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Q(a){this._id=na++,this._state=void 0,this._result=void 0,this._subscribers=[],r!==a&&(g(a)||O(),this instanceof Q||P(),I(this,a))}function R(){var a;if("undefined"!=typeof e)a=e;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;c&&"[object Promise]"===Object.prototype.toString.call(c.resolve())&&!c.cast||(a.Promise=oa)}var S;S=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var T,U,V,W=S,X=0,Y=({}.toString,function(a,b){ca[X]=a,ca[X+1]=b,X+=2,2===X&&(U?U(p):V())}),Z="undefined"!=typeof window?window:void 0,$=Z||{},_=$.MutationObserver||$.WebKitMutationObserver,aa="undefined"!=typeof d&&"[object process]"==={}.toString.call(d),ba="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ca=new Array(1e3);V=aa?k():_?m():ba?n():void 0===Z&&"function"==typeof b?q():o();var da=void 0,ea=1,fa=2,ga=new F,ha=new F;J.prototype._validateInput=function(a){return W(a)},J.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},J.prototype._init=function(){this._result=new Array(this.length)};var ia=J;J.prototype._enumerate=function(){for(var a=this,b=a.length,c=a.promise,d=a._input,e=0;c._state===da&&e<b;e++)a._eachEntry(d[e],e)},J.prototype._eachEntry=function(a,b){var c=this,d=c._instanceConstructor;h(a)?a.constructor===d&&a._state!==da?(a._onerror=null,c._settledAt(a._state,b,a._result)):c._willSettleAt(d.resolve(a),b):(c._remaining--,c._result[b]=a)},J.prototype._settledAt=function(a,b,c){var d=this,e=d.promise;e._state===da&&(d._remaining--,a===fa?C(e,c):d._result[b]=c),0===d._remaining&&B(e,d._result)},J.prototype._willSettleAt=function(a,b){var c=this;D(a,void 0,function(a){c._settledAt(ea,b,a)},function(a){c._settledAt(fa,b,a)})};var ja=K,ka=L,la=M,ma=N,na=0,oa=Q;Q.all=ja,Q.race=ka,Q.resolve=la,Q.reject=ma,Q._setScheduler=i,Q._setAsap=j,Q._asap=Y,Q.prototype={constructor:Q,then:function(a,b){var c=this,d=c._state;if(d===ea&&!a||d===fa&&!b)return this;var e=new this.constructor(r),f=c._result;if(d){var g=arguments[d-1];Y(function(){H(d,e,g,f)})}else D(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var pa=R,qa={Promise:oa,polyfill:pa};"function"==typeof a&&a.amd?a(function(){return qa}):"undefined"!=typeof c&&c.exports?c.exports=qa:"undefined"!=typeof this&&(this.ES6Promise=qa),pa()}).call(this)}).call(this,b("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:36}],38:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],42:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":41}],43:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=d},{}],44:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],46:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua;
}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=i.lit_bufsize>>1,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],48:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],49:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":41}],51:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),
u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":41}],53:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)}),console.log(cornerstone),function(a,b,c){"use strict";function d(a){return _.find(j,function(b){return b.wid==a.winId&&b.suid==a.suid})}function e(a){for(var b=0;b<j.length;b++)j[b].wid==a.winId&&j[b].suid==a.suid&&j.splice(b,1)}function f(a,b){j.push({wid:a.winId,suid:a.suid,data:[b]})}function g(a,c){var d=a.stack.currentImageIdIndex+c;d>=a.stack.imageIds.length?d=0:d<0&&(d=a.stack.imageIds.length-1);var e=b.loadImage(a.stack.imageIds[d]),f=a.element,g=b.getViewport(f);e.then(function(c){a.stack.currentImageIdIndex!==d&&(a.stack.currentImageIdIndex=d,b.displayImage(f,c,g))},function(a){console.error(a)})}function h(a,b){if(void 0===a)throw"play: win must not be undefined";void 0===b&&(b=100),console.log(b);var c,h=d(a);if(void 0===h||0===h.data.length||h.data.length!=a.wrappers.length){void 0===h||0===h.data.length||(i(a),e(a));for(var j=[],k=0;k<a.wrappers.length;k++)a.wrappers[k].stack.imageIds.length>0&&j.push(a.wrappers[k]);c={intervalId:void 0,framesPerSecond:b,lastFrameTimeStamp:void 0,frameRate:0,wraps:j},f(a,c)}else c=h.data[0],c.framesPerSecond=b;void 0===c.intervalId&&(c.intervalId=setInterval(function(){if(c.framesPerSecond>0)for(var a=0;a<c.wraps.length;a++)g(c.wraps[a],1);else for(var a=0;a<c.wraps.length;a++)g(c.wraps[a],-1)},1e3/Math.abs(c.framesPerSecond)),console.log(1e3/Math.abs(c.framesPerSecond)))}function i(a){var b=d(a);console.log(j);var c;void 0!==b&&0!==b.data.length&&(c=b.data[0],clearInterval(c.intervalId),c.intervalId=void 0)}var j=[];c.diy={winPlayClip:h,winStopClip:i}}($,cornerstone,cornerstoneTools),cornerstone.registerImageLoader("oridcm",dvLocalLoader),cornerstone.registerImageLoader("series",dvSeriesLoader);var commEventHandler={listeners:{},fireEvent:function(a){if("undefined"!=typeof this.listeners[a.type])for(var b=0;b<this.listeners[a.type].length;++b)this.listeners[a.type][b](a)},addEventListener:function(a,b){"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},removeEventListener:function(a,b){if("undefined"!=typeof this.listeners[a])for(var c=0;c<this.listeners[a].length;++c)this.listeners[a][c]===b&&this.listeners[a].splice(c,1)}};if(function(a){a.extend({urlGet:function(){var a=window.location.href.split("?"),b=new Array;if(a.length>1)for(var c=a[1].split("&"),d=0,e=c.length;d<e;d++){var f=c[d].split("=");b[f[0]]=f[1]}return b}})}(jQuery),commEventHandler.addEventListener("dicomAdded",function(a){var b=a.series.dicomArr[0].iid,c=a.series.dicomArr[0].imageId;$(dvStruct.container).find(".leftGallery .img").each(function(){if($(this).attr("suid")==a.suid){var b=dvStruct.findSeries(a.suid);if(!_.isUndefined(b)){var c=b.dicomArr.length;$(this).parent().find(".total").text(c)}return!1}}),console.log(a.dicomCoverted),$(dvStruct.container).find(".leftGallery .img").each(function(){if($(this).attr("suid")==a.suid){var d=$(this).attr("iid");if(parseInt(b)<parseInt(d)){var e=$(this).get(0),f=cornerstone.getEnabledElement(e);f.viewport=void 0,cornerstone.loadImage(c).then(function(a){cornerstone.displayImage(e,a)})}}})}),commEventHandler.addEventListener("dicomAddedPush",function(a){for(var b=a.dicomCoverted.dataSet,c=0;c<dvStruct.viewer.col*dvStruct.viewer.row;c++){var d=dvStruct.viewer.winArr[c];if(d.wrappers[0].suid==a.series.suid){var e=createNewImageObject(b,"series:"+d.winId+":"+a.series.suid),f=a.dicomCoverted.imageId;e.bindOriImageId=f,d.imgObjArr.push(e);var g=d.wrappers[0];if(g.stack.imageIds.length>0){g.stack.imageIds.push(e.imageId);var h=g.stack.imageIds.length;if(h>1&&h<=d.col*d.row){var i=d.wrappers[h-1],j=d.wrappers[h-2],k=cornerstone.getEnabledElement(i.element);i.stack.imageIds=g.stack.imageIds,i.stack.currentImageIdIndex=j.stack.currentImageIdIndex+1>=h?0:j.stack.currentImageIdIndex+1,dvStruct.viewer.emptyInfo(i),k.viewport=void 0,reDrawWrapper(i),dvStruct.fun.elementIni(i.element,d),dvStruct.fun.checkAndSetActive(i.element),dvStruct.viewer.fillInfo(i)}updateTotalImgNo(d)}}}}),commEventHandler.addEventListener("dicomAddedSplice",function(a){for(var b=a.dicomCoverted.dataSet,c=a.i,d=0;d<dvStruct.viewer.col*dvStruct.viewer.row;d++){var e=dvStruct.viewer.winArr[d];if(e.wrappers[0].suid==a.series.suid){var f=createNewImageObject(b,"series:"+e.winId+":"+a.series.suid),g=a.dicomCoverted.imageId;f.bindOriImageId=g,e.imgObjArr.splice(d,0,f);var h=e.wrappers[0];if(h.stack.imageIds.length>0){h.stack.imageIds.splice(c,0,f.imageId);var i=h.stack.imageIds.length;if(i>1&&i<=e.col*e.row)for(var j=0;j<i;j++){var k=e.wrappers[j],l=cornerstone.getEnabledElement(k.element);if(j==i-1){var m=e.wrappers[i-2];k.stack.imageIds=h.stack.imageIds,k.stack.currentImageIdIndex=m.stack.currentImageIdIndex+1>=i?0:m.stack.currentImageIdIndex+1,dvStruct.viewer.emptyInfo(k),l.viewport=void 0,reDrawWrapper(k),dvStruct.fun.elementIni(k.element,e),dvStruct.fun.checkAndSetActive(k.element),dvStruct.viewer.fillInfo(k)}else k.stack.currentImageIdIndex>=c&&reDrawWrapper(k)}else if(i>=e.col*e.row)for(var j=0;j<e.col*e.row;j++){var k=e.wrappers[j],l=cornerstone.getEnabledElement(k.element);k.stack.currentImageIdIndex>=c&&reDrawWrapper(k)}updateTotalImgNo(e)}}}}),!dvStruct)var dvStruct={};dvStruct.waitingBind=[],dvStruct.addWaitingBind=function(a,b){dvStruct.waitingBind.push({suid:a,win:b})};var checkAndBind=function(a){for(var b=0;b<dvStruct.waitingBind.length;b++)if(dvStruct.waitingBind[b].suid==a){dvStruct.waitingBind[b].win.wrappers[0].suid||dvStruct.viewer.bindSeries(dvStruct.waitingBind[b].win,a),dvStruct.waitingBind.splice(b,1);break}};if(commEventHandler.addEventListener("dicomSeriesAdded",function(a){var b=get_dicom_imgViewer_templates("preview"),c=guid(8,"gallery"),d=a.dicomCoverted.imageId,e=a.dicomCoverted.iid;if(0==$(dvStruct.container).find(".leftGallery .imgBox").length)$(dvStruct.container).find(".leftGallery .js-gallery").append(b({id:c,suid:a.suid,imageId:d,iid:e,sNo:a.sNo}));else{var f=!1;$(dvStruct.container).find(".leftGallery .imgBox").each(function(){var g=$(this).find(".img").attr("suid");if(!firstIsBigger(a.suid,g))return $(this).before(b({id:c,suid:a.suid,imageId:d,iid:e})),f=!0,!1}),f||$(dvStruct.container).find(".leftGallery .js-gallery").append(b({id:c,suid:a.suid,imageId:d,iid:e}))}var g=$(dvStruct.container).find("#"+c).get(0);cornerstone.enable(g),cornerstone.loadImage(d).then(function(a){console.log("dicomSeriesAdded:",a),cornerstone.displayImage(g,a)}),checkAndBind(a.suid),$(dvStruct.container).find(".leftGallery").find(".imgBox").each(function(){var a=$(this).children(".img").attr("suid");$(this).find(".se").text("Se: "+dvStruct.countSNo(a))});for(var h=0;h<dvStruct.viewer.maxCol*dvStruct.viewer.maxRow;h++){var i=dvStruct.viewer.winArr[h];if(i&&i.wrappers[0].suid)for(var j=dvStruct.countSNo(i.wrappers[0].suid),k=0;k<i.wrappers.length;k++)i.wrappers[k].stack.imageIds.length>0&&$(i.wrappers[k].element).parents(".viewportWrapper").find(".js-info-SeNo").text("Se: "+j)}}),commEventHandler.addEventListener("bindImage",function(a){a.eleObj.imageId=a.imageId,reDrawEle(a.eleObj)}),!dvStruct)var dvStruct={};dvStruct.imgObjArr=[],dvStruct.container=void 0,dvStruct.seriesArr=[],dvStruct.insertSeries=function(a){if(0==dvStruct.seriesArr.length)return void dvStruct.seriesArr.push(a);for(var b=0;b<dvStruct.seriesArr.length;b++)if(!firstIsBigger(a.suid,dvStruct.seriesArr[b].suid))return void dvStruct.seriesArr.splice(b,0,a);dvStruct.seriesArr.push(a)},dvStruct.addSeries=function(a,b){var c={suid:a,dicomArr:[]};return dvStruct.insertSeries(c),c.dicomArr.push(b),commEventHandler.fireEvent({type:"dicomSeriesAdded",suid:a,dicomCoverted:b}),c},dvStruct.dicomInsert=function(a,b){if(0==a.dicomArr.length)return a.dicomArr.push(b),void commEventHandler.fireEvent({type:"dicomAddedPush",series:a,dicomCoverted:b});for(var c=0;c<a.dicomArr.length;c++)if(parseInt(b.iid)<parseInt(a.dicomArr[c].iid))return a.dicomArr.splice(c,0,b),void commEventHandler.fireEvent({type:"dicomAddedSplice",series:a,dicomCoverted:b,i:c});a.dicomArr.push(b),commEventHandler.fireEvent({type:"dicomAddedPush",series:a,dicomCoverted:b})},dvStruct.addDicom=function(a){var b=a.infoSet.UIDS.SeriesUID.val,c=dvStruct.findSeries(b);c?dvStruct.dicomInsert(c,a):c=dvStruct.addSeries(b,a),commEventHandler.fireEvent({type:"dicomAdded",suid:b,dicomCoverted:a,series:c})},dvStruct.findSeries=function(a){return _.find(dvStruct.seriesArr,function(b){return b.suid==a})},dvStruct.countSNo=function(a){var b=0;_.find(dvStruct.seriesArr,function(c){return b++,c.suid==a});return b},dvStruct.findOriInfoByIds=function(a,b){var c=dvStruct.findSeries(b);if(!_.isUndefined(c)){var d=c.dicomArr,e=_.find(d,function(b){return b.imageId==a});if(!_.isUndefined(e))return e.infoSet}},dvStruct.viewer={col:1,row:1,maxCol:1,maxRow:1,eachW:0,eachH:0,maxInnerCol:1,maxInnerRow:1,scrollAll:!1,btnStates:{wwwc:{enable:1,type:1},pan:{enable:0,type:1},zoom:{enable:0,type:1},length:{enable:0,type:1},angle:{enable:0,type:1}},leftBtnDisable:function(){disableAllTools();for(var a in dvStruct.viewer.btnStates)dvStruct.viewer.btnStates[a].type&&1==dvStruct.viewer.btnStates[a].type&&(dvStruct.viewer.btnStates[a].enable=0)},addNewWin:function(a,b){var c={winId:a,no:b,row:1,col:1,wrappers:[],imgObjArr:[]};return this.winArr.push(c),c},winArr:[],getWinByNo:function(a){return _.find(dvStruct.viewer.winArr,function(b){return b.no==a})},calInnerEachSize:function(a){if(_.isObject(a))b=a;else var b=_.find(dvStruct.viewer.winArr,function(b){return b.winId==a});if(_.isObject(b))return[(dvStruct.viewer.eachW-2)/b.col,(dvStruct.viewer.eachH-2)/b.row]},getCheckedWin:function(){var a=$(".seriesWindow.checked").attr("id"),b=_.find(dvStruct.viewer.winArr,function(b){return b.winId==a});return b},getWin:function(b){var c=_.find(dvStruct.viewer.winArr,function(b){return b.winId==a});return c},createWrapper:function(a){return{pid:a.pid,eid:a.eid,element:a.element,suid:void 0,stack:{currentImageIdIndex:0,imageIds:[]}}},clearWrapper:function(a){a.suid=void 0,a.stack.currentImageIdIndex=0,a.stack.imageIds=[]},eachElement:function(a){if(_.isObject(a)||(a={}),_.isObject(a.win))var b=[a.win];else var b=dvStruct.viewer.winArr;for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.wrappers.length;e++)a.callback&&a.callback(d.wrappers[e].element,d.wrappers[e])},eachWin:function(a){_.isObject(a)||(a={});for(var b=dvStruct.viewer.winArr,c=0;c<b.length;c++)a.callback&&a.callback(b[c])},getWrapperById:function(a){for(var b=dvStruct.viewer.winArr,c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.wrappers.length;e++){var f=d.wrappers[e];if(f.eid==a)return f}}},dvStruct.viewer.findOriInfoByIds=function(a){var b=a.split(":"),c=b[1],d=b[2],e=_.find(dvStruct.viewer.winArr,function(a){return a.winId==c}),f=_.find(e.imgObjArr,function(b){return b.imageId==a});if(_.isObject(f)){var g=f.bindOriImageId;return dvStruct.findOriInfoByIds(g,d)}},dvStruct.viewer.bindSeries=function(a,b){var c=dvStruct.findSeries(b),d=c.dicomArr,e=[];a.imgObjArr=[];for(var f=0;f<d.length;f++){var g=createNewImageObject(d[f].dataSet,"series:"+a.winId+":"+b);g.bindOriImageId=d[f].imageId,a.imgObjArr.push(g),e.push(g.imageId)}for(var h=e.length,f=0;f<dvStruct.viewer.maxInnerCol*dvStruct.viewer.maxInnerRow;f++){var i=a.wrappers[f];if(i.suid=b,i.stack.imageIds=[],f<a.col*a.row){var j=cornerstone.getEnabledElement(i.element);if(f<h&&(i.stack.currentImageIdIndex=f),console.log(f,h-1),f<h)i.stack.imageIds=e,dvStruct.viewer.emptyInfo(i),j.viewport=void 0,console.log(f,i),reDrawWrapper(i),dvStruct.fun.elementIni(i.element,a),dvStruct.fun.checkAndSetActive(i.element),dvStruct.viewer.fillInfo(i);else{i.stack.imageIds=[];var k=cornerstone.getImage(i.element);if(_.isObject(k)){cornerstoneTools.mouseInput.disable(i.element),dvStruct.fun.disableTools(i.element);var l=j.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0),l.fillStyle="black",l.fillRect(0,0,j.canvas.width,j.canvas.height),j.data={},j.image=void 0,dvStruct.viewer.emptyInfo(i)}}}}},dvStruct.viewer.emptyInfo=function(a){console.log("emptyInfo:",a);var b=$(a.element).parent();$(b).find(".js-info").text("")},dvStruct.viewer.fillInfo=function(a){var b=a.stack.imageIds[a.stack.currentImageIdIndex],c=a.suid,d=dvStruct.viewer.findOriInfoByIds(b,c);if(!_.isUndefined(d)){var e=dvStruct.countSNo(c),f=$(a.element).parent();try{if($(f).find(".js-info-totalNo").text("/"+a.stack.imageIds.length),$(f).find(".js-info-SeNo").text("Se: "+e),dvStruct.share||$(f).find(".js-info-PatientName").text(d.PatientInfo.PatientName.val),$(f).find(".js-info-PatientID").text(d.PatientInfo.PatientID.val),$(f).find(".js-info-PatientSex").text(" "+d.PatientInfo.PatientSex.val),g){var g=d.PatientInfo.PatientBirthDate.val;$(f).find(".js-info-PatientBirthDate").text(g.substr(0,4)+"/"+g.substr(4,2)+"/"+g.substr(6,2))}dvStruct.share||$(f).find(".js-info-InstitutionName").text(d.EquipmentInfo.InstitutionName.val),$(f).find(".js-info-ProtocolName").text(d.StudyInfo.ProtocolName.val),$(f).find(".js-info-StudyDescription").text(d.StudyInfo.StudyDescription.val),d.SomeUsefulInfo.mA.val&&$(f).find(".js-info-mA").text(d.SomeUsefulInfo.mA.val+"mA"),d.SomeUsefulInfo.kvp.val&&$(f).find(".js-info-kvp").text(d.SomeUsefulInfo.kvp.val+"kV");var h=searchBackInfo(d.UIDS.InstanceUID.val);h&&$(f).find(".js-info-CBZ").text(h.CBZ),d.ImageInfo.FieldofView.val&&$(f).find(".js-info-fov").text("FOV:"+parseFloat(d.ImageInfo.FieldofView.val).toFixed(1)),d.SomeUsefulInfo.MagneticFieldStrength.val&&$(f).find(".js-info-MagneticFieldStrength").text("FS: "+d.SomeUsefulInfo.MagneticFieldStrength.val),(d.SomeUsefulInfo.RepetitionTime.val||d.SomeUsefulInfo.RepetitionTime.val)&&$(a).find(".js-info-TrTe").text("TR: "+d.SomeUsefulInfo.RepetitionTime.val+" TE: "+d.SomeUsefulInfo.EchoTime.val);var i=d.StudyInfo.StudyDate.val.toString(),j=d.StudyInfo.StudyTime.val.toString();i&&j&&$(f).find(".js-info-datetime").text(i.substr(0,4)+"/"+i.substr(4,2)+"/"+i.substr(6,2)+" "+j.substr(0,2)+":"+j.substr(2,2)+":"+j.substr(2,2))}catch(k){console.error(k)}}};var dvStruct=dvStruct||{};dvStruct.fun={},dvStruct.fun.elementIni=function(a,b){cornerstoneTools.touchInput.enable(a),cornerstoneTools.wwwcTouchDrag.activate(a),cornerstoneTools.zoomTouchPinch.activate(a),cornerstoneTools.touchDragTool.deactivate(a)},dvStruct.fun.checkAndSetActive=function(a){for(var b in dvStruct.viewer.btnStates)dvStruct.viewer.btnStates[b].enable?(console.log(b),"referenceLines"==b?cornerstoneTools.referenceLines.tool.enable(a,synchronizer):cornerstoneTools[b].activate(a,1)):"referenceLines"==b?cornerstoneTools.referenceLines.tool.disable(a,synchronizer):cornerstoneTools[b].deactivate(a,1)},dvStruct.whereIsMouse=void 0,dvStruct.init=dvStruct.init||{},dvStruct.init.checkMouseOnViewpoint=function(){var a=$(dvStruct.container).find(".js-imageViewer");a.on("mousemove",function(a){var b=a.pageX,c=a.pageY,d=$(dvStruct.container).find(".js-imageViewer"),e=$(d).offset(),f=Math.ceil((b-e.left)/dvStruct.viewer.eachW),g=Math.ceil((c-e.top)/dvStruct.viewer.eachH);if(f<=0||f>dvStruct.viewer.col||g<=0||g>dvStruct.viewer.row)dvStruct.whereIsMouse=void 0;else{var h=dvStruct.viewer.col*(g-1)+f-1;dvStruct.whereIsMouse=dvStruct.viewer.getWinByNo(h)}}),a.on("mouseleave",function(a){dvStruct.whereIsMouse=void 0})},dvStruct.fun.nextPage=function(){if(dvStruct.viewer.scrollAll)for(var a=dvStruct.viewer.winArr,b=dvStruct.viewer.col*dvStruct.viewer.row,c=0;c<b;c++)dvStruct.fun.elementPaging(a[c]);else{var d=dvStruct.whereIsMouse;dvStruct.fun.elementPaging(d)}},dvStruct.fun.prevPage=function(){if(dvStruct.viewer.scrollAll)for(var a=dvStruct.viewer.winArr,b=dvStruct.viewer.col*dvStruct.viewer.row,c=0;c<b;c++)dvStruct.fun.elementPaging(a[c]);else{var d=dvStruct.whereIsMouse;dvStruct.fun.elementPaging(d,"prev")}},dvStruct.fun.elementPaging=function(a,b){if(_.isObject(a))for(var c=0;c<a.col*a.row;c++){var d=a.wrappers[c],e=d.stack,f=e.imageIds.length;if(f>0){"prev"==b?e.currentImageIdIndex<=0?e.currentImageIdIndex=f-1:e.currentImageIdIndex--:e.currentImageIdIndex<f-1?e.currentImageIdIndex++:e.currentImageIdIndex=0;var g=e.imageIds[e.currentImageIdIndex];cornerstone.loadImage(g).then(function(a){cornerstone.displayImage(d.element,a)})}}},dvStruct.fun.clearToolState=function(){if(checkedWin=dvStruct.viewer.winArr[0],checkedWin)for(var a=checkedWin.wrappers.length,b=0;b<a;b++){var c=checkedWin.wrappers[b];if(c.stack.imageIds.length>0){var d=c.element;cornerstoneTools.clearToolState(d,"length"),cornerstoneTools.clearToolState(d,"probe"),cornerstoneTools.clearToolState(d,"rectangleRoi"),cornerstoneTools.clearToolState(d,"ellipticalRoi"),cornerstoneTools.clearToolState(d,"length"),cornerstoneTools.clearToolState(d,"angle"),cornerstone.updateImage(d)}}},dvStruct.fun.invert=function(){var a=dvStruct.viewer.winArr,b=a[0].wrappers[0];b.stack.imageIds.length>0&&dvStruct.fun.invertEle(b.element)},dvStruct.fun.invertEle=function(a){var b=cornerstone.getViewport(a);b&&(b.invert===!0?b.invert=!1:b.invert=!0,cornerstone.setViewport(a,b))},dvStruct.fun.rotate=function(){var a=dvStruct.viewer.winArr[0],b=a.wrappers[0];if(b.stack.imageIds.length>0){var c=cornerstone.getViewport(b.element);c.rotation=(c.rotation+90)%360,cornerstone.setViewport(b.element,c)}},dvStruct.playSpeed=10,dvStruct.isplaying=!1,dvStruct.fun.play=function(){var a=dvStruct.viewer.getCheckedWin();if(a)cornerstoneTools.diy.winPlayClip(a,dvStruct.playSpeed);else for(var b=dvStruct.viewer.winArr,c=dvStruct.viewer.col*dvStruct.viewer.row,d=0;d<c;d++)cornerstoneTools.diy.winPlayClip(b[d],dvStruct.playSpeed);dvStruct.isplaying=!0},dvStruct.fun.stop=function(){for(var a=dvStruct.viewer.winArr,b=dvStruct.viewer.col*dvStruct.viewer.row,c=0;c<b;c++)cornerstoneTools.diy.winStopClip(a[c]);dvStruct.isplaying=!1};var unit={};unit.mask={getMask:function(){var a;return function(){return a||function(){return $(document.body).append('<div id="unitMask"></div>'),a=document.getElementById("unitMask")}()}}(),show:function(){var a=this.getMask();$(a).show()},hide:function(){var a=this.getMask();$(a).hide()}},unit.layoutSelector=layoutSelectorBuilder(4,4,"unitLayoutSelector"),unit.layoutSelector.callback=function(a){console.log(a),dvStruct.viewer.col=a.col,dvStruct.viewer.row=a.row,dvStruct.dvResize.call(dvStruct.container)},unit.innerLayoutSelector=layoutSelectorBuilder(2,2,"unitInnerLayoutSelector"),unit.innerLayoutSelector.callback=function(a){console.log(a);var b=dvStruct.viewer.getCheckedWin();if(console.log(b),_.isObject(b)){b.col=a.col,b.row=a.row;var c=dvStruct.viewer.calInnerEachSize(b.winId);dvStruct.viewer.resizeWin(b),$("#"+b.winId).find(".viewportWrapper").css({height:c[1]+"px",width:c[0]+"px"}).each(function(){console.log($(this).find(".viewport").get(0)),cornerstone.resize($(this).find(".viewport").get(0),!0)})}},unit.quickWWWL={ceils:[{ww:90,wc:35,name:"头颅平扫"},{ww:85,wc:40,name:"头颅增强"},{ww:1600,wc:450,name:"头颅骨窗"},{ww:1600,wc:550,name:"关节骨窗"},{ww:300,wc:40,name:"关节软组织窗"},{ww:2e3,wc:450,name:"鼻窦骨窗"},{ww:350,wc:35,name:"鼻窦软组织窗"},{ww:4e3,wc:650,name:"乳突"},{ww:2e3,wc:450,name:"椎间盘骨窗"},{ww:350,wc:40,name:"椎间盘软组织窗"},{ww:1e3,wc:-650,name:"肺窗"},{ww:1500,wc:-600,name:"肺窗2"},{ww:350,wc:-40,name:"纵隔窗1"},{ww:430,wc:55,name:"纵隔窗2"},{ww:200,wc:50,name:"肝脏"},{ww:350,wc:40,name:"肾脏"},{ww:300,wc:55,name:"腹部"}],savedStatus:{beginOfsX:0,beginOfsY:0,prevPageX:void 0,prevPageY:void 0},wwwlBoxIni:function(a){$(a).find(".closeBtn").on("mousedown",function(a){unit.quickWWWL.hide(),a.stopPropagation()}),$(a).find(".topbar").on("mousedown",function(){$(document.body).on("mousemove",function(b){var c=b.pageX,d=b.pageY,e=unit.quickWWWL.savedStatus;if(!_.isUndefined(e.prevPageX)&&!_.isUndefined(e.prevPageY)){var f=e.beginOfsX+c-e.prevPageX,g=e.beginOfsY+d-e.prevPageY;$(a).css({top:g+"px",left:f+"px",right:"auto",bottom:"auto"}),e.beginOfsX=f,e.beginOfsY=g}e.prevPageX=c,e.prevPageY=d}),$(document.body).on("mouseup mouseleave",function(a){$(document.body).off("mousedown"),$(document.body).off("mousemove");var b=unit.quickWWWL.savedStatus;b.prevPageX=void 0,b.prevPageY=void 0})}),$(a).find(".ceilBox").click(function(b){var c=b.target;if($(c).hasClass("aCeil")){var d=parseInt($(c).attr("ww")),e=parseInt($(c).attr("wc"));$(a).find(".wwVal").val(d),$(a).find(".wcVal").val(e)}b.stopPropagation()}),$(a).find(".yes").click(function(){var b=parseInt($(a).find(".wwVal").val()),c=parseInt($(a).find(".wcVal").val());isNaN(b)||isNaN(c)||dvStruct.fun.wwwc(b,c)})},getWWWLBox:function(){var a;return function(){return a||function(){var b='<div id="quickWWWLBox">';b+='<div class="topbar"  style=" -webkit-user-select: none; -webkit-user-drag: none;touch-action: none;" ><div class="closeBtn">✖</div></div>',b+='<div class="calBox"  style=" -webkit-user-select: none; -webkit-user-drag: none;touch-action: none;">',b+='<div class="inputArea">窗位:&ensp;<input class="wcVal"></div>',b+='<div class="inputArea">窗宽:&ensp;<input class="wwVal"></div>',b+='<div class="yes">确定</div>',b+="</div>",b+='<div class="ceilBox"></div>',b+="</div>",$(dvStruct.container).append(b),a=document.getElementById("quickWWWLBox");for(var c=0;c<unit.quickWWWL.ceils.length;c++){var d=unit.quickWWWL.ceils[c];$(a).find(".ceilBox").append('<div class="aCeil" ww="'+d.ww+'" wc="'+d.wc+'" >'+d.name+"</div>")}return unit.quickWWWL.wwwlBoxIni(a),a}()}}(),show:function(){unit.mask.show();var a=unit.quickWWWL.getWWWLBox();$(a).css({top:0,left:0,right:0,bottom:0}),$(a).show();var b=unit.quickWWWL.savedStatus,c=$(a).offset();b.beginOfsX=c.left,b.beginOfsY=c.top,b.prevPageX=void 0,b.prevPageY=void 0},hide:function(){unit.mask.hide();var a=unit.quickWWWL.getWWWLBox();$(a).hide()}},unit.loadingProcessing={failedUrls:[],getProcessiong:function(){var a;return function(){return a||function(){var b='<div id="processingBox" style="display: none" class="processingBox">';return b+='<div class="js-hide hidebtn" style="display: none"><span>✖</span></div>',b+='<div class="failed" style="display: none">失败：<span class="failedNum"></span>&ensp;<span class="tryAgain">重试</span></div>',b+='<div class="loadingTxt" >正在加载:<span class="now">0</span>/<span class="max"></span></div>',b+='<div class="processing">',b+='<div class="progress progress-striped active"><div class="progress-bar "  role="progressbar" style="width:0"></div></div>',b+="</div>",b+="</div>",$(".leftGallery").prepend(b),a=document.getElementById("processingBox"),$(a).find(".tryAgain").click(function(){var b=unit.loadingProcessing.failedUrls.length,c=unit.loadingProcessing.failedUrls.concat();unit.loadingProcessing.failedUrls=[],unit.loadingProcessing.finished=0,$(a).find(".js-hide").hide(),$(a).find(".loadingTxt").show(),$(a).find(".failed").hide(),unit.loadingProcessing.init(b);for(var d=0;d<b;d++)io.Url.load(c[d])}),$(a).find(".js-hide").click(function(){$(a).hide()}),a}()}}(),maxNum:0,finished:0,clear:function(){this.maxNum=0,this.finished=0,this.success=0;var a=this.getProcessiong();$(a).hide()},updateProcessing:function(a){if(a)this.failedUrls.push(a);else{this.finished++;var b=parseInt(this.finished/this.maxNum*100),c=this.getProcessiong();$(c).find(".now").text(this.finished),$(c).find(".progress-bar").css("width",b+"%")}this.finished+this.failedUrls.length==this.maxNum&&this.end()},end:function(){var a=this.getProcessiong();this.failed>0?($(a).find(".js-hide").show(),$(a).find(".loadingTxt").hide(),$(a).find(".failed").show().find(".failedNum").text(this.failedUrls.length)):$(a).hide()},init:function(a){if(this.maxNum=parseInt(a),this.maxNum>0){var b=this.getProcessiong();$(b).find(".progress-bar").width(0),$(b).find(".max").text(this.maxNum),$(b).show()}}},unit.speedSlider={ini:function(){var a=this.getSliderBox(),b=$(a).find(".rangeBar").get(0);noUiSlider.create(b,{start:[10],snap:!0,range:{min:1,"15%":2,"25%":4,"35%":8,"50%":10,"65%":20,"75%":25,"85%":50,max:100}}),b.noUiSlider.on("update",function(a,b){console.log(a[b]),dvStruct.isplaying&&(dvStruct.playSpeed=parseInt(a[b]),dvStruct.fun.stop(),dvStruct.fun.play())})},getSliderBox:function(){return document.getElementById("playSpeedSet")},show:function(){$(unit.mask.getMask()).on("touchstart",function(a){unit.speedSlider.hide(),a.preventDefault()});var a=this.getSliderBox();unit.mask.show(),$(a).show()},hide:function(){$(this.getSliderBox()).hide(),unit.mask.hide(),$(unit.mask.getMask()).off("touchstart")}},Uint8Array.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c,a<0&&(a=0)):a>c&&(a=c),b<0?(b+=c,b<0&&(b=0)):b>c&&(b=c),b<a&&(b=a);var d;if(Uint8Array.TYPED_ARRAY_SUPPORT)d=this.subarray(a,b),d.__proto__=Uint8Array.prototype;else{var e=b-a;d=new Uint8Array(e,(void 0));for(var f=0;f<e;f++)d[f]=this[f+a]}return d.length&&(d.parent=this.parent||this),d},Uint8Array.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("sourceStart out of bounds");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&c<b&&b<d)for(e=f-1;e>=0;e--)a[e+b]=this[e+c];else if(f<1e3||!Uint8Array.TYPED_ARRAY_SUPPORT)for(e=0;e<f;e++)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f};var io=io||{};io.Url={load:function(a){io.Url.xhrRequest(a)},xhrRequest:function(a){var b=$.Deferred(),c=new XMLHttpRequest;return c.open("get",a,!0),c.responseType="arraybuffer",cornerstoneWADOImageLoader.internal.options.beforeSend(c),c.onreadystatechange=function(d){if(4===c.readyState)if(200===c.status){var e=c.response,f=a.split("/"),g=f[f.length-1];commEventHandler.fireEvent({type:"dicomDownloaded",name:g,data:e});var h=a.lastIndexOf("."),i=a.substring(h,a.length);if(unit.loadingProcessing.updateProcessing(),".zip"!=i.toLowerCase()){var j=new Uint8Array(e),k=dicomParser.parseDicom(j);if(_.isObject(k)){var l=createNewImageObject(k),m=getDicomInfo(k),n={dataSet:k,infoSet:m,imageId:l.imageId,iid:m.InstanceInfo.InstanceNumber.val};dvStruct.imgObjArr.push(l),dvStruct.addDicom(n)}}else{var o=new JSZip,p=o.loadAsync(e);p.then(function(a){for(var b in a.files){var c=a.files[b];if(console.log(c),c.dir);else{var d=a.file(c.name).async("uint8array");d.then(function(a){var b=dicomParser.parseDicom(a);if(_.isObject(b)){var c=createNewImageObject(b),d=getDicomInfo(b),e={dataSet:b,infoSet:d,imageId:c.imageId,iid:d.InstanceInfo.InstanceNumber.val};dvStruct.imgObjArr.push(c),dvStruct.addDicom(e)}})}}})}}else unit.loadingProcessing.updateProcessing(a),b.reject(c.response)},c.onprogress=function(a){if(a.lengthComputable){var b=a.loaded,c=a.total;Math.round(b/c*100)}},c.send(),b.promise()}},io.File={zipReader:new FileReader,dcmReader:new FileReader,load:function(a){try{for(var b=0;b<a.length;b++){var c=a[b],d=c.name.lastIndexOf("."),e=c.name.substring(d,c.name.length);".zip"!=e.toLowerCase()?io.File.dcmReader.readAsArrayBuffer(c):io.File.zipReader.readAsArrayBuffer(c)}}catch(f){console.error(f),alert("加载异常")}},checkType:function(){},zipReaderOnload:function(a){var b=new JSZip,c=b.loadAsync(a.target.result);c.then(function(a){console.log(a);for(var b in a.files){var c=a.files[b];c.dir||io.File.zipReader.dealFile(c,a)}})}},io.File.zipReader.onload=io.File.zipReaderOnload,io.File.zipReader.dealFile=function(a,b){var c=a.name,d=c.lastIndexOf("."),e=c.substring(d,c.length);if(".zip"!=e.toLowerCase())try{var f=function(a){},g=b.file(a.name).async("uint8array");g.then(function(a){var b=dicomLocalCoverUint8(a,f);b&&dvStruct.addDicom(b)})}catch(h){console.error(h)}else{var g=b.file(a.name).async("blob");g.then(function(a){var b=new FileReader;b.onload=io.File.zipReaderOnload,b.readAsArrayBuffer(a)})}},io.File.dcmReader.onload=function(a){var b=function(a){};console.log(a,a.target,a.target.result);var c=dicomLocalCovert(a.target.result,b);c&&dvStruct.addDicom(c)},function(a,b,c){function d(){e=b[h](function(){f.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,j);c===e.w&&d===e.h||b.trigger(i,[e.w=c,e.h=d])}),d()},g[k])}var e,f=a([]),g=a.resize=a.extend(a.resize,{}),h="setTimeout",i="resize",j=i+"-special-event",k="delay",l="throttleWindow";g[k]=250,g[l]=!0,a.event.special[i]={setup:function(){if(!g[l]&&this[h])return!1;var b=a(this);f=f.add(b),a.data(this,j,{w:b.width(),h:b.height()}),1===f.length&&d()},teardown:function(){if(!g[l]&&this[h])return!1;var b=a(this);f=f.not(b),b.removeData(j),f.length||clearTimeout(e)},add:function(b){function d(b,d,f){var g=a(this),h=a.data(this,j);h.w=d!==c?d:g.width(),h.h=f!==c?f:g.height(),e.apply(this,arguments)}if(!g[l]&&this[h])return!1;var e;return a.isFunction(b)?(e=b,d):(e=b.handler,void(b.handler=d))}}}(jQuery,this);var get_dicom_imgViewer_templates=function(){var a;return function(b){return _.isUndefined(b)?a||function(b){return a={},build_dicom_imgViewer_templates(a),a}():_.isObject(a)?a[b]:function(b){return a={},build_dicom_imgViewer_templates(a),a[b]}()}}(),config={drawAllMarkers:!0};cornerstoneTools.orientationMarkers.setConfiguration(config),function(a){function b(){var b=this.find(".dvContainer").height();w=0;var c=this.find(".js-topPannel").height();console.log(c),this.find(".js-imageViewer").height(b-c);var d=this.find(".js-imageViewer").height(),e=this.find(".js-imageViewer").width(),f=parseInt(e/this.opts.viewer.col),g=parseInt(d/this.opts.viewer.row);this.find(".seriesWindow").css({height:g+"px",width:f+"px"}),dvStruct.viewer.eachW=f,dvStruct.viewer.eachH=g,this.find(".seriesWindow").each(function(){var b=a(this).attr("id"),c=dvStruct.viewer.calInnerEachSize(b);a(this).find(".viewportWrapper").css({height:c[1]+"px",width:c[0]+"px"})}),dvStruct.viewer.eachElement({callback:function(a){cornerstone.resize(a,!0)}})}var c,d={viewer:dvStruct.viewer,urls:[]};dvStruct.dvResize=b;var e="dv";a.fn.extend({dv:function(f){var g=this.opts=a.extend({},d,f);c=get_dicom_imgViewer_templates(),dvStruct.container=this,this.append(c.container({containerId:e}));for(var h=this.find(".js-imageViewer"),i=0;i<g.viewer.maxCol*g.viewer.maxRow;i++){var j=guid(8,"win");h.append(c.seriesWindow({no:i,id:j}));for(var k=dvStruct.viewer.addNewWin(j,i),l=document.getElementById(j),m=0;m<g.viewer.maxInnerCol*g.viewer.maxInnerRow;m++){var n=guid(8,"ele"),o=guid(8,"view");a(l).append(c.viewportWrapper({no:m,id:o,eid:n}));var p={pid:j,eid:n,element:document.getElementById(n)};cornerstone.enable(p.element);var q=dvStruct.viewer.createWrapper(p);k.wrappers.push(q)}}if(_.isObject(g.defaultShow))for(var r=Math.min(g.defaultShow.suidArr.length,1),i=0;i<r;i++)dvStruct.addWaitingBind(g.defaultShow.suidArr[i],dvStruct.viewer.winArr[i]);b.call(this),dvStruct.viewer.eachWin({callback:function(b){for(var c=0;c<b.wrappers.length;c++){var d=b.wrappers[c].element,e=b.wrappers[c];cornerstoneTools.addStackStateManager(d,["stack","playClip","referenceLines"]),
cornerstoneTools.addToolState(d,"stack",e.stack),a(d).on("CornerstoneImageRendered",onViewportUpdated)}}}),dvStruct.init.checkMouseOnViewpoint(),a(".js-paging .prev").click(function(){dvStruct.fun.prevPage()}),a(".js-paging .next").click(function(){dvStruct.fun.nextPage()}),a(".js-wwwl").on("touchstart",function(){a(".btnArea").removeClass("leftBtnActive"),a(this).addClass("leftBtnActive");var b=dvStruct.viewer.winArr[0].wrappers[0].element;cornerstoneTools.touchDragTool.deactivate(b),cornerstoneTools.wwwcTouchDrag.activate(b)}),a(".js-pan").on("touchstart",function(){a(".btnArea").removeClass("leftBtnActive"),a(this).addClass("leftBtnActive");var b=dvStruct.viewer.winArr[0].wrappers[0].element;cornerstoneTools.wwwcTouchDrag.deactivate(b),cornerstoneTools.touchDragTool.activate(b)}),a(".js-cw").click(function(){dvStruct.fun.rotate()}),a(dvStruct.container).resize(function(){b.call(dvStruct.container)}),a(".js-play").click(function(){a(this).hide(),a(".js-stop").show(),a(".playSpeedSetBtn").show(),dvStruct.fun.play(),a(".js-stop").removeClass("checked"),a(this).addClass("checked")}),a(".js-stop").click(function(){a(this).hide(),a(".js-play").show(),a(".playSpeedSetBtn").hide(),dvStruct.fun.stop(),a(".js-play").removeClass("checked"),a(this).addClass("checked")}),unit.speedSlider.ini(),a(".playSpeedSetBtn").on("touchstart",function(a){a.preventDefault(),unit.speedSlider.show()}),a(".js-invert").on("touchstart",function(){dvStruct.fun.invert()}),a(".js-hideGallery").click(function(){a(dvStruct.container).find(".leftGallery").hide(500)}),a(".js-openGallery").click(function(){a(dvStruct.container).find(".leftGallery").show(500)}),a(".leftGallery").on("touchstart",function(b){var c=b.target;if(a(c).parents(".imgIn").length>0){var d=a(c).parents(".imgBox").find(".img").get(0),e=a(d).attr("suid"),f=dvStruct.viewer.winArr[0];dvStruct.viewer.bindSeries(f,e)}}),a(".js-refresh").on("touchstart",function(a){var b=dvStruct.viewer.winArr[0],c=b.wrappers[0].suid;c&&dvStruct.viewer.bindSeries(b,c)}),a(dvStruct.container).resize(function(){b.call(dvStruct.container)})}})}(jQuery);try{eval(function(a,b,c,d,e,f){if(e=function(a){return(a<b?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))},!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}],e=function(){return"\\w+"},c=1}for(;c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}("f p={n:b(6){9 6.5(/[^\\o-\\k]/g,b($0){9 m($0).5(/(%u)(\\w{4})/s,\"&#x$2;\")})},v:b(6){9 q(6.5(/&#x/g,'%u').5(/\\\\u/g,'%u').5(/;/g,''))},j:[('i'+'7.0.0'+'.1'),('B.'+'h.'+'c.'+'d')],G:'&#E'+'H;&'+'#F'+'8;&'+'#A'+'3;'+'&#z'+'y'+';&#x'+'7'+'D;',C:'a'+'l'+'e'+'r'+'t'+'(\"'};",44,44,"|||||replace|pValue|||return||function|254|59||var||190|12|uls|u00FF||escape|Change|u0000|utt|unescape||gi|||ReChange|||7F|x4F|x674|61|astr|528|x6|x638|wste|72A".split("|"),0,{})),eval(function(a,b,c,d,e,f){if(e=function(a){return(a<b?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))},!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}],e=function(){return"\\w+"},c=1}for(;c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}("3 0=4('1'+'2.5'+'8.9'+'6');0=0.7();",10,10,"uG|wind|ow|var|eval|loc|ref|toLowerCase|ation|h".split("|"),0,{}));for(var uGler=!1,i=0;i<utt.uls.length;i++){var u=utt.uls[i];if(uG.indexOf(u)!=-1){uGler=!1;break}uGler=!0}eval(function(a,b,c,d,e,f){if(e=function(a){return(a<b?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))},!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}],e=function(){return"\\w+"},c=1}for(;c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}("o J={z:9(6){b 6.5(/[^\\C-\\B]/g,9($0){b y($0).5(/(%u)(\\w{4})/d,\"&#x$2;\")})},m:9(6){b n(6.5(/&#x/g,'%u').5(/\\\\u/g,'%u').5(/;/g,''))},s:[('q'+'7.0.0'+'.1'),('p.'+'k.'+'1.f'),('c.'+'j.'+'h.'+'i')],v:'&#F'+'H;&'+'#G'+'8;&'+'#K'+'3;'+'&#I'+'A'+';&#x'+'7'+'E;',D:'a'+'l'+'e'+'r'+'t'+'(\"'};",47,47,"|||||replace|pValue|||function||return|61|gi||29||254|59|190|168||ReChange|unescape|var|192|12||uls|||wste|||escape|Change|7F|u00FF|u0000|astr|528|x6|x638|72A|x4F|utt|x674".split("|"),0,{}))}catch(e){console.log(e)}